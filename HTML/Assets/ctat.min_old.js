/*
 MIT License - https://bitbucket.org/pellepim/jstimezonedetect/src/default/LICENCE.txt

 For usage and examples, visit:
 http://pellepim.bitbucket.org/jstz/

 Copyright (c) Jon Nylander
*/
var $jscomp={scope:{}};$jscomp.defineProperty="function"==typeof Object.defineProperties?Object.defineProperty:function(a,b,d){if(d.get||d.set)throw new TypeError("ES3 does not support getters and setters.");a!=Array.prototype&&a!=Object.prototype&&(a[b]=d.value)};$jscomp.getGlobal=function(a){return"undefined"!=typeof window&&window===a?a:"undefined"!=typeof global?global:a};$jscomp.global=$jscomp.getGlobal(this);$jscomp.SYMBOL_PREFIX="jscomp_symbol_";
$jscomp.initSymbol=function(){$jscomp.initSymbol=function(){};$jscomp.global.Symbol||($jscomp.global.Symbol=$jscomp.Symbol)};$jscomp.symbolCounter_=0;$jscomp.Symbol=function(a){return $jscomp.SYMBOL_PREFIX+(a||"")+$jscomp.symbolCounter_++};
$jscomp.initSymbolIterator=function(){$jscomp.initSymbol();var a=$jscomp.global.Symbol.iterator;a||(a=$jscomp.global.Symbol.iterator=$jscomp.global.Symbol("iterator"));"function"!=typeof Array.prototype[a]&&$jscomp.defineProperty(Array.prototype,a,{configurable:!0,writable:!0,value:function(){return $jscomp.arrayIterator(this)}});$jscomp.initSymbolIterator=function(){}};$jscomp.arrayIterator=function(a){var b=0;return $jscomp.iteratorPrototype(function(){return b<a.length?{done:!1,value:a[b++]}:{done:!0}})};
$jscomp.iteratorPrototype=function(a){$jscomp.initSymbolIterator();a={next:a};a[$jscomp.global.Symbol.iterator]=function(){return this};return a};$jscomp.makeIterator=function(a){$jscomp.initSymbolIterator();var b=a[Symbol.iterator];return b?b.call(a):$jscomp.arrayIterator(a)};$jscomp.arrayFromIterator=function(a){for(var b,d=[];!(b=a.next()).done;)d.push(b.value);return d};$jscomp.arrayFromIterable=function(a){return a instanceof Array?a:$jscomp.arrayFromIterator($jscomp.makeIterator(a))};
$jscomp.checkStringArgs=function(a,b,d){if(null==a)throw new TypeError("The 'this' value for String.prototype."+d+" must not be null or undefined");if(b instanceof RegExp)throw new TypeError("First argument to String.prototype."+d+" must not be a regular expression");return a+""};
$jscomp.polyfill=function(a,b,d,e){if(b){d=$jscomp.global;a=a.split(".");for(e=0;e<a.length-1;e++){var g=a[e];g in d||(d[g]={});d=d[g]}a=a[a.length-1];e=d[a];b=b(e);b!=e&&null!=b&&$jscomp.defineProperty(d,a,{configurable:!0,writable:!0,value:b})}};
$jscomp.polyfill("String.prototype.startsWith",function(a){return a?a:function(a,d){var b=$jscomp.checkStringArgs(this,a,"startsWith");a+="";for(var g=b.length,c=a.length,f=Math.max(0,Math.min(d|0,b.length)),h=0;h<c&&f<g;)if(b[f++]!=a[h++])return!1;return h>=c}},"es6-impl","es3");$jscomp.polyfill("String.prototype.includes",function(a){return a?a:function(a,d){return-1!==$jscomp.checkStringArgs(this,a,"includes").indexOf(a,d||0)}},"es6-impl","es3");
$jscomp.owns=function(a,b){return Object.prototype.hasOwnProperty.call(a,b)};
$jscomp.polyfill("WeakMap",function(a){function b(a){$jscomp.owns(a,e)||$jscomp.defineProperty(a,e,{value:{}})}function d(a){var c=Object[a];c&&(Object[a]=function(a){b(a);return c(a)})}if(function(){if(!a||!Object.seal)return!1;try{var c=Object.seal({}),b=Object.seal({}),d=new a([[c,2],[b,3]]);if(2!=d.get(c)||3!=d.get(b))return!1;d["delete"](c);d.set(b,4);return!d.has(c)&&4==d.get(b)}catch(l){return!1}}())return a;var e="$jscomp_hidden_"+Math.random().toString().substring(2);d("freeze");d("preventExtensions");
d("seal");var g=0,c=function(a){this.id_=(g+=Math.random()+1).toString();if(a){$jscomp.initSymbol();$jscomp.initSymbolIterator();a=$jscomp.makeIterator(a);for(var c;!(c=a.next()).done;)c=c.value,this.set(c[0],c[1])}};c.prototype.set=function(a,c){b(a);if(!$jscomp.owns(a,e))throw Error("WeakMap key fail: "+a);a[e][this.id_]=c;return this};c.prototype.get=function(a){return $jscomp.owns(a,e)?a[e][this.id_]:void 0};c.prototype.has=function(a){return $jscomp.owns(a,e)&&$jscomp.owns(a[e],this.id_)};c.prototype["delete"]=
function(a){return $jscomp.owns(a,e)&&$jscomp.owns(a[e],this.id_)?delete a[e][this.id_]:!1};return c},"es6-impl","es3");$jscomp.ASSUME_NO_NATIVE_MAP=!1;
$jscomp.polyfill("Map",function(a){if(!$jscomp.ASSUME_NO_NATIVE_MAP&&function(){if(!a||!a.prototype.entries||"function"!=typeof Object.seal)return!1;try{var c=Object.seal({x:4}),b=new a($jscomp.makeIterator([[c,"s"]]));if("s"!=b.get(c)||1!=b.size||b.get({x:4})||b.set({x:4},"t")!=b||2!=b.size)return!1;var f=b.entries(),d=f.next();if(d.done||d.value[0]!=c||"s"!=d.value[1])return!1;d=f.next();return d.done||4!=d.value[0].x||"t"!=d.value[1]||!f.next().done?!1:!0}catch(p){return!1}}())return a;$jscomp.initSymbol();
$jscomp.initSymbolIterator();var b=new WeakMap,d=function(a){this.data_={};this.head_=c();this.size=0;if(a){a=$jscomp.makeIterator(a);for(var b;!(b=a.next()).done;)b=b.value,this.set(b[0],b[1])}};d.prototype.set=function(a,c){var b=e(this,a);b.list||(b.list=this.data_[b.id]=[]);b.entry?b.entry.value=c:(b.entry={next:this.head_,previous:this.head_.previous,head:this.head_,key:a,value:c},b.list.push(b.entry),this.head_.previous.next=b.entry,this.head_.previous=b.entry,this.size++);return this};d.prototype["delete"]=
function(a){a=e(this,a);return a.entry&&a.list?(a.list.splice(a.index,1),a.list.length||delete this.data_[a.id],a.entry.previous.next=a.entry.next,a.entry.next.previous=a.entry.previous,a.entry.head=null,this.size--,!0):!1};d.prototype.clear=function(){this.data_={};this.head_=this.head_.previous=c();this.size=0};d.prototype.has=function(a){return!!e(this,a).entry};d.prototype.get=function(a){return(a=e(this,a).entry)&&a.value};d.prototype.entries=function(){return g(this,function(a){return[a.key,
a.value]})};d.prototype.keys=function(){return g(this,function(a){return a.key})};d.prototype.values=function(){return g(this,function(a){return a.value})};d.prototype.forEach=function(a,c){for(var b=this.entries(),d;!(d=b.next()).done;)d=d.value,a.call(c,d[1],d[0],this)};d.prototype[Symbol.iterator]=d.prototype.entries;var e=function(a,c){var d;d=c&&typeof c;"object"==d||"function"==d?b.has(c)?d=b.get(c):(d=""+ ++f,b.set(c,d)):d="p_"+c;var e=a.data_[d];if(e&&$jscomp.owns(a.data_,d))for(var g=0;g<
e.length;g++){var h=e[g];if(c!==c&&h.key!==h.key||c===h.key)return{id:d,list:e,index:g,entry:h}}return{id:d,list:e,index:-1,entry:void 0}},g=function(a,c){var b=a.head_;return $jscomp.iteratorPrototype(function(){if(b){for(;b.head!=a.head_;)b=b.previous;for(;b.next!=b.head;)return b=b.next,{done:!1,value:c(b)};b=null}return{done:!0,value:void 0}})},c=function(){var a={};return a.previous=a.next=a.head=a},f=0;return d},"es6-impl","es3");$jscomp.ASSUME_NO_NATIVE_SET=!1;
$jscomp.polyfill("Set",function(a){if(!$jscomp.ASSUME_NO_NATIVE_SET&&function(){if(!a||!a.prototype.entries||"function"!=typeof Object.seal)return!1;try{var b=Object.seal({x:4}),e=new a($jscomp.makeIterator([b]));if(!e.has(b)||1!=e.size||e.add(b)!=e||1!=e.size||e.add({x:4})!=e||2!=e.size)return!1;var g=e.entries(),c=g.next();if(c.done||c.value[0]!=b||c.value[1]!=b)return!1;c=g.next();return c.done||c.value[0]==b||4!=c.value[0].x||c.value[1]!=c.value[0]?!1:g.next().done}catch(f){return!1}}())return a;
$jscomp.initSymbol();$jscomp.initSymbolIterator();var b=function(a){this.map_=new Map;if(a){a=$jscomp.makeIterator(a);for(var b;!(b=a.next()).done;)this.add(b.value)}this.size=this.map_.size};b.prototype.add=function(a){this.map_.set(a,a);this.size=this.map_.size;return this};b.prototype["delete"]=function(a){a=this.map_["delete"](a);this.size=this.map_.size;return a};b.prototype.clear=function(){this.map_.clear();this.size=0};b.prototype.has=function(a){return this.map_.has(a)};b.prototype.entries=
function(){return this.map_.entries()};b.prototype.values=function(){return this.map_.values()};b.prototype[Symbol.iterator]=b.prototype.values;b.prototype.forEach=function(a,b){var d=this;this.map_.forEach(function(c){return a.call(b,c,c,d)})};return b},"es6-impl","es3");$jscomp.findInternal=function(a,b,d){a instanceof String&&(a=String(a));for(var e=a.length,g=0;g<e;g++){var c=a[g];if(b.call(d,c,g,a))return{i:g,v:c}}return{i:-1,v:void 0}};
$jscomp.polyfill("Array.prototype.find",function(a){return a?a:function(a,d){return $jscomp.findInternal(this,a,d).v}},"es6-impl","es3");$jscomp.array=$jscomp.array||{};$jscomp.iteratorFromArray=function(a,b){$jscomp.initSymbolIterator();a instanceof String&&(a+="");var d=0,e={next:function(){if(d<a.length){var g=d++;return{value:b(g,a[g]),done:!1}}e.next=function(){return{done:!0,value:void 0}};return e.next()}};e[Symbol.iterator]=function(){return e};return e};
$jscomp.polyfill("Array.prototype.keys",function(a){return a?a:function(){return $jscomp.iteratorFromArray(this,function(a){return a})}},"es6-impl","es3");$jscomp.polyfill("Number.isFinite",function(a){return a?a:function(a){return"number"!==typeof a?!1:!isNaN(a)&&Infinity!==a&&-Infinity!==a}},"es6-impl","es3");$jscomp.polyfill("Number.isInteger",function(a){return a?a:function(a){return Number.isFinite(a)?a===Math.floor(a):!1}},"es6-impl","es3");
$jscomp.polyfill("String.prototype.endsWith",function(a){return a?a:function(a,d){var b=$jscomp.checkStringArgs(this,a,"endsWith");a+="";void 0===d&&(d=b.length);for(var g=Math.max(0,Math.min(d|0,b.length)),c=a.length;0<c&&0<g;)if(b[--g]!=a[--c])return!1;return 0>=c}},"es6-impl","es3");$jscomp.polyfill("Number.isNaN",function(a){return a?a:function(a){return"number"===typeof a&&isNaN(a)}},"es6-impl","es3");
$jscomp.polyfill("Math.sign",function(a){return a?a:function(a){a=Number(a);return 0===a||isNaN(a)?a:0<a?1:-1}},"es6-impl","es3");$jscomp.polyfill("Array.prototype.findIndex",function(a){return a?a:function(a,d){return $jscomp.findInternal(this,a,d).i}},"es6-impl","es3");$jscomp.polyfill("Object.assign",function(a){return a?a:function(a,d){for(var b=1;b<arguments.length;b++){var g=arguments[b];if(g)for(var c in g)$jscomp.owns(g,c)&&(a[c]=g[c])}return a}},"es6-impl","es3");
$jscomp.polyfill("Array.prototype.values",function(a){return a?a:function(){return $jscomp.iteratorFromArray(this,function(a,d){return d})}},"es6","es3");$jscomp.polyfill("Number.MAX_SAFE_INTEGER",function(){return 9007199254740991},"es6-impl","es3");$jscomp.polyfill("Number.isSafeInteger",function(a){return a?a:function(a){return Number.isInteger(a)&&Math.abs(a)<=Number.MAX_SAFE_INTEGER}},"es6-impl","es3");
var jstz=function(){var a={"America/Denver":["America/Mazatlan"],"Europe/London":["Africa/Casablanca"],"America/Chicago":["America/Mexico_City"],"America/Asuncion":["America/Campo_Grande","America/Santiago"],"America/Montevideo":["America/Sao_Paulo","America/Santiago"],"Asia/Beirut":"Asia/Amman Asia/Jerusalem Europe/Helsinki Asia/Damascus Africa/Cairo Asia/Gaza Europe/Minsk".split(" "),"Pacific/Auckland":["Pacific/Fiji"],"America/Los_Angeles":["America/Santa_Isabel"],"America/New_York":["America/Havana"],
"America/Halifax":["America/Goose_Bay"],"America/Godthab":["America/Miquelon"],"Asia/Dubai":["Asia/Yerevan"],"Asia/Jakarta":["Asia/Krasnoyarsk"],"Asia/Shanghai":["Asia/Irkutsk","Australia/Perth"],"Australia/Sydney":["Australia/Lord_Howe"],"Asia/Tokyo":["Asia/Yakutsk"],"Asia/Dhaka":["Asia/Omsk"],"Asia/Baku":["Asia/Yerevan"],"Australia/Brisbane":["Asia/Vladivostok"],"Pacific/Noumea":["Asia/Vladivostok"],"Pacific/Majuro":["Asia/Kamchatka","Pacific/Fiji"],"Pacific/Tongatapu":["Pacific/Apia"],"Asia/Baghdad":["Europe/Minsk",
"Europe/Moscow"],"Asia/Karachi":["Asia/Yekaterinburg"],"Africa/Johannesburg":["Asia/Gaza","Africa/Cairo"]},b=function(a){a=-a.getTimezoneOffset();return null!==a?a:0},d=function(){var a=b(new Date(2014,0,2)),c=b(new Date(2014,5,2)),d=a-c;return 0>d?a+",1":0<d?c+",1,s":a+",0"},e=function(){var a;if("undefined"!==typeof Intl&&"undefined"!==typeof Intl.DateTimeFormat&&(a=Intl.DateTimeFormat(),"undefined"!==typeof a&&"undefined"!==typeof a.resolvedOptions&&(a=a.resolvedOptions().timeZone)&&(-1<a.indexOf("/")||
"UTC"===a)))return a},g=function l(a,c,b){"undefined"===typeof c&&(c=864E5,b=36E5);var d=(new Date(a.getTime()-c)).getTime();a=a.getTime()+c;for(var f=(new Date(d)).getTimezoneOffset(),e=null;d<a-b;){var g=new Date(d);if(g.getTimezoneOffset()!==f){e=g;break}d+=b}return 864E5===c?l(e,36E5,6E4):36E5===c?l(e,6E4,1E3):e},c=function(a,c,b,d){if("N/A"!==b)return b;if("Asia/Beirut"===c){if("Africa/Cairo"===d.name&&13983768E5===a[6].s&&14116788E5===a[6].e||"Asia/Jerusalem"===d.name&&13959648E5===a[6].s&&
14118588E5===a[6].e)return 0}else if("America/Santiago"===c){if("America/Asuncion"===d.name&&14124816E5===a[6].s&&1397358E6===a[6].e||"America/Campo_Grande"===d.name&&14136912E5===a[6].s&&13925196E5===a[6].e)return 0}else if("America/Montevideo"===c){if("America/Sao_Paulo"===d.name&&14136876E5===a[6].s&&1392516E6===a[6].e)return 0}else if("Pacific/Auckland"===c&&"Pacific/Fiji"===d.name&&14142456E5===a[6].s&&13961016E5===a[6].e)return 0;return b},f=function(b,d){for(var f={},e=jstz.olson.dst_rules.zones,
g=e.length,l=a[d],u=0;u<g;u++){var h=e[u],n;n=e[u];for(var C=0,r=0;r<b.length;r++)if(n.rules[r]&&b[r]){if(b[r].s>=n.rules[r].s&&b[r].e<=n.rules[r].e)C=0,C+=Math.abs(b[r].s-n.rules[r].s),C+=Math.abs(n.rules[r].e-b[r].e);else{C="N/A";break}if(864E6<C){C="N/A";break}}n=C=c(b,d,C,n);"N/A"!==n&&(f[h.name]=n)}for(var I in f)if(f.hasOwnProperty(I))for(e=0;e<l.length;e++)if(l[e]===I)return I;return d},h=function(a){var c=function(){for(var a=[],c=0;c<jstz.olson.dst_rules.years.length;c++){var b;b=jstz.olson.dst_rules.years[c];
var d=(new Date(b,0,1,0,0,1,0)).getTime();b=(new Date(b,12,31,23,59,59)).getTime();for(var f=(new Date(d)).getTimezoneOffset(),e=null,l=null;d<b-864E5;){var h=new Date(d),n=h.getTimezoneOffset();n!==f&&(n<f&&(e=h),n>f&&(l=h),f=n);d+=864E5}b=e&&l?{s:g(e).getTime(),e:g(l).getTime()}:!1;a.push(b)}return a}();return function(a){for(var c=0;c<a.length;c++)if(!1!==a[c])return!0;return!1}(c)?f(c,a):a};return{determine:function(){var c=e();c||(c=jstz.olson.timezones[d()],"undefined"!==typeof a[c]&&(c=h(c)));
return{name:function(){return c}}}}}();jstz.olson=jstz.olson||{};
jstz.olson.timezones={"-720,0":"Etc/GMT+12","-660,0":"Pacific/Pago_Pago","-660,1,s":"Pacific/Apia","-600,1":"America/Adak","-600,0":"Pacific/Honolulu","-570,0":"Pacific/Marquesas","-540,0":"Pacific/Gambier","-540,1":"America/Anchorage","-480,1":"America/Los_Angeles","-480,0":"Pacific/Pitcairn","-420,0":"America/Phoenix","-420,1":"America/Denver","-360,0":"America/Guatemala","-360,1":"America/Chicago","-360,1,s":"Pacific/Easter","-300,0":"America/Bogota","-300,1":"America/New_York","-270,0":"America/Caracas",
"-240,1":"America/Halifax","-240,0":"America/Santo_Domingo","-240,1,s":"America/Asuncion","-210,1":"America/St_Johns","-180,1":"America/Godthab","-180,0":"America/Argentina/Buenos_Aires","-180,1,s":"America/Montevideo","-120,0":"America/Noronha","-120,1":"America/Noronha","-60,1":"Atlantic/Azores","-60,0":"Atlantic/Cape_Verde","0,0":"UTC","0,1":"Europe/London","60,1":"Europe/Berlin","60,0":"Africa/Lagos","60,1,s":"Africa/Windhoek","120,1":"Asia/Beirut","120,0":"Africa/Johannesburg","180,0":"Asia/Baghdad",
"180,1":"Europe/Moscow","210,1":"Asia/Tehran","240,0":"Asia/Dubai","240,1":"Asia/Baku","270,0":"Asia/Kabul","300,1":"Asia/Yekaterinburg","300,0":"Asia/Karachi","330,0":"Asia/Kolkata","345,0":"Asia/Kathmandu","360,0":"Asia/Dhaka","360,1":"Asia/Omsk","390,0":"Asia/Rangoon","420,1":"Asia/Krasnoyarsk","420,0":"Asia/Jakarta","480,0":"Asia/Shanghai","480,1":"Asia/Irkutsk","525,0":"Australia/Eucla","525,1,s":"Australia/Eucla","540,1":"Asia/Yakutsk","540,0":"Asia/Tokyo","570,0":"Australia/Darwin","570,1,s":"Australia/Adelaide",
"600,0":"Australia/Brisbane","600,1":"Asia/Vladivostok","600,1,s":"Australia/Sydney","630,1,s":"Australia/Lord_Howe","660,1":"Asia/Kamchatka","660,0":"Pacific/Noumea","690,0":"Pacific/Norfolk","720,1,s":"Pacific/Auckland","720,0":"Pacific/Majuro","765,1,s":"Pacific/Chatham","780,0":"Pacific/Tongatapu","780,1,s":"Pacific/Apia","840,0":"Pacific/Kiritimati"};jstz.olson.dst_rules={years:[2008,2009,2010,2011,2012,2013,2014],zones:[{name:"Africa/Cairo",rules:[{e:12199572E5,s:12090744E5},{e:1250802E6,s:1240524E6},{e:12858804E5,s:12840696E5},!1,!1,!1,{e:14116788E5,s:1406844E6}]},{name:"Africa/Casablanca",rules:[{e:12202236E5,s:12122784E5},{e:12508092E5,s:12438144E5},{e:1281222E6,s:12727584E5},{e:13120668E5,s:13017888E5},{e:13489704E5,s:1345428E6},{e:13828392E5,s:13761E8},{e:14142888E5,s:14069448E5}]},{name:"America/Asuncion",rules:[{e:12050316E5,s:12243888E5},
{e:12364812E5,s:12558384E5},{e:12709548E5,s:12860784E5},{e:13024044E5,s:1317528E6},{e:1333854E6,s:13495824E5},{e:1364094E6,s:1381032E6},{e:13955436E5,s:14124816E5}]},{name:"America/Campo_Grande",rules:[{e:12032172E5,s:12243888E5},{e:12346668E5,s:12558384E5},{e:12667212E5,s:1287288E6},{e:12981708E5,s:13187376E5},{e:13302252E5,s:1350792E6},{e:136107E7,s:13822416E5},{e:13925196E5,s:14136912E5}]},{name:"America/Goose_Bay",rules:[{e:122559486E4,s:120503526E4},{e:125704446E4,s:123648486E4},{e:128909886E4,
s:126853926E4},{e:13205556E5,s:129998886E4},{e:13520052E5,s:13314456E5},{e:13834548E5,s:13628952E5},{e:14149044E5,s:13943448E5}]},{name:"America/Havana",rules:[{e:12249972E5,s:12056436E5},{e:12564468E5,s:12364884E5},{e:12885012E5,s:12685428E5},{e:13211604E5,s:13005972E5},{e:13520052E5,s:13332564E5},{e:13834548E5,s:13628916E5},{e:14149044E5,s:13943412E5}]},{name:"America/Mazatlan",rules:[{e:1225008E6,s:12074724E5},{e:12564576E5,s:1238922E6},{e:1288512E6,s:12703716E5},{e:13199616E5,s:13018212E5},{e:13514112E5,
s:13332708E5},{e:13828608E5,s:13653252E5},{e:14143104E5,s:13967748E5}]},{name:"America/Mexico_City",rules:[{e:12250044E5,s:12074688E5},{e:1256454E6,s:12389184E5},{e:12885084E5,s:1270368E6},{e:1319958E6,s:13018176E5},{e:13514076E5,s:13332672E5},{e:13828572E5,s:13653216E5},{e:14143068E5,s:13967712E5}]},{name:"America/Miquelon",rules:[{e:12255984E5,s:12050388E5},{e:1257048E6,s:12364884E5},{e:12891024E5,s:12685428E5},{e:1320552E6,s:12999924E5},{e:13520016E5,s:1331442E6},{e:13834512E5,s:13628916E5},{e:14149008E5,
s:13943412E5}]},{name:"America/Santa_Isabel",rules:[{e:12250116E5,s:1207476E6},{e:12564612E5,s:12389256E5},{e:12885156E5,s:12703752E5},{e:13199652E5,s:13018248E5},{e:13514148E5,s:13332744E5},{e:13828644E5,s:13653288E5},{e:1414314E6,s:13967784E5}]},{name:"America/Santiago",rules:[{e:1206846E6,s:1223784E6},{e:1237086E6,s:12552336E5},{e:127035E7,s:12866832E5},{e:13048236E5,s:13138992E5},{e:13356684E5,s:13465584E5},{e:1367118E6,s:13786128E5},{e:13985676E5,s:14100624E5}]},{name:"America/Sao_Paulo",rules:[{e:12032136E5,
s:12243852E5},{e:12346632E5,s:12558348E5},{e:12667176E5,s:12872844E5},{e:12981672E5,s:1318734E6},{e:13302216E5,s:13507884E5},{e:13610664E5,s:1382238E6},{e:1392516E6,s:14136876E5}]},{name:"Asia/Amman",rules:[{e:1225404E6,s:12066552E5},{e:12568536E5,s:12381048E5},{e:12883032E5,s:12695544E5},{e:13197528E5,s:13016088E5},!1,!1,{e:14147064E5,s:13959576E5}]},{name:"Asia/Damascus",rules:[{e:12254868E5,s:120726E7},{e:125685E7,s:12381048E5},{e:12882996E5,s:12701592E5},{e:13197492E5,s:13016088E5},{e:13511988E5,
s:13330584E5},{e:13826484E5,s:1364508E6},{e:14147028E5,s:13959576E5}]},{name:"Asia/Dubai",rules:[!1,!1,!1,!1,!1,!1,!1]},{name:"Asia/Gaza",rules:[{e:12199572E5,s:12066552E5},{e:12520152E5,s:12381048E5},{e:1281474E6,s:126964086E4},{e:1312146E6,s:130160886E4},{e:13481784E5,s:13330584E5},{e:13802292E5,s:1364508E6},{e:1414098E6,s:13959576E5}]},{name:"Asia/Irkutsk",rules:[{e:12249576E5,s:12068136E5},{e:12564072E5,s:12382632E5},{e:12884616E5,s:12697128E5},!1,!1,!1,!1]},{name:"Asia/Jerusalem",rules:[{e:12231612E5,
s:12066624E5},{e:1254006E6,s:1238112E6},{e:1284246E6,s:12695616E5},{e:131751E7,s:1301616E6},{e:13483548E5,s:13330656E5},{e:13828284E5,s:13645152E5},{e:1414278E6,s:13959648E5}]},{name:"Asia/Kamchatka",rules:[{e:12249432E5,s:12067992E5},{e:12563928E5,s:12382488E5},{e:12884508E5,s:12696984E5},!1,!1,!1,!1]},{name:"Asia/Krasnoyarsk",rules:[{e:12249612E5,s:12068172E5},{e:12564108E5,s:12382668E5},{e:12884652E5,s:12697164E5},!1,!1,!1,!1]},{name:"Asia/Omsk",rules:[{e:12249648E5,s:12068208E5},{e:12564144E5,
s:12382704E5},{e:12884688E5,s:126972E7},!1,!1,!1,!1]},{name:"Asia/Vladivostok",rules:[{e:12249504E5,s:12068064E5},{e:12564E8,s:1238256E6},{e:12884544E5,s:12697056E5},!1,!1,!1,!1]},{name:"Asia/Yakutsk",rules:[{e:1224954E6,s:120681E7},{e:12564036E5,s:12382596E5},{e:1288458E6,s:12697092E5},!1,!1,!1,!1]},{name:"Asia/Yekaterinburg",rules:[{e:12249684E5,s:12068244E5},{e:1256418E6,s:1238274E6},{e:12884724E5,s:12697236E5},!1,!1,!1,!1]},{name:"Asia/Yerevan",rules:[{e:1224972E6,s:1206828E6},{e:12564216E5,s:12382776E5},
{e:1288476E6,s:12697272E5},{e:13199256E5,s:13011768E5},!1,!1,!1]},{name:"Australia/Lord_Howe",rules:[{e:12074076E5,s:12231342E5},{e:12388572E5,s:12545838E5},{e:12703068E5,s:12860334E5},{e:13017564E5,s:1317483E6},{e:1333206E6,s:13495374E5},{e:13652604E5,s:1380987E6},{e:139671E7,s:14124366E5}]},{name:"Australia/Perth",rules:[{e:12068136E5,s:12249576E5},!1,!1,!1,!1,!1,!1]},{name:"Europe/Helsinki",rules:[{e:12249828E5,s:12068388E5},{e:12564324E5,s:12382884E5},{e:12884868E5,s:1269738E6},{e:13199364E5,
s:13011876E5},{e:1351386E6,s:13326372E5},{e:13828356E5,s:13646916E5},{e:14142852E5,s:13961412E5}]},{name:"Europe/Minsk",rules:[{e:12249792E5,s:12068352E5},{e:12564288E5,s:12382848E5},{e:12884832E5,s:12697344E5},!1,!1,!1,!1]},{name:"Europe/Moscow",rules:[{e:12249756E5,s:12068316E5},{e:12564252E5,s:12382812E5},{e:12884796E5,s:12697308E5},!1,!1,!1,!1]},{name:"Pacific/Apia",rules:[!1,!1,!1,{e:13017528E5,s:13168728E5},{e:13332024E5,s:13489272E5},{e:13652568E5,s:13803768E5},{e:13967064E5,s:14118264E5}]},
{name:"Pacific/Fiji",rules:[!1,!1,{e:12696984E5,s:12878424E5},{e:13271544E5,s:1319292E6},{e:1358604E6,s:13507416E5},{e:139005E7,s:1382796E6},{e:14215032E5,s:14148504E5}]},{name:"Europe/London",rules:[{e:12249828E5,s:12068388E5},{e:12564324E5,s:12382884E5},{e:12884868E5,s:1269738E6},{e:13199364E5,s:13011876E5},{e:1351386E6,s:13326372E5},{e:13828356E5,s:13646916E5},{e:14142852E5,s:13961412E5}]}]};(function(a,b){"object"==typeof module&&module.exports?module.exports=b():"function"==typeof define&&define.amd?define(b):a.Spinner=b()})(this,function(){function a(a,c){var b=document.createElement(a||"div"),d;for(d in c)b[d]=c[d];return b}function b(a){for(var c=1,b=arguments.length;c<b;c++)a.appendChild(arguments[c]);return a}function d(a,c,b,d){var f=["opacity",c,~~(100*a),b,d].join("-");b=.01+b/d*100;d=Math.max(1-(1-a)/c*(100-b),a);var e=p.substring(0,p.indexOf("Animation")).toLowerCase();n[f]||
(x.insertRule("@"+(e&&"-"+e+"-"||"")+"keyframes "+f+"{0%{opacity:"+d+"}"+b+"%{opacity:"+a+"}"+(b+.01)+"%{opacity:1}"+(b+c)%100+"%{opacity:"+a+"}100%{opacity:"+d+"}}",x.cssRules.length),n[f]=1);return f}function e(a,c){var b=a.style,d,f;c=c.charAt(0).toUpperCase()+c.slice(1);if(void 0!==b[c])return c;for(f=0;f<l.length;f++)if(d=l[f]+c,void 0!==b[d])return d}function g(a,c){for(var b in c)a.style[e(a,b)||b]=c[b];return a}function c(a){for(var c=1;c<arguments.length;c++){var b=arguments[c],d;for(d in b)void 0===
a[d]&&(a[d]=b[d])}return a}function f(a,c){return"string"==typeof a?a:a[c%a.length]}function h(a){this.opts=c(a||{},h.defaults,q)}function m(){function c(c,b){return a("<"+c+' xmlns="urn:schemas-microsoft.com:vml" class="spin-vml">',b)}x.addRule(".spin-vml","behavior:url(#default#VML)");h.prototype.lines=function(a,d){function e(){return g(c("group",{coordsize:u+" "+u,coordorigin:-h+" "+-h}),{width:u,height:u})}function l(a,l,u){b(v,b(g(e(),{rotation:360/d.lines*a+"deg",left:~~l}),b(g(c("roundrect",
{arcsize:d.corners}),{width:h,height:d.scale*d.width,left:d.scale*d.radius,top:-d.scale*d.width>>1,filter:u}),c("fill",{color:f(d.color,a),opacity:d.opacity}),c("stroke",{opacity:0}))))}var h=d.scale*(d.length+d.width),u=2*d.scale*h,m=-(d.width+d.length)*d.scale*2+"px",v=g(e(),{position:"absolute",top:m,left:m});if(d.shadow)for(m=1;m<=d.lines;m++)l(m,-2,"progid:DXImageTransform.Microsoft.Blur(pixelradius=2,makeshadow=1,shadowopacity=.3)");for(m=1;m<=d.lines;m++)l(m);return b(a,v)};h.prototype.opacity=
function(a,c,b,d){a=a.firstChild;d=d.shadow&&d.lines||0;a&&c+d<a.childNodes.length&&(a=(a=(a=a.childNodes[c+d])&&a.firstChild)&&a.firstChild)&&(a.opacity=b)}}var l=["webkit","Moz","ms","O"],n={},p,x,q={lines:12,length:7,width:5,radius:10,scale:1,corners:1,color:"#000",opacity:.25,rotate:0,direction:1,speed:1,trail:100,fps:20,zIndex:2E9,className:"spinner",top:"50%",left:"50%",shadow:!1,hwaccel:!1,position:"absolute"};h.defaults={};c(h.prototype,{spin:function(c){this.stop();var b=this,d=b.opts,f=
b.el=a(null,{className:d.className});g(f,{position:d.position,width:0,zIndex:d.zIndex,left:d.left,top:d.top});c&&c.insertBefore(f,c.firstChild||null);f.setAttribute("role","progressbar");b.lines(f,b.opts);if(!p){var e=0,l=(d.lines-1)*(1-d.direction)/2,h,u=d.fps,m=u/d.speed,v=(1-d.opacity)/(m*d.trail/100),n=m/d.lines;(function z(){e++;for(var a=0;a<d.lines;a++)h=Math.max(1-(e+(d.lines-a)*n)%m*v,d.opacity),b.opacity(f,a*d.direction+l,h,d);b.timeout=b.el&&setTimeout(z,~~(1E3/u))})()}return b},stop:function(){var a=
this.el;a&&(clearTimeout(this.timeout),a.parentNode&&a.parentNode.removeChild(a),this.el=void 0);return this},lines:function(c,e){function l(c,b){return g(a(),{position:"absolute",width:e.scale*(e.length+e.width)+"px",height:e.scale*e.width+"px",background:c,boxShadow:b,transformOrigin:"left",transform:"rotate("+~~(360/e.lines*h+e.rotate)+"deg) translate("+e.scale*e.radius+"px,0)",borderRadius:(e.corners*e.scale*e.width>>1)+"px"})}for(var h=0,u=(e.lines-1)*(1-e.direction)/2,m;h<e.lines;h++)m=g(a(),
{position:"absolute",top:1+~(e.scale*e.width/2)+"px",transform:e.hwaccel?"translate3d(0,0,0)":"",opacity:e.opacity,animation:p&&d(e.opacity,e.trail,u+h*e.direction,e.lines)+" "+1/e.speed+"s linear infinite"}),e.shadow&&b(m,g(l("#000","0 0 4px #000"),{top:"2px"})),b(c,b(m,l(f(e.color,h),"0 0 1px rgba(0,0,0,.1)")));return c},opacity:function(a,c,b){c<a.childNodes.length&&(a.childNodes[c].style.opacity=b)}});if("undefined"!==typeof document){x=function(){var c=a("style",{type:"text/css"});b(document.getElementsByTagName("head")[0],
c);return c.sheet||c.styleSheet}();var v=g(a("group"),{behavior:"url(#default#VML)"});!e(v,"transform")&&v.adj?m():p=e(v,"animation")}return h});var CTATConfig={Options:{},addProperty:function(a,b,d,e){d=d||b[0];Object.defineProperty(CTATConfig,a,{enumerable:!0,configurable:!1,writable:!e,value:d.toLowerCase()});var g={};b.forEach(function(c){g[c]=c.toLowerCase();Object.defineProperty(CTATConfig,a+"_is_"+c,{enumerable:!1,writable:!1,value:function(){return CTATConfig[this.prop].toLowerCase()==this.val}.bind({prop:a,val:g[c]})})});CTATConfig.Options[a]=g}};CTATConfig.addProperty("platform",["CTAT","Google","Undefined"],"CTAT",!0);
CTATConfig.addProperty("external",["Google","LTI","SCORM","None"],"None");CTATConfig.addProperty("parserType",["XML","JSON"],"XML");"undefined"!==typeof module&&(module.exports=CTATConfig);var CTATGlobals={tutorRunning:!1,Tab:{Tracker:1,Focus:null,previousFocus:null},NameSpace:{svg:"http://www.w3.org/2000/svg",xml:"http://www.w3.org/2000/xmlns/",xlink:"http://www.w3.org/1999/xlink",ev:"http://www.w3.org/2001/xml-events",mathml:"http://www.w3.org/1998/Math/MathML"},EncodedParams:{authenticity_token:"authenticity_token",info:"info",question_file:"question_file",skills:"skills"},CommDisabled:!1,orientation:"portrait",ignoreInterfaceDescriptions:!0},useDebugging;
void 0===useDebugging&&(useDebugging=!1);var useDebuggingBasic;void 0===useDebuggingBasic&&(useDebuggingBasic=!1);var version="4.4.0",ctatcontainer="container",movieclips=[],canvasCalibrate=5,flashVars=null,mobileAPI=null,aVars=null;CTATGlobals.interfaceElement=null;var commMessageHandler=CTATGlobals.selectedTextInput=null,commLoggingLibrary=null,logHintSAI=null,nameTranslator=null,hints=[],hintIndex=0,caseInsensitive=!0,unordered=!0,lockWidget=!0,highlightRightSelection=!0;
CTATGlobals.suppressStudentFeedback=!1;CTATGlobals.confirmDone=!1;var incompatibleBrowserMessage="Your browser does not support CTAT. Please update or replace your browser.";var CTATSandboxDriver={};function getSafeElementById(a){return document.getElementById(a)};var CTATGlobalFunctions={};function unhighlightall(a){if(CTATShellTools.component_descriptions){a=CTATShellTools.getAllComponents();for(var b=0;b<a.length;b++){var d=a[b];d.setHintHighlight&&d.setHintHighlight(!1,null)}}}CTATGlobalFunctions.stringToBoolean=function(a){switch(String(a).toLowerCase()){case "true":case "yes":case "1":return!0;case "false":case "no":case "0":case "":case null:return!1;default:return!!a}};
CTATGlobalFunctions.isInstructorMode=function(){var a=flashVars?flashVars.getRawFlashVars():null;return a&&a.deliverymode?"delivery"==a.deliverymode?!1:!0:!1};CTATGlobalFunctions.getLoggingLibrary=function(a){null==commLoggingLibrary&&(commLoggingLibrary=new CTATLoggingLibrary(!0));return commLoggingLibrary};CTATGlobalFunctions.setPreviewMode=function(a,b){CTATGlobalFunctions.isCTATObject(a)?a.setPreviewMode(b):a.previewMode=b};
CTATGlobalFunctions.setCenterTutor=function(a,b){CTATGlobalFunctions.isCTATObject(a)?a.setCenterTutor(b):a.centerTutor=b};CTATGlobalFunctions.setTutorWidth=function(a,b){CTATGlobalFunctions.isCTATObject(a)?a.setTutorWidth(b):a.width=b};CTATGlobalFunctions.setTutorHeight=function(a,b){CTATGlobalFunctions.isCTATObject(a)?a.setTutorHeight(b):a.height=b};CTATGlobalFunctions.setTutorDimensions=function(a,b,d){CTATGlobalFunctions.isCTATObject(a)?a.setTutorDimensions(b,d):(a.width=b,a.height=d)};
CTATGlobalFunctions.setTutorValue=function(a,b,d){CTATGlobalFunctions.isCTATObject(a)?a.setTutorValue(b,d):a[b]=d};CTATGlobalFunctions.setCommunicationMode=function(a,b){CTATGlobalFunctions.isCTATObject(a)?a.setCommunicationMode(b):a.tutoring_service_communication=b};CTATGlobalFunctions.setRemoteSocketURL=function(a,b){CTATGlobalFunctions.isCTATObject(a)?a.setRemoteSocketURL(b):a.remoteSocketURL=b};
CTATGlobalFunctions.setRemoteSocketPort=function(a,b){CTATGlobalFunctions.isCTATObject(a)?a.setRemoteSocketPort(b):a.remoteSocketPort=b};CTATGlobalFunctions.setProblemSummary=function(a){};CTATGlobalFunctions.isCTATObject=function(a){return"object"==typeof testConfig&&testConfig.getClassName?!0:!1};CTATGlobalFunctions.getCTATClassname=function(a){return"object"==typeof testConfig&&testConfig.getClassName?testConfig.getClassName():"object"};
CTATGlobalFunctions.toBoolean=function(a){return"boolean"===typeof a?a:"string"===typeof a?CTATGlobalFunctions.stringToBoolean(a):"number"===typeof a?0<a:a?!0:!1};function noenter(a){if(CTATConfig.platform_is_Google())return 0;a=a||window.event;return 13!==(a.keyCode||a.charCode)}CTATGlobalFunctions.isBlank=function(a){return!a||/^\s*$/.test(a)};function componentToHex(a){a=a.toString(16);return 1==a.length?"0"+a:a}
function rgbToHex(a,b,d){return"#"+componentToHex(a)+componentToHex(b)+componentToHex(d)}function hexToRgb(a){return(a=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(a))?{r:parseInt(a[1],16),g:parseInt(a[2],16),b:parseInt(a[3],16)}:null}
function parseQueryStringArgs(a){ctatdebug("parseQueryStringArgs ()");ctatdebug("Query String: "+a);var b="?"==a.charAt(0)?a.substring(1):a;a={};if(b)for(var b=b.split("&"),d=0;d<b.length;d++){var e=b[d].split("=");a[decodeURIComponent(e[0])]=decodeURIComponent(e[1].replace(/\+/g," "))}return a}
function setOrientation(a){ctatdebug("setOrientation ("+a+")");switch(a){case -90:case 90:mobileAPI&&mobileAPI.processOrientationChange("landscape");break;default:mobileAPI&&mobileAPI.processOrientationChange("portrait")}}Object.hasOwnProperty("create")||(Object.create=function(){function a(){}return function(b){if(1!=arguments.length)throw Error("Object.create implementation only accepts one parameter.");a.prototype=b;return new a}}());
function thisMovie(a){return-1!=navigator.appName.indexOf("Microsoft")?window[a]:document[a]}function introspect(a,b,d,e){d=d||"";"number"!==this.typeOf(e)&&(e=1);var g=this.typeOf(b);a=[d,a," ",g," :"].join("");if("object"===g){if(0<e){d=[d,"  "].join("");for(var c in b)g=this.introspect(c,b[c],d,e-1),a=[a,"\n",g].join("");return a}return[a," ..."].join("")}return"null"===g?[a," null"].join(""):[a," ",b].join("")}
function findPointOfAttachment(a){ctatdebug("findPointOfAttachment ("+a+")");for(var b=0;b<movieclips.length;b++){var d=movieclips[b];ctatdebug("Examining: "+d.getName()+"...");if(!0===d.isRegistered(a))return d}return null}function findMovieClip(a){a=a.trim();ctatdebug("findMovieClip ("+a.trim()+")");for(var b=0;b<movieclips.length;b++){var d=movieclips[b];ctatdebug("Examining: "+d.getName()+"...");if(d.getName()==a)return d}return null}
function colName(a,b){ctatdebug("colName ("+a+")");for(var d="";0<=a;)d=String.fromCharCode(a%26+97)+d,a=Math.floor(a/26)-1;!0===b&&d.toUpperCase();return d}function selectText(a){}function urldecode(a){return decodeURIComponent((""+a).replace(/\+/g,"%20"))}function detectIE(){var a=window.navigator.userAgent,b=a.indexOf("MSIE "),d=a.indexOf("Trident/");return 0<b?parseInt(a.substring(b+5,a.indexOf(".",b)),10):0<d?(b=a.indexOf("rv:"),parseInt(a.substring(b+3,a.indexOf(".",b)),10)):!1}
function listProperties(a){ctatdebug("listProperties (l: "+a.length+")");for(var b in a)ctatdebug("["+b+"]")}function listPropertiesKV(a,b){ctatdebug("listPropertiesKV (size: "+a.length+")");if(1==b)for(var d=0;d<a.length;d++)ctatdebug("["+d+"]: "+a[d]);else for(d in a)ctatdebug("["+d+"]: "+a[d])}function listAllDivAttributes(a){ctatdebug("listAllDivAttributes ()");var b=0;a=a.attributes;for(var d=a.length;b<d;b++)pointer.ctatdebug("Attribute: "+a[b].nodeName+", with value: "+a[b].nodeValue)}
var getBackgroundDimensions=function(a){ctatdebug("Using url: "+$(a).css("background-image"));var b=new Image;b.src=$(a).css("background-image").replace(/url\(|\)$|"/ig,"");return b.width+" "+b.height},getBackgroundWidth=function(a){ctatdebug("Using url: "+$(a).css("background-image"));var b=new Image;b.src=$(a).css("background-image").replace(/url\(|\)$|"/ig,"");return b.width},getBackgroundHeight=function(a){ctatdebug("Using url: "+$(a).css("background-image"));var b=new Image;b.src=$(a).css("background-image").replace(/url\(|\)$|"/ig,
"");return b.height};function getIndicesOf(a,b,d){var e=0,g=a.length,c=[];d||(b=b.toLowerCase(),a=a.toLowerCase());for(;-1<(d=b.indexOf(a,e));)c.push(d),e=d+g;return c}CTATGlobalFunctions.formatColor=function(a){if(/^#[0-9a-f]{6}$/i.test(a))return a;var b=a.match(/rgb\s*\(\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*\)/i);if(null!==b)return rgbToHex(Number(b[1]),Number(b[2]),Number(b[3]));b=a.match(/^#?([0-9a-f]{0,6})$/i);if(null!==b){for(a=b[1];6>a.length;)a="0"+a;return"#"+a}return a};
CTATGlobalFunctions.Gensym=function(){this.make_gensym=function(){var a="",b=0;return{set_prefix:function(b){a=String(b)},set_index:function(a){b=a},gensym:function(){var d=a+b;b+=1;return d}}};var a=this.make_gensym();a.set_index(2);var b=this.make_gensym();b.set_index(1);b.set_prefix("ctatdiv");return{z_index:a.gensym,div_id:b.gensym}};CTATGlobalFunctions.gensym=CTATGlobalFunctions.Gensym();var CTATBase=function(a,b){function d(a,c,b){null===a&&(a="unknownclass");null===c&&(c="nullinstance");return"["+a+":"+c+"] "+b}var e=a,g=b,c=this,f=!0;"undefined"!=CTATBase.DebuggingFilter[e]&&CTATBase.DebuggingFilter[e]&&(f=!1);this.getClassName=function(){return e};this.getClassname=function(){return e};this.setClassName=function(a){e=a};this.setName=function(a){g=a};this.getName=function(){return g};this.getUseDebugging=function(){return useDebugging};this.setUseDebugging=function(a){useDebugging=
a};this.toHHMMSS=function(a){var c=parseInt(a,10);a=Math.floor(c/3600);var b=Math.floor((c-3600*a)/60),c=c-3600*a-60*b;10>a&&(a="0"+a);10>b&&(b="0"+b);10>c&&(c="0"+c);return a+":"+b+":"+c};this.ctatdebug=function(a){if(f){var b=a;useDebuggingBasic?c.ctatdebugInternal(b,"UnknownClass"):(null===a&&(b="No message provided"),useDebugging&&c.ctatdebugInternal(b,c.getClassName()))}};this.ctatdebugObject=function(a){var c=0,b;for(b in a)this.ctatdebug("("+c+")"+b+": "+a[b]),c++};this.ctatdebugInternal=function(a,
b){var f=a;if(null===f||void 0===f)f="No message!";""===f&&(f="Empty message!");if(useDebuggingBasic)f=d("Unknown","undefined",f),CTATBase.customconsole||(CTATBase.customconsole=getSafeElementById("customconsole")),CTATBase.customconsole?(CTATBase.customconsole.innerHTML+=f+"<br>",CTATBase.customconsole.scrollTop=CTATBase.customconsole.scrollHeight):console.log(f);else{null===b&&(b="UndefinedClass");null===f&&(f="No message");f=d(b,c.getName(),f);try{console.trace(f)}catch(n){}"google"==CTATConfig.platform?
Logger.log(f):(CTATBase.customconsole||(CTATBase.customconsole=getSafeElementById("customconsole")),null!==CTATBase.customconsole&&(CTATBase.customconsole.innerHTML+=f+"<br>",CTATBase.customconsole.scrollTop=CTATBase.customconsole.scrollHeight))}};this.ctatdebugObjectShallow=function(a){var b="",d;for(d in a)b+=d+", ";c.ctatdebugInternal("Object: "+b,"Global")};this.urldecode=function(a){return decodeURIComponent((a+"").replace(/\+/g,"%20"))};this.entitiesConvert=function(a){this.ctatdebug("entitiesConvert ()");
return this.urldecode(unescape(a))};this.entitiesGenerate=function(a){return a}};function formatLogMessageGoogle(a,b,d){d=(new CTATBase(a,b)).htmlEncode(d);return"["+a+":"+b+"] "+d}function ctatdebug(a){(useDebugging||useDebuggingBasic)&&null!==a&&("google"==CTATConfig.platform?Logger.log(formatLogMessageGoogle("CTATTutor","tutor",a)):(ctatdebug.debugPointer||(ctatdebug.debugPointer=new CTATBase("CTATTutor","tutor")),ctatdebug.debugPointer.ctatdebug(a,"CTATTutor")))}
Object.defineProperty(CTATBase,"DebuggingFilter",{enumerable:!1,configurable:!1,writable:!0,value:[]});"undefined"!==typeof module&&(module.exports=CTATBase);var CTATProblem=function(){CTATBase.call(this,"CTATProblem","problem");var a="",b="",d="tutor",e="",g="",c="notstarted";this.setState=function(a){c=a};this.getState=function(){return c};this.setLabel=function(c){a=c};this.getLabel=function(){return a};this.setDescription=function(a){b=a};this.getDescription=function(){return b};this.setTutorFlag=function(a){d=a};this.getTutorFlag=function(){return d};this.setProblemFile=function(a){e=a};this.getProblemFile=function(){return e};this.setStudentInterface=
function(a){g=a};this.getStudentInterface=function(){return g}};CTATProblem.prototype=Object.create(CTATBase.prototype);CTATProblem.prototype.constructor=CTATProblem;var CTATProblemSet=function(){CTATBase.call(this,"CTATProblemSet","problemset");var a=this,b=[];this.addProblem=function(a){b.push(a)};this.getProblems=function(){return b};this.getProblemSize=function(){return b.length};this.getFirstProblem=function(){a.ctatdebug("getFirstProblem () problems.length "+b.length);return 0==b.length?null:b[0]}};CTATProblemSet.prototype=Object.create(CTATBase.prototype);CTATProblemSet.prototype.constructor=CTATProblemSet;var CTATXML=function(){CTATBase.call(this,"CTATXML","xmlparser");this.parse=function(a){return this.parseXML(a)};this.parseXML=function(a){this.ctatdebug("parseXML ()");var b=null;try{"undefined"!==typeof $?b=$.parseXML(a):"undefined"!==typeof XMLParser?b=(new XMLParser).parseFromString(a):this.ctatdebug("Bottoming out, no parser configured!")}catch(d){return null!=b?this.ctatdebug("JQuery could not process the provided XML: "+d.message+" ("+b.parseError.errorCode+") ("+b.parseError.reason+") ("+
b.parseError.line+")"):this.ctatdebug("JQuery could not process the provided XML (xmlDoc==null): "+d.message),null}return null==b?(this.ctatdebug("Unspecified error parsing xml message. xmlDoc is null"),null):b.documentElement};this.getElementName=function(a){return a.nodeName};this.getElementValue=function(a){return a.nodeValue};this.getElementChildren=function(a){for(var b=[],d=0;d<a.childNodes.length;d++)1==a.childNodes[d].nodeType&&b.push(a.childNodes[d]);return b};this.getNodeTextValue=function(a){if(null==
a)return"";if(null==a.childNodes)return a.nodeValue;if(0==a.childNodes.length)return"";for(var b=a.childNodes,d=0;d<b.length;d++){var e=b[d];if("value"==e.nodeName||"Value"==e.nodeName){if(1==e.childNodes.length)return e.childNodes[0].nodeValue;if(0==e.childNodes.length)break;else return e.childNodes[1].nodeValue}}return a.childNodes[0].nodeValue};this.getElementAttr=function(a,b){if(!a.attributes)return this.ctatdebug("Warning: Element "+a.nodeName+" does not have any attributes"),"";for(var d=0;d<
a.attributes.length;d++)if(a.attributes[d].nodeName==b)return a.attributes[d].nodeValue;return""};this.listElementAttr=function(a){this.ctatdebug("Listing "+a.attributes.length+" attributes for element "+a.nodeName+" ...");for(var b=0;b<a.attributes.length;b++)this.ctatdebug(b+" name: "+a.attributes[b].nodeName+", value: "+a.attributes[b].nodeValue)};this.stringify=function(a){return this.xmlToString(a)};this.xmlToString=function(a){this.ctatdebug("xmlToString ()");return null==a?(this.ctatdebug("Error: xml data is null"),
null):(new XMLSerializer).serializeToString(a)}};CTATXML.prototype=Object.create(CTATBase.prototype);CTATXML.prototype.constructor=CTATXML;"undefined"!==typeof module&&(module.exports=CTATXML);var CTATPackage=function(){CTATBase.call(this,"CTATPackage","packagemanager");var a=this,b=new CTATXML,d=new CTATProblemSet,e=[d];this.init=function(e){a.ctatdebug("init ()");if(null==e)a.ctatdebug("Error: document root to be parsed is null.");else{a.ctatdebug("Root name: "+b.getElementName(e));e=b.getElementChildren(e);for(var c=0;c<e.length;c++){var f=e[c],g=b.getElementName(f);a.ctatdebug("Examining element: "+b.getElementName(f));if("Problems"==g){a.ctatdebug("Processing Problems ...");for(var f=
b.getElementChildren(f),m=0;m<f.length;m++){var l=f[m];a.ctatdebug("Problem ["+m+"] desc: "+b.getElementAttr(l,"description")+", interface: "+b.getElementAttr(l,"student_interface")+", brd: "+b.getElementAttr(l,"problem_file"));var n=new CTATProblem;n.setName(b.getElementAttr(l,"name"));n.setLabel(b.getElementAttr(l,"label"));n.setDescription(b.getElementAttr(l,"description"));n.setTutorFlag(b.getElementAttr(l,"tutor_flag"));n.setProblemFile(b.getElementAttr(l,"problem_file"));n.setStudentInterface(b.getElementAttr(l,
"student_interface"));a.ctatdebug("Adding problem ...");d.addProblem(n)}}"ProblemSets"==g&&a.ctatdebug("Processing ProblemSets ...");"Assets"==g&&a.ctatdebug("Processing Assets ...")}}};this.getProblems=function(){return d};this.getProblemSets=function(){return e}};CTATPackage.prototype=Object.create(CTATBase.prototype);CTATPackage.prototype.constructor=CTATPackage;var CTATConnectionBase=function(a,b){CTATBase.call(this,"CTATConnectionBase","ctatconnection");var d=-1,e="",g="http";this.setURL=function(a){e=a};this.getURL=function(){return e};this.setID=function(a){d=a};this.getID=function(){return d};this.setSocketType=function(a){g=a};this.getSocketType=function(){return g}};CTATConnectionBase.prototype=Object.create(CTATBase.prototype);CTATConnectionBase.prototype.constructor=CTATConnectionBase;var CTATConnection=function(a){function b(){f.ctatdebug("init ()");var a=flashVars?flashVars.getRawFlashVars():d,a=a.session_id?a.session_id:"dummySession";if(null!==e){"dummySession"==a&&f.ctatdebug("Unable to find CTAT session information from environment, trying OLI ...");try{e.setRequestHeader("Content-type",g.contentType),e.setRequestHeader("ctatsession",a)}catch(l){alert("HTTP object creation error: "+l.message)}}else"undefined"==typeof $?alert("Internal error: http object is null right after creation"):
g.headers.ctatsession=a;f.ctatdebug("init () done")}CTATConnectionBase.call(this,"CTATConnection");var d=a,e=null,g={contentType:"text/plain",data:null,processData:!1,method:"POST",mimeType:"text/html",headers:{}},c=!1,f=this,h=null;f.setSocketType("http");this.setContentType=function(a){g.contentType=a};this.getContentType=function(){return g.contentType};this.setConsumed=function(a){c=a;f.ctatdebug("consumed: "+c)};this.getConsumed=function(){f.ctatdebug("consumed: "+c);return c};this.assignReceiveFunction=
function(a){h=a;e&&"undefined"!=typeof e.onreadystatechange&&(e.onreadystatechange=a)};this.assignFailFunction=function(a){g.error=a;e&&"function"==typeof e.error&&e.error(a)};this.setData=function(a){g.data=a};this.getData=function(){return g.data};this.getHTTPObject=function(){return e};this.getMethod=function(){return g.method};this.setMethod=function(a){g.method=a};this.send=function(){f.ctatdebug("send ()");var a=f.getHTTPObject(),c=function(){f.ctatdebug("Networking error!")};a&&(a.onerror=
c);try{a&&a.open(f.getMethod(),f.getURL(),!0)}catch(n){f.ctatdebug("Error in newConnection.httpObject.open: "+n.message);return}b();try{"undefined"!=typeof $?e=a=$.ajax(f.getURL(),g).done(h).fail(c):g.data?a.send(g.data):a.send()}catch(n){this.ctatdebug("Error in newConnection.httpObject.send: "+n.message)}};this.then=function(a,c){var b=e&&"function"==typeof e.then;f.ctatdebug("CTATConnection.then() supported "+b+", done & fail:\n  "+a+",\n  "+c);return b?e.then(a,c):{then:function(){console.log("CTATConnection.then() not supported")}}};
f.ctatdebug("createHTTPObject ()");e=new XMLHttpRequest;if("undefined"!=typeof $)e=null;else if(window.XMLHttpRequest)f.ctatdebug("Creating regular XMLHttpRequest ..."),e=new XMLHttpRequest,e.overrideMimeType&&e.overrideMimeType("text/html");else if(f.ctatdebug("Trying alternative HTTP object creation ..."),window.ActiveXObject){f.ctatdebug("Detected window.ActiveXObject ...");try{f.ctatdebug("Creating Msxml2.XMLHTTP ..."),e=new ActiveXObject("Msxml2.XMLHTTP")}catch(m){try{f.ctatdebug("Creating Microsoft.XMLHTTP ..."),
e=new ActiveXObject("Microsoft.XMLHTTP")}catch(l){alert("Error: Unable to create HTTP Request Object: "+l.message)}}}else alert("Internal error: an HTTP connection object could not be created")};CTATConnection.prototype=Object.create(CTATConnectionBase.prototype);CTATConnection.prototype.constructor=CTATConnection;var CTATWSConnection=function(a){CTATConnectionBase.call(this,"CTATWSConnection");var b="",d=!1,e=this,g=null,c=[],f=!1,h=0,m=0,l=null,n=null;e.setSocketType("ws");this.setConsumed=function(a){d=a;e.ctatdebug("consumed: "+d)};this.getConsumed=function(){e.ctatdebug("consumed: "+d);return d};this.assignReceiveFunction=function(a){l=a};this.assignCloseFunction=function(a){n=a};this.setData=function(a){b=a};this.getData=function(){return b};this.init=function(){ctatdebug("init ("+e.getURL()+"); websocket "+
g);null==g&&(g=new WebSocket(e.getURL()),g.addEventListener("open",function(a){ctatdebug("STATUS: open");f=!0;ctatdebug("Connection open, flushing outgoing queue ...");h=(new Date).getTime();if(0<c.length){for(a=0;a<c.length;a++)g.send(c[a]);c=[]}}),g.addEventListener("message",function(a){m=(new Date).getTime();ctatdebug("STATUS: message after "+(m-h)+" ms");ctatdebug("Received: "+a.data);l?l(a.data):ctatdebug("Error: no processing function provided")}),g.addEventListener("close",function(a){ctatdebug("STATUS: close; "+
(a?"code "+a.code+", reason "+a.reason:"no event"));f=!1;g.close(1E3,a?a.reason?a.reason:"received close code "+a.code:"no close event received");n&&n(a)}),g.addEventListener("error",function(a){ctatdebug("STATUS: error; "+(a?a.type:"no event"));f=!1;g.close(1E3,"client closing in response to error")}),ctatdebug("init () done"))};this.send=function(){ctatdebug("send ()");e.init();!1===f?(ctatdebug("Connection not ready yet, storing ..."),c.push(b)):(ctatdebug("Connection ready, sending data ..."),
h=(new Date).getTime(),g.send(b))};this.getWebSocket=function(){return g};this.close=function(a,c){f=!1;n=c||n;g.close(1E3,a||"no reason")}};CTATWSConnection.prototype=Object.create(CTATConnectionBase.prototype);CTATWSConnection.prototype.constructor=CTATWSConnection;var CTATCanvasComponent=function(a){var b=this,d=[];this.addShape=function(a){d.push(a)};this.hideShape=function(a){for(var b=0;b<d.length;b++)if(d[b].getName()==a){d[b].modifyCanvasCSS("visibility","hidden");break}};this.showShape=function(a){for(var b=0;b<d.length;b++)if(d[b].getName()==a){d[b].modifyCanvasCSS("visibility","visible");break}};this.hideComponent=function(){for(var a=0;a<d.length;a++)d[a].modifyCanvasCSS("visibility","hidden")};this.showComponent=function(){for(var a=0;a<d.length;a++)d[a].modifyCanvasCSS("visibility",
"visible")};this.moveShape=function(a,b,c){for(var f=0;f<d.length;f++)if(d[f].getName()==a){d[f].modifyCanvasCSS("left",b+"px");d[f].modifyCanvasCSS("top",c+"px");break}};this.moveComponent=function(a,b){for(var c=0;c<d.length;c++)d[c].modifyCanvasCSS("left",a+"px"),d[c].modifyCanvasCSS("top",b+"px")};this.removeShape=function(a){for(var b=0,c=0;c<d.length;c++)if(d[c].getName()==a){b=c;break}d[b].detatchCanvas();d.splice(b,1)};this.removeComponent=function(){for(;0<d.length;)b.removeShape(d[0].getName())}};var CTATDefaultLanguagePack={HORIZONTAL:"LR",VERTICAL:"TB",LOADING:"Please wait while the tutor is being loaded",NEXTPROBLEM:"Retrieving the Next Problem...",CONGRATULATIONS_YOU_ARE_DONE:"Congratulations, you are done with this problem.",SURE_YOU_ARE_DONE:"Are you sure you are done?",TUTORDISCONNECTED:"The tutor has disconnected. Please refresh the page.",OUTOFORDER:"You need to do other steps first, before doing the step you just worked on. You might request a hint for more help.",DONE:"Done",HINT:"Hint",
NEXT:"Next",PREVIOUS:"Previous",HIGHLIGHTEDSTEP:"Instead of the step you are working on, please work on the highlighted step.",NO_HINT_AVAILABLE:"No hint is available at this step.",NOTDONE:"I'm sorry, but you are not done yet. Please continue working.",AUTHORPLEASECLOSE:"Authoring Tools disconnected. Please close this page.",ERROR_502:"Error contacting the server, please refresh the page and try again (HTTP status 502: gateway response).",ERROR_CONN_TS:"Connection refused by tutoring service, please check your server or contact an administrator.",
ERROR_CONN_LS:"Connection refused by the logging server, please check your connection or contact an administrator.",AWAITING_OTHER_COLLABORATORS:"Waiting for other team members..."},CTATLanguageManager=function(){CTATBase.call(this,"CTATLanguageManager","theLanguagePack");var a=this;this.getString=function(b){a.ctatdebug("getString ("+b+") -> "+typeof CTATLanguagePack);if("undefined"!==typeof CTATLanguagePack){if(CTATLanguagePack[b])return CTATLanguagePack[b]}else a.ctatdebug("No custom language pack defined, using default...");
return CTATDefaultLanguagePack[b]};this.filterString=function(b){a.ctatdebug("filterString ("+b+") -> "+typeof CTATLanguagePack);if("undefined"!==typeof CTATLanguagePack){if(CTATLanguagePack[b])return a.ctatdebug("Found tag in provided language pack, returning: "+CTATLanguagePack[b]),CTATLanguagePack[b]}else a.ctatdebug("No custom language pack defined, using default...");return"undefined"!==typeof CTATDefaultLanguagePack&&CTATDefaultLanguagePack[b]?(a.ctatdebug("Found tag in default language pack, returning: "+
CTATDefaultLanguagePack[b]),CTATDefaultLanguagePack[b]):b}};CTATLanguageManager.prototype=Object.create(CTATBase.prototype);CTATLanguageManager.prototype.constructor=CTATLanguageManager;CTATLanguageManager.theSingleton=new CTATLanguageManager;var scrimIsUp=!1,errorScrim=!1,waitScrim=!0,warnScrim=!1,connectionScrim=!1,authorTimeSet=!0,inAuthorTime=!0,CTATScrim=function(){function a(){warnScrim=!1;u.scrimDown()}function b(a){"google"!=CTATConfig.platform&&(!0===scrimIsUp&&u.scrimDownForced(),u.ctatdebug("errScrimUp ("+a+")"),!0===errorScrim?!0===f&&(f=!1,getSafeElementById(ctatcontainer).removeChild(q)):!0===warnScrim&&(f=!0),u.scrimUp(a))}function d(a,c){u.ctatdebug("makeHTMLButton ()");var b=document.createElement("input");b.type="button";
b.value=c;a?(u.ctatdebug("clickHandle!=null"),b.onclick=a):(u.ctatdebug("clickHandle==null"),b.onclick=u.defaultClickHandler);b.id=c;b.setAttribute("class","scrimButton");return b}CTATBase.call(this,"CTATScrim","__undefined__");var e="",g=!1,c=!1,f=!1,h=null,m=null,l=new CTATCanvasComponent("CTAT Scrim"),n=[],p=null,x=null,q=null,v=null,u=this;this.scrimUp=function(b){if("google"!=CTATConfig.platform)if(u.ctatdebug("scrimUp ()"),b=CTATGlobals.languageManager.filterString(b),u.ctatdebug("Message: "+
b),!0===scrimIsUp?(e=!0===waitScrim?b:e+(" \n "+b),l.removeComponent(),u.removeHTMLElements()):(e=b,scrimIsUp=!0),u.ctatdebug("scrimUp() to call drawScrim() scrimIsUp "+scrimIsUp),u.ctatdebug("drawScrim ()"),"google"==CTATConfig.platform)u.ctatdebug("This is not available for now when we're in this environment");else if($('<div id="scrim" class="ctatpageoverlay"></div>').appendTo("body"),$("#scrim").css("z-index",1E3),"google"!=CTATConfig.platform&&($("#scrimpanel").empty(),$("#scrim").append('<div class="css3-windows-7"><div class="fenster"><h4 class="titel">CTAT Info Panel</h4><div id="scrimpanel" class="inhalt"><br>'+
e+"<br><br></div></div></div>"),!0===f&&(waitScrim=!1,q=d(a,"close"),$(q).appendTo("#scrimpanel")),!0===g&&(waitScrim=!1,p=d(h,"yes"),$(p).appendTo("#scrimpanel"),g=!1),!0===c&&(waitScrim=!1,x=d(m,"no"),$(x).appendTo("#scrimpanel"),c=!1),!0===waitScrim)){u.ctatdebug("Adding spinner ...");$("#scrimpanel").append("<br>");b=$('<div id="scrim_spin">');b.css("width","100%");b.css("position","relative");$("#scrimpanel").append(b);try{var v=(new Spinner({className:"scrim_spinner"})).spin();$("#scrim_spin").append(v.el)}catch(C){(C instanceof
ReferenceError||C instanceof TypeError)&&u.ctatdebug('Spinner is not available, please include it in the build or add <script src="node_modules/spin.js/spin.min.js">\x3c/script> to the html file.',C,typeof C)}}};this.waitScrimUp=function(){u.ctatdebug("waitScrimUp () CTATConfig.platform "+CTATConfig.platform+", scrimIsUp "+scrimIsUp);"google"!=CTATConfig.platform&&(!0===scrimIsUp&&u.scrimDownForced(),waitScrim=!0,u.scrimUp(CTATGlobals.languageManager.getString("LOADING")),u.ctatdebug("return from waitScrimUp(): scrimIsUp "+
scrimIsUp))};this.nextProblemScrimUp=function(){"google"!=CTATConfig.platform&&(!0===scrimIsUp&&u.scrimDownForced(),u.ctatdebug("nextProblemScrimUp ()"),u.scrimUp(CTATGlobals.languageManager.getString("NEXTPROBLEM")))};this.OKScrimUp=function(a,b){"google"!=CTATConfig.platform&&(!0===scrimIsUp&&u.scrimDownForced(),u.ctatdebug("OKScrimUp ("+a+","+b+")"),waitScrim=c=g=f=warnScrim=errorScrim=!1,u.scrimUp(a),v=d(b,"OK"),$(v).appendTo("#scrimpanel"))};this.confirmScrimUp=function(a,b,d){"google"!=CTATConfig.platform&&
(!0===scrimIsUp&&u.scrimDownForced(),u.ctatdebug("confirmScrimUp ("+a+","+b+","+d+")"),c=g=!0,m=d,h=b,u.scrimUp(a))};this.errorScrimUp=function(a){"google"!=CTATConfig.platform&&(!0===scrimIsUp&&u.scrimDownForced(),!1===authorTimeSet?(u.ctatdebug("we don't know if we're in authorTime or not yet so we're just going to hold onto the messasge"),n.push("ERROR: "+a),errorScrim=!0):!1===inAuthorTime?u.ctatdebug("We're not in authorTime, student's don't need to see our design mistakes"):(errorScrim=!0,b("ERROR: "+
a)))};this.warningScrimUp=function(a){"google"!=CTATConfig.platform&&(!0===scrimIsUp&&u.scrimDownForced(),!1===authorTimeSet?(u.ctatdebug("we don't know if we're in authorTime or not yet so we're just going to hold onto the messasge"),n.push("WARNING: "+a),warnScrim=!0):!1===inAuthorTime?u.ctatdebug("We're not in authorTime, student's don't need to see our design mistakes"):(warnScrim=!0,b("WARNING: "+a)))};this.handleTSDisconnect=function(){connectionScrim=!0;u.scrimUp(CTATGlobals.languageManager.getString("TUTORDISCONNECTED"))};
this.removeHTMLElements=function(){};this.scrimDown=function(){"google"!=CTATConfig.platform&&(!1===scrimIsUp?u.ctatdebug("The scrim isn't up, returning"):!0===errorScrim?u.ctatdebug("The scrim is up to describe errors to the user, leave it up!"):!0===warnScrim?u.ctatdebug("The scrim is up to display warnings to the user, leave it up!"):!0===connectionScrim?u.ctatdebug("The scrim is up for a connection issue leave it up!"):u.scrimDownForced())};this.scrimDownForced=function(){u.ctatdebug("enter scrimDownForced() scrimIsUp "+
scrimIsUp);$("#scrim").remove();l.removeComponent();u.removeHTMLElements();waitScrim=scrimIsUp=!1;e="";u.ctatdebug("exit scrimDownForced() scrimIsUp "+scrimIsUp)};this.defaultClickHandler=function(){u.ctatdebug("defaultClickHandler ()");u.scrimDown()};this.setInAuthorTime=function(a){u.ctatdebug("setting inAuthorTime = "+a);authorTimeSet=!0;inAuthorTime=a;if(!a)warnScrim=errorScrim=!1,f&&null.removeChild(q);else if(errorScrim||warnScrim)for(var c in n)b(c)};this.getInAuthorTime=function(){return inAuthorTime}};
CTATScrim.prototype=Object.create(CTATBase.prototype);CTATScrim.prototype.constructor=CTATScrim;CTATGlobals.languageManager=CTATLanguageManager.theSingleton;CTATScrim.scrim=new CTATScrim;var CTAT={ToolTutor:{interfaceMessages:[],tutorMessages:[]}};
Object.defineProperty(CTAT.ToolTutor,"message_handler",{enumerable:!0,get:function(){if(window.hasOwnProperty("getInterfaceObject")&&"function"===typeof window.getInterfaceObject)return window.getInterfaceObject();if(window.hasOwnProperty("interfaceObject"))return window.interfaceObject;this.hasOwnProperty("_interface")||(this._interface=null);return this._interface},set:function(a){window.hasOwnProperty("interfaceObject")?window.interfaceObject=a:this._interface=a;return a}});
Object.defineProperty(CTAT.ToolTutor,"tutor",{enumerable:!0,get:function(){if(window.hasOwnProperty("getTutorObject")&&"function"===typeof window.getTutorObject)return window.getTutorObject();if(window.hasOwnProperty("tutorObject"))return window.tutorObject;this.hasOwnProperty("_tutor")||(this._tutor=null);return this._tutor},set:function(a){window.hasOwnProperty("tutorObject")?window.tutorObject=a:this._tutor=a;return a}});
CTAT.ToolTutor.registerTutor=function(a){if(window.hasOwnProperty("registerTutor")&&"function"===typeof window.registerTutor)return window.registerTutor(a);if(this.tutor=a)for(;0<this.tutorMessages.length;)this.sendToTutor(this.tutorMessages.shift())};
CTAT.ToolTutor.sendToInterface=function(a){ctatdebug("CTAT.ToolTutor.sendToInterface()\n  "+a);return window.hasOwnProperty("sendToInterface")&&"function"===typeof window.sendToInterface?window.sendToInterface.apply(null,arguments):this.message_handler?this.message_handler.receiveFromTutor(a):commMessageHandler?commMessageHandler.processMessage(a):this.interfaceMessages.push(a)};
CTAT.ToolTutor.registerInterfaceMessageHandler=function(a){ctatdebug("CTAT.ToolTutor.registerInterfaceMessageHandler("+a+")");"string"===typeof a&&(a=document.getElementById(a));if(this.message_handler=a)for(;0<this.interfaceMessages.length;)this.sendToInterface(this.interfaceMessages.shift())};CTAT.ToolTutor.registerInterface=function(a){if(window.hasOwnProperty("registerInterface")&&"function"===typeof window.registerInterface)return window.registerInterface(a);this.registerInterfaceMessageHandler(a)};
CTAT.ToolTutor.sendToTutor=function(a){return window.hasOwnProperty("sendToTutor")&&"function"===typeof window.sendToTutor?window.sendToTutor(a):this.tutor?this.tutor.receiveFromInterface(a):this.tutorMessages.push(a)};
CTAT.ToolTutor.reboot=function(a){(a="undefined"!=typeof location&&location&&location.href?location.href:null)&&console.log("ToolTutor.reboot(), setting location to "+a);return a&&!CTATConfiguration.get("editorMode")?("function"==typeof setTimeout?setTimeout(location.replace.bind(location),600,a):location.replace(a),!0):!1};var CTATGuid={s4:function(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)},guid:function(){return this.s4()+this.s4()+"-"+this.s4()+"-"+this.s4()+"-"+this.s4()+"-"+this.s4()+this.s4()+this.s4()}};var CTATConfiguration=function(){CTATBase.call(this,"CTATConfiguration","config");var a=this,b={},d=null,e=null,g=null,c=null;this.raw={admit_code:"ies",authenticity_token:"",auth_token:"none",BehaviorRecorderMode:"AuthorTimeTutoring",class_name:"DefaultClass",curriculum_service_url:"",connection:"javascript",dataset_level_name:"none",dataset_level_type:"ProblemSet",dataset_name:"none",expire_logout_url:"none",info:"",instructor_name:"none",instrumentation_log:"off",lcId:"none",Logging:"None",log_service_url:"http://pslc-qa.andrew.cmu.edu/log/server",
log_to_disk_directory:".",problem_name:"none",problem_position:"none",problem_started_url:"none",problem_state_status:"empty",question_file:"none",refresh_session_url:"none",remoteSocketPort:"20080",remoteSocketSecurePort:"20443",remoteSocketURL:"127.0.0.1",restore_problem_url:"",reuse_swf:"false",run_problem_url:"none",school_name:"none",SessionLog:"true",session_id:CTATGuid.guid(),session_timeout:"none",show_debug_traces:"false",skills:"",source_id:"PACT_CTAT_HTML5",student_interface:"none",student_problem_id:"none",
study_condition_name:"none",study_condition_type:"none",study_condition_description:"none",study_name:"Study1",target_frame:"_parent",TutorShopDeliveryMethod:"sendandload",tutoring_service_communication:"javascript",user_guid:"none",wmode:"opaque",ssl:"off",sui:"",centerTutor:!1,previewMode:!1,width:550,height:450};this.assignRawFlashVars=function(c){a.ctatdebug("assignRawFlashVars() raw['session_id'] "+a.raw.session_id+", aData['session_id'] "+c.session_id);a.raw=c;a.preParse()};this.getRawFlashVars=
function(){return a.raw};this.getSingleParameterValues=function(c){var b=[];if(!c)return b;var d=a.getRawFlashVars(),f;for(f in c){var e=c[f];d[e]&&"none"!=d[e]&&b.push(d[e])}return b};this.usingFlash=function(){return this.getSingleParameterValues(["student_interface","swf_name"]).some(function(a){return 0<=a.search(/[.]swf$/i)})};this.generateDefaultConfiguration=function(c,b){var d={},f=0,e=0;if(c)for(var g in c)d[g]=c[g],f++;a.ctatdebug("generateDefaultConfiguration() nDefaults "+f+", result['session_id'] "+
d.session_id);if("undefined"!=typeof b&&null!=b)for(g in b)d[g]=b[g],e++;a.ctatdebug("generateDefaultConfiguration() nLocalVars "+e);e=f=null;if(window&&window.frameElement&&(e=window.frameElement.getAttribute("data-params"))){f=jQuery.parseJSON(e);console.log("setting data params from iframe attr");for(var h in f)d[h]=CTATGlobals.EncodedParams[h]?decodeURIComponent(f[h].replace(/\+/g,"%20")):f[h],console.log("set "+h+" to "+d[h])}if(null===f)for(h=$('object param[name="flashvars"]'),a.ctatdebug("generateDefaultConfiguration() objs "+
h),f=0;f<h.length;++f)if(e=$(h[f]).attr("value"),a.ctatdebug("generateDefaultConfiguration() fVarsAsString "+e),e&&(e=parseQueryStringArgs(e))&&e.question_file)for(var q in e)d[q]=e[q];ctatdebug("tutorPrep ("+d+")");q={};if(null===d||void 0===d)ctatdebug("tutorPrep(): Internal error: null argument passed");else{ctatdebug("parseQueryString ()");h=location.search;ctatdebug("Query String: "+h);f="?"==h.charAt(0)?h.substring(1):h;h={};if(f)for(f=f.split("&"),e=0;e<f.length;e++){g=f[e].split("=");ctatdebug("Setting flashvar "+
g[0]+", to: "+decodeURIComponent(g[1].replace(/\+/g," ")));h[decodeURIComponent(g[0])]="";for(var v=1;v<g.length;v++)h[decodeURIComponent(g[0])]+=(1<v?"=":"")+decodeURIComponent(g[v].replace(/\+/g," "));ctatdebug("Decoded args: "+h[decodeURIComponent(g[0])])}null!==h&&(ctatdebug("tutorPrep(): Assigning parsed arguments ..."),q=h);h=!1;for(var u in q)if(q.hasOwnProperty(u))switch(ctatdebug("Processing external FlashVar "+u+"("+q[u]+")"),u){case "GENERATED":"on"==q[u]&&(d.session_id=CTATGuid.guid(),
h=!0);break;case "BRD":d.question_file=q[u];break;case "BRMODE":d.BehaviorRecorderMode=q[u];break;case "PROBLEM":d.problem_name=q[u];break;case "DATASET":d.dataset_name=q[u];break;case "LEVEL1":d.dataset_level_name1=q[u];break;case "TYPE1":d.dataset_level_type1=q[u];break;case "LEVEL2":d.dataset_level_name2=q[u];break;case "TYPE2":d.dataset_level_type2=q[u];break;case "LEVEL3":d.dataset_level_name3=q[u];break;case "TYPE3":d.dataset_level_type3=q[u];break;case "LEVEL4":d.dataset_level_name4=q[u];break;
case "TYPE4":d.dataset_level_type4=q[u];break;case "USER":d.user_guid=q[u];break;case "SESSION":!1===h&&(d.session_id=q[u]);break;case "SOURCE":d.source_id=q[u];break;case "LOGTYPE":d.Logging=q[u];break;case "PORT":d.remoteSocketPort=q[u];break;case "REMOTEURL":d.remoteSocketURL=q[u];break;case "DISKDIR":d.log_to_disk_directory=q[u];break;case "log_service_url":d.log_service_url=q[u];break;case "URL":d.log_service_url=q[u];break;case "LOGURL":d.log_service_url=q[u];break;case "CONNECTION":d.tutoring_service_communication=
q[u];break;case "SUI":d.sui=q[u];break;case "VAR1":d.var1=q[u];break;case "VAL1":d.val1=q[u];break;case "VAR2":d.var2=q[u];break;case "VAL2":d.val2=q[u];break;case "VAR3":d.var3=q[u];break;case "VAL3":d.val3=q[u];break;case "VAR4":d.var4=q[u];break;case "VAL4":d.val4=q[u];break;case "SLOG":case "SessionLog":d.SessionLog=q[u];break;case "KEYBOARDGROUP":"Disabled"==q[u]&&(d.keyboard="disabled");"Auto"==q[u]&&(d.keyboard="auto");"On"==q[u]&&(d.keyboard="on");break;default:d[u]=q[u]}}return d};this.getCustomFields=
function(){return b};this.setTimeZone=function(c){a.ctatdebug("setTimeZone ("+c+")");null==c||""==c||void 0==c?(c=jstz.determine(),a.ctatdebug("Assigning detected timezone: "+c.name()),c=c.name()):(50<c.length&&(c=c.substr(0,50)),3!=c.length&&4!=c.length||a.ctatdebug("3 and 4 letter time zone abbreviations are deprecated. See list of tz database zone names for better options"));null!=a.raw&&(a.raw.timezone=c)};this.getTimeZone=function(){return null!=a.raw&&a.raw.timezone?a.raw.timezone:"UTC"};this.listWithAmpersands=
function(){var c="",b;for(b in a.raw)var d=b+"="+encodeURIComponent(a.raw[b]),c=""!=c?c+"&"+d:d;a.ctatdebug("CTATConfiguration.listWithAmpersands() result "+c.substring(0,25)+"...");return c};this.listFlashVars=function(){ctatdebug("listFlashVars ()");for(var c in a.raw)ctatdebug("["+c+"]: "+a.raw[c])};this.preParse=function(){ctatdebug("preParse ()");if(void 0==a.raw.dataset_name||void 0==a.raw.dataset_name)a.raw.dataset_name="DefaultDataset";var c=0,d;for(d in a.raw){if("VAR"==d||"var"==d)b[d]=
a.raw[d];c++}a.ctatdebug("preParse() nRaw "+c);c=0;for(d=!0;1==d;){d=!1;var e="custom_field_name"+(c+1),g="custom_field_value"+(c+1);a.ctatdebug("Trying : "+a.raw[e]+","+a.raw[g]);null!=a.raw[e]&&(a.ctatdebug("Adding: "+e+","+a.raw[g]),b[a.raw[e]]=a.raw[g],d=!0,c++)}};this.getDatasetNames=function(){a.ctatdebug("getDatasetNames ()");if(null!=d)return d;d={};d=[];for(var c=0,b=!0;1==b;){var b=!1,e="dataset_level_name"+(c+1);null!=a.raw[e]&&(a.ctatdebug("Adding: "+e+","+a.raw[e]),d[c]=a.raw[e],b=!0,
c++)}return d};this.getDatasetTypes=function(){a.ctatdebug("getDatasetTypes ()");if(null!=e)return e;e=[];for(var c=0,b=!0;1==b;){var b=!1,d="dataset_level_type"+(c+1);null!=a.raw[d]&&(a.ctatdebug("Adding: "+d+","+a.raw[d]),e[c]=a.raw[d],b=!0,c++)}return e};this.getConditionNames=function(){var c=[],b=0;void 0!=a.raw.study_condition_name&&""!=a.raw.study_condition_name&&(c.push(a.raw.study_condition_name),b++);for(var d=0,e=!0;1==e;){var e=!1,g="study_condition_name"+(d+1);null!=a.raw[g]&&(a.ctatdebug("Adding: "+
g+","+a.raw[g]),c[d+b]=a.raw[g],e=!0,d++)}return c};this.getConditionTypes=function(){g=[];var c=0;void 0!=a.raw.study_condition_type&&""!=a.raw.study_condition_type&&(g.push(a.raw.study_condition_type),c++);for(var b=0,d=!0;1==d;){var d=!1,e="study_condition_type"+(b+1);null!=a.raw[e]&&(a.ctatdebug("Adding: "+e+","+a.raw[e]),g[b+c]=a.raw[e],d=!0,b++)}return g};this.getConditionDescriptions=function(){a.ctatdebug("getConditionDescriptions ()");c=[];var b=0;a.raw.study_condition_description&&""!==
a.raw.study_condition_description&&(a.ctatdebug("Adding study_condition_description: "+a.raw.study_condition_description),c.push(a.raw.study_condition_description),b++);for(var d=0,e=!0;!0===e;){var e=!1,g="study_condition_description"+(d+1);null!=a.raw[g]&&(a.ctatdebug("Adding: "+g+","+a.raw[g]),c[d+b]=a.raw[g],e=!0,d++)}return c};this.get=function(c){return a.raw[c]};this.set=function(c,b){c&&(a.raw[c]=b)};this.setParams=function(c){if(c)for(var b in c)a.set(b,c[b])};this.isInstructorMode=function(){var a=
this.getRawFlashVars();return a&&a.deliverymode?"delivery"==a.deliverymode?!1:!0:!1};this.getLoggingLibrary=function(){null===commLoggingLibrary&&(commLoggingLibrary=new CTATLoggingLibrary(!0));return commLoggingLibrary};this.setPreviewMode=function(c,b){a.raw.previewMode=b};this.setCenterTutor=function(c,b){a.raw.centerTutor=b};this.setTutorWidth=function(c,b){a.raw.width=b};this.setTutorHeight=function(c,b){a.raw.height=b};this.setTutorDimensions=function(c,b,d){a.raw.width=b;a.raw.height=d};this.setTutorValue=
function(c,b,d){a.raw[b]=d};this.setCommunicationMode=function(c,b){a.raw.tutoring_service_communication=b};this.setRemoteSocketURL=function(c,b){a.raw.remoteSocketURL=b};this.setRemoteSocketPort=function(c,b){a.raw.remoteSocketPort=b}};CTATConfiguration.prototype=Object.create(CTATBase.prototype);CTATConfiguration.prototype.constructor=CTATConfiguration;flashVars=CTATConfiguration.theConfObject=null;
CTATConfiguration.generateDefaultConfigurationObject=function(a,b){if(!CTATConfiguration.theConfObject){this.theConfObject=new CTATConfiguration;var d=this.theConfObject.generateDefaultConfiguration(this.theConfObject.raw,a);this.theConfObject.assignRawFlashVars(d);"none"==this.theConfObject.get("session_id")&&this.theConfObject.set("session_id",CTATGuid.guid());flashVars=this.theConfObject;console.log("CTATConfiguration.generateDefaultConfigurationObject() flashVars.getRawFlashVars()['session_id'] "+
flashVars.getRawFlashVars().session_id);console.log("flashVars.getRawFlashVars()['remoteSocketPort'] "+flashVars.getRawFlashVars().remoteSocketPort)}"Default"!=b&&"OLI"!=b||this.theConfObject.setParams(a);return this.theConfObject};CTATConfiguration.getRawFlashVars=function(){CTATConfiguration.generateDefaultConfigurationObject();return CTATConfiguration.theConfObject.getRawFlashVars()};CTATConfiguration.get=function(a){CTATConfiguration.generateDefaultConfigurationObject();return CTATConfiguration.theConfObject.get(a)};
CTATConfiguration.set=function(a,b){CTATConfiguration.generateDefaultConfigurationObject();CTATConfiguration.theConfObject.set(a,b)};CTATConfiguration.getCustomFields=function(){CTATConfiguration.generateDefaultConfigurationObject();return CTATConfiguration.theConfObject.getCustomFields()};CTATConfiguration.setParams=function(a){CTATConfiguration.generateDefaultConfigurationObject();CTATConfiguration.theConfObject.setParams(a)};
CTATConfiguration.getSingleParameterValues=function(a){CTATConfiguration.generateDefaultConfigurationObject();return CTATConfiguration.theConfObject.getSingleParameterValues(a)};CTATConfiguration.usingFlash=function(){CTATConfiguration.generateDefaultConfigurationObject();return CTATConfiguration.theConfObject.usingFlash()};CTATConfiguration.prototype.set=CTATConfiguration.prototype.set;CTATConfiguration.prototype.get=CTATConfiguration.prototype.get;var CTATTutorMessageBuilder=function(){CTATBase.call(this,"CTATTutorMessageBuilder","__undefined__")};CTATTutorMessageBuilder.isHint=function(a){return null===a||"undefined"===typeof a?!1:0===a.toString().toLowerCase().indexOf(CTATTutorMessageBuilder.HINT.toLowerCase())};CTATTutorMessageBuilder.isCorrect=function(a){if(null===a||"undefined"===typeof a)return!1;a=a.toString().toLowerCase();return 0===a.indexOf(CTATTutorMessageBuilder.CORRECT.toLowerCase())?!0:0===a.indexOf(CTATExampleTracerLink.SUCCESS.toLowerCase())};
CTATTutorMessageBuilder.prototype=Object.create(CTATBase.prototype);CTATTutorMessageBuilder.prototype.createInCorrectActionMessage=function(a,b){this.ctatdebug("createInCorrectActionMessage ()");var d;d="<message><verb>SendNoteProperty</verb><properties><MessageType>InCorrectAction</MessageType>"+("<transaction_id>"+a+"</transaction_id>");this.ctatdebug("In CTATTutorMessageBuilder "+b);d+=b.toXMLString(!1);return d+"</properties></message>"};
CTATTutorMessageBuilder.prototype.createCorrectActionMessage=function(a,b){this.ctatdebug("createCorrectActionMessage ()");var d;d="<message><verb>SendNoteProperty</verb><properties><MessageType>CorrectAction</MessageType>"+("<transaction_id>"+a+"</transaction_id>")+b.toXMLString(!1);return d+"</properties></message>"};
CTATTutorMessageBuilder.prototype.createAssociatedRulesMessageForHint=function(a,b,d,e,g,c,f,h,m){f=void 0==f?a.length:f;h=void 0==h?1:h;b="<message><verb>SendNoteProperty</verb><properties><MessageType>AssociatedRules</MessageType><Indicator>Hint</Indicator>"+(b?b:new CTATSAI("","","")).toXMLString();b+="<TutorAdvice>";for(var l=0;l<a.length;l++)b+="<value><![CDATA["+a[l]+"]]\x3e</value>";b=b+("</TutorAdvice><TotalHintsAvailable>"+f+"</TotalHintsAvailable><CurrentHintNumber>"+h+"</CurrentHintNumber>")+
("<Actor>"+d+"</Actor>")+this.fmtSkillBarVector(e);b+="<skillBarDelimiter><![CDATA[`]]\x3e</skillBarDelimiter>";if(g||0===g)b+="<StepID>"+g+"</StepID>";b+="<transaction_id>"+c+"</transaction_id>";b+="<LogAsResult>true</LogAsResult>";b+=this.formatCustomFields(m);return b+="</properties></message>"};
CTATTutorMessageBuilder.prototype.createAssociatedRulesMessageForAction=function(a,b,d,e,g,c,f,h,m,l,n){this.ctatdebug("TMB.createAssociatedRulesMessageForAction(indicator "+a+", sai "+b+", actor "+d+", studentSAI "+e+",\n  skillBarVector "+g+", stepID "+c+", transactionID "+f+",\n  tutorAdvice "+h+", outOfOrder "+m+", traceOutcome "+n);a="<message><verb>SendNoteProperty</verb><properties><MessageType>AssociatedRules</MessageType>"+("<Indicator>"+(CTATTutorMessageBuilder.isCorrect(a)?"Correct":"InCorrect")+
"</Indicator>");a+=(b?b:new CTATSAI("","","")).toXMLString();b=e.toXMLString().replace("<Selection>","<StudentSelection>").replace("<Action>","<StudentAction>").replace("<Input>","<StudentInput>");b=b.replace("</Selection>","</StudentSelection>").replace("</Action>","</StudentAction>").replace("</Input>","</StudentInput>");a=a+b+("<Actor>"+d+"</Actor>")+this.fmtSkillBarVector(g);a+="<skillBarDelimiter><![CDATA[`]]\x3e</skillBarDelimiter>";a+="<StepID>"+c+"</StepID>";a+="<transaction_id>"+f+"</transaction_id>";
h&&(a+="<TutorAdvice><![CDATA["+h+"]]\x3e</TutorAdvice>");a+="<LogAsResult>true</LogAsResult>";a+="<end_of_transaction>"+(h?!1:!0)+"</end_of_transaction>";a+="undefined"!=typeof m&&m?"<OutOfOrder>true</OutOfOrder>":"";a+=n?"<"+CTATMsgType.TRACE_OUTCOME+">"+n+"</"+CTATMsgType.TRACE_OUTCOME+">":"";a+=this.formatCustomFields(l);return a+="</properties></message>"};
CTATTutorMessageBuilder.prototype.formatCustomFields=function(a){var b="";if(a)for(var d in a)a.hasOwnProperty(d)&&(b+="<custom_field><name>"+d+"</name><value>"+(null==a[d]?"":a[d].toString())+"</value></custom_field>");return b?"<custom_fields>"+b+"</custom_fields>":""};
CTATTutorMessageBuilder.prototype.isDoneStep=function(a,b){b[0]=!1;var d=a.getIndicator();if(!d)return!1;var e=a.getStudentSelection();e||(e=a.getProperty("tool_selection"));b[0]=CTATTutorMessageBuilder.isCorrect(indicator);var g="done"==e;this.ctatdebug("isDoneStep() indicatorObj "+d+", selectionObj "+e+", correct[0] "+b[0]+", result "+g);return g};
CTATTutorMessageBuilder.prototype.createHintMessage=function(a,b,d,e){d="<message><verb>SendNoteProperty</verb><properties><MessageType>ShowHintsMessage</MessageType><HintsMessage>";for(var g=0;g<a.length;g++)d+="<value><![CDATA["+a[g]+"]]\x3e</value>";d+="</HintsMessage>";b&&b.toXMLString&&(d+=b.toXMLString());return d+("<transaction_id>"+e+"</transaction_id>")+"</properties></message>"};
CTATTutorMessageBuilder.prototype.createErrorMessage=function(a,b){var d;d="<message><verb>SendNoteProperty</verb><properties><MessageType>TutoringServiceError</MessageType><ErrorType>"+a+"</ErrorType><Details>"+(b?b:"");return d+="</Details></properties></message>"};
CTATTutorMessageBuilder.prototype.createSuccessMessage=function(a,b){var d;d="<message><verb>SendNoteProperty</verb><properties><MessageType>SuccessMessage</MessageType>"+("<SuccessMsg><![CDATA["+b+"]]\x3e</SuccessMsg>")+("<transaction_id>"+a+"</transaction_id>")+"<end_of_transaction>true</end_of_transaction>";return d+="</properties></message>"};
CTATTutorMessageBuilder.prototype.createBuggyMessage=function(a,b){var d;d="<message><verb>SendNoteProperty</verb><properties><MessageType>BuggyMessage</MessageType>"+("<BuggyMsg><![CDATA["+b+"]]\x3e</BuggyMsg>")+("<transaction_id>"+a+"</transaction_id>")+"<end_of_transaction>true</end_of_transaction>";return d+="</properties></message>"};
CTATTutorMessageBuilder.prototype.createLockWidgetMsg=function(a){return"<message><verb>SendNoteProperty</verb><properties><MessageType>SendWidgetLock</MessageType>"+("<WidgetLockFlag>"+a+"</WidgetLockFlag>")+"</properties></message>"};
CTATTutorMessageBuilder.prototype.createMessage=function(a,b){var d="<message><verb>SendNoteProperty</verb><properties><MessageType>"+a+"</MessageType>";if(b)for(var e in b)d+="<"+e+">"+b[e]+"</"+e+">";d+="</properties></message>";this.ctatdebug("CTATTutorMessageBuilder.createMessage("+a+", "+b+") returns "+d);return d};
CTATTutorMessageBuilder.prototype.createStateGraphMessage=function(a,b,d,e,g,c,f){a="<message><verb>SendNoteProperty</verb><properties><MessageType>StateGraph</MessageType>"+("<caseInsensitive>"+a+"</caseInsensitive>")+("<unordered>"+b+"</unordered>")+("<lockWidget>"+d+"</lockWidget>");a+="<suppressStudentFeedback>"+e+"</suppressStudentFeedback>";a+="<highlightRightSelection>"+g+"</highlightRightSelection>";a+="<confirmDone>"+c+"</confirmDone>";a+="<skillBarDelimiter><![CDATA[`]]\x3e</skillBarDelimiter>";
a+=this.fmtSkillBarVector(f);return a+="</properties></message>"};CTATTutorMessageBuilder.prototype.fmtSkillBarVector=function(a){var b="";if(void 0!==a&&null!==a&&0<a.length){for(var b=b+"<Skills>",d=0;d<a.length;d++)b+="<value><![CDATA["+a[d]+"]]\x3e</value>";b+="</Skills>"}return b};
CTATTutorMessageBuilder.prototype.createHighlightWidgetMessage=function(a,b,d,e){a="<message><verb>SendNoteProperty</verb><properties><MessageType>HighlightMsg</MessageType>"+("<HighlightMsgText>"+d+"</HighlightMsgText>")+("<Selection><value>"+a+"</value></Selection>")+("<Action><value>"+b+"</value></Action>");a+="<transaction_id>"+e+"</transaction_id>";a+="<end_of_transaction>true</end_of_transaction>";return a+="</properties></message>"};
Object.defineProperty(CTATTutorMessageBuilder,"TRIGGER",{enumerable:!1,configurable:!1,writable:!1,value:"trigger"});Object.defineProperty(CTATTutorMessageBuilder,"SUBTYPE",{enumerable:!1,configurable:!1,writable:!1,value:"subtype"});Object.defineProperty(CTATTutorMessageBuilder,"TUTOR_PERFORMED",{enumerable:!1,configurable:!1,writable:!1,value:"tutor-performed"});Object.defineProperty(CTATTutorMessageBuilder,"HINT",{enumerable:!1,configurable:!1,writable:!1,value:"Hint"});
Object.defineProperty(CTATTutorMessageBuilder,"CORRECT",{enumerable:!1,configurable:!1,writable:!1,value:"Correct"});CTATTutorMessageBuilder.prototype.constructor=CTATTutorMessageBuilder;"undefined"!==typeof module&&(module.exports=CTATTutorMessageBuilder);var CTATLMS={identifier:null,initLMSConnection:function(){},closeLMSConnection:function(){},setValue:function(a,b){},getValue:function(a){return null},saveProblemState:function(a){},getProblemState:function(a){CTATConfiguration.get("restoreProblemUrl")?$.get(CTATConfiguration.get("restoreProblemUrl"),"",null,"text").done(function(b){a(b)}).fail(function(b,d,e){a(null);b=(new CTATTutorMessageBuilder).createErrorMessage("Load ProblemState Error",d+" "+e);CTAT.ToolTutor.sendToInterface(b,!0)}):a(null)},
gradeStudent:function(a,b){},logEvent:function(a){},processProblemSummary:function(a){},is:{},init:{}};
CTATLMS.init.StandAlone=function(){CTATLMS.identifier=null;CTATLMS.initLMSConnection=function(){};CTATLMS.closeLMSConnection=function(){};CTATLMS.commit=function(){};CTATLMS.setValue=function(){};CTATLMS.getValue=function(){return null};CTATLMS.logEvent=function(a){};CTATLMS.saveProblemState=function(){};CTATLMS.getProblemState=function(a){return a(null)};CTATLMS.gradeStudent=function(){};CTATLMS.processProblemSummary=function(){}};CTATLMS.is.SCORM=function(){return window.location.search&&/[?&;]mode=SCORM/i.test(window.location.search)};
CTATLMS.init.SCORM=function(){var a=!1;CTATLMS.identifier="SCORM";CTATLMS.initLMSConnection=function(){if(!0!==a){window.parent.doLMSInitialize();var b=CTATLMS.getValue("cmi.core.lesson_status");CTATConfiguration.set("problem_state_status",b);"not attempted"==b&&CTATConfiguration.set("problem_state_status","incomplete");"passed"==b&&CTATConfiguration.set("problem_state_status","completed");"failed"==b&&CTATConfiguration.set("problem_state_status","incomplete");"browsed"==b&&CTATConfiguration.set("problem_state_status",
"incomplete");CTATLMS.setValue("cmi.core.lesson_status","incomplete");a=!0}};CTATLMS.commit=window.parent.doLMSCommit;CTATLMS.closeLMSConnection=window.parent.doLMSFinish;CTATLMS.setValue=window.parent.doLMSSetValue;CTATLMS.getValue=window.parent.doLMSGetValue;CTATLMS.logEvent=function(a){};CTATLMS.saveProblemState=function(a){return CTATLMS.setValue("cmi.suspend_data",a.problem_state)};CTATLMS.getProblemState=function(a){var b=CTATLMS.getValue("cmi.suspend_data");return a(b)};CTATLMS.gradeStudent=
function(a,d){CTATLMS.setValue("cmi.core.score.min",0);CTATLMS.setValue("cmi.core.score.max",100);return CTATLMS.setValue("cmi.core.score.raw",Number((a/d).toFixed(2).replace(/[.]/,"")))};CTATLMS.processProblemSummary=function(a){["cmi.core.lesson_status","cmi.core.score.raw","cmi.core.exit","cmi.core.session_time"].forEach(function(a){var b=this.getElementsByTagName(a);CTATLMS.setValue(a,$("<div>").html(b[0].innerHTML).text())},a);CTATLMS.commit();CTATLMS.closeLMSConnection()};CTATLMS.initLMSConnection()};
CTATLMS.is.XBlock=function(){return window.location.search&&/[?&;]mode=XBlock/i.test(window.location.search)};
CTATLMS.init.XBlock=function(){var a=document.referrer?(new URL(document.referrer)).origin:"";CTATLMS.identifier="XBlock";CTATLMS.initLMSConnection=function(){};CTATLMS.closeLMSConnection=function(){};CTATLMS.commit=function(){};CTATLMS.setValue=function(a,d){};CTATLMS.getValue=function(a){return null};CTATLMS.saveProblemState=function(b){parent.postMessage({action:"save_problem_state",input:window.btoa(b.problem_state)},a)};CTATLMS.getProblemState=function(a){return a(window.atob(CTATConfiguration.get("saveandrestore")))};
CTATLMS.gradeStudent=function(b,d){parent.postMessage({action:"grade",input:{value:b,max:d}},a)};CTATLMS.logEvent=function(b){parent.postMessage({action:"log",input:b},a)};CTATLMS.processProblemSummary=function(a){}};CTATLMS.is.Authoring=function(){return window.location.search&&/[?&;]mode=AUTH(ORING)?/i.test(window.location.search)};CTATLMS.is.ToolsListener=function(){return window.location.search&&/[?&;]mode=ctatAsListener/i.test(window.location.search)};CTATLMS.is.OLI=function(){return"OLI"==CTATConfiguration.get("CTATTarget")};
CTATLMS.is.TutorShop=function(){return"TutorShop"==CTATConfiguration.get("LMS")};
CTATLMS.init.TutorShop=function(){CTATLMS.identifier="TutorShop";CTATLMS.initLMSConnection=function(){};CTATLMS.closeLMSConnection=function(){};CTATLMS.commit=function(){};CTATLMS.setValue=function(a,b){};CTATLMS.getValue=function(a){return null};CTATLMS.logEvent=function(a){};CTATLMS.saveProblemState=function(a){if(CTATConfiguration.get("restoreProblemUrl")&&CTATConfiguration.get("curriculum_service_url")){a.session_id=a.session_id?a.session_id:"dummySession";var b=[],d;for(d in a)b.push(d+"="+encodeURIComponent(a[d]));
$.post(CTATConfiguration.get("curriculum_service_url"),b.join("&"),null,"application/x-www-form-urlencoded")}};CTATLMS.getProblemState=function(a){CTATConfiguration.get("restoreProblemUrl")?$.get(CTATConfiguration.get("restoreProblemUrl"),"",null,"text").done(function(b){a(b)}).fail(function(b,d,e){a(null);b=(new CTATTutorMessageBuilder).createErrorMessage("Load ProblemState Error",d+" "+e);CTAT.ToolTutor.sendToInterface(b,!0)}):a(null)};CTATLMS.gradeStudent=function(){};CTATLMS.processProblemSummary=
function(){}};CTATLMS.is.Assistments=function(){return CTATTarget&&"ASSISTMENTS"==CTATTarget};var bundleFormatter="",inBundle=!1,useBundling=!1,useOLIEncoding=!1,CTATCommLibrary=function(a,b){CTATBase.call(this,"CTATCommLibrary",a);var d=authenticityToken="",e=0,g=[],c=null,f=a?a:null,h=null==b?!0:b,m=!0,l=null,n=this,p="http",x="ERROR_CONN_TS",q="";this.setUseCommSettings=function(a){m=a};this.getUseCommSettings=function(){return m};this.setConnectionRefusedMessage=function(a){x=a};this.setSocketType=function(a){p=a};this.hasSecureSocket=function(){return/https/i.test(p)||/wss/i.test(p)};
this.hasJavaScriptConnection=function(){return/javascript/i.test(p)};this.hasWebSocket=function(){return/websocket/i.test(p)};this.assignHandler=function(a){f=a};this.assignMessageListener=function(a){l=a};this.encodeVariables=function(a){n.ctatdebug("encodeVariables ()");for(var c="",b=0;b<a.length;b++){var d=a[b];0<b&&(c+="&");c+=d.name;c+="=";c+=encodeURIComponent(d.value)}return c};this.encodeVariablesOLI=function(a){n.ctatdebug("encodeVariablesOLI ()");for(var c="",b=0;b<a.length;b++){var d=
a[b];0<b&&(c+="&");c+=d.name;c+="=";c+=encodeURIComponent(d.value)}return c};this.createConnection=function(a,b,d){n.ctatdebug("createConnection () canBeWebSocket "+d);d="undefined"==typeof d?!0:!1!==d;if(!b)return new CTATConnection(a);if(d&&n.hasWebSocket())return d=this.findWSConnection(b),d||(d=new CTATWSConnection(a),d.setID(e),d.setURL(b),d.assignReceiveFunction(this.processWSReply),d.assignCloseFunction(this.processWSClose),g.push(d),e++),d;d=new CTATConnection(a);d.setID(e);d.setURL(b);d.assignReceiveFunction(n.processReply);
g.push(d);e++;return c=d};this.findWSConnection=function(a){ctatdebug("findWSConnection( "+a+" )");a=n.editSocketURLForHTTPS(a);for(var c=0;c<g.length;c++){var b=g[c];ctatdebug("checking: socketType = "+b.getSocketType()+" URL = "+b.getURL());if("ws"==b.getSocketType()&&b.getURL()==a)return b}return null};this.startBundle=function(){n.ctatdebug("startBundle ()");!1===useBundling?this.ctatdebug("Not using bundling, bump"):(bundleFormatter='<?xml version="1.0" encoding="UTF-8"?><message><verb/><properties><MessageType>MessageBundle</MessageType><messages>',
inBundle=!0)};this.endBundle=function(){n.ctatdebug("endBundle ()");!1===useBundling?n.ctatdebug("Not using bundling, bump"):(inBundle=!1,bundleFormatter+="</messages></properties></message>",n.sendXML(bundleFormatter))};this.setFixedURL=function(a){d=a};this.getURL=function(){n.ctatdebug("getURL ()");if(""!==d)return n.ctatdebug("Returning fixedURL: "+d),d;var a=flashVars.getRawFlashVars(),c="http://";n.hasSecureSocket()&&(c="https://");c=c+a.remoteSocketURL+":"+a.remoteSocketPort;-1!=a.remoteSocketURL.indexOf("http")&&
(c=a.remoteSocketURL+":"+a.remoteSocketPort);return c};this.sendXML=function(a,c){n.ctatdebug("Sending: "+a);n.ctatdebug("sendXML ("+a+")");f.updateLastActionTimestamp&&f.updateLastActionTimestamp();if(!0===useBundling&&!0===inBundle)n.ctatdebug("Bundling ..."),bundleFormatter+=a;else{bundleFormatter=a;flashVars.getRawFlashVars();var b=this.getURL(),d=bundleFormatter;-1==bundleFormatter.indexOf("<?xml")&&(d='<?xml version="1.0" encoding="UTF-8"?>'+bundleFormatter);n.getUseCommSettings()&&n.hasJavaScriptConnection()?
(n.sendToToolsOrCollaborators(b,d,c),CTAT.ToolTutor.sendToTutor(d)):n.send_post(b,d)}};this.sendToToolsOrCollaborators=function(a,c,b){return!n.hasWebSocket()||"ctatAsListener"!=CTATConfiguration.get("mode")&&"undefined"!=typeof b&&!1===b?!1:(this.send_post(a,c),!0)};this.sendXMLNoBundle=function(a){n.ctatdebug("sendXMLNoBundle ("+a+")");bundleFormatter=a;f.updateLastActionTimestamp&&f.updateLastActionTimestamp();var c=this.getURL(),b=a;-1==a.indexOf("<?xml")&&(b='<?xml version="1.0" encoding="UTF-8"?>'+
a);flashVars.getRawFlashVars();n.getUseCommSettings()&&n.hasJavaScriptConnection()?(n.sendToToolsOrCollaborators(c,b),CTAT.ToolTutor.sendToTutor(b)):this.send_post(c,b)};this.sendXMLURL=function(a,c,b){ctatdebug("sendXMLURL ("+c+", "+b+")");var d=a;-1==a.indexOf("<?xml")&&(d='<?xml version="1.0" encoding="UTF-8"?>'+a);flashVars.getRawFlashVars();n.ctatdebug("Sending: "+d);f.updateLastActionTimestamp&&f.updateLastActionTimestamp();this.getUseCommSettings()&&n.hasJavaScriptConnection()?(n.sendToToolsOrCollaborators(c,
d),b||CTAT.ToolTutor.sendToTutor(d)):this.send_post(c,d)};this.send_post_variables=function(a,c){n.ctatdebug("send_post_variables ("+a+")");flashVars.getRawFlashVars();var b;b=!1===useOLIEncoding?this.encodeVariables(c):this.encodeVariablesOLI(c);this.ctatdebug("Sending: "+b);f.updateLastActionTimestamp&&f.updateLastActionTimestamp();if(!0===CTATGlobals.CommDisabled)n.ctatdebug("Communications globally disabled, please check your settings");else{var d=n.createConnection(CTATConfiguration.getRawFlashVars(),
a,!1);d.setContentType("application/x-www-form-urlencoded");n.ctatdebug("CTATCommLibrary.send_post_variables() data to send:\n  "+b);null!==l&&l.processOutgoing(b);d.setURL(a);d.setData(b);d.assignReceiveFunction(n.processReply);d.send()}};this.send_post=function(a,c){var b;ctatdebug("send_post ("+a+")");if(!0===CTATGlobals.CommDisabled)n.ctatdebug("Communications globally disabled, please check your settings");else{ctatdebug("Outoing on wire: "+c);b=flashVars.getRawFlashVars();var d=a;n.hasWebSocket()?
(ctatdebug("opening websocket connection: url "+a),d=a.replace("http:","ws:"),d=n.editSocketURLForHTTPS(d),ctatdebug("opening websocket connection to "+d),b=n.createConnection(b,d),b.setData(c),n.ctatdebug(c)):(b=n.createConnection(b,d),b.setData(c));null!==l&&l.processOutgoing(c);b.send()}};this.processReply=function(a,c,b){n.ctatdebug("processReply ("+g.length+","+a+", ...)");"undefined"==typeof b&&"function"==typeof this.getHTTPObject&&this.getHTTPObject();c=0;a=[];var d;for(d=0;d<g.length;d++){var e=
g[d];if(e&&"function"==typeof e.getHTTPObject){var u=e.getHTTPObject();n.ctatdebug("Testing connection entry["+d+"]: readyState & status: "+(u?u.readyState+" & "+u.status:"null")+", consumed: "+e.getConsumed());u&&(4==u.readyState&&!1===e.getConsumed()?(n.ctatdebug("Investigating request response: "+c+" -> "+u.status+", for: "+e.getURL()),b=!1,0===u.status&&(b=!0,n.ctatdebug("Received message (status 0): ("+u.responseText+"), status: "+u.status),h&&CTATScrim.scrim.errorScrimUp(CTATGlobals.languageManager.filterString(x))),
408==u.status&&(b=!0,n.ctatdebug("Received message (status 408): "+u.responseText),h&&CTATScrim.scrim.scrimDown()),502==u.status&&(b=!0,n.ctatdebug("Received message (status 502): "+u.responseText),h&&CTATScrim.scrim.errorScrimUp(CTATGlobals.languageManager.filterString(ERROR_502))),200==u.status?(b=!0,n.ctatdebug("Processing 200 response ..."),null!==f?(a.push(u.responseText),null!==l&&l.processIncoming(u.responseText)):n.ctatdebug("Error: httphandler is null, can't process response!")):f&&f.processError&&
(b=!0,n.ctatdebug("Processing non-200 response, status "+u.status),f.processError(u.status,u.responseText)),!1===b&&n.ctatdebug("Error: status not handled for: "+u.status),n.ctatdebug("Marking connection as consumed ..."),e.setConsumed(!0)):(0===u.readyState&&n.ctatdebug("Received message (status 0, request not initialized)"),1===u.readyState&&n.ctatdebug("Received message (status 1, server connection established)"),2===u.readyState&&n.ctatdebug("Received message (status 2, request received)"),3===
u.readyState&&n.ctatdebug("Received message (status 3, processing request)")),c++)}}n.cleanup();for(c=0;c<a.length;c++)n.ctatdebug("Processing incoming message: "+c),b=a[c],-1!=b.indexOf("status=success")?n.ctatdebug("Info: logging success message received, not propagating to message handler"):(n.ctatdebug("Processing incoming message: "+b),f.processMessage(b))};this.processWSReply=function(a){n.ctatdebug("processWSReply() length "+(null===a?null:a.toString().length));"string"==typeof a&&(null!==
l&&l.processIncoming(a),-1!=a.indexOf("status=success")?n.ctatdebug("processWSReply() logging success message received, not propagating to message handler: "+a):(n.ctatdebug("Processing incoming message: "+a),f.processMessage(a)))};this.processWSClose=function(a){n.ctatdebug("processWSClose("+a+")");a instanceof CloseEvent&&n.ctatdebug("CloseEvent: code "+a.code+", reason "+a.reason+", wasClean "+a.wasClean);CTATLMS.is.Authoring()||CTATLMS.is.ToolsListener()?CTATScrim.scrim.scrimUp(CTATGlobals.languageManager.filterString("AUTHORPLEASECLOSE")):
CTATScrim.scrim.handleTSDisconnect()};this.cleanup=function(){n.ctatdebug("cleanup ()");n.ctatdebug("checkEntries() httprequests.length "+g.length);for(var a=0,c=g.length-1;0<=c;c--){var b=g[c];if(b)if(!0===b.getConsumed())n.ctatdebug("checkEntries() removing["+c+"] ID: "+b.getID()),g.splice(c,1),a++;else if("function"==typeof b.getHTTPObject){var d=b.getHTTPObject();n.ctatdebug("checkEntries() checking["+c+"], readyState: "+(d?d.readyState:"null")+", consumed: "+b.getConsumed())}}n.ctatdebug("Removed "+
a+" entries")};this.retrieveProblemFile=function(a,c,b){var d=/\.([A-z]*)$/.exec(a);d&&d[1]&&"nools"===d[1].toLowerCase()?(console.log("got a nools file:",a),b.processNools(a)):(console.log("got an xml file, maybe:",a),this.retrieveXMLFile(a,c,b))};this.getFileRequest=function(a,c,b){var d=-1!=(location.href?location.href:a).indexOf("file://")?!0:!1;location.href||n.ctatdebug("We can't check location.href in the current configuration");if(d)b=(new CTATTutorMessageBuilder).createErrorMessage("","Unable to load: "+
a+" - You are trying to use the file:// protocol, which is not allowed in this browser."),n.ctatdebug("onerror GET for fileName "+b),CTAT.ToolTutor.sendToInterface(b,!0);else return q=a,a=new CTATConnection,a.assignReceiveFunction(function(a,b,d){"undefined"==typeof d&&(d="function"==typeof this.getHTTPObject&&this.getHTTPObject());n.ctatdebug("onready... GET for xmlFile xmlhttp "+d+", .readyState & .status "+(d?d.readyState+" & "+d.status:""));d&&4!=d.readyState||(d&&200==d.status&&c(d),d&&404==
d.status&&(a=(new CTATTutorMessageBuilder).createErrorMessage("Unable to download file","("+q+") not found"),n.ctatdebug("Error loading xmlFile "+q+": "+a),CTAT.ToolTutor.sendToInterface(a,!0)))}),a.assignFailFunction(b),a};this.retrieveXMLFile=function(a,c,b){n.ctatdebug("retrieveXMLFile ("+a+")");c=this.getFileRequest(a,function(a){a.responseXML?(n.ctatdebug("parsing brd xml using something else"),a=a.responseXML.documentElement):(n.ctatdebug("parsing brd xml using node"),a=(new CTATXML).parseXML(a.responseText));
null===a?(a=(new CTATTutorMessageBuilder).createErrorMessage("Error parsing xmlFile "+q),n.ctatdebug("Error parsing xmlFile "+q+": "+a),CTAT.ToolTutor.sendToInterface(a,!0)):b.processXML(a)},function(){var a=(new CTATTutorMessageBuilder).createErrorMessage("","Unable to load: "+q+" - Either you are trying to use the  file:// protocol, there is a firewall between the tutor and BRD, or the BRD is on a different domain and permission to retrieve data from that server is denied.");n.ctatdebug("onerror GET for xmlFile "+
a);CTAT.ToolTutor.sendToInterface(a,!0);b.processXML(null)});c.setMethod("GET");c.setURL(a);c.setContentType("text/plain");c.send()};this.retrieveJSONFile=function(a,c){n.ctatdebug("retrieveJSONFile ("+a+")");var b=this.getFileRequest(a,function(){4==b.readyState&&200==b.status&&(n.ctatdebug("Successfully retrieved file: "+a),c(JSON.parse(b.responseText)))},function(){var a=(new CTATTutorMessageBuilder).createErrorMessage("","Unable to load: "+q+" - Either you are trying to use the  file:// protocol, there is a firewall between the tutor and BRD, or the BRD is on a different domain and permission to retrieve data from that server is denied.");
n.ctatdebug("onerror GET for xmlFile "+a);CTAT.ToolTutor.sendToInterface(a,!0)});b.open("GET",a,!0);b.setRequestHeader("Content-type","text/plain");b.send()};this.retrieveFile=function(a,c){n.ctatdebug("retrieveFile ("+a+")");var b=this.getFileRequest(a,function(){4==b.readyState&&200==b.status&&(n.ctatdebug("Successfully retrieved file: "+a),c(b.responseText))},function(){var a=(new CTATTutorMessageBuilder).createErrorMessage("","Unable to load: "+q+" - Either you are trying to use the  file:// protocol, there is a firewall between the tutor and BRD, or the BRD is on a different domain and permission to retrieve data from that server is denied.");
n.ctatdebug("onerror GET for xmlFile "+a);CTAT.ToolTutor.sendToInterface(a,!0)});b.open("GET",a,!0);b.setRequestHeader("Content-type","text/plain");b.send()};this.then=function(a,b){return c&&"function"==typeof c.then?c.then(a,b):{then:function(){console.log("CTATCommLibrary.then() not supported")}}}};CTATCommLibrary.setAuthenticityToken=function(a){Array.isArray(a)&&(a=0<a.length?a[0]:"");a&&(CTATCommLibrary.authenticityToken=decodeURIComponent(a))};CTATCommLibrary.getAuthenticityToken=function(a){return CTATCommLibrary.authenticityToken};
CTATCommLibrary.addAuthenticityToken=function(a){return CTATCommLibrary.authenticityToken&&(""===a||0>a.search(/authenticity_token=/)&&0<=a.search(/^[?]?[^?&=><]+=?[^&=]*(&[^?&=><]+=?[^&=]*)*$/))?""+a+(a?"&":"")+"authenticity_token="+encodeURIComponent(CTATCommLibrary.authenticityToken):a};CTATCommLibrary.prototype=Object.create(CTATBase.prototype);CTATCommLibrary.prototype.constructor=CTATCommLibrary;
CTATCommLibrary.prototype.editSocketURLForHTTPS=function(a){if(a&&"https:"===window.top.location.protocol){ctatdebug("We're embedded in an https window, using wss...");a=a.replace("ws:","wss:");var b=CTATConfiguration.get("remoteSocketSecurePort");b&&(a=a.replace(/(wss:\/\/[^:]{1,}:)\d{1,}/,"$1"+b));ctatdebug("url after replace: "+a)}return a};var CTATSequencer=function(){CTATBase.call(this,"CTATSequencer","sequencer");var a=this,b=new CTATPackage,d=new CTATXML,e=null,g="sequential",c=null;this.setAlgorithm=function(a){g=a};this.getAlgorithm=function(){return g};this.handlePackageRetrieval=function(d){a.ctatdebug("handlePackageRetrieval ()");b.init(d);null!=c&&c(b)};this.processXML=function(d){a.ctatdebug("parseXML ()");b.init(d);null!=c&&c(b)};this.init=function(b,g){a.ctatdebug("init ("+b+", "+g+")");c=g;e=new CTATCommLibrary(null,!1);
e.retrieveXMLFile(b,d,this)};this.getProblemSetSize=function(){a.ctatdebug("getProblemSetSize ()");var c=b.getProblemSets();return 0==c.length?(a.ctatdebug("Error: no problem sets available, trying list of problems directly ..."),b.getProblems().getProblemSize()):c[0].getProblemSize()};this.getFirstProblem=function(){a.ctatdebug("getFirstProblem ()");var c=b.getProblemSets();return 0==c.length?(a.ctatdebug("Error: no problem sets available, trying list of problems directly ..."),b.getProblems()[0]):
c[0].getFirstProblem()};this.getProblemList=function(){a.ctatdebug("getProblemList ()");if(0==b.getProblemSets().length){a.ctatdebug("Error: no problem sets available, trying list of problems directly ...");var c=b.getProblems()}return c};this.getNextProblem=function(c){a.ctatdebug("getNextProblem ()")}};CTATSequencer.prototype=Object.create(CTATBase.prototype);CTATSequencer.prototype.constructor=CTATSequencer;
Object.defineProperty(CTATSequencer,"PackageListURI",{enumerable:!1,configurable:!1,writable:!1,value:/^([^?]*\/)?package[.]xml$/i});var CTATActionEvaluationData=function(a){CTATBase.call(this,"CTATActionEvaluationData","actionevaluation");var b=0,d=0,e="",g=a;this.setClassification=function(a){this.classification=a};this.isHint=function(){return"HINT"==g};this.hasClassification=function(){return!0};this.setCurrentHintNumber=function(a){b=a};this.setTotalHintsAvailable=function(a){d=a};this.setHintID=function(a){e=a};this.getClassification=function(){return""};this.setEvaluation=function(a){g=a};this.getEvaluation=function(){return g};
this.getAttributeString=function(){var a="";if(!this.isHint())return a;a+='current_hint_number="'+b+'" ';a+='total_hints_available="'+d+'" ';""!==e&&(a+='hint_id="'+e+'" ');return a}};CTATActionEvaluationData.prototype=Object.create(CTATBase.prototype);CTATActionEvaluationData.prototype.constructor=CTATActionEvaluationData;var CTATVariable=function(){this.value=this.name=""};var CTATCurriculumService=function(a){CTATBase.call(this,"CTATCurriculumService","curriculum_service");var b=[],d=this;this.reset=function(){b=[]};this.addVariable=function(a,d){var c=new CTATVariable;c.name=a;c.value=d;b.push(c)};this.sendSummary=function(e){d.ctatdebug("sendSummary ()");var g=new CTATXML,c=e.getXMLObject();e=c.getElementsByTagName("ProblemSummary");e=$("<div>").html(e[0].innerHTML).text();g.xmlToString(c);var c=flashVars.getRawFlashVars(),g=c.curriculum_service_url,f=new CTATXML,
h=f.parse(e),f=f.getElementAttr(h,"CompletionStatus");g?(f&&f.toLowerCase().startsWith("complete")&&(CTATScrim.scrim.nextProblemScrimUp(),a.assignMessageListener(d),a.assignHandler(d)),b=[],this.addVariable("user_guid",c.user_guid),this.addVariable("session_id",c.session_id),this.addVariable("authenticity_token",c.authenticity_token),this.addVariable("school_name",c.school_name),this.addVariable("summary",e),e=c.target_frame,f=c.reuse_swf,c=c.run_problem_url,this.addVariable("targetFrame",e),this.addVariable("reuseSWF",
f),d.ctatdebug("CTATCurriculumService.sendSummary about to send targetFrame = "+e+", reuseSwf "+f+", runProblemUrl "+c),a.send_post_variables(g,b)):"complete"==f&&CTATScrim.scrim.scrimUp(CTATGlobals.languageManager.getString("CONGRATULATIONS_YOU_ARE_DONE"))};this.processOutgoing=function(a){d.ctatdebug('CTATCurriculumService.processOutgoing("'+a+'")')};this.processIncoming=function(a){var b=flashVars.getRawFlashVars().run_problem_url;d.ctatdebug("CTATCurriculumService.processIncoming("+(a?a.substring(0,
12)+"...":"")+") parent.location.replace "+parent.location.replace+', runProblemUrl "'+b+'"');if(b&&parent&&parent.location){var c=CTATCommShell.commShell.getLoggingLibrary();c&&c.then(function(){parent.location.replace(b)},function(){console.log("CTATCurriculumService: cannot chain to logging lib "+c)})}};this.processMessage=function(a){this.ctatdebug("CTATCurriculumService.processMessage("+(a?a.substring(0,30)+"...":"")+")")};this.updateFlashVars=function(a){d.ctatdebug("UpdateFlashVars ()")};this.checkProtocol=
function(a){return"localhost"==a||"127.0.0.1"==a?!0:null===/^http[s]?:\/\/([^\/]+)\//.exec(a)||4096<=a.length?!1:!0}};CTATCurriculumService.prototype=Object.create(CTATBase.prototype);CTATCurriculumService.prototype.constructor=CTATCurriculumService;var CTATHTMLManager=function(){var a=null,b="";this.urldecode=function(a){return decodeURIComponent((a+"").replace(/\+/g,"%20"))};this.showEntities=function(){ctatdebug("showEntities ()");for(var b,e=0;e<a.length;e++)b=a[e],ctatdebug(b)};this.initEntities=function(){null==a&&(a=[],a["&amp;"]="*!*",a["&nbsp;"]="\u00a0",a["&iexcl;"]="\u00a1",a["&cent;"]="\u00a2",a["&pound;"]="\u00a3",a["&curren;"]="\u00a4",a["&yen;"]="\u00a5",a["&brvbar;"]="\u00a6",a["&sect;"]="\u00a7",a["&uml;"]="\u00a8",a["&copy;"]=
"\u00a9",a["&reg;"]="\u00ae",a["&deg;"]="\u00b0",a["&plusmn;"]="\u00b1",a["&sup1;"]="\u00b9",a["&sup2;"]="\u00b2",a["&sup3;"]="\u00b3",a["&acute;"]="\u00b4",a["&micro;"]="\u00b5",a["&frac14;"]="\u00bc",a["&frac12;"]="\u00bd",a["&frac34;"]="\u00be",a["&iquest;"]="\u00bf",a["&Agrave;"]="\u00c0",a["&Aacute;"]="\u00c1",a["&Acirc;"]="\u00c2",a["&Atilde;"]="\u00c3",a["&Auml;"]="\u00c4",a["&Aring;"]="\u00c5",a["&AElig;"]="\u00c6",a["&Ccedil;"]="\u00c7",a["&Egrave;"]="\u00c8",a["&Eacute;"]="\u00c9",a["&Ecirc;"]=
"\u00ca",a["&Euml;"]="\u00cb",a["&Igrave;"]="\u00cc",a["&Iacute;"]="\u00cd",a["&Icirc;"]="\u00ce",a["&Iuml;"]="\u00cf",a["&ETH;"]="\u00d0",a["&Ntilde;"]="\u00d1",a["&Ograve;"]="\u00d2",a["&Oacute;"]="\u00d3",a["&Ocirc;"]="\u00d4",a["&Otilde;"]="\u00d5",a["&Ouml;"]="\u00d6",a["&Oslash;"]="\u00d8",a["&Ugrave;"]="\u00d9",a["&Uacute;"]="\u00da",a["&Ucirc;"]="\u00db",a["&Uuml;"]="\u00dc",a["&Yacute;"]="\u00dd",a["&THORN;"]="\u00de",a["&szlig;"]="\u00df",a["&agrave;"]="\u00e0",a["&aacute;"]="\u00e1",a["&acirc;"]=
"\u00e2",a["&atilde;"]="\u00e3",a["&auml;"]="\u00e4",a["&aring;"]="\u00e5",a["&aelig;"]="\u00e6",a["&ccedil;"]="\u00e7",a["&egrave;"]="\u00e8",a["&eacute;"]="\u00e9",a["&ecirc;"]="\u00ea",a["&euml;"]="\u00eb",a["&igrave;"]="\u00ec",a["&iacute;"]="\u00ed",a["&icirc;"]="\u00ee",a["&iuml;"]="\u00ef",a["&eth;"]="\u00f0",a["&ntilde;"]="\u00f1",a["&ograve;"]="\u00f2",a["&oacute;"]="\u00f3",a["&ocirc;"]="\u00f4",a["&otilde;"]="\u00f5",a["&ouml;"]="\u00f6",a["&oslash;"]="\u00f8",a["&ugrave;"]="\u00f9",a["&uacute;"]=
"\u00fa",a["&ucirc;"]="\u00fb",a["&uuml;"]="\u00fc",a["&yacute;"]="\u00fd",a["&thorn;"]="\u00fe",a["&yuml;"]="\u00ff",a["&gt;"]=">",a["&lt;"]="<",a["&#61;"]="=",a["&361;"]="=",a["&quot;"]='"');ctatdebug("(singleQuoteEscape==true) Replacing &apos; with: \\'");a["&apos;"]="\\'"};this.entitiesConvert=function(a){ctatdebug("entitiesConvert ()");return this.urldecode(unescape(a))};this.entitiesGenerate=function(a){return b=a};this.htmlEncode=function(a){return a};this.htmlDecode=function(a){return"undefined"!==
typeof $?$("<div/>").html(a).text():"undefined"!==typeof Entities?(new Entities).decode(a):a}};"undefined"!==typeof module&&(module.exports=CTATHTMLManager);var CTATLogMessageBuilder=function(){CTATBase.call(this,"CTATLogMessageBuilder","logmessagebuilder");var a=this,b=[],d=[];this.setContextName=function(a){CTATLogMessageBuilder.contextGUID=a};this.getContextName=function(){return CTATLogMessageBuilder.contextGUID};this.makeSessionElement=function(){var a=flashVars.getRawFlashVars();return void 0!=a.log_session_id&&null!=a.log_session_id?"<session_id>"+a.log_session_id+"</session_id>":"<session_id>"+a.session_id+"</session_id>"};this.createContextMessage=
function(b){a.ctatdebug("createContextMessage()");var d=new Date,c=flashVars.getRawFlashVars(),e='<context_message context_message_id="'+this.getContextName()+'" name="START_PROBLEM">';b||(e+=this.makeMetaElement(d));void 0!=c.class_name?""!=c.class_name?(b="<class>"+("<name>"+c.class_name+"</name>"),void 0!=c.school_name&&(b+="<school>"+c.school_name+"</school>"),void 0!=c.period_name&&(b+="<period>"+c.period_name+"</period>"),void 0!=c.class_description&&(b+="<description>"+c.class_description+
"</description>"),void 0!=c.instructor_name&&(b+="<instructor>"+c.instructor_name+"</instructor>"),b+="</class>"):b="<class />":b="<class />";e+=b;b=flashVars.getDatasetTypes();var h=flashVars.getDatasetNames();a.ctatdebug("Check: "+b.length+", "+h.length);if(null!=b&&null!=h){a.ctatdebug("We have valid data set names and types, adding to message ...");for(var d="<dataset>"+("<name>"+c.dataset_name+"</name>"),m=0;m<b.length;m++)a.ctatdebug("Adding ..."),d+='<level type="'+b[m]+'">',d+="<name>"+h[m]+
"</name>";d+="<problem ";a.ctatdebug('Checking vars ["problem_tutorflag"]: '+c.problem_tutorflag);a.ctatdebug('Checking vars ["problem_otherproblemflag"]: '+c.problem_otherproblemflag);if(void 0!=c.problem_tutorflag||void 0!=c.problem_otherproblemflag)void 0!=c.problem_tutorflag?d+=' tutorFlag="'+c.problem_tutorflag+'"':void 0!=c.problem_otherproblemflag&&(d+='tutorFlag="'+c.problem_otherproblemflag+'"');d=d+">"+("<name>"+c.problem_name+"</name>");d=void 0!=c.problem_context?d+("<context>"+c.problem_context+
"</context>"):d+"<context />";d+="</problem>";for(c=0;c<b.length;c++)d+="</level>";e+=d+"</dataset>"}c="";b=flashVars.getConditionNames();d=flashVars.getConditionTypes();h=flashVars.getConditionDescriptions();if(0<b.length)for(m=0;m<b.length;m++)c+="<condition><name>"+b[m]+"</name>",c+=""==d[m]?"":"<type>"+d[m]+"</type>",c+=""==h[m]?"":"<desc>"+h[m]+"</desc>",c+="</condition>";var e=e+c,c=flashVars.getCustomFields(),l;for(l in c)c.hasOwnProperty(l)&&(e+="<custom_field>",e+="<name>"+l+"</name>",e+=
"<value>"+c[l]+"</value>",e+="</custom_field>");e+="</context_message>";a.ctatdebug("messageString = "+e);return e};this.createSemanticEventToolMessage=function(e,g,c,f,h,m){a.ctatdebug("createSemanticEventToolMessage("+m+")");var l=new Date;flashVars.getRawFlashVars();var n='<tool_message context_message_id="'+this.getContextName()+'">';h||(n+=this.makeMetaElement(l));g='<semantic_event transaction_id="'+g+'" name="'+c+'"';""!=f&&(g+=' subtype="'+f+'"');void 0!=m&&""!=m&&(g+=' trigger="'+m+'"');
n+=g+"/>";f="<event_descriptor>";e=e.toXMLString(!0);n+=f+e+"</event_descriptor>";n+=this.createCustomFields(b,d);n+="</tool_message>";a.ctatdebug("messageString = "+n);return n};this.createUIEventToolMessage=function(e,g,c,f){a.ctatdebug("createUIEventToolMessage()");var h=new Date;flashVars.getRawFlashVars();var m='<tool_message context_message_id="'+this.getContextName()+'">';f||(m+=this.makeMetaElement(h));m+='<ui_event name="'+g+'">'+c+"</ui_event>";e="<event_descriptor>"+e.toSerializedString();
m=m+(e+"</event_descriptor>")+this.createCustomFields(b,d);m+="</tool_message>";a.ctatdebug("messageString = "+m);return m};this.createTutorMessage=function(e,g,c,f,h,m,l,n){a.ctatdebug("createTutorMessage()");var p=new Date;flashVars.getRawFlashVars();var x='<tutor_message context_message_id="'+this.getContextName()+'">';n||(x+=this.makeMetaElement(p));g='<semantic_event transaction_id="'+g+'" name="'+c+'"';""!==m&&(g+=' subtype="'+m+'"');x+=g+"/>";e="<event_descriptor>"+e.toXMLString(!0);x+=e+"</event_descriptor>";
e="<action_evaluation ";f.hasClassification()&&null!=f.getAttributeString()&&(e+=f.getAttributeString());e+=">"+f.getEvaluation()+"</action_evaluation>";x+=e;""!=h&&(x+="<tutor_advice>"+h+"</tutor_advice>");null!=l&&(a.ctatdebug("Adding skills to log message ..."),x+=l.toLogString());x+=this.createCustomFields(b,d);x+="</tutor_message>";a.ctatdebug("messageString = "+x);return x};this.createGenericMessage=function(b,d){a.ctatdebug("createGenericMessage()");flashVars.getRawFlashVars();var c='<message context_message_id="'+
this.getContextName()+'">',c=c+b+"</message>";a.ctatdebug("messageString = "+c);return c};this.makeMetaElement=function(b){a.ctatdebug("makeMetaElement ()");var d=flashVars.getRawFlashVars(),c;c="<meta>"+("<user_id>"+d.user_guid+"</user_id>");c+="<session_id>"+d.session_id+"</session_id>";c+="<time>"+this.formatTimeStamp(b)+"</time>";return c+="<time_zone>"+flashVars.getTimeZone()+"</time_zone></meta>"};this.wrapForOLI=function(b){a.ctatdebug("wrapForOLI ()");var d=new Date,c=flashVars.getRawFlashVars();
b=encodeURIComponent(b);var e;e='<?xml version="1.0" encoding="UTF-8"?><log_action '+('auth_token="'+encodeURIComponent(c.auth_token)+'" ');e=void 0!=c.log_session_id&&null!=c.session_id?e+('session_id="'+c.log_session_id+'" '):e+('session_id="'+c.session_id+'" ');e=e+'action_id="EVALUATE_QUESTION" '+('user_guid="'+c.user_guid+'" ');e+='date_time="'+this.formatTimeStampOLI(d)+'" ';e+='timezone="'+flashVars.getTimeZone()+'" ';e+='source_id="'+c.source_id+'" ';e=c.activity_context_guid?e+('external_object_id="'+
c.activity_context_guid+'" info_type="tutor_message.dtd">'):e+'external_object_id="" info_type="tutor_message.dtd">';return e+b+"</log_action>"};this.createLogSessionStart=function(){a.ctatdebug("createLogSessionStart ()");var b=new Date;a.ctatdebug("Date: "+b);var d='<log_session_start timezone="'+flashVars.getTimeZone()+'" ',c=flashVars.getRawFlashVars(),d=d+('date_time="'+this.formatTimeStampOLI(b)+'" '),d=d+('auth_token="'+c.auth_token+'" '),d=d+('session_id="'+c.session_id+'" '),d=d+('user_guid="'+
c.user_guid+'" ');return d+'class_id="" treatment_id="" assignment_id="" info_type="tutor_message.dtd"/>'};this.formatTimeStamp=function(b){a.ctatdebug("formatTimeStamp ("+b+")");var d="",c=b.getUTCFullYear(),d=d+(c+"-"),c=b.getUTCMonth();c++;d+=(10>c?"0"+c:c)+"-";c=b.getUTCDate();d+=(10>c?"0"+c:c)+" ";c=b.getUTCHours();d+=(10>c?"0"+c:c)+":";c=b.getUTCMinutes();d+=(10>c?"0"+c:c)+":";c=b.getUTCSeconds();d+=10>c?"0"+c:c;b=b.getUTCMilliseconds();return d+"."+b};this.formatTimeStampOLI=function(b){a.ctatdebug("formatTimeStampOLI ("+
b+")");var d="",c=b.getUTCFullYear(),d=d+(c+"/"),c=b.getUTCMonth();c++;d+=(10>c?"0"+c:c)+"/";c=b.getUTCDate();d+=(10>c?"0"+c:c)+" ";c=b.getUTCHours();d+=(10>c?"0"+c:c)+":";c=b.getUTCMinutes();d+=(10>c?"0"+c:c)+":";c=b.getUTCSeconds();d+=10>c?"0"+c:c;b=b.getUTCMilliseconds();return d+"."+b};this.resetCustomFields=function(){a.ctatdebug("resetCustomFields ()");b=[];d=[]};this.createCustomFields=function(b,d){a.ctatdebug("createCustomFields ()");if(null==b||null==d)return a.ctatdebug("No custom fields provided"),
"";a.ctatdebug("Processing "+b.length+" custom fields ...");for(var c="",e=0;e<b.length;e++)a.ctatdebug("Adding custom field: ["+b[e]+"],["+d[e]+"]"),c+="<custom_field>",c+="<name>"+b[e]+"</name>",c+="<value>"+d[e]+"</value>",c+="</custom_field>";return c};this.addCustomFields=function(e,g){a.ctatdebug("addCustomFields ()");if(void 0!=e)for(var c=0;c<e.length;c++)b.push(e[c]),d.push(g[c])};this.addCustomField=function(e,g){a.ctatdebug("addCustomfield ("+e+","+g+")");b.push(e);d.push(g)};this.getCustomFieldNames=
function(){return b};this.getCustomFieldValues=function(){return d}};CTATLogMessageBuilder.prototype=Object.create(CTATBase.prototype);CTATLogMessageBuilder.prototype.constructor=CTATLogMessageBuilder;CTATLogMessageBuilder.contextGUID="";CTATLogMessageBuilder.commLogMessageBuilder=null;var CTATCustomLogElementObject=function(){this.reset=function(){};this.addCustomLogElement=function(a,b){customElementsNames.push(a);customElementsTypes.push(a)};this.getCustomElementNames=function(){return customElementsNames};this.getCustomElementTypes=function(){return customElementsTypes}};var loggingDisabled=!1,CTATLoggingLibrary=function(a){CTATBase.call(this,"CTATLoggingLibrary","logginglibrary");var b=this,d=!0,e=!1,g=!1,c=[],f="undefined",h="undefined",m="undefined",l="undefined",n="undefined",p="undefined",x="undefined",q="undefined",v="UnassignedDataset",u="UnassignedLevelName",A="UnassignedLevelType",y=null,C=null,q=CTATGuid.guid();void 0!=a&&null!=a?(e=a,0==e&&(CTATLogMessageBuilder.commLogMessageBuilder=new CTATLogMessageBuilder)):CTATLogMessageBuilder.commLogMessageBuilder=
new CTATLogMessageBuilder;var r=new CTATCommLibrary;r.setName("commLoggingLibrary");r.setUseCommSettings(!1);r.setConnectionRefusedMessage("ERROR_CONN_LS");r.assignHandler(this);r.setFixedURL(CTATConfiguration.get("log_service_url"));this.getLastSAI=function(){return C};this.assignLogListener=function(a){y=a};this.generateSession=function(){c.session_id="ctat_session_"+CTATGuid.guid();return c.session_id};this.setLogClassName=function(a){f=a};this.setDatasetName=function(a){v=a};this.setDatasetLevelName=
function(a){u=a};this.setDatasetLevelType=function(a){A=a};this.setSchool=function(a){h=a};this.setPeriod=function(a){m=a};this.setDescription=function(a){l=a};this.setInstructor=function(a){n=a};this.setProblemName=function(a){p=a};this.setProblemContext=function(a){x=a};this.setUserID=function(a){q=a};this.getLoggingCommLibrary=function(){return r};this.setUseSessionLog=function(a){d=a};this.setLoggingURL=function(a){b.getLoggingCommLibrary().setFixedURL(a)};this.getSessionIdentifierBundle=function(){var a=
[];a.class_name=f;a.school_name=h;a.period_name=m;a.class_description=l;a.instructor_name=n;a.dataset_name=v;a.problem_name=p;a.problem_context=x;a.auth_token="";a.user_guid=q;a.session_id=c.session_id;a.source_id="tutor";a.dataset_level_name1=u;a.dataset_level_type1=A;return a};this.setupExternalLibraryUsage=function(){b.ctatdebug("setupExternalLibraryUsage ()");c.class_name=f;c.school_name=h;c.period_name=m;c.class_description=l;c.instructor_name=n;c.dataset_name=v;c.problem_name=p;c.problem_context=
x;c.auth_token="";c.user_guid=q;c.session_id="ctat_session_"+CTATGuid.guid();c.source_id="tutor";c.dataset_level_name1=u;c.dataset_level_type1=A;flashVars=CTATConfiguration.generateDefaultConfigurationObject();flashVars.assignRawFlashVars(c)};this.initCheck=function(){b.ctatdebug("initCheck ()");0==e&&0==g&&(b.setupExternalLibraryUsage(),g=!0)};this.sendMessage=function(a){b.ctatdebug("sendMessage ()");b.ctatdebug("Raw log message to send: "+a);this.sendMessageInternal(a);null!=y&&y(a)};this.sendMessageInternal=
function(a){b.ctatdebug("sendMessageInternal ()");if(!0===loggingDisabled)b.ctatdebug("Warning: loggingDisabled==true");else if(1==e){var c=CTATConfiguration.get("Logging");if("ClientToService"!=c&&"ClientToLogServer"!=c)b.ctatdebug("Logging is turned off, as per: "+c);else{var d=CTATConfiguration.get("tutoring_service_communication");"ClientToService"!=c||"http"!=d&&"https"!=d||(c=CTATConfiguration.get("remoteSocketURL")+":"+CTATConfiguration.get("remoteSocketPort"),b.setLoggingURL(c),b.ctatdebug("Reconfigured the logging url to be: "+
c));b.ctatdebug("Pre encoded log message: "+a);0>a.indexOf("<log_session_start")&&(a=CTATLogMessageBuilder.commLogMessageBuilder.wrapForOLI('<?xml version="1.0" encoding="UTF-8"?><tutor_related_message_sequence version_number="4">'+a+"</tutor_related_message_sequence>"));b.ctatdebug("Encoded log message: "+a);CTATLMS.logEvent(a);CTATConfiguration.get("log_service_url")&&r.sendXMLNoBundle(a)}}else b.ctatdebug("Use internal: "+e)};this.startProblem=function(){b.ctatdebug("startProblem ()");b.initCheck();
b.logSessionStart();CTATLogMessageBuilder.commLogMessageBuilder||(CTATLogMessageBuilder.commLogMessageBuilder=new CTATLogMessageBuilder);b.sendMessage(CTATLogMessageBuilder.commLogMessageBuilder.createContextMessage(!0))};this.logSessionStart=function(){b.ctatdebug("logSessionStart ()");b.initCheck();var a=CTATConfiguration.getRawFlashVars();void 0!=a.SessionLog&&("false"==a.SessionLog||"boolean"==typeof a.SessionLog&&!1===a.SessionLog?(b.ctatdebug("Turning SessionLog off ..."),d=!1):(b.ctatdebug("Turning SessionLog on ..."),
d=!0));!0===d&&(CTATLogMessageBuilder.commLogMessageBuilder||(CTATLogMessageBuilder.commLogMessageBuilder=new CTATLogMessageBuilder),this.sendMessage(CTATLogMessageBuilder.commLogMessageBuilder.createLogSessionStart()))};this.logSemanticEvent=function(a,c,d,e,f,g,l){b.ctatdebug("logSemanticEvent ("+l+")");b.initCheck();C=c;var h=new Date;CTATLogMessageBuilder.commLogMessageBuilder.resetCustomFields();CTATLogMessageBuilder.commLogMessageBuilder.addCustomFields(f,g);CTATLogMessageBuilder.commLogMessageBuilder.addCustomField("tool_event_time",
CTATLogMessageBuilder.commLogMessageBuilder.formatTimeStamp(h)+" UTC");a=CTATLogMessageBuilder.commLogMessageBuilder.createSemanticEventToolMessage(c,a,d,e,!0,l);this.sendMessage(a)};this.logTutorResponse=function(a,c,d,e,f,g,l,h,u){b.ctatdebug("logTutorResponse ()");b.initCheck();C=c;var m=new Date;CTATLogMessageBuilder.commLogMessageBuilder.resetCustomFields();CTATLogMessageBuilder.commLogMessageBuilder.addCustomFields(h,u);CTATLogMessageBuilder.commLogMessageBuilder.addCustomField("tutor_event_time",
CTATLogMessageBuilder.commLogMessageBuilder.formatTimeStamp(m)+" UTC");b.ctatdebug("Formatting feedback ...");void 0!=g&&null!=g?g="<![CDATA["+CTATGlobals.languageManager.filterString(g)+"]]\x3e":(b.ctatdebug("No feedback provided, using empty string"),g="");b.ctatdebug("Creating tutor message ...");a=CTATLogMessageBuilder.commLogMessageBuilder.createTutorMessage(c,a,d,f,g,e,l,!0);this.sendMessage(a)};this.processMessage=function(a){b.ctatdebug("processMessage ()");b.ctatdebug("Response from log server: "+
a)};this.start=function(){b.ctatdebug("start ()");var a=b.generateSession();b.startProblem();return a};this.logInterfaceAttempt=function(a,c,d,e){b.ctatdebug("logInterfaceAttempt ()");e=CTATGuid.guid();a=new CTATSAI(a,c,d);a.setInput(d);C=a;this.logSemanticEvent(e,a,"ATTEMPT","");return e};this.logInterfaceAttemptSAI=function(a,c){b.ctatdebug("logInterfaceAttemptSAI ()");C=a;var d=CTATGuid.guid();this.logSemanticEvent(d,a,"ATTEMPT","");return d};this.logResponse=function(a,c,d,e,f,g,l,h){b.ctatdebug("logResponse ()");
c=new CTATSAI(c,d,e);c.setInput(e);e=new CTATActionEvaluationData("");e.setEvaluation(g);void 0==h?this.logTutorResponse(a,c,f,"",e,l):this.logTutorResponse(a,c,f,"",e,l,null,h.getCustomElementNames(),h.getCustomElementTypes())};this.logResponseSAI=function(a,c,d,e,f,g){b.ctatdebug("logResponse ()");var l=new CTATActionEvaluationData("");l.setEvaluation(e);void 0==g?this.logTutorResponse(a,c,d,"",l,f):this.logTutorResponse(a,c,d,"",l,f,null,g.getCustomElementNames(),g.getCustomElementTypes())};this.endSession=
function(){this.generateSession()};this.then=function(a,c){return r&&"function"==typeof r.then?r.then(a,c):{then:function(){console.log("CTATLoggingLibrary.then() not supported")}}}};CTATLoggingLibrary.prototype=Object.create(CTATBase.prototype);CTATLoggingLibrary.prototype.constructor=CTATLoggingLibrary;var CTATArgument=function(){var a="",b="Undefined",d="String",e="text";this.setValue=function(a){b=a};this.getValue=function(){return b};this.setName=function(b){a=b};this.getName=function(){return a};this.setType=function(a){d=a};this.getType=function(){return d};this.setFormat=function(a){e=a};this.getFormat=function(){return e}};CTATArgument.prototype.clone=function(){var a=new CTATArgument;a.setValue(this.getValue());a.setType(this.getType());a.setFormat(this.getFormat());return a};
"undefined"!==typeof module&&(module.exports=CTATArgument);var CTATStringUtil=function(){this.String2Boolean=function(a){switch(a){case "0":case "false":case "no":case "FALSE":case "NO":case "No":return!1}return!0};this.replaceString=function(a,b,d){return a.replace(b,d)}};"undefined"!==typeof module&&(module.exports=CTATStringUtil);var CTATSAI=function(a,b,d,e){CTATBase.call(this,"CTATSAI","sai");var g=new CTATStringUtil,c="undefined",f=[],h=[],m=[],l=[],n=null,p=this,n="xml"==CTATConfig.parserType?new CTATXML:new CTATJSON;this.getArguments=function(){return m};this.getArgument=function(a){if(0==m.length){var c=new CTATArgument;m.push(c)}return m[a]};this.getArgumentsTyped=function(){p.ctatdebug("getArgumentsTyped");var a,c=[];for(a=0;a<m.length;a++){var b=m[a];"Boolean"===b.getType()?(p.ctatdebug("Adding Boolean argument ("+
b.getValue()+") ..."),c.push(g.String2Boolean(b.getValue()))):"Number"===b.getType()?(p.ctatdebug("Adding Number argument ("+b.getValue()+") ..."),c.push(Number(b.getValue()))):"String"===b.getType()?"No_Value"===b.getValue()?(p.ctatdebug("Detected default argument ("+b.getValue()+"), setting contents to null instead"),c.push(null)):c.push(String(b.getValue())):p.ctatdebug("Unrecognized argument type: "+b.getType()+" in "+p.toSerializedString()+" IGNORING IT!!!")}p.ctatdebug("Resulting arguments: "+
c);return c};this.addSelection=function(a,c){var b=new CTATArgument;b.setValue(a);void 0!=c&&null!=c&&b.setType(c);f.push(b)};this.addAction=function(a){h.push(a)};this.checkDefaultArgument=function(){p.ctatdebug("checkDefaultArgument ()");if(0===m.length){p.ctatdebug("Adding default argument ...");var a=new CTATArgument;m.push(a)}};this.setArgument=function(a,c){p.checkDefaultArgument();for(var b=m.length;b<=a;++b)m.push(new CTATArgument);b=m[a];b.setValue(c);return b};this.addArgument=function(a,
c,b){this.ctatdebug("addArgument ("+a+","+c+","+b+")");var d=new CTATArgument;d.setValue(a);d.setType(c);d.setFormat(b);m.push(d);return d};this.addExistingArgument=function(a){m.push(a);return a};this.setSAI=function(a,b,d,e,f){p.setSelection(Array.isArray(a)?0<a.length?a[0]:"":a);p.setAction(Array.isArray(b)?0<b.length?b[0]:"":b);p.setInput(Array.isArray(d)?0<d.length?d[0]:"":d);p.setType(e);c=f};this.setInput=function(a){p.ctatdebug("setInput("+a+")");p.checkDefaultArgument();p.getArgument(0).setValue(a)};
this.getInputObject=function(){return 0===m.length?null:m[0]};this.getInput=function(){return 0===m.length?"":p.getArgument(0).getValue()};this.setType=function(a){p.checkDefaultArgument();p.getArgument(0).type=a};this.getType=function(){return 0===m.length?"":p.getArgument(0).type};this.setFormat=function(a){p.checkDefaultArgument();p.getArgument(0).setFormat(a)};this.getFormat=function(){return 0===m.length?"":p.getArgument(0).getFormat()};this.toString=function(){return"["+String(p.getSelection())+
","+String(p.getAction())+","+String(p.getInput())+"]"};this.setSelection=function(a,c){var b=p.getSelectionObject();null==b?(b=new CTATArgument,b.setValue(a),void 0!=c&&null!=c&&b.setType(c),f.push(b)):b.setValue(a)};this.getSelectionObject=function(){return 0==f.length?null:f[0]};this.getSelection=function(){if(0==f.length)return null;var a=f[0];return"object"===typeof a?a.getValue():a};this.setAction=function(a){0<h.length?h[0]=a:h.push(a)};this.getAction=function(){return 0==h.length?null:h[0]};
this.appendToSelectionArray=function(a,c){var b=new CTATArgument;b.setValue(String(a));void 0!=c&&null!=c&&b.setType(c);f.push(b)};this.setSelectionArray=function(a){f=[];for(var c=0;c<a.length;c++)p.appendToSelectionArray(a[c],"String")};this.getSelectionArray=function(){for(var a=[],c=0;c<f.length;c++){var b=f[c];"object"===typeof b?a.push(f[c].getValue()):a.push(b)}return a};this.appendToActionArray=function(a){null==a?h.push(""):h.push(String(a))};this.setActionArray=function(a){h=null==a?[]:
Array.isArray(a)?a.slice():[String(a)]};this.getActionArray=function(){return h};this.appendToInputArray=function(a){p.ctatdebug("appendToInputArray ("+a+")");null==a?p.addArgument("","String","text"):p.addArgument(a,"String","text")};this.setInputArray=function(a){m=[];if(null!=a)for(var c=0;c<a.length;c++)p.appendToInputArray(a[c])};this.getInputArray=function(){p.ctatdebug("getInputArray ("+m.length+")");l=[];for(var a=0;a<m.length;a++){var c=m[a];"object"===typeof c?(p.ctatdebug("Adding object value ("+
c.getValue()+") to temp input array"),l.push(c.getValue())):(p.ctatdebug("Adding string value ("+c+") to temp input array"),l.push(c))}return l};this.setPrompt=function(a){c=a};this.getPrompt=function(){return c};this.propagate=function(a){p.ctatdebug("propagate ()");a=a.getArguments();for(var c=0;c<a.length;c++){var b=a[c],d=m[c];if(null===b||null===d){p.ctatdebug("Internal error: argument lists do not align between received SAI and source SAI");break}d.setValue(b.getValue())}};this.fromString=function(a){a=
n.parse(a);p.fromXML(a)};this.fromXML=function(a){p.ctatdebug("fromXML ()");m=[];a=n.getElementChildren(a);for(var c,b=0;b<a.length;b++){var d=a[b];if("selection"==n.getElementName(d)||"Selection"==n.getElementName(d)){for(var e=n.getElementChildren(d),f=!1,g=0;g<e.length;g++)c=e[g],"value"==n.getElementName(c)&&(c=n.getNodeTextValue(c),1>g?p.setSelectionArray(c):p.appendToSelectionArray(c),f=!0,p.setSelection(c));!1===f&&(c=n.getNodeTextValue(d),p.setSelectionArray(c),p.setSelection(c))}if("action"==
n.getElementName(d)||"Action"==n.getElementName(d)){e=n.getElementChildren(d);f=!1;for(g=0;g<e.length;g++)c=e[g],"value"==n.getElementName(c)&&(c=n.getNodeTextValue(c),1>g?p.setActionArray(c):p.appendToActionArray(c),f=!0,p.setAction(c));!1===f&&(c=n.getNodeTextValue(d),p.setActionArray(c),p.setAction(c))}if("inputArray"==n.getElementName(d)||"value"==n.getElementName(d)||"Input"==n.getElementName(d)){c=n.getElementChildren(d);var l;m=[];e=new CTATHTMLManager;f=new CTATArgument;g=0;m.push(f);for(var h=
0;h<c.length;h++){var q=c[h];"value"==n.getElementName(q)&&(l=n.getElementChildren(q),null!==l?(p.ctatdebug("Parsing SAI input ..."),p.ctatdebug("Childnodes: "+l.length),1===l.length?(l=e.htmlDecode(n.getNodeTextValue(q)),p.ctatdebug("Setting new value to: "+l),f.setValue(l)):(l=e.htmlDecode(n.getNodeTextValue(q)),p.ctatdebug("Setting new value to: "+l),f.setValue(l),f.setName(q.attributes.getNamedItem("name").value),f.setType(q.attributes.getNamedItem("type").value),f.setFormat(q.attributes.getNamedItem("format").value),
g++),1>h?p.setInputArray(l):p.appendToInputArray(l)):(q=e.htmlDecode(n.getNodeTextValue(q)),p.ctatdebug("Setting new value to: "+q),f.setValue(q),1>h?p.setInputArray(q):p.appendToInputArray(q)))}}if("prompt"==n.getElementName(d)||"Prompt"==n.getElementName(d))p.ctatdebug("Parsing prompt ..."),p.setPrompt(n.getNodeTextValue(d))}p.checkDefaultArgument()};this.appendFromElement=function v(a,c,b,d,e){p.ctatdebug("appendFromElement ()");d=String(n.getElementName(c)).toLowerCase();if(d==a||"value"==d)if(d=
n.getElementChildren(c),!Array.isArray(d)||1>d.length)0==e?b.push(n.getNodeTextValue(c)):p.appendToInputArray(n.getNodeTextValue(c));else for(c=0;c<d.length;++c)v(a,d[c],b,c,e)};this.setArrayFromElements=function(a){p.ctatdebug("setArrayFromElements ()");if(!a||!Array.isArray(a)||1>a.length)p.ctatdebug("can't get name: don't know whether selection, action or input");else{var c,b=String(n.getElementName(a[0])).toLowerCase();switch(b){case "selection":p.ctatdebug("Processing selection field ...");f=
[];for(c=0;c<a.length;++c)p.appendFromElement(b,a[c],f,c,!1);break;case "action":p.ctatdebug("Processing action field ...");h=[];for(c=0;c<a.length;++c)p.appendFromElement(b,a[c],h,c,!1);break;case "input":p.ctatdebug("Processing input field ...");m=[];for(c=0;c<a.length;++c)p.appendFromElement(b,a[c],m,c,!0);break;default:console.log('CTATSAI.setArrayFromElements(): unexpected element name "'+b+'"');return}p.ctatdebug("CTATSAI.setArrayFromElements() eltName "+b+", length "+c+", selectionArray "+
p.getSelectionArray()+", actionArray "+p.getActionArray()+", inputArray "+p.getInputArray())}};this.fromXMLInternal=function(a){p.ctatdebug("fromXMLInternal ()");new CTATXML;m=[];a=n.getElementChildren(a);for(var c,b=0;b<a.length;b++){var d=a[b];if("selection"==n.getElementName(d)||"Selection"==n.getElementName(d)){for(var e=n.getElementChildren(d),f=!1,g=0;g<e.length;g++)c=e[g],"value"==n.getElementName(c)&&(c=n.getNodeTextValue(c),1>g?p.setSelectionArray(c):p.appendToSelectionArray(c),f=!0,p.setSelection(c));
!1===f&&(c=n.getNodeTextValue(d),p.setSelectionArray(c),p.setSelection(c))}if("action"==n.getElementName(d)||"Action"==n.getElementName(d)){e=d.childNodes;f=!1;for(g=0;g<e.length;g++)c=e[g],"value"==n.getElementName(c)&&(c=n.getNodeTextValue(c),1>g?p.setActionArray(c):p.appendToActionArray(c),f=!0,p.setAction(c));!1===f&&(c=n.getNodeTextValue(d),p.setActionArray(c),p.setAction(c))}if("inputArray"==n.getElementName(d)||"Input"==n.getElementName(d)){c=d.childNodes;m=[];var e=new CTATHTMLManager,f=new CTATArgument,
g=0,l;m.push(f);for(var h=0;h<c.length;h++)if(l=c[h],"value"==n.getElementName(l)){var v=n.getElementChildren(l);null!==v?(p.ctatdebug("Parsing SAI input ..."),p.ctatdebug("Childnodes: "+v.length),1===v.length?(l=e.htmlDecode(n.getNodeTextValue(l)),p.ctatdebug("Setting new value to: "+l),f.setValue(l)):(l=e.htmlDecode(n.getNodeTextValue(l)),p.ctatdebug("Setting new value to: "+l),f.setValue(l),f.setName(n.getElementAttr("name")),f.setType(n.getElementAttr("type")),f.setFormat(n.getElementAttr("format")),
g++)):(l=e.htmlDecode(n.getNodeTextValue(l)),p.ctatdebug("Setting new value to: "+l),f.setValue(l));1>h?p.setInputArray(l):p.appendToInputArray(l)}}if("prompt"==n.getElementName(d)||"Prompt"==n.getElementName(d))p.ctatdebug("Parsing prompt ..."),p.setPrompt(n.getNodeTextValue(d))}p.checkDefaultArgument()};this.toXMLString=function(a){p.ctatdebug("toXMLString ()");return a?p.toLSxmlString():p.toTSxmlString()};this.toLSxmlString=function(){p.ctatdebug("toLSxmlString ()");for(var a="",c=0;c<f.length;c++){var b=
f[c];"object"===typeof b?(a="String"!=b.getType()?a+('<selection type="'+b.getType()+'">'):a+"<selection>",a+=b.getValue()+"</selection>"):a+="<selection>"+b+"</selection>"}a+="<action>"+p.getAction();for(c=1;c<h.length;c++)a+="</action><action>"+h[c];a+="</action>";for(c=0;c<m.length;c++)b=m[c],a="object"===typeof b?"String"!=b.getType()?a+('<input type="'+b.getType()+'"><![CDATA['+b.getValue()+"]]\x3e</input>"):a+("<input><![CDATA["+b.getValue()+"]]\x3e</input>"):a+("<input><![CDATA["+b+"]]\x3e</input>");
return a};this.toTSxmlString=function(){p.ctatdebug("toTSxmlString ()");var a;a="<Selection><value>"+p.getSelection();for(var c=1;c<f.length;c++){var b=f[c];a="object"===typeof b?a+("</value><value>"+b.getValue()):a+("</value><value>"+b)}a+="</value></Selection><Action><value>"+p.getAction();for(c=1;c<h.length;c++)a+="</value><value>"+h[c];a+="</value></Action><Input>";if(1<m.length)for(c=0;c<m.length;c++)b=m[c],a+='<value fmt="text" name="'+b.getName()+'" type="'+b.getType()+'"><![CDATA['+b.getValue()+
"]]\x3e</value>";else a+="<value><![CDATA["+p.getInput()+"]]\x3e</value>";return a+"</Input>"};this.toSerializedString=function(){var a;a=""+("<selection>"+p.getSelection()+"</selection><action>"+p.getAction()+"</action><inputArray>");for(var c=0;c<m.length;c++){var b=m[c];a+='<value fmt="text" name="'+b.getName()+'" type="'+b.getType()+'">'+b.getValue()+"</value>"}return a+"</inputArray>"};this.clone=function(){p.ctatdebug("clone ()");for(var a=new CTATSAI(p.getSelection(),p.getAction(),p.getInput(),
p.getPrompt()),c=0;c<p.getArguments().length;++c)a.setArgument(c,p.getArgument(c).clone());a.setSelectionArray(p.getSelectionArray().slice());a.setActionArray(p.getActionArray().slice());a.setInputArray(p.getInputArray().slice());p.ctatdebug("CTATSAI.clone() this "+p+", clone "+a+", clone inputArray "+a.getInputArray());return a};this.isDone=function(){var a=p.getSelection(),c=p.getAction();return null==a||null==c?!1:"done"==a.toString().toLowerCase()&&"buttonpressed"==c.toString().toLowerCase()};
var x=!1;if(Array.isArray(a)&&Array.isArray(b)&&(Array.isArray(d)||null==d)&&(p.setSelectionArray(a),p.setActionArray(b),p.setInputArray(d),x=!0,0<a.length&&0<b.length)){p.setSAI(a[0],b[0],null==d?null:d[0],"String",e);return}null!==a&&""!==a&&p.setSelection(a);null!==a&&(p.setSAI(a,b,d,"String",e),x||(p.setSelectionArray(Array.isArray(a)?a:[a]),p.setActionArray(Array.isArray(b)?b:[b]),p.setInputArray(Array.isArray(d)?d:[d]),x=!0))};CTATSAI.prototype=Object.create(CTATBase.prototype);
CTATSAI.prototype.constructor=CTATSAI;CTATSAI.delayedActionRegExp=/^([^:]+):([0-9]+)$/;"undefined"!==typeof module&&(module.exports=CTATSAI);var CTATSkill=function(){CTATBase.call(this,"CTATSkill","skill");var a="",b="",d="",e="",g=0,c="",f=!1,h="",m="",l="",n="",p="";this.setSkillName=function(c){a=c};this.setDisplayName=function(a){b=a};this.setModelName=function(a){e=a};this.setCategory=function(a){d=a};this.setLevel=function(a){!0===isNaN(a)?ctatdebug("Error: attempting to set a level to NaN"):(g=a,this.setPKnown(String(g)))};this.setDescription=function(a){c=a};this.getSkillName=function(){return a};this.getDisplayName=function(){return b};
this.hasDisplayName=function(){return""!==b&&null!==b};this.getModelName=function(){return e};this.hasCategory=function(){return""!==d};this.hasModelName=function(){return""!==e};this.getCategory=function(){return d};this.getLevel=function(){return g};this.getDescription=function(){return c};this.setTouched=function(a){f=a};this.getTouched=function(){return f};this.toXMLString=function(){return""};this.toSetPreferencesXMLString=function(){var e='<skill label="'+b+'" pSlip="'+m+'" description="'+c;
return e+='" pKnown="'+l+'" category="'+d+'" pLearn="'+n+'" name="'+a+'" pGuess="'+h+'" history="'+p+'" />'};this.setPGuess=function(a){h=a};this.getPGuess=function(){return h};this.setPSlip=function(a){m=a};this.getPSlip=function(){return m};this.setPLearn=function(a){n=a};this.getPLearn=function(){return n};this.setPKnown=function(a){l=a};this.getPKnown=function(){return l};this.setSkillHistory=function(a){p=a};this.getSkillHistory=function(){return p}};CTATSkill.prototype=Object.create(CTATBase.prototype);
CTATSkill.prototype.constructor=CTATSkill;var CTATSkillSet=function(){CTATBase.call(this,"CTATSkillSet","skills");this.internalSkillSet=[];var a=this;this.fromXMLString=function(a,d){this.ctatdebug("fromXMLString ()");this.ctatdebug("Skills string: "+a);if(null===a)this.ctatdebug("Warning: skill object is null");else if(""===a)this.ctatdebug("Info: empty skill string provided, bump");else if(a){this.ctatdebug("CTATSkillSet.fromXMLString() Raw:     "+a);var b=d?a:decodeURIComponent(a.replace(/\+/g," "));this.ctatdebug("CTATSkillSet.fromXMLString() Decoded: "+
b);if(null!==/\/<value>.+<\/value>/.exec(b))this.parseByValue(b);else{var g=(new CTATXML).parseXML(b);this.parseByAttributes(g,b)}this.ctatdebug("fromXMLString () done")}else this.ctatdebug("Warning: skill object is undefined or otherwise empty.")};this.fromXMLData=function(a,d){this.ctatdebug("fromXMLData ()");null!==/\/<value>.+<\/value>/.exec(d)?this.parseByValue(d):this.parseByAttributes(a);this.ctatdebug("fromXMLData () done")};this.parseByValue=function(b){this.ctatdebug("parseByValue()");if(b){b=
b.childNodes;for(var d=new CTATXML,e=0;e<b.length;e++){var g=d.getNodeTextValue(b[e]).split("`"),c=g[0].split(" ");4==g.length?this.addSkill(c[0],g[1],g[2],g[3],g[3],c[1]):this.addSkill(c[0],g[1],g[2],g[3],g[4],c[1])}}else a.ctatdebug("Error: aSkills is null")};this.parseDOM=function(a){this.ctatdebug("parseDOM()");var b=new CTATXML;a=b.getElementChildren(a);for(var e=0;e<a.length;e++){var g=b.getNodeTextValue(a[e]).split("`"),c=g[0].split(" ");4==g.length?this.addSkill(c[0],g[1],g[2],g[3],g[3],c[1]):
this.addSkill(c[0],g[1],g[2],g[3],g[4],c[1])}};this.parseByAttributes=function(b){this.ctatdebug("parseByAttributes()");if(b)if(b=b.childNodes)for(var d=0;d<b.length;d++){var e=b[d];if("Skill"==e.nodeName||"skill"==e.nodeName){this.ctatdebug("Parsing node ("+d+"): "+e.nodeName+" -> "+e.nodeValue);var g=e.attributes.getNamedItem("name");if(g=g?g.value:""){var c=e.attributes.getNamedItem("pKnown"),c=c?c.value:"",f=e.attributes.getNamedItem("description"),f=f?f.value:"",h=e.attributes.getNamedItem("label"),
h=h?h.value:"",m=e.attributes.getNamedItem("category"),m=m?m.value:"",l=e.attributes.getNamedItem("pGuess"),l=l?l.value:"",n=e.attributes.getNamedItem("pLearn"),n=n?n.value:"",p=e.attributes.getNamedItem("pSlip"),p=p?p.value:"",e=(e=e.attributes.getNamedItem("history"))?e.value:"";this.addSkill(g,c,.95,f,h,m,l,n,p,e)}}}else this.ctatdebug("Error: list of skill xml elements is null");else a.ctatdebug("Error: aSkills is null")};this.getSkillSet=function(){return this.internalSkillSet};this.getSize=
function(){return this.internalSkillSet.length};this.addSkill=function(a,d,e,g,c,f,h,m,l,n){this.ctatdebug("addSkill() name = "+a+" level = "+d+" mastery = "+e+" aDescription = "+g+" adisplayName = "+c+" aCategory = "+f+" pguess= "+h+" plearn = "+m+" pslip = "+l+" history = "+n);a=this.setSkillLevel(a,d,e);this.ctatdebug("Configuring "+a.getDisplayName());g&&a.setDescription(g);c&&a.setDisplayName(c);f&&a.setCategory(f);(h||0===h)&&a.setPGuess(h);(m||0===m)&&a.setPLearn(m);(l||0===l)&&a.setPSlip(l);
""!==n&&a.setSkillHistory(n);return a};this.addSkillAsObject=function(a){this.addSkill(a.name,a.level,a.mastery,a.description,a.label,a.category,a.pGuess,a.pLearn,a.pSlip,"")};this.setSkillLevel=function(a,d,e){this.ctatdebug("setSkillLevel ("+a+","+d+","+e+")");e=this.getSkill(a);null===e?(this.ctatdebug("Skill not found, creating new one ..."),e=new CTATSkill,e.setSkillName(a),e.setLevel(d),this.internalSkillSet.push(e)):(this.ctatdebug("Skill found, adjusting ..."),e.setLevel(1),e.setLevel(d));
e.setTouched(!0);return e};this.getSkill=function(a){this.ctatdebug("getSkill ("+a+") -> "+this.internalSkillSet.length);if(!a)return null;for(var b=0;b<this.internalSkillSet.length;b++){var e=this.internalSkillSet[b];if(e.getSkillName()==a)return this.ctatdebug("Returning: "+b),e}return null};this.getSkillLevel=function(a){if(!a)return-1;for(var b in this.internalSkillSet)if(b.getSkillName()==a)return b.getLevel();return-1};this.getTouched=function(){this.ctatdebug("getTouched ()");for(var a=[],
d=0;d<this.internalSkillSet.length;d++){var e=this.internalSkillSet[d];!0===e.getTouched()&&(this.ctatdebug("Adding touched skill: "+e.getSkillName()),a.push(e))}return a};this.untouchSkills=function(){this.ctatdebug("untouchSkills ()");for(var a=0;a<this.internalSkillSet.length;a++)this.internalSkillSet[a].setTouched(!1)};this.toSetPreferencesXMLString=function(){this.ctatdebug("toSetPreferencesXMLString ()");for(var a="<skills>",d=0;d<this.internalSkillSet.length;d++)a+=this.internalSkillSet[d].toSetPreferencesXMLString();
return a+"</skills>"};this.toLogString=function(){this.ctatdebug("toLogString ("+this.internalSkillSet.length+")");for(var a="",d=0;d<this.internalSkillSet.length;d++){var e=this.internalSkillSet[d],a=a+('<skill probability="'+e.getLevel()+'"><name>'+e.getSkillName()+"</name>");e.hasCategory()&&(a+="<category>"+e.getCategory()+"</category>");e.hasModelName()&&(a+="<model_name>"+e.getModelName()+"</model_name>");a+="</skill>"}return a}};CTATSkillSet.prototype=Object.create(CTATBase.prototype);
CTATSkillSet.prototype.constructor=CTATSkillSet;CTATSkillSet.skills=null;"undefined"!==typeof module&&(module.exports=CTATSkillSet);function CTATJSONObject(a,b){this.name=a||"";this.value=b||null}
var transformArray=[],CTATJSON=function(){CTATBase.call(this,"CTATJSON","json");var a=null,b=0;this.isJSONObject=function(a){return a.ctat?!0:!1};this.parse=function(a){return this.parseJSON(a)};this.parseJSON=function(b){this.ctatdebug("parseJSON ()");a=null;if("string"==typeof b){this.ctatdebug("Parsing JSON as a string ... ");try{a=JSON.parse(b)}catch(g){return this.ctatdebug("Error parsing JSON message: "+g.message),a=null}this.ctatdebug("Successfully parsed JSON string")}this.ctatdebug("JSON string has already been parsed, assigning as an object ...");for(var d in a)return this.ctatdebug("Creating internal JSON object with name: "+
d),b=new CTATJSONObject,b.name=d,b.value=a[d],b;return null};this.getElementName=function(a){return"object"!=typeof a?(this.ctatdebug("Internal error, the provided element is not of type CTATJSONObject, instead we found: "+typeof a),null):a.name};this.getElementValue=function(a){return null==a?(this.ctatdebug("Error: anElement is null"),null):"object"!=typeof a?(this.ctatdebug("Internal error, the provided element is not of type CTATJSONObject, instead we found: "+typeof a),null):a.value};this.getElementChildren=
function(a){if(null==a)return this.ctatdebug("Error: anElement is null"),null;if("object"!=typeof a)return this.ctatdebug("Internal error, the provided element is not of type CTATJSONObject, instead we found: "+typeof a),null;var b=a.value,d=[],c;for(c in b){var f=b[c];if("string"==typeof f)a=new CTATJSONObject,a.name=c,a.value=f,d.push(a);else if(null==f[0]||void 0==f[0])a=new CTATJSONObject,a.name=c,a.value=f,d.push(a);else for(var h in f)a=new CTATJSONObject,a.name=c,a.value=f[h],d.push(a)}return d};
this.getNodeTextValue=function(a){if("string"!=typeof a.value){var b=null;for(b in a.value)if("content"==b)return a.value[b].toString();for(b in a.value)if("value"==b)return a.value[b].toString()}return a.value};this.getElementAttr=function(a,b){var d=a.value,c;for(c in d)if(c==b)return d[c];return null};this.isArray=function(a){return"[object Array]"===Object.prototype.toString.call(a)};this.walkDOM=function(a){this.ctatdebug("walkDOM () >>>>>>>>>>>>>>>>>>");b=0;this.walk(a);this.ctatdebug("walkDOM () <<<<<<<<<<<<<<<<<<")};
this.walk=function(a){b++;if(!(5<b)){var d=0,g;for(g in a){var c=a[g];this.ctatdebug("("+d+") typeof (key): "+typeof g+" -> typeof(value): "+typeof c+"("+c.length+")");"string"!=typeof c?(this.ctatdebug("walk ("+g+")"),this.walk(c)):this.ctatdebug("walk ("+g+") : "+c);d++}}};this.stringify=function(a){return this.toJSONString(a)};this.toJSONString=function(a){return JSON.stringify(a,null,2)};this.syntaxHighlight=function(a){"string"!=typeof a&&(a=JSON.stringify(a,void 0,2));a=a.replace(/&/g,"&amp;").replace(/</g,
"&lt;").replace(/>/g,"&gt;");return a.replace(/("(\\u[a-zA-Z0-9]{4}|\\[^u]|[^\\"])*"(\s*:)?|\b(true|false|null)\b|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?)/g,function(a){var b="number";/^"/.test(a)?b=/:$/.test(a)?"key":"string":/true|false/.test(a)?b="boolean":/null/.test(a)&&(b="null");return'<span class="'+b+'">'+a+"</span>"})}};CTATJSON.prototype=Object.create(CTATBase.prototype);CTATJSON.prototype.constructor=CTATJSON;"undefined"!==typeof module&&(module.exports=CTATJSON);var CTATMessage=function(a){function b(a){var b=[],d=c.getElementChildren(a);this.ctatdebug("CTATMessage.parseCustomFields("+c.stringify(a)+"): valueElts.length "+d.length);for(a=0;a<d.length;++a){var e=d[a];"value"!=c.getElementName(e)?console.log("CTATMessage.parseRules(): unexpected element name "+c.getElementName(e)+" at custom_fields["+a+"]"):(e=c.getNodeTextValue(e))&&b.push(e)}return b}function d(a){var b={},d=c.getElementChildren(a);this.ctatdebug("CTATMessage.parseCustomFields("+c.stringify(a)+
"): cfElts.length "+d.length);for(a=0;a<d.length;++a){var e=d[a];if("custom_field"==c.getElementName(e)){for(var f=null,g=null,e=c.getElementChildren(e),l=0,h=0;l<e.length&&2>h;++l){var m=e[l];switch(c.getElementName(m)){case "name":f=c.getNodeTextValue(m);h++;break;case "value":g=c.getNodeTextValue(m),h++}}f&&(b[f]=g?g:"",this.ctatdebug("CTATMessage.parseCustomFields(): result["+f+"]="+b[f]+";"))}}return b}CTATBase.call(this,"CTATMessage","message");CTATMessage.makeTransactionId=function(){return CTATGuid.guid()};
var e=a,g=null,c=null;void 0==a&&(e=null);c="xml"==CTATConfig.parserType?new CTATXML:new CTATJSON;e&&(this.ctatdebug("messageParser "+c+", messageObj "+e),e.children&&this.ctatdebug(e.children));var f="ungraded",h=!1,m=!1,l=new CTATSkillSet,n="",p="",x="",q="",v="",u,A=null,y=null,C=null,r=!1;this.setURL=function(a){u=a};this.getURL=function(){return u};this.assignSAI=function(a){m=!0;A=a};this.setTransactionID=function(a){p=a};this.getTransactionID=function(){return p};this.setGradeResult=function(a){f=
a};this.getGradeResult=function(){return f};this.getXMLObject=function(){return e};this.getSkillsObject=function(){return l};this.getCustomFields=function(){return y};this.getRules=function(){return C};this.getSuccessMessage=function(){return x};this.getBuggyMsg=function(){return q};this.getHighlightMsg=function(){return v};this.parse=function(){this.ctatdebug("parse ()");if(null!==e){this.ctatdebug("messageParser: "+c);this.ctatdebug("Root name: "+c.getElementName(e));"tool_message"==c.getElementName(e)?
(this.ctatdebug("Detected tool message"),n="tool_message"):"message"!=c.getElementName(e)?(this.ctatdebug("Detected log message"),h=!0,n=c.getElementName(e)):(this.ctatdebug("Detected regular message"),h=!1,this.parseMessageType());this.parseTransactionID();this.parseSAI();for(var a=c.getElementChildren(e),b=0;b<a.length;b++){var d=a[b];"properties"==c.getElementName(d)&&(ctatdebug("Found a 'properties' element ... "),g=c.getElementChildren(d))}this.ctatdebug("Message "+n+", with transaction id: "+
p)}};this.parseSAI=function(){this.ctatdebug("parseSAI ()");var a="",f="",g="",p="",r=[],E=[],w=[];if("tool_message"==n){this.ctatdebug("Parsing s, a and i");a=c.getElementChildren(e);for(f=0;f<a.length;f++)if(g=a[f],"tool_message"==c.getElementName(g))for(g=c.getElementChildren(g),p=0;p<g.length;p++)r=g[p],"event_descriptor"==c.getElementName(r)&&(A=new CTATSAI,A.fromXMLInternal(r));m=!0}else{if(h){this.ctatdebug("isLogMessage ...");for(var z=c.getElementChildren(e),K=0;K<z.length;K++){var M=z[K];
if("event_descriptor"==c.getElementName(M))for(var M=c.getElementChildren(M),L=0;L<M.length;L++){var G=M[L];"selection"==c.getElementName(G)&&(a=c.getNodeTextValue(G),r.push(G));"action"==c.getElementName(G)&&(f=c.getNodeTextValue(G),E.push(G));"input"==c.getElementName(G)&&(g=c.getNodeTextValue(G),w.push(G));"prompt"==c.getElementName(G)&&(p=c.getNodeTextValue(G))}}}else for(this.ctatdebug("!isLogMessage ..."),z=c.getElementChildren(e),K=0;K<z.length;K++)if(M=z[K],"properties"==c.getElementName(M))for(M=
c.getElementChildren(M),L=0;L<M.length;L++){var G=M[L],U=c.getElementName(G);this.ctatdebug("Nodename: "+U);switch(U){case "URL":u=c.getNodeTextValue(G);break;case "Skills":l.parseByValue(G);break;case "SuccessMsg":x=a=c.getNodeTextValue(G);break;case "BuggyMsg":q=c.getNodeTextValue(G);break;case "Selection":a=c.getNodeTextValue(G);r.push(G);break;case "Action":f=c.getNodeTextValue(G);E.push(G);break;case "Input":g=c.getNodeTextValue(G);w.push(G);break;case "prompt":p=c.getNodeTextValue(G);break;
case "HighlightMsgText":v=c.getNodeTextValue(G);break;case "custom_fields":y=d(G);break;case "Rules":C=b(G)}}this.ctatdebug("SAI: "+a+","+f+","+g);""!==a&&null!==a?(A=new CTATSAI(a,f,g,p),A.setArrayFromElements(r),A.setArrayFromElements(E),A.setArrayFromElements(w),m=!0):(this.ctatdebug("No SAI found"),m=!1);this.ctatdebug("parseSAI () done, hassai: "+m+", ("+a+","+f+","+g+","+p+")")}};this.parseTransactionID=function(){this.ctatdebug("parseTransactionID()");if("tool_message"!=n){if(!h)for(var a=
c.getElementChildren(e),b=0;b<a.length;b++){var d=a[b];if("properties"==c.getElementName(d))for(var d=c.getElementChildren(d),f=0;f<d.length;f++){var g=d[f];"transaction_id"==c.getElementName(g)&&(p=c.getNodeTextValue(g))}}this.ctatdebug("parseTransactionID() done, id: "+p)}};this.parseMessageType=function(){this.ctatdebug("parseMessageType()");for(var a=c.getElementChildren(e),b=0;b<a.length;b++){var d=a[b];if("properties"==c.getElementName(d))for(var d=c.getElementChildren(d),f=0;f<d.length;f++){var g=
d[f];"MessageType"==c.getElementName(g)&&(n=c.getNodeTextValue(g))}}this.ctatdebug("parseMessageType() -> "+n)};this.getMessageType=function(){return n};this.getTransactionID=function(){return p};this.getSAI=function(){return m?A:new CTATSAI};this.getSelection=function(){return m?A.getSelection():""};this.getAction=function(){return m?A.getAction():""};this.getInput=function(){return m?A.getInput():""};this.getSelectionArray=function(){return m?A.getSelectionArray():[]};this.getActionArray=function(){return m?
A.getActionArray():[]};this.getInputArray=function(){return m?A.getInputArray():[]};this.getXML=function(){return e};this.getXMLString=function(a){if(e.xml)return e.xml;if(XMLSerializer)return(new XMLSerializer).serializeToString(e);alert("ERROR: Extremely old browser");return""};this.getIndicator=function(){return"AssociatedRules"!=n?"":this.getProperty("Indicator")};this.getIndicatorSub=function(){return"AssociatedRules"!=n?"":this.getProperty("IndicatorSub")};this.setProperty=function(a,b){this.ctatdebug("setProperty ("+
a+","+b+")");if(null!==g)for(var d=0;d<g.length;d++)c.getElementName(g[d]);else this.ctatdebug("Internal error: no messageProperties object available")};this.getProperty=function(a){if(!h)if(null!==g)for(var b=0;b<g.length;b++){var d=g[b];if(c.getElementName(d)==a)return c.getNodeTextValue(d)}else this.ctatdebug("Internal error: no messageProperties object available");return""};this.hasProperty=function(a){a=this.getProperty(a);return!h&&""!==a};this.hasSAI=function(){return m};this.isEndOfTransaction=
function(){return"true"==this.getProperty("end_of_transaction")?!0:!1};this.isLogMessageType=function(){return h};this.hasStudentSAI=function(){return!1};this.getStudentSelection=function(){return null.getSelection()};this.getStudentAction=function(){return null.getAction()};this.getStudentInput=function(){return null.getInput()};this.getStudentSAI=function(){return null};this.getToolSelection=function(){return""};p=CTATMessage.makeTransactionId();this.parse();this.init=function(a){this.setMessageType(a)};
this.setSelection=function(a){A&&A.setSelection(a);this.setProperty("SELECTION",a)};this.setAction=function(a){A&&A.setAction(a);this.setProperty("ACTION",a)};this.setInput=function(a){A&&A.setInput(a);this.setProperty("INPUT",a)};this.lockTransactionId=function(a){if(null===a||"undefined"===typeof a||1>a.length)throw new CTATExampleTracerException("lockTranactionId() argument "+a+" must be a valid id");this.setProperty(CTATMessage.TRANSACTION_ID_TAG,a);r=!0};this.setMessageType=function(a){this.setProperty(CTATMessage.MESSAGE_TYPE,
a);n=a};this.setTransactionId=function(a){if(!r){if(null===a||"undefined"===typeof a||1>a.length)a=CTATMessage.makeTransactionId();this.setProperty(CTATMessage.TRANSACTION_ID_TAG,a)}};CTATMessage.create=function(a,c){var b=new CTATMessage;b.init(a);return b}};Object.defineProperty(CTATMessage,"MESSAGE_TYPE",{enumerable:!1,configurable:!1,writable:!1,value:"MessageType"});Object.defineProperty(CTATMessage,"TRANSACTION_ID_TAG",{enumerable:!1,configurable:!1,writable:!1,value:"transaction_id"});
CTATMessage.prototype=Object.create(CTATBase.prototype);CTATMessage.prototype.constructor=CTATMessage;"undefined"!==typeof module&&(module.exports=CTATMessage);var CTATComponentDescription=function(){CTATBase.call(this,"CTATComponentDescription","");this.groupName=this.name=this.type="Unknown";this.height=this.width=this.y=this.x=0;this.tabIndex=this.zIndex=-1;this.styles={};this.params={};this.componentPointer=null;this.setComponentPointer=function(a){this.componentPointer=a};this.getComponentPointer=function(){return this.componentPointer};this.setGenericDefaults=function(){this.name="Generic name";this.styles={BackgroundColor:null,BorderColor:null,FontName:null,
FontSize:null,FontColor:null,FontBold:null,FontItalic:!1,FontUnderlined:!1,TextAlign:null,ShowHintHighlight:!1,blockOnCorrect:!1,disabledBackgroundColor:"#999999",disabledTextColor:"#999999",tutorComponent:null};return this}};CTATComponentDescription.prototype=Object.create(CTATBase.prototype);CTATComponentDescription.prototype.constructor=CTATComponentDescription;var CTATShellTools={ctat_base:new CTATBase("CTATShellTools","shelltools"),component_descriptions:{},registerComponentDescription:function(a){CTATShellTools.ctat_base.ctatdebug("registerComponentDescription ("+a.name+","+a.type+")");CTATShellTools.component_descriptions[a.name]=a},listComponents:function(){CTATShellTools.ctat_base.ctatdebug("listComponents ()");var a=CTATShellTools.component_descriptions,b;for(b in a){var d=a[b];CTATShellTools.ctat_base.ctatdebug("Obtaining component for "+d.name+
" with type: "+d.type);d=d.getComponentPointer();null!==d?CTATShellTools.ctat_base.ctatdebug("Component: "+d.getName()+" of instance: "+d.getClassName()):CTATShellTools.ctat_base.ctatdebug("Error: component pointer is null")}},feedback_components:[],registerFeedbackComponent:function(a,b,d,e,g){CTATShellTools.feedback_components.push({component:a,next:b,prev:d,showHints:e,showFeedback:g})},showNextHint:function(){CTATShellTools.feedback_components.forEach(function(a){a.next&&a.next.bind(a.component)()})},
showPrevHint:function(){CTATShellTools.feedback_components.forEach(function(a){a.prev&&a.prev.bind(a.component)()})},showFeedback:function(a){0==CTATShellTools.feedback_components.length?CTATScrim.scrim.OKScrimUp(a,null):CTATShellTools.feedback_components.forEach(function(b){b.showFeedback&&b.showFeedback.bind(b.component)(a)})},showHints:function(a){CTATShellTools.feedback_components.forEach(function(b){b.showHints&&b.showHints.bind(b.component)(a)})},getCurrentMs:function(){return(new Date).valueOf()},
getAllComponents:function(){var a=[];$(".CTATComponent").each(function(){a.push($(this).data("CTATComponent"))});return a},getNameFromGroup:function(a){CTATShellTools.ctat_base.ctatdebug("getNameFromGroup ("+a+")");var b=a.split(" ");return 1==b.length?a:b[0].substring(0,b[0].length-1)},findComponent:function(a){var b=CTATShellTools.component_descriptions,d=[],e=null;CTATShellTools.ctat_base.ctatdebug("findComponent("+a+")");if(!a)return[];for(var g=['div[data-ctat-component]:has(input[name="'+a+
'"])',"done"==a.toLowerCase()?".CTATDoneButton":"","hint"==a.toLowerCase()||"help"==a.toLowerCase()?".CTATHintButton":""],e=-1<a.indexOf(".")?$('[id="'+a+'"]'):$("#"+a),c=0;0===e.length&&c<g.length;c++)e=$(g[c]);if(0<e.length&&(e.each(function(){$(this).data("CTATComponent")&&d.push($(this).data("CTATComponent"))}),0<d.length))return d;CTATShellTools.ctat_base.ctatdebug("JQuery couldn't find the component, let's try our internal list ...");for(var f in b){e=b[f];if(!e||!e.name||!e.getComponentPointer())return CTATShellTools.ctat_base.ctatdebug("Internal error parsing component at index "+
f+(e?e.name?"(no component pointer)":"(no name attribute)":"")),null;CTATShellTools.ctat_base.ctatdebug("Comparing "+e.name+" to: "+a);if(e.name==a)return CTATShellTools.ctat_base.ctatdebug("Found a component description for ["+e.name+"], returning pointer ("+e.getComponentPointer()+") ..."),d.push(e.getComponentPointer()),d;e.groupName==a&&(CTATShellTools.ctat_base.ctatdebug("Found the component group ("+e.groupName+"), adding component instance for "+e.name+" ..."),d.push(e.getComponentPointer()))}return 0===
d.length&&(CTATShellTools.ctat_base.ctatdebug("Info (groupArray.length==0), no appropriate component found, perhaps this is a group component"),-1!=a.indexOf("."))?(a=a.split("."),this.findComponent(a[0])):d},findComponentInstance:function(a,b){var d=CTATShellTools.findComponent(a,b);return 1==d.length?d[0]:d},findComponentByClass:function(a){var b=CTATShellTools.component_descriptions,d;for(d in b){var e=b[d];if(null===e)return null;if(null!==e.getComponentPointer()&&e.getComponentPointer().getClassName()==
a)return e.getComponentPointer()}a=$("."+a);return 0<a.length?a.first().data("CTATComponent"):null}};var CTATTutoringServiceMessageBuilder=function(){CTATBase.call(this,"CTATTutoringServiceMessageBuilder","__undefined__");this.createStartProblemMessage=function(a){this.ctatdebug("createStartProblemMessage ()");return"<message><verb>NotePropertySet</verb><properties><MessageType>StartProblem</MessageType><ProblemName>"+a+"</ProblemName></properties></message>"};this.createInterfaceIdentificationMessage=function(a){this.ctatdebug("createInterfaceIdentificationMessage ("+a+")");return"<message><verb>NotePropertySet</verb><properties><MessageType>InterfaceIdentification</MessageType><Guid>"+
a+"</Guid></properties></message>"};this.createInterfaceDescriptionMessage=function(a){this.ctatdebug("createInterfaceDescriptionMessage ()");message="<message><verb>NotePropertySet</verb><properties><MessageType>InterfaceDescription</MessageType>";message+="<WidgetType>"+a.getClassName()+"</WidgetType>";message+="<CommName>"+a.getName()+"</CommName>";message+="<UpdateEachCycle>false</UpdateEachCycle>";message+="<serialized>";message+="<"+a.getClassName()+' name="'+a.getName()+'" x="0" y="0" width="50" height="30" scaleX="1" scaleY="1" originalWidth="50" originalHeight="30" zIndex="-1" tabIndex="-1">';
message+="<Parameters><selection>";if("CTATRadioButton"==a.getClassName()||"CTATCheckBox"==a.getClassName())message+="<CTATComponentParameter>",message+="<name>group</name>",message+='<value fmt="text" name="Group Name" type="String" includein="sparse">'+a.getComponentGroup()+"</value>",message+="</CTATComponentParameter>";message+="</selection></Parameters>";message+="</"+a.getClassName()+">";message+="</serialized>";return message+="</properties></message>"};this.createSetPreferencesMessage=function(a){this.ctatdebug("createSetPreferencesMessage ()");
var b=CTATConfiguration.getRawFlashVars(),d;d="<message><verb>NotePropertySet</verb><properties><MessageType>SetPreferences</MessageType>"+("<log_service_url>"+b.log_service_url+"</log_service_url>");var e=!1,g=!1,c=b.Logging;this.ctatdebug("Parsing and processing logMethod: "+c);switch(c){case "ServiceToLogServer":e=!0;break;case "ServiceToDisk":g=!0;break;case "ServiceToDiskAndLogServer":g=e=!0;break;case "ClientToLogServer":g=e=!1;break;case "ClientToService":g=e=!0}d=d+("<log_to_remote_server>"+
e+"</log_to_remote_server><log_to_disk>"+g+"</log_to_disk>")+("<log_to_disk_directory>"+b.log_to_disk_directory+"</log_to_disk_directory>");d+="<logging>"+b.Logging+"</logging>";d+="<user_guid>"+b.user_guid+"</user_guid>";d+="<problem_name>"+b.problem_name+"</problem_name>";d+="<question_file><![CDATA["+b.question_file+"]]\x3e</question_file>";d+="<class_name>"+b.class_name+"</class_name>";d+="<school_name>"+b.school_name+"</school_name>";d+="<instructor_name>"+b.instructor_name+"</instructor_name>";
d+="<session_id>"+b.session_id+"</session_id>";d+="<source_id>"+b.source_id+"</source_id>";d+="<sui><![CDATA["+b.sui+"]]\x3e</sui>";d+="<problem_state_status>"+b.problem_state_status+"</problem_state_status>";d+="<curriculum_service_url>"+b.curriculum_service_url+"</curriculum_service_url>";d+="<restore_problem_url>"+b.restore_problem_url+"</restore_problem_url>";d+="<tutoring_service_communication>"+b.tutoring_service_communication+"</tutoring_service_communication>";d+="<mode>"+b.mode+"</mode>";
d+="<collaborators>"+b.collaborators+"</collaborators>";null!==CTATSkillSet.skills&&(d+=CTATSkillSet.skills.toSetPreferencesXMLString());d=d+("<CommShellVersion>"+a+"</CommShellVersion>")+"</properties></message>";return""+d};this.createTracerActionMessage=function(a,b){this.ctatdebug("createTracerActionMessage ()");var d;d="<message><verb>NotePropertySet</verb><properties><MessageType>TracerAction</MessageType>"+("<transaction_id>"+a+"</transaction_id>")+b.toXMLString(!1);return""+(d+"</properties></message>")};
this.createInterfaceActionMessage=function(a,b){this.ctatdebug("createInterfaceActionMessage ()");var d;d="<message><verb>NotePropertySet</verb><properties><MessageType>InterfaceAction</MessageType>"+("<transaction_id>"+a+"</transaction_id>")+b.toXMLString(!1);return""+(d+"</properties></message>")};this.createUntutoredActionMessage=function(a,b){this.ctatdebug("createUntutoredActionMessage ("+a+")");var d;d="<message><verb>NotePropertySet</verb><properties><MessageType>UntutoredAction</MessageType>"+
("<transaction_id>"+a+"</transaction_id>")+b.toXMLString(!1);return""+(d+"</properties></message>")};this.createProblemSummaryRequestMessage=function(){return"<message><verb>NotePropertySet</verb><properties><MessageType>ProblemSummaryRequest</MessageType></properties></message>"};this.createProblemRestoreEndMessage=function(){return"<message><verb>NotePropertySet</verb><properties><MessageType>ProblemRestoreEnd</MessageType></properties></message>"};this.createInterfaceConfigurationEnd=function(){return"<message><verb>NotePropertySet</verb><properties><MessageType>InterfaceConfigurationEnd</MessageType></properties></message>"};
this.createInCorrectActionMessage=function(a,b){this.ctatdebug("createInCorrectActionMessage ()");var d;d="<message><verb>SendNoteProperty</verb><properties><MessageType>InCorrectAction</MessageType>"+("<transaction_id>"+a+"</transaction_id>")+b.toXMLString(!1);return""+(d+"</properties></message>")};this.createURLResponse=function(a,b){CTATGlobal.debug(classType,"createURLResponse ()");return"<message><verb>NotePropertySet</verb><properties><MessageType>GetURLResponse</MessageType><URL><![CDATA[ "+
a+" ]]\x3e</URL><content><![CDATA[ "+btoa(b)+" ]]\x3e</content></properties></message>"};this.createCorrectActionMessage=function(a,b){this.ctatdebug("createCorrectActionMessage ()");var d;d="<message><verb>SendNoteProperty</verb><properties><MessageType>CorrectAction</MessageType>"+("<transaction_id>"+a+"</transaction_id>")+b.toXMLString(!1);return""+(d+"</properties></message>")}};CTATTutoringServiceMessageBuilder.prototype=Object.create(CTATBase.prototype);
CTATTutoringServiceMessageBuilder.prototype.constructor=CTATTutoringServiceMessageBuilder;var CTATMessageHandler=function(a){function b(){var a=!1,c,b=[],d="";for(c=g.length-1;0<=c;--c)if("SendWidgetLock"==g[c].getMessageType())switch(b=g.splice(c,1),d=b[0].getProperty("WidgetLockFlag"),String(d).toLowerCase()){case "no":case "off":case "false":a=!1;break;default:a=!0}e.ctatdebug("checkForSendWidgetLock() found "+b.length+" msg, wlFlag "+d+", result"+a);return a}CTATBase.call(this,"CTATMessageHandler","messagehandler");var d=null,e=this,g=[],c=null,f=0,c=CTATConfig.parserType_is_XML()?
new CTATXML:new CTATJSON;this.assignHandler=function(a){e.ctatdebug("assignHandler ()");d=a};this.reset=function(){e.ctatdebug("reset ()");g=[]};this.getInStartState=function(){return CTATMessageHandler.inStartState};var h=!1;this.receiveFromTutor=function(a){this.processMessage(a)};this.processMessage=function(a){e.ctatdebug("Incoming message: "+a);if(!0!==h)if(CTATConfig.parserType_is_JSON()&&-1!=a.indexOf("<?xml"))alert("Error: CTAT is configured to parse JSON but it received an XML message, disabling comm capabilities ..."),
h=!0;else if(CTATConfig.parserType_is_XML()&&0===a.indexOf("{"))alert("Error: CTAT is configured to parse XML but it received a JSON message, disabling comm capabilities ..."),h=!0;else{var b;e.ctatdebug("Attempting parse ...");b=c.parse(a);null===b?e.ctatdebug("Error parsing message: "+a):this.parseElement(b,a)}};this.parseElement=function(a,b){var d=c.getElementName(a);e.ctatdebug("parseElement ("+d+")");"CTATResponseMessages"!=d&&"StartStateMessages"!=d&&"MessageBundle"!=d||this.processMessageBundle(a);
"message"==d&&this.processSingleMessage(a,b)};this.processMessageBundle=function(a,b){var d=c.getElementName(a);e.ctatdebug("processMessageBundle ("+d+")");d=c.getElementChildren(a);if(null===d)e.ctatdebug("Error parsing bundle");else{ctatdebug("Processing "+d.length+" objects in bundle");for(var f=0;f<d.length;f++)this.parseElement(d[f])}};this.processSingleMessage=function(b,l){e.ctatdebug("processSingleMessage ("+c.getElementName(b)+")");a.sendToTools(l);l=new CTATMessage(b);var h=l.getProperty("subtype"),
h=!h||/tutor/i.test(h)?"tutor":h;d.updateLastActionTimestamp&&d.updateLastActionTimestamp();var m=c.getElementChildren(b);e.ctatdebug("Generated CTATMessage, now doing regular processing ...");for(var x=0;x<m.length;x++){var q=m[x];if("properties"==c.getElementName(q)){e.ctatdebug("Parsing properties ...");for(var v=c.getElementChildren(q),u=0;u<v.length;u++){var A=v[u];if("MessageType"==c.getElementName(A)){A=c.getNodeTextValue(A);e.ctatdebug("MessageType: "+A);switch(A){case "StateGraph":ctatdebug("Setting inStartState to true");
CTATMessageHandler.inStartState=!0;a.setGotProblemRestoreEnd(!1);this.processStateGraph(q);a.propagateShellEvent("StateGraph",l);break;case "StartProblem":e.ctatdebug("Setting inStartState to true");CTATMessageHandler.inStartState=!0;a.setGotProblemRestoreEnd(!1);this.processStartProblem(v);a.propagateShellEvent("StartProblem",l);break;case "InterfaceIdentification":this.processInterfaceIdentification(v);a.propagateShellEvent("InterfaceIdentification",l);break;case "InterfaceDescription":this.processInterfaceDescription(v);
a.propagateShellEvent("InterfaceDescription",l);break;case "GetAllInterfaceDescriptions":a.getAllInterfaceDescriptions();a.propagateShellEvent("GetAllInterfaceDescriptions",l);break;case "SendWidgetLock":e.ctatdebug("Found: SendWidgetLock");!0===this.getInStartState()&&g.push(l);a.propagateShellEvent("SendWidgetLock",l);break;case "CorrectAction":e.ctatdebug("Found: CorrectAction");!0===this.getInStartState()?g.push(l):d.processCorrectAction(l);a.propagateShellEvent("CorrectAction",l);break;case "InCorrectAction":e.ctatdebug("Found: InCorrectAction");
!0===CTATMessageHandler.inStartState?g.push(l):(e.ctatdebug("Handing incorrect message to messagehandler ..."),d.processInCorrectAction(l));a.propagateShellEvent("InCorrectAction",l);break;case "HighlightMsg":e.ctatdebug("Found: HighlightMsg");d.processHighlightMsg(l);a.propagateShellEvent("HighlightMsg",l);break;case "UnHighlightMsg":e.ctatdebug("Found: UnHighlightMsg");d.processUnHighlightMsg(l);a.propagateShellEvent("UnHighlightMsg",l);break;case "AssociatedRules":e.ctatdebug("Found: AssociatedRules ("+
v.length+")");for(var y=A="",C="",r=0;r<v.length;r++){var I=v[r];switch(c.getElementName(I)){case "TutorAdvice":A=c.getNodeTextValue(I);break;case "Actor":h=c.getNodeTextValue(I);break;case "Indicator":y=c.getNodeTextValue(I);break;case "StepID":c.getNodeTextValue(I);break;case "LogAsResult":c.getNodeTextValue(I);break;case "tool_selection":case "StudentSelection":C=c.getNodeTextValue(I);break;case "Skills":e.ctatdebug("Processing skills ..."),null===CTATSkillSet.skills&&(e.ctatdebug("Interesting, there isn't a skillSet object yet. Creating ..."),
CTATSkillSet.skills=new CTATSkillSet),CTATSkillSet.skills.parseByValue(I)}}d.processAssociatedRules(l,y,A,C);a.propagateShellEvent("AssociatedRules",l);break;case "BuggyMessage":e.ctatdebug("Found: BuggyMessage");d.processBuggyMessage(l);a.propagateShellEvent("BuggyMessage",l);break;case "SuccessMessage":e.ctatdebug("Found: SuccessMessage");d.processSuccessMessage(l);a.propagateShellEvent("SuccessMessage",l);break;case "InterfaceAction":e.ctatdebug("Found: InterfaceAction");A=l.getSAI();-1!=A.getAction().indexOf(":")?
(e.ctatdebug("Processing and storing timed interface action : "+A.getAction()),y=parseInt(A.getAction().substring(A.getAction().indexOf(":")+1)),e.ctatdebug("Target time: "+y),A.setAction(A.getAction().substring(0,A.getAction().indexOf(":"))),e.ctatdebug("Timing ..."),setTimeout(d.processInterfaceAction,y,l),setTimeout(a.propagateShellEvent,y,"InterfaceAction",l,h)):(e.ctatdebug("Processing regular (non-timed) interface action"),!0===CTATMessageHandler.inStartState?(e.ctatdebug("inStartState==true => storing for later playback ..."),
g.push(l)):(d.processInterfaceAction(l),a.propagateShellEvent("InterfaceAction",l,h)));break;case "UntutoredAction":e.ctatdebug("Found: UntutoredAction");A=l.getSAI();-1!=A.getAction().indexOf(":")?(e.ctatdebug("Processing and storing timed interface action : "+A.getAction()),y=parseInt(A.getAction().substring(A.getAction().indexOf(":")+1)),e.ctatdebug("Target time: "+y),A.setAction(A.getAction().substring(0,A.getAction().indexOf(":"))),e.ctatdebug("Timing ..."),setTimeout(d.processUntutoredAction,
y,l),setTimeout(a.propagateShellEvent,y,"UntutoredAction",l,h)):(e.ctatdebug("Processing regular (non-timed) interface action"),!0===CTATMessageHandler.inStartState?(e.ctatdebug("inStartState==true => storing for later playback ..."),g.push(l)):(d.processUntutoredAction(l),a.propagateShellEvent("UntutoredAction",l,h)));break;case "InterfaceIdentification":e.ctatdebug("Found: InterfaceIdentification");a.propagateShellEvent("InterfaceIdentification",l);break;case "AuthorModeChange":e.ctatdebug("Found: AuthorModeChange");
d.globalReset();a.propagateShellEvent("AuthorModeChange",l);break;case "ResetAction":e.ctatdebug("Found: ResetAction");d.globalReset();a.propagateShellEvent("ResetAction",l);break;case "ShowHintsMessage":e.ctatdebug("Found: ShowHintsMessage");A=!1;y=[];for(C=0;C<v.length;C++)if(r=v[C],"HintsMessage"==c.getElementName(r))for(r=c.getElementChildren(r),I=0;I<r.length;I++){var J=r[I];"value"==c.getElementName(J)&&(y.push(c.getNodeTextValue(J)),A=!0)}!0===A?d.processHintResponse(l,y):e.ctatdebug("Error: incomplete hint message received");
a.propagateShellEvent("ShowHintsMessage",l);break;case "ConfirmDone":e.ctatdebug("Found: ConfirmDone");d.processConfirmDone(l);a.propagateShellEvent("ConfirmDone",l);break;case "VersionInfo":e.ctatdebug("Found: VersionInfo");d.processVersionInfo(v);a.propagateShellEvent("VersionInfo",l);break;case "TutoringServiceAlert":e.ctatdebug("Found: TutoringServiceAlert");d.processTutoringServiceAlert(v);a.propagateShellEvent("TutoringServiceAlert",l);break;case "TutoringServiceError":A=l.getProperty("Action");
e.ctatdebug("Found: TutoringServiceError - actor "+h+", action "+A);var B;A&&(B=CTATSAI.delayedActionRegExp.exec(A))&&2<B.length&&1<B[2]?(y=parseInt(B[2]),l.setProperty("Action",B[1]),e.ctatdebug("Delaying TutoringServiceError by "+y+" ..."),setTimeout(d.processTutoringServiceError,y,l),setTimeout(a.propagateShellEvent,y,"TutoringServiceError",l,h)):(d.processTutoringServiceError(l),a.propagateShellEvent("TutoringServiceError",l,h));break;case "ProblemSummaryResponse":e.ctatdebug("Found: ProblemSummaryResponse");
d.processProblemSummaryResponse(l);a.propagateShellEvent("ProblemSummaryResponse",l);break;case "StartStateEnd":e.ctatdebug("Found: StartStateEnd");CTATShellTools.listComponents();null!==d?d.processStartState():this.ctatdebug("Error: no message handler object available to process start state");try{e.processStartStateActions()}catch(D){e.ctatdebug("Caught in the act: "+D.message)}CTATMessageHandler.inStartState=!1;a.propagateShellEvent("StartStateEnd",l);break;case "ProblemRestoreEnd":e.ctatdebug("Found: ProblemRestoreEnd");
d.processProblemRestoreEnd(l);a.propagateShellEvent("ProblemRestoreEnd",l);break;case "GetURL":e.ctatdebug("Found: GetURL");d.processGetURL(l);a.propagateShellEvent("GetURL",l);break;case "SetPreferences":d.forwardToTutor(l);return;case "InterfaceReboot":f++;ctatdebug("Found: InterfaceReboot #"+f+" -- href "+(location?location.href:"(no location)"));1<f&&!CTAT.ToolTutor.reboot("InterfaceReboot from CTATMessageHandler")&&(A="ws://"+CTATConfiguration.get("remoteSocketURL")+":"+CTATConfiguration.get("remoteSocketPort"),
ctatdebug("closing connection w/ url: "+A),a.closeWSConnection(A,function(){var a=window.frameElement.getAttribute("id");"function"==typeof CustomEvent&&(a=new CustomEvent("refreshIframe",{detail:a}),window.parent.document.dispatchEvent(a))},"interfaceReboot"));break;case "NoOp":h=l&&l.getTransactionID();m=l&&l.getSAI();ctatdebug("NoOp transactionID "+h+", SAI "+m);return}(A=/student[0-9]+/i.exec(h))&&A[0]==h&&d.forwardToTutor(l)}}}}};this.processStateGraph=function(a){e.ctatdebug("processStateGraph ()");
if(void 0===a||null===a)e.ctatdebug("Error: state graph property list is undefined");else if(e.ctatdebug("Processing node: "+a.nodeName),null===c.getElementChildren(a))e.ctatdebug("Error: state graph property list is undefined");else{a=c.getElementChildren(a);for(var b=0;b<a.length;b++){var f=a[b];e.ctatdebug("State graph attribute: "+c.getElementName(f));"caseInsensitive"==c.getElementName(f)&&(caseInsensitive="false"==c.getNodeTextValue(f)?!1:!0);"unordered"==c.getElementName(f)&&(unordered="false"==
c.getNodeTextValue(f)?!1:!0);"lockWidget"==c.getElementName(f)&&(lockWidget="false"==c.getNodeTextValue(f)?!1:!0);"suppressStudentFeedback"==c.getElementName(f)&&("false"==c.getNodeTextValue(f)?CTATGlobals.suppressStudentFeedback=!1:CTATGlobals.suppressStudentFeedback=!0);"highlightRightSelection"==c.getElementName(f)&&(highlightRightSelection="false"==c.getNodeTextValue(f)?!1:!0);"confirmDone"==c.getElementName(f)&&(e.ctatdebug("Confirm done: "+c.getNodeTextValue(f)),"true"==c.getNodeTextValue(f)?
CTATGlobals.confirmDone=!0:CTATGlobals.confirmDone=!1);"Skills"==c.getElementName(f)&&(null===CTATSkillSet.skills&&(CTATSkillSet.skills=new CTATSkillSet),CTATSkillSet.skills.parseByValue(f),d.updateSkillWindow())}}};this.processStartProblem=function(a){e.ctatdebug("processStartProblem ()");d.processStartProblem()};this.processInterfaceIdentification=function(a){};this.processInterfaceDescription=function(a){e.ctatdebug("processInterfaceDescription ("+a.length+")");for(var b="Unknown",d="Unknown",
f=null,g=0;g<a.length;g++){var h=a[g];e.ctatdebug("Inspecting element: "+c.getElementName(h));"WidgetType"==c.getElementName(h)&&(e.ctatdebug("Widget type: "+c.getNodeTextValue(h)),b=c.getNodeTextValue(h));"CommName"==c.getElementName(h)&&(e.ctatdebug("Instance name: "+c.getNodeTextValue(h)),d=c.getNodeTextValue(h));if("serialized"==c.getElementName(h)){e.ctatdebug("Prepareing to de-serialize component ...");for(var m=c.getElementChildren(h),u=0;u<m.length;u++){var A=m[u];-1!=c.getElementName(A).indexOf("CTAT")&&
(f=A)}}"interface"==c.getElementName(h)&&(e.ctatdebug("Storing interface for post start-state reconstruction ..."),CTATGlobals.interfaceElement=h);"script"==c.getElementName(h)&&(e.ctatdebug("Storing and loading main javascript code as defined by the BRD ..."),scriptElement=c.getNodeTextValue(h))}null!==f?this.deserializeComponent(b,d,f):e.ctatdebug("Error: unable to find CTAT serialization point of attachement");e.ctatdebug("processInterfaceDescription () done")};this.deserializeComponent=function(a,
b,d){e.ctatdebug("deserializeComponent ("+a+","+b+")");if(!0===CTATGlobals.ignoreInterfaceDescriptions)e.ctatdebug("ignoreInterfaceDescriptions==true");else if(null===c.getElementAttr(d,"x"))e.ctatdebug("Warning: this component does not have x,y information. Probably an older component");else{var f=c.getElementAttr(d,"x"),g=c.getElementAttr(d,"y"),h=c.getElementAttr(d,"width"),l=c.getElementAttr(d,"height"),u=c.getElementAttr(d,"tabIndex"),m=c.getElementAttr(d,"zIndex");null===u&&(u=-1);null===m&&
(m=0);var n=new CTATComponentDescription;n.type=a;n.name=b;n.x=Math.floor(f);n.y=Math.floor(g);n.tabIndex=u;n.zIndex=m;n.width=Math.floor(h);n.height=Math.floor(l);CTATShellTools.registerComponentDescription(n);d=c.getElementChildren(d);for(f=0;f<d.length;f++){g=d[f];c.getElementName(g);if("Parameters"==c.getElementName(g))for(this.ctatdebug("Processing component parameters ..."),h=c.getElementChildren(g)[0],h=c.getElementChildren(h),l=0;l<h.length;l++){var C=h[l];if("CTATComponentParameter"==c.getElementName(C)){this.ctatdebug("Processing parameter property (CTATComponentParameter) ...");
for(var m=u=void 0,C=c.getElementChildren(C),r=0;r<C.length;r++){var I=C[r];"name"==c.getElementName(I)&&(this.ctatdebug("Found parameter name: "+c.getNodeTextValue(I)),u=c.getNodeTextValue(I));"value"==c.getElementName(I)&&(this.ctatdebug("Found parameter value: "+c.getNodeTextValue(I)),m=c.getNodeTextValue(I).trim())}this.ctatdebug("Parameter name: "+u+", value: "+m);void 0!==u&&(n.params[u]=m,"group"==u&&(n.groupName=m))}}if("Styles"==c.getElementName(g))for(this.ctatdebug("Processing component styles ..."),
g=c.getElementChildren(g)[0],g=c.getElementChildren(g),h=0;h<g.length;h++)if(m=g[h],"CTATStyleProperty"==c.getElementName(m)){this.ctatdebug("Processing style property (CTATStyleProperty) ...");u=l="";m=c.getElementChildren(m);for(C=0;C<m.length;C++)r=m[C],"name"==c.getElementName(r)&&(l=c.getNodeTextValue(r)),"value"==c.getElementName(r)&&(u=c.getNodeTextValue(r).trim());this.ctatdebug("Style (name: "+l+", value: "+u+")");""!==l&&(n.styles[l]=u)}}e.ctatdebug("deserializeComponent ("+a+","+b+") done")}};
this.processStartStateActions=function(){e.ctatdebug("processStartStateActions ("+g.length+")");if(0===g.length)e.ctatdebug("No start state messages, bump");else if(0<CTATMessageHandler.startStateHandlers.length)for(var a=0;a<CTATMessageHandler.startStateHandlers.length;a++)CTATMessageHandler.startStateHandlers[a].processStartStateActions(g);else{for(var a=b(),c=0;c<g.length;c++){var f=g[c];e.ctatdebug("Processing startstate message type: "+f.getMessageType());switch(f.getMessageType()){case "InterfaceAction":d.processInterfaceAction(f,
a);break;case "UntutoredAction":d.processUntutoredAction(f,a);break;case "CorrectAction":d.processCorrectAction(f);break;case "InCorrectAction":d.processInCorrectAction(f)}}if(""!==CTATMessageHandler.scriptElement)try{eval(CTATMessageHandler.scriptElement)}catch(p){alert("Error executing script from BRD: "+p.message)}}};this.sleep=function(a){e.ctatdebug("sleep ("+a+")")}};CTATMessageHandler.prototype=Object.create(CTATBase.prototype);CTATMessageHandler.prototype.constructor=CTATMessageHandler;
CTATMessageHandler.startStateHandlers=[];CTATMessageHandler.inStartState=!1;CTATMessageHandler.scriptElement="";var CTATSessionExpiry=function(a,b,d,e){function g(){var a=x&&x.getHTTPObject?x.getHTTPObject():null;h.ctatdebug("CTATSessionExpiry.processInactivityReply() refreshConnection "+x+", getHTTPObject "+a);x&&a&&h.ctatdebug("CTATSessionExpiry.processInactivityReply() readyState "+a.readyState+", status "+a.status+", responseText "+(4==a.readyState?a.responseText:null))}function c(){try{if(50>l)throw"No-op: time interval "+l+" too short: less than 50 ms";q=setInterval(function(){x.send.apply(x,[])},l);
return"ok"}catch(u){return u.toString()}}function f(){try{if(50>n)throw"No-op: time interval "+n+" too short: less than 50 ms";v=setInterval(function(){h.checkInactivity.apply(h,[])},n);return"ok"}catch(u){return u.toString()}}CTATBase.call(this,"CTATSessionExpiry",b);var h=this,m=1E3*b,l=1E3*(b-60),n=6E4,p=Date.now(),x=null,q=0,v=0;this.checkInactivity=function(){var a=Date.now(),c=p;h.ctatdebug("CTATSessionExpiry.checkInactivity() elapsed "+(a-c)+", limit "+m+",\n                 now "+Date(a)+
",\n lastActionTimestamp "+h.getLastActionTimestamp());if(!(a<c+m))try{h.cancelTimers();var b=new CTATConnection(CTATConfiguration.getRawFlashVars());b.setMethod("GET");b.setURL(d);b.assignReceiveFunction(g);b.send();return"ok"}catch(C){return C.toString()}};this.updateLastActionTimestamp=function(){p=Date.now()};this.getLastActionTimestamp=function(){return new Date(p)};this.toString=function(){return"CTATSessionExpiry sessionTimeoutMS "+m+", refreshIntervalMS "+l+", refreshTimer "+q+", inactivityTimer "+
v+",\n  expireLogoutURL "+d+",\n  refreshSessionURL "+e};this.getRefreshConnection=function(){return x};this.getSessionTimeoutMS=function(){return m};this.getRefreshIntervalMS=function(){return l};this.getInactivityIntervalMS=function(){return n};this.setSessionTimeoutMS=function(a){m=a};this.setRefreshIntervalMS=function(a){l=a;h.cancelRefreshTimer();c()};this.setInactivityIntervalMS=function(a){n=a;h.cancelInactivityTimer();f()};this.cancelRefreshTimer=function(){0!==q&&clearInterval(q);q=0};this.cancelInactivityTimer=
function(){0!==v&&clearInterval(v);v=0};this.cancelTimers=function(){h.cancelRefreshTimer();h.cancelInactivityTimer()};this.getRefreshTimer=function(){return q};this.getInactivityTimer=function(){return v};x=new CTATConnection(a);x.setMethod("GET");x.setURL(e);x.assignReceiveFunction(function(){var a=x&&x.getHTTPObject?x.getHTTPObject():null;h.ctatdebug("CTATSessionExpiry.processRefreshReply() refreshConnection "+x+", getHTTPObject "+a);x&&a&&h.ctatdebug("CTATSessionExpiry.processRefreshReply() readyState "+
a.readyState+", status "+a.status+", responseText "+(4==a.readyState?a.responseText:null))});c();f()};CTATSessionExpiry.prototype=Object.create(CTATBase.prototype);CTATSessionExpiry.prototype.constructor=CTATSessionExpiry;
CTATSessionExpiry.factory=function(a){var b=Number(a.session_timeout)||0,d=a.expire_logout_url,e=a.refresh_session_url;ctatdebug("CTATSessionExpiry.init() session_timeout "+b+", expire_logout_url "+d+", refresh_session_url "+e);return 60>=b||!d||!e?null:new CTATSessionExpiry(a,b,d,e)};"undefined"!==typeof module&&(module.exports=CTATSessionExpiry);var CTATTransactionListener=function(a){function b(a){return a&&"function"==typeof a.getTransactionID?a.getTransactionID():null}function d(a){h.ctatdebug("formatTimeStamp ("+a+")");return sprintf("%04d-%02d-%02d %02d:%02d:%02d.%03d UTC",a.getUTCFullYear(),a.getUTCMonth()+1,a.getUTCDate(),a.getUTCHours(),a.getUTCMinutes(),a.getUTCSeconds(),a.getUTCMilliseconds())}function e(a,c){for(var b,d,f=1;;++f){var e=c+"_type"+f,g=c+"_name"+f;b=CTATConfiguration.get(e);d=CTATConfiguration.get(g);if(!b||!d)break;
a[e]=b;a[g]=d}1==f&&(b=CTATConfiguration.get(c+"_type"),d=CTATConfiguration.get(c+"_name"),a[e]=b?b:"",a[g]=d?d:"");return a}function g(a,c){if(a&&"function"==typeof a.toLowerCase&&0<=a.toLowerCase().indexOf("hint"))return!0;if(!c)return!1;if(0<=c.getMessageType().toLowerCase().indexOf("hint"))return!0;var b=c.getSelection().toLowerCase();return 0<=c.getAction().toLowerCase().indexOf("buttonpress")&&(0<=b.indexOf("hint")||0<=b.indexOf("help"))}function c(a,c){var b=a.getProperty(c),d=b?b.split(CTATTransactionListener.valueDelimiter):
[];h.ctatdebug("CTATTransactionListener.getPropertyAsArray("+c+") withValues "+b+", result "+d);return d}function f(a,b){for(var d=c(a,b),f="",e=0;e<d.length;++e)f+=d[e];h.ctatdebug("CTATTransactionListener.getProperty("+b+") valueElts "+d+", result "+f);return f}CTATBase.call(this,"CTATTransactionListener","");var h=this,m=null,l={},n=0,p=CTATConfig.parserType_is_XML()?new CTATXML:new CTATJSON;this.getMailer=function(){return m};this.onmessage=function(a){h.ctatdebug("CTATTransactionListener.onmessage("+
a.toString()+")");(a=a.data&&3<=a.data.length?new CTATSAI(a.data[0],a.data[1],a.data[2]):null)&&CTATCommShell.shell.processComponentAction(a,!1,!0,null,"ATTEMPT","Detector")};if(!m)a:{if("undefined"!=typeof TransactionMailerUsers&&"function"==typeof TransactionMailerUsers.create)try{m=m=TransactionMailerUsers.create("Assets",a,CTATConfiguration.get("process_detectors_url"),CTATConfiguration.get("authenticity_token"),CTATConfiguration.get("detectors"));break a}catch(x){console.trace("Error creating transaction mailer: "+
x);m=m=null;break a}m=void 0}this.isReady=function(){return null!=h.mailerProxy};this.toString=function(){return"transactions sent to ["+h.process_transactions_url+":]"};this.processCommShellEvent=function(a,q,v){console.trace("CTATTransactionListener.processCommShellEvent("+a+", "+q+", "+v+")");try{var u=null;switch(a){case "InterfaceAction":case "AssociatedRules":case "UntutoredAction":case "NextPressed":case "PreviousPressed":var x=q;q&&q.constructor!=CTATMessage&&(x=q.constructor!=Element?p.parse(x):
x,x=new CTATMessage(x));var y=x;h.ctatdebug("CTATTransactionListener.makeOrCompleteTransaction("+a+") pointer "+h+", problemInfo null, pointer.problemInfo "+(h?h.problemInfo:null));var C=x=null,r=!1;if(C=b(y)){var I,J;b:switch(a){case "UntutoredAction":J=!1;break b;case "InterfaceAction":J="tutor-performed"!=f(y,"subtype").toLowerCase();break b;default:J=!0}if(I=!(r=!J)){var B;J=C;var D=l[J];D?(delete l[J],--n,h.ctatdebug("CTATTransactionListener.removeIncompleteTransaction("+J+") count now "+n),
B=D):B=null;I=(x=B)&&(r=!0)}I||(x={meta:h.problemInfo.meta,context:h.problemInfo.context});switch(a){case "AssociatedRules":case "NextPressed":case "PreviousPressed":v=x;v.tutor_data&&console.log("Warning: CTATTransactionListener.addTutorInfo("+a+") tx has tutor_data with time "+v.tutor_data.tutor_event_time);v.tutor_data={};v.tutor_data.tutor_event_time=d(new Date);v.tutor_data.selection=f(y,"Selection");v.tutor_data.action=f(y,"Action");v.tutor_data.input=f(y,"Input");v.tutor_data.action_evaluation=
y.getIndicator();0<=v.tutor_data.action_evaluation.toLowerCase().indexOf("hint")&&(v.tutor_data.current_hint_number=f(y,"CurrentHintNumber"),v.tutor_data.total_hints_available=f(y,"TotalHintsAvailable"));v.tutor_data.tutor_advice=f(y,"TutorAdvice");var H=v.tutor_data;I=[];var E=CTAT.ToolTutor.tutor&&CTAT.ToolTutor.tutor.getProblemSummary()?CTAT.ToolTutor.tutor.getProblemSummary().getSkills():null,w=y.getSkillsObject().getSkillSet();for(B=0;B<w.length;++B){var z=w[B],K=CTATSkillSet.skills?CTATSkillSet.skills.getSkill(z.getSkillName()):
null;if(K){D={};D.name=K.getSkillName();D.category=K.getCategory();var M=null==D.category||""==D.category.trim()?D.name:D.name+" "+D.category,L=E?E.getSkill(M):null,G;L?(D.pKnown=isNaN(G=L.getPKnown())?"":G,D.pGuess=isNaN(G=L.getPGuess())?"":G,D.pSlip=isNaN(G=L.getPSlip())?"":G,D.pLearn=isNaN(G=L.getPLearn())?"":G,D.history=isNaN(G=L.getHistory())?"":G,D.opportunityCount=isNaN(G=L.getOpportunityCount())?"":G):(D.pKnown=isNaN(G=K.getPKnown())?"":G,D.pGuess=isNaN(G=K.getPGuess())?"":G,D.pSlip=isNaN(G=
K.getPSlip())?"":G,D.pLearn=isNaN(G=K.getPLearn())?"":G);h.ctatdebug("CTATTransactionListener.createSkills() ssSk "+K+", tracerSk "+L+", skElt "+D);I.push(D)}}H.skills=I;v.tutor_data.step_id=f(y,"StepID");v.tutor_data.rule_names=c(y,"Rules");var U=v.tutor_data,P=y.getCustomFields();h.ctatdebug("CTATTransactionListener.createCustomFields() result "+P);U.custom_fields=P;break;default:x.meta.date_time=d(new Date);H=x;if(!(H.transaction_id=b(y)))throw Error("Message has no transaction_id: eventType "+
a+", msg\n  "+y);H.semantic_event="UntutoredAction"==a?"UNTUTORED-ACTION":g(a,y)?"HINT-REQUEST-HINTS":"ATTEMPT-RESULT";H.actor=v?v:"student";H.tool_data&&console.log("Warning: CTATTransactionListener.addToolInfo("+a+") tx has tool_data with time "+H.tool_data.tool_event_time);H.tool_data={};H.tool_data.tool_event_time=d(new Date);H.tool_data.selection=f(y,"Selection");H.tool_data.action=f(y,"Action");H.tool_data.input=f(y,"Input")}var S;if(r)S=x;else{var H=C,E=x,N=l[H];N&&(console.log("Warning: CTATTransactionListener.storeIncompleteTransaction() found tx with ID "+
H,N),--n);l[H]=E;++n;h.ctatdebug("CTATTransactionListener.storeIncompleteTransaction("+H+") count now "+n);S=null}u=S}else u=null;break;case "StartProblem":h.ctatdebug("CTATTransactionListener.createContextMessage()");S={};var X=new Date;h.ctatdebug("TX.makeMetaElement ()");N={};N.date_time=d(X);N.session_id=CTATConfiguration.get("session_id");N.user_guid=CTATConfiguration.get("user_guid");S.meta=N;S.context={};r=S.context;N=null;CTATLogMessageBuilder&&CTATLogMessageBuilder.commLogMessageBuilder&&
(N=CTATLogMessageBuilder.commLogMessageBuilder.getContextName());N||(N=CTATLogMessageBuilder.contextGUID);if(!N)throw Error("Context message ID not yet defined");r.context_message_id=N;var F=S.context,Q;Q=CTATConfiguration.get("class_name");F.class_name=Q?Q:"";Q=CTATConfiguration.get("school_name");F.class_school=Q?Q:"";Q=CTATConfiguration.get("period_name");F.class_period_name=Q?Q:"";Q=CTATConfiguration.get("class_description");F.class_description=Q?Q:"";Q=CTATConfiguration.get("instructor_name");
F.class_instructor_name=Q?Q:"";var T=S.context,V=CTATConfiguration.get("dataset_name");T.dataset_name=V?V:"";e(T,"dataset_level");prop=CTATConfiguration.get("problem_name");T.problem_name=prop?prop:"";prop=CTATConfiguration.get("problem_context");T.problem_context=prop?prop:"";prop=CTATConfiguration.get("problem_tutorflag");T.problem_tutorFlag=prop?prop:"";e(T,"study_condition");x=S.context;N=0;if(y=CTATConfiguration.getCustomFields())for(C in x.custom_fields={},y)y.hasOwnProperty(C)&&(x.custom_fields[C]=
y[C],++N);h.ctatdebug("CTATTransactionListener.createCustomFields() nAdded "+N+", cfs "+y);h.problemInfo=S;break;case "ProblemRestoreEnd":h.initializing=!1}u&&!h.initializing&&m.sendTransaction(u)}catch(Y){console.log("Error in CTATTransactionListener.processCommShellEvent("+a+"): "+Y,Y.stack)}};ctatdebug("**<end of CTATTransactionListener constructor, process_transactions_url "+a+", mailerProxy "+m)};
Object.defineProperty(CTATTransactionListener,"scriptParam",{enumerable:!1,configurable:!1,writable:!1,value:"process_transactions_url"});Object.defineProperty(CTATTransactionListener,"valueDelimiter",{enumerable:!1,configurable:!1,writable:!1,value:/<\/?value>/});CTATTransactionListener.prototype=Object.create(CTATBase.prototype);CTATTransactionListener.prototype.constructor=CTATTransactionListener;"undefined"!==typeof module&&(module.exports=CTATTransactionListener);
CTATTransactionListener.create=function(a){var b=null;if(!a&&("undefined"==typeof TransactionMailerUsers||"function"!=typeof TransactionMailerUsers.create))return null;try{if(b=new CTATTransactionListener(a),!b.getMailer())throw Error("Transaction listener postMessage() not defined.");}catch(d){console.trace("Error creating or connecting to transaction listener",d),b=null}return b};var CTATNameTranslator=function(){CTATBase.call(this,"CTATNameTranslator","translator");var a=!1,b=this;this.setPassthrough=function(b){a=CTATGlobalFunctions.toBoolean(b)};this.getPassthrough=function(){return a};this.manufactorJSON=function(a,e){b.ctatdebug("manufactorJSON ("+a+","+e+")");var d=a.split(":");if(1==d.length)return b.ctatdebug("No range in aRange, returning basic JSON ..."),"";var c=this.getA1Row(d[0]),f=this.getA1Col(d[0]),h=this.getA1Row(d[1]),m=this.getA1Col(d[1]);b.ctatdebug("Manufacturing json from: ["+
c+","+f+"] to: ["+h+","+m+"]");d="[";c=parseInt(h)-parseInt(c);f=parseInt(m)-parseInt(f);c++;f++;b.ctatdebug("X range: "+c+", Y range: "+f);for(h=0;h<c;h++){0<h&&(d+=",");d+="[";for(m=0;m<f;m++)0<m&&(d+=","),d+='"',d+=e,d+='"';d+="]"}return d+"]"};this.translateFromCTAT=function(d,e){if(!0===a)return d;var g=d.toLowerCase();b.ctatdebug("translateFromCTAT ("+g+")");var c;if(-1!=g.indexOf(".r")){var f=g.split(".");c=f[1].split("r");0>=c.length&&(c=f[1].split("c"));0>=c.length?b.ctatdebug("Info: incoming name does not need translation"):
(g=c[1],c=c[0].substr(1),b.ctatdebug("Original row (1st format): "+c+" original col: "+g),g=!0===e?colName(g,!1)+c:f[0]+"."+colName(g,!1)+c,b.ctatdebug("Translated: "+g))}else{if(0===g.indexOf("r")){var f=g.indexOf("c"),h=parseInt(g.substr(1,f-1)),m=parseInt(g.substr(f+1));c=h+1;g=m;b.ctatdebug("Original row (2nd format) (columnindex: "+f+"): "+h+" -> "+c+", original col: "+m+" -> "+g);g=colName(g,!1)+c;b.ctatdebug("Translated: "+g);return g}b.ctatdebug("Info: incoming name does not need translation")}return g};
this.translateToCTAT=function(b){if(!0===a)return b;var d=this.letterToColumn(b.substr(0,1))-1;return"R"+(parseInt(b.substr(1))-1)+"C"+d};this.columnToLetter=function(a){for(var b,d="";0<a;)b=(a-1)%26,d=String.fromCharCode(b+65)+d,a=(a-b-1)/26;return d};this.letterToColumn=function(a){for(var b=0,d=a.length,c=0;c<d;c++)b+=(a.charCodeAt(c)-64)*Math.pow(26,d-c-1);return b};this.getA1Row=function(a){return parseInt(a.substr(1))-1};this.getA1Col=function(a){return this.letterToColumn(a.substr(0,1))-1}};
CTATNameTranslator.prototype=Object.create(CTATBase.prototype);CTATNameTranslator.prototype.constructor=CTATNameTranslator;var CTATCommShell=function(){CTATBase.call(this,"CTATCommShell","theShell");var a=null,b=null,d=null,e=null,g=null,c=this,f=null,h=null,m={},l=null,n=null,p=null,x=null,q=[],v=!1,h="xml"==CTATConfig.parserType?new CTATXML:new CTATJSON;this.init=function(f){this.ctatdebug("init ()");var h=CTATConfiguration.getRawFlashVars(),l="http://";"https"==h.tutoring_service_communication&&(l="https://");var m=h.remoteSocketURL;m&&(m=String(m).toLowerCase(),0==m.indexOf("http")||0==m.indexOf("ws"))&&(l="");g=
f;CTATLogMessageBuilder.contextGUID=CTATGuid.guid();c.ctatdebug("processSkills ()");CTATSkillSet.skills=new CTATSkillSet;f=flashVars.getRawFlashVars();null!=f.skills&&CTATSkillSet.skills.fromXMLString(f.skills,!0);c.updateSkillWindow(null);null==commMessageHandler&&(commMessageHandler=new CTATMessageHandler(this),CTAT.ToolTutor.registerInterface(commMessageHandler));commMessageHandler.assignHandler(this);e=new CTATTutoringServiceMessageBuilder;h.deliverymode&&"review"==h.deliverymode&&(h.Logging=
"None");b=CTATSessionExpiry.factory(h);CTATLogMessageBuilder.commLogMessageBuilder=new CTATLogMessageBuilder;a=new CTATCommLibrary;a.setConnectionRefusedMessage("ERROR_CONN_TS");a.setSocketType(h.tutoring_service_communication+(h.collaborators||CTATLMS.is.ToolsListener()?" websocket":""));a.assignHandler(this);d=new CTATCurriculumService(a);null==commLoggingLibrary&&(commLoggingLibrary=new CTATLoggingLibrary(!0));commLoggingLibrary.getLoggingCommLibrary().setFixedURL(flashVars.getRawFlashVars().log_service_url);
flashVars.setTimeZone(null);new CTATHTMLManager;this.ctatdebug("CTATCommShell.init() FlashVar info: "+h.info);if(null!=h.info)try{parent.javaScriptInfo&&parent.javaScriptInfo(decodeURIComponent(h.info))}catch(r){}else this.ctatdebug("There is no info flash var");console.log("Connecting to: "+l+h.remoteSocketURL+":"+h.remoteSocketPort);f=e.createSetPreferencesMessage(version);a.sendXMLURL(f,l+h.remoteSocketURL+":"+h.remoteSocketPort,CTATConfiguration.get("collaborators"));(l=CTATConfiguration.get("collaborators"))&&
1<l.length&&(CTATScrim.scrim.scrimDown(),CTATScrim.scrim.scrimUp(CTATGlobals.languageManager.getString("AWAITING_OTHER_COLLABORATORS")));c.addGlobalEventListener(CTATTransactionListener.create(h[CTATTransactionListener.scriptParam]))};this.getCommLibrary=function(){return a};this.forwardToTutor=function(c){a&&a.hasJavaScriptConnection()&&CTAT.ToolTutor.sendToTutor(c.getXMLString())};this.getLoggingLibrary=function(){return commLoggingLibrary};this.propagateShellEvent=function(a,c,b){ctatdebug("propagateShellEvent ("+
a+", "+typeof c+")");for(var d=0;d<q.length;d++)q[d].processCommShellEvent(a,c,b)};this.reset=function(){c.ctatdebug("reset ()");CTATGlobals.interfaceElement=null;commMessageHandler.reset()};this.getSessionExpiry=function(){return b};this.getMessageHandler=function(){return this.commMessageHandler};this.addStartStateHandler=function(a){c.ctatdebug("addStartStateHandler ()");null==CTATMessageHandler.startStateHandlers&&(CTATMessageHandler.startStateHandlers=[]);CTATMessageHandler.startStateHandlers.push(a)};
this.gradeComponent=function(a){this.ctatdebug("gradeComponent ("+a.getName()+","+a.getClassName()+")");var b=CTATShellTools.findComponentByClass("CTATDoneButton");null!=b&&b!=a?b.moveHintHighlight(!1,null):c.ctatdebug("Info: no done button available to reset");c.clearFeedbackComponents();null!=nameTranslator?nameTranslator.translateFromCTAT(a.getName()):this.ctatdebug("Info: no name translator provided, using as-is");null==a?this.ctatdebug("Internal error, provided component is null"):(this.ctatdebug("Info: we have a valid component, grading ..."),
"Do not tutor"==a.getTutorComponent()?c.processComponentAction(a.getSAI(),!1):(this.ctatdebug("Checking for back grading: "+a.getName()),"CTATTextArea"==a.getClassName()||"CTATTextInput"==a.getClassName()||"CTATTextField"==a.getClassName()?(this.ctatdebug("Backgrading ..."),this.ctatdebug("Grading "+a.getClassName()+" with value: "+a.getValue()),!0===CTATGlobalFunctions.isBlank(a.getValue())?this.ctatdebug("Empty component, nothing to grade"):(a.updateSAI(),a=a.getSAI(),c.processComponentAction(a))):
(a="CTATTableGoogle"==a.getClassName()?new CTATSAI(a.getCurrentSelection(),"UpdateTextArea",a.getCurrentValue()):a.getSAI(),c.processComponentAction(a))))};this.processMessage=function(a){this.ctatdebug("processMessage ()");commMessageHandler.processMessage(a);this.ctatdebug("processMessage () done")};this.processStartProblem=function(){this.ctatdebug("processStartProblem ()");"google"==CTATConfig.external&&this.showFeedback("The tutor is starting, please wait ...");CTATLMS.initLMSConnection&&CTATLMS.initLMSConnection()};
this.processStartState=function(){this.ctatdebug("processStartState ()");CTATMessageHandler.inStartState=!0;null!=g?(this.ctatdebug("Calling tutor.createInterface () ..."),g.createInterface()):(this.ctatdebug("Error: no tutor object available, calling createInterface globally ..."),window.hasOwnProperty("createInterface")&&window.createInterface());this.ctatdebug("Logging start of problem ...");null!=commLoggingLibrary?commLoggingLibrary.startProblem():this.ctatdebug("Info: no logging library available!");
c.propagateShellEvent("StartProblem",null);this.ctatdebug("End of start state, inspecting suppressStudentFeedback ...");if(!0===CTATGlobals.suppressStudentFeedback){this.ctatdebug("Hiding hint button ...");var a=CTATShellTools.findComponentByClass("CTATHintButton");null!=a&&a.SetVisible(!1)}"google"==CTATConfig.external?(c.ctatdebug("Calling google app script hint request driver ..."),addCall(new RPCObject("resetOnEditQueue","dummy","dummy"))):this.ctatdebug("processStartState () done")};this.sendStartProblemMessage=
function(){c.ctatdebug("sendStartProblemMessage()")};this.sendProblemSummaryRequest=function(b){c.ctatdebug("sendProblemSummaryRequest()");p=b;b=(new CTATTutoringServiceMessageBuilder).createProblemSummaryRequestMessage();a.sendXML(b,!1)};this.getAllInterfaceDescriptions=function(){c.ctatdebug("getAllInterfaceDescriptions ()");c.sendInterfaceDescriptionMessages()};this.sendInterfaceDescriptionMessages=function(){c.ctatdebug("sendInterfaceDescriptionMessages ()");for(var b=CTATShellTools.getAllComponents(),
d='<?xml version="1.0" encoding="UTF-8"?><message><verb>NotePropertySet</verb><properties><MessageType>MessageBundle</MessageType><messages>',f=new CTATTutoringServiceMessageBuilder,e=0;e<b.length;e++){var g=b[e];c.ctatdebug("Getting component interface description message for: "+g.getName());d+=f.createInterfaceDescriptionMessage(g);g.getConfigurationActions&&g.getConfigurationActions().forEach(function(a){d+=f.createInterfaceActionMessage(CTATGuid.guid(),a)})}d+="</messages></properties></message>";
c.ctatdebug("Final bundle: "+d);a.sendXMLNoBundle(d)};this.processSerialization=function(){c.ctatdebug("processSerialization()");c.setText(this.label)};this.processComponentAction=function(b,d,f,e,g,h){c.ctatdebug("processComponentAction("+b.getName()+" -> "+b.getSelection()+","+b.getAction()+","+b.getInput()+")");this.showFeedback("");f=CTATGuid.guid();null!=commLoggingLibrary?v&&(c.ctatdebug("We're not in the start state, logging the action ..."),"scrim"==b.getSelection()?ctatdebug("Not logging any scrim actions (for now)"):
void 0!=g?commLoggingLibrary.logSemanticEvent(f,b,g,"","","",h):"hint"==b.getSelection()||"null.nextButton"==b.getSelection()||"null.previousButton"==b.getSelection()?commLoggingLibrary.logSemanticEvent(f,b,"HINT_REQUEST","","","",h):commLoggingLibrary.logSemanticEvent(f,b,"ATTEMPT","","","",h)):this.ctatdebug("Info: no logging library available!");g=new CTATTutoringServiceMessageBuilder;!1!==d&&d!==CTAT.Component.Base.Tutorable.Options.TutorComponent.DO_NOT_TUTOR?(b=g.createInterfaceActionMessage(f,
b),c.propagateShellEvent("InterfaceAction",b)):(b=g.createUntutoredActionMessage(f,b),c.propagateShellEvent("UntutoredAction",b));a.sendXML(b)};this.onEditSuccess=function(a){c.ctatdebug("onEditSuccess ("+a+")");null==nameTranslator?c.ctatdebug("Error: CTAT name translator not available"):-1!=a.indexOf(":")?(c.ctatdebug("Bump"),c.showFeedback("You're asking for a hint for multiple cells, please select only a single cell.")):(a=nameTranslator.translateToCTAT(a),c.ctatdebug("Info A1 notiation mapped to (if needed): "+
a),a=new CTATSAI("hint","ButtonPressed",a),c.processComponentAction(a),c.propagateShellEvent("REQUESTHINT",null),c.ctatdebug("onEditSuccess () done"))};this.onFailure=function(a){c.ctatdebug("onFailure ("+a.message+")")};this.onNOPEditSuccess=function(a){c.ctatdebug("onNOPEditSuccess ("+a+")")};this.onNOPFailure=function(a){c.ctatdebug("onNOPFailure ("+a.message+")")};this.requestHint=function(){c.ctatdebug("requestHint(external -> "+CTATConfig.external+")");var a;if("none"==CTATConfig.external)c.ctatdebug("Calling built-in hint request driver ..."),
CTATGlobals.Tab.previousFocus?(a=new CTATSAI("hint","ButtonPressed","hint request"),CTATGlobals.Tab.previousFocus.getSAI?(a.addSelection(CTATGlobals.Tab.previousFocus.getSAI().getSelection()),a.addAction("PreviousFocus")):c.ctatdebug("Current focus is not a CTAT component, can't ask for a hint yet")):(c.ctatdebug("CTATGlobals.Tab.previousFocus===null"),a=new CTATSAI("hint","ButtonPressed","hint request")),this.processComponentAction(a),this.propagateShellEvent("RequestHint",null);else if(c.clearFeedbackComponents(),
"google"==CTATConfig.external){c.ctatdebug("Calling google app script hint request driver ...");try{google.script.run.withSuccessHandler(c.onEditSuccess).withFailureHandler(c.onFailure).getSheetSelectedRange()}catch(A){c.ctatdebug("google.script.run: "+A.message)}}else c.ctatdebug("'external' has configuration that doesn't match anything: "+CTATConfig.external)};this.processDone=function(a){c.ctatdebug("processDone()");!0===CTATGlobals.confirmDone?CTATScrim.scrim.confirmScrimUp(CTATGlobals.languageManager.getString("SURE_YOU_ARE_DONE"),
this.processDoneContinue,this.processDoneCancel):(a=new CTATSAI("done","ButtonPressed",a&&"string"==typeof a?a:"-1"),c.processComponentAction(a))};this.processDoneContinue=function(a){c.ctatdebug("processDoneContinue()");CTATScrim.scrim.scrimDown();a=new CTATSAI("done","ButtonPressed",a&&"string"==typeof a?a:"-1");c.processComponentAction(a);c.propagateShellEvent("DonePressed",null)};this.processDoneCancel=function(a){c.ctatdebug("processDoneCancel()");CTATScrim.scrim.scrimDown();a=CTATGuid.guid();
var b=new CTATSAI("ConfirmDone","ButtonPressed","no");commLoggingLibrary.logSemanticEvent(a,b,"ATTEMPT","")};this.processGetURL=function(b){c.ctatdebug("processGetURL()");-1!=b.getURL().indexOf("http://")?a.retrieveFile(b.getURL().substring(7),c.processClientBRDLoad):a.retrieveFile(b.getURL(),c.processClientBRDLoad)};this.processClientBRDLoad=function(b){c.ctatdebug("processClientBRDLoad()");var d=a.getURL();a.sendXML("<message><verb>NotePropertySet</verb><properties><MessageType>GetURLResponse</MessageType><URL><![CDATA[ "+
d+" ]]\x3e</URL><content><![CDATA[ "+window.btoa(b)+" ]]\x3e</content></properties></message>")};this.processCorrectAction=function(a){c.ctatdebug("processCorrectAction()");a.setGradeResult("correct");c.clearFeedbackComponents();null!=x&&(ctatdebug("Calling custom grading processor ..."),x("CORRECT",a));var b=a.getSelection();if(m[b]&&null!=l)l("CORRECT",a),this.propagateShellEvent("CORRECT",a);else{var d=CTATShellTools.findComponent(b);if(null!=d)for(ctatdebug("Processing "+d.length+" components ..."),
b=0;b<d.length;b++)ctatdebug("Check "+d[b].getName()),d[b]?d[b].setCorrect&&d[b].setCorrect(a):c.ctatdebug("Internal error, component pointer is null");else c.ctatdebug("Error: component is null for selection "+b)}};this.processInCorrectAction=function(a){c.ctatdebug("processInCorrectAction()");a.setGradeResult("incorrect");null!=x&&(ctatdebug("Calling custom grading processor ..."),x("INCORRECT",a));var b=a.getSelection();if(m[b]&&null!=l)l("INCORRECT",a);else{var d=CTATShellTools.findComponent(b);
if(null!==d)for(b=0;b<d.length;b++)ctatdebug("Calling setIncorrect on component ("+d[b].getClassName()+")..."),d[b].setIncorrect&&d[b].setIncorrect(a);else c.ctatdebug("Error: component is null for selection "+b)}};this.processHighlightMsg=function(a){c.ctatdebug("processHighlightMsg()");var b=a.getSelection(),d=CTATShellTools.findComponent(b);if(null!=d)for(b=0;b<d.length;b++)d[b].setHintHighlight(!0,a);else c.ctatdebug("Error: component is null for selection "+b);this.showFeedback(a.getHighlightMsg())};
this.processUnHighlightMsg=function(a){c.ctatdebug("processUnHighlightMsg()");var b=a.getSelection(),d=CTATShellTools.findComponent(b);if(null!=d)for(b=0;b<d.length;b++)d[b].setHintHighlight(!1,null,a);else c.ctatdebug("Error: component is null for selection "+b)};this.processAssociatedRules=function(b,d,f,g){c.ctatdebug("processAssociatedRules()");if(0==commMessageHandler.getInStartState()){logHintSAI=b.getSAI();var h,l=new CTATActionEvaluationData("");c.ctatdebug("Found tutor advice: "+f);"Hint"==
d||"HintWindow"==d?(ctatdebug("Preparing log message to indicate a hint response","commShell"),l.setCurrentHintNumber(hintIndex+1),l.setTotalHintsAvailable(hints.length),l.setEvaluation("HINT"),h="HINT_MSG",hints[hintIndex]&&(f=hints[hintIndex])):("Correct"==b.getIndicator()?l.setEvaluation("CORRECT"):l.setEvaluation("INCORRECT"),h="RESULT");ctatdebug("Adding custom field names ...");var m=[],n=[];m.push("step_id");n.push(b.getProperty("StepID"));var u=b.getRules();u&&(m.push("rule_names"),n.push(u.toString()));
var u=b.getCustomFields(),q;for(q in u)m.push(q),n.push(u[q]);q=b.getSkillsObject();c.updateSkillWindow(q);ctatdebug("Sending log message ...");null!=commLoggingLibrary?v&&commLoggingLibrary.logTutorResponse(b.getTransactionID(),logHintSAI,h,"",l,f,q,m,n):this.ctatdebug("Info: no logging library available!");"done"==logHintSAI.getSelection()&&"ButtonPressed"==logHintSAI.getAction()&&"Correct"==b.getIndicator()&&(h=e.createProblemSummaryRequestMessage(),a.sendXML(h,!1))}else c.updateSkillWindow(null);
if((g=g&&CTATShellTools.findComponent(g))&&g.length)for(h=0;h<g.length;h++)ctatdebug("Calling processAssociatedRules on component ("+g[h].getClassName()+")..."),g[h].processAssociatedRules&&g[h].processAssociatedRules(b,d,f);c.ctatdebug("processAssociatedRules() done")};this.processBuggyMessage=function(a){c.ctatdebug("processBuggyMessage()");this.showFeedback(a.getBuggyMsg())};this.processSuccessMessage=function(a){c.ctatdebug("processSuccessMessage()");this.showFeedback(a.getSuccessMessage())};
this.processUntutoredAction=function(a,b){c.processInterfaceAction(a,b)};this.processInterfaceAction=function(a,b){c.ctatdebug('CTATCommShell.processInterfaceAction ("'+a.getMessageType()+'")');var d=a.getProperty("trigger"),d=a.getProperty("subtype")||(d&&"data"==d.toLowerCase()?"tutor-performed":"");null!=commLoggingLibrary?v&&commLoggingLibrary.logSemanticEvent(a.getTransactionID(),a.getSAI(),"ATTEMPT",d):this.ctatdebug("Info: no logging library available!");if("root"==a.getSelection()||"_root"==
a.getSelection()){c.ctatdebug("Info: selection is 'root', we'll call the function straight up ...");for(var d=[window,CTATCommShell.commShell],f=a.getAction(),e=a.getInput(),g=0;g<d.length&&"function"!=typeof d[g][f];++g);if(g>=d.length)c.ctatdebug("Internal error: unable to find function: "+f);else{c.ctatdebug("Calling as: "+f+"("+e+")");try{d[g][f](e)}catch(B){c.ctatdebug("Internal error: unable to execute function: "+B.message)}}}else if(d=CTATShellTools.findComponent(a.getSelection()),null===
d)c.ctatdebug("Internal error: unable to find pointer to component object");else if(0==d.length)c.ctatdebug("Error: no component found to call interface action on");else{f=d.length;c.ctatdebug("Call the action on the component(s) -> ("+f+")...");for(e=0;e<f;e++)if(c.ctatdebug("About to call "+a.getAction()+" ("+a.getInput()+") on: "+a.getSelection()),g=d[e],g.executeSAI(a),c.ctatdebug("Method executed, continuing with post-processing ..."),1==commMessageHandler.getInStartState()){var h=a.getAction();
h&&h.toLowerCase().startsWith("updatetext")&&g.setEnabled(!b)}c.ctatdebug("processInterfaceAction() Done")}};this.processInterfaceIdentification=function(a){c.ctatdebug("processInterfaceIdentification()")};this.processAuthorModeChange=function(a){c.ctatdebug("processAuthorModeChange()")};this.processShowHintsMessage=function(a){c.ctatdebug("processShowHintsMessage()")};this.processConfirmDone=function(a){c.ctatdebug("processConfirmDone()")};this.processVersionInfo=function(a){c.ctatdebug("processVersionInfo()")};
this.updateLastActionTimestamp=function(){b&&b.updateLastActionTimestamp()};this.processTutoringServiceAlert=function(a){c.ctatdebug("processTutoringServiceAlert()");for(var b="",d=0;d<a.length;d++){var f=a[d];"ErrorType"==h.getElementName(f)&&h.getNodeTextValue(f);"Details"==h.getElementName(f)&&(b=h.getNodeTextValue(f))}CTATScrim.scrim.scrimUp(b)};this.processTutoringServiceError=function(a){c.ctatdebug("processTutoringServiceError()");var b=a.getProperty("ErrorType");a=a.getProperty("Details");
CTATScrim.scrim.scrimDown();CTATScrim.scrim.errorScrimUp(b+" - "+a)};this.processProblemSummaryResponse=function(a){c.ctatdebug("processProblemSummaryResponse()");CTATLMS.processProblemSummary&&CTATLMS.processProblemSummary(a.getXMLObject());CTATLMS.closeLMSConnection&&CTATLMS.closeLMSConnection();if(null!=p){var b=a.getXMLObject(),e=b.getElementsByTagName("ProblemSummary"),g=b.getElementsByTagName("cmi.core.lesson_status"),h=b.getElementsByTagName("cmi.core.score.raw");a=b.getElementsByTagName("cmi.core.exit");
b=b.getElementsByTagName("cmi.core.session_time");e=$("<div>").html(e[0].innerHTML).text();g="<cmi.core.lesson_status>"+$("<div>").html(g[0].innerHTML).text()+"</cmi.core.lesson_status>";h="<cmi.core.score.raw>"+$("<div>").html(h[0].innerHTML).text()+"</cmi.core.score.raw>";a="<cmi.core.exit>"+$("<div>").html(a[0].innerHTML).text()+"</cmi.core.exit>";b="<cmi.core.session_time>"+$("<div>").html(b[0].innerHTML).text()+"</cmi.core.session_time>";p(e,"<scorm>"+g+h+a+b+"</scorm>");p=null}else b=new CTATXML,
null!=f?f(b.xmlToString(a.getXMLObject())):d.sendSummary(a)};this.setGotProblemRestoreEnd=function(a){v=a};this.processProblemRestoreEnd=function(a){c.ctatdebug("processProblemRestoreEnd() scrimIsUp "+scrimIsUp);v=!0;CTATScrim.scrim.scrimDown()};this.clearFeedbackComponents=function(){c.ctatdebug("clearFeedbackComponents ()");CTATShellTools.showHints(null)};this.processHintResponse=function(a,b){c.ctatdebug("processHintResponse()");unhighlightall();CTATShellTools.showHints(b);var d=a.getSAI();if(null!=
d)if(d=d.getSelection(),null!=d)if(c.ctatdebug("Highlighting selection for hint: "+d),d=CTATShellTools.findComponent(d),null!=d)for(var f=0;f<d.length;f++)1==CTATCommShell.detailedFeedback&&d[f].setHintHighlight(!0,a);else c.ctatdebug("Unable to find component name in list: "+d);else c.ctatdebug("Error: no highlight selection present in SAI");else c.ctatdebug("Warning: no SAI found in highlight message");CTATCommShell.detailedFeedback=!0;c.ctatdebug("processHintResponse() done")};this.showHighlightSelection=
function(a,b){c.ctatdebug("showHighlightSelection ("+a+")");var d=CTATShellTools.findComponent(a);if(null!=d)for(var f=0;f<d.length;f++)1==CTATCommShell.detailedFeedback&&(0===f?d[f].moveHintHightlight&&d[f].moveHintHighlight(!0,b):d[f].setHintHighlight&&d[f].setHintHighlight(!0,b));else c.ctatdebug("Unable to find component name in list: "+d)};this.globalReset=function(){c.ctatdebug("globalReset ()");CTATMessageHandler.scriptElement=""};this.nextProblem=function(b){c.ctatdebug("nextProblem ()");
if(CTATGlobalFunctions.isBlank(b))c.ctatdebug("Message is blank, requesting next problem ..."),b=flashVars.getRawFlashVars().run_problem_url,a.send(b);else{c.ctatdebug("Message contains html data, writing ...");try{document.close()}catch(A){alert("Error closing document: "+A.message)}try{document.write(b)}catch(A){alert("Error writing document: "+A.message)}}};this.updateSkillWindow=function(a){c.ctatdebug("updateSkillWindow()");CTATSkillSet.skills.untouchSkills();var b=CTATShellTools.findComponentByClass("CTATSkillWindow");
null!==b?null!=a?b.updateSkillSet(a):b.drawComponent():c.ctatdebug("Info: no skill window available")};this.processComponentFocus=function(a){c.ctatdebug("processComponentFocus("+a.getName()+","+a.getClassName()+")");"CTATTextInput"==a.getClassName()||"CTATTextField"==a.getClassName()||"CTATTextArea"==a.getClassName()?(CTATGlobals.selectedTextInput=a,null!==mobileAPI&&!0===mobileAPI.getEnabled()&&mobileAPI.processTextFocus(a.getX(),a.getY(),a.getWidth(),a.getHeight())):CTATGlobals.selectedTextInput=
null;c.ctatdebug("processComponentFocus() done")};this.showFeedback=function(a){null!=a&&void 0!=a&&/\S/.test(a)&&" "!=a?(c.ctatdebug("showFeedback("+a+") -> l: "+a.length),CTATShellTools.showFeedback(a),null!=n&&n(a)):c.ctatdebug("showFeedback(): False alarm: empty message. This can happen when the commshell is trying to clear the hint window and there is no hint window.")};this.assignFeedbackHandler=function(a){c.ctatdebug("assignFeedbackHandler()");n=a};this.gradeSAI=function(a,b,d){c.ctatdebug("gradeSAI()");
m[a]=d;a=new CTATSAI(a,b,d);c.processComponentAction(a,!0,!0)};this.assignGradingHandler=function(a){c.ctatdebug("assignGradingHandler()");l=a};this.assignAnonymousGradingProcessor=function(a){x=a};this.assignDoneProcessor=function(a){f=a};this.addEventListener=function(a,c){};this.addGlobalEventListener=function(a){c.ctatdebug("addGlobalEventListener( "+a+")");a&&q.push(a)};this.sendToTools=function(c){a&&a.sendToToolsOrCollaborators(a.getURL(),c,!1)};this.closeWSConnection=function(c,b,d){(c=a.findWSConnection(c))?
c.close(d,b):console.warn("connection not found")}};CTATCommShell.prototype=Object.create(CTATBase.prototype);CTATCommShell.prototype.constructor=CTATCommShell;CTATCommShell.commShell=null;CTATCommShell.detailedFeedback=!0;function enableDetailedFeedback(a){CTATCommShell.detailedFeedback=a};var CTATComponentReference=function(a,b){var d=a,e=b;this.setElement=function(a){d=a};this.getElement=function(){return d};this.setDiv=function(a){e=a};this.getDiv=function(){return e}};CTATComponentReference.components={};CTATComponentReference.list=function(){for(var a in CTATComponentReference.components){var b=CTATComponentReference.components[a];ctatdebug("Component: "+b.getElement().getName()+", with div: "+b.getDiv().id)}};
CTATComponentReference.getComponentFromID=function(a){var b=CTATComponentReference.components;return b.hasOwnProperty(a)?(a=b[a],a.getElement()?a.getElement():null):null};CTATComponentReference.add=function(a,b){var d=new CTATComponentReference(a,b);return CTATComponentReference.components[d.getDiv().getAttribute("id")]=d};var CTATCompBase=function(a,b,d,e,g,c){CTATBase.call(this,a,b);var f=d||0,h=e||0,m=g||-2,l=c||-2,n=50,p=25,x=!1,q=!1,v="",u=!1,A=!0,y=null,C="",r=null;this.isTabIndexable=!0;var I=0,J=null,B=this,D=null,H="hidden",E=CTATGlobalFunctions.gensym.z_index(),w=CTATGlobalFunctions.gensym.div_id(),z=CTATGlobalFunctions.gensym.z_index(),K=CTATGlobalFunctions.gensym.div_id();this.setIsAbstractComponent=function(a){x=a};this.isAbstractComponent=function(){return x};this.setIsFeedbackComponent=function(a){q=
a};this.isFeedbackComponent=function(){return q};this.setTabIndex=function(a){!0===this.isTabIndexable?(r=a,0>r?(r=CTATGlobals.Tab.Tracker,CTATGlobals.Tab.Tracker++):CTATGlobals.Tab.Tracker=r):r=-1};this.getTabIndex=function(){return r||this.getComponent().getAttribute("tabindex")};this.setZIndex=function(a){B.ctatdebug("Setting z index to: "+a);I=a;null!==y&&(y.style.zIndex=a)};this.getZIndex=function(){return I};this.setDefaultWidth=function(a){n=a};this.getDefaultWidth=function(){return n};this.setDefaultHeight=
function(a){p=a};this.getDefaultHeight=function(){return p};this.processCommShellEvent=function(a,c){B.ctatdebug("processCommShellEvent ("+a+")")};this.makeDivWrapper=function(a){y=document.createElement("div");y.id=this.getName();y.setAttribute("onkeypress","return noenter(event)");y.setAttribute("data-ctat-component",this.getClassName());y.style.position="absolute";y.style.left=f+"px";y.style.top=h+"px";y.style.zIndex=E;y.style.width=B.getWidth()+"px";y.style.height=B.getHeight()+"px";$(y).data("CTATComponent",
this);a.appendChild(y)};this.setDivWrapper=function(a){y=a;y.setAttribute("data-ctat-component",this.getClassName())};var M=this.setClassName;this.setClassName=function(a){M(a);y&&y.setAttribute("data-ctat-component",this.getClassName())};this.wrapComponent=function(a){B.ctatdebug("wrapComponent ()");B.makeDivWrapper(a);B.ctatdebug("wrapComponent () done")};this.createCanvas=function(){B.ctatdebug("createCanvas ()");D=document.createElement("canvas");D.setAttribute("id",K);D.setAttribute("onkeypress",
"return noenter(event)");D.setAttribute("width",m+canvasCalibrate+"px");D.setAttribute("height",l+canvasCalibrate+"px");D.setAttribute("style","border: 1px "+this.borderColor+" solid; "+("hidden"==H?"visibility: hidden; ":"")+"z-index:"+z+";");y.firstChild?y.insertBefore(D,y.firstChild):y.appendChild(D);return D};this.redraw=function(){var a=y.style.display;y.style.display="none";y.style.display=a};this.setCanvasVisibility=function(a){H=a};this.getSubCanvasCtx=function(){if(D)return D.getContext("2d")};
this.getSubCanvas=function(){return D};this.getX=function(){return f};this.getY=function(){return h};this.getWidth=function(){if(0>=m){var a;J?a=window.getComputedStyle(J):y&&(a=window.getComputedStyle(y));if(a)return parseFloat(a.width)}return m};this.getHeight=function(){if(0>=l&&y){var a=window.getComputedStyle(y);return parseFloat(a.getPropertyValue("height"))}return l};this.getText=function(){return v};this.getEnabled=function(){return A};this.assignEnabled=function(a){A=a;y.setAttribute("data-ctat-enabled",
A)};this.setEnabled=function(a){B.ctatdebug("setEnabled ("+a+")");B.assignEnabled(a);J?J.disabled=!A:B.ctatdebug("Error: component pointer is null")};this.lock=this.setEnabled.bind(B,!1);this.unlock=this.setEnabled.bind(B,!0);this.getDivWrap=function(){return y};this.getComponent=function(){return J};this.component=null;Object.defineProperty(this,"component",{get:function(){return J}});this.getCanvasZIndex=function(){return z};this.getComponentGroup=function(){return C};this.setComponent=function(a){J=
a;this.setEnabled(this.getEnabled())};this.getTopDivZIndex=function(){return E};this.getTopDivID=function(){return w};this.setComponentGroup=function(a){C=a;J&&(J.name=a)};this.assignText=function(a){v=a};this.init=function(){B.ctatdebug("THIS IS THE BASE INIT METHOD")};this.initialize=function(){B.ctatdebug("initialize ()");B.configFromDescription();B.init();B.processSerialization();B.render();B.processTabOrder();B.ctatdebug("initialize () done")};this.getInitialized=function(){return u};this.setInitialized=
function(a){B.ctatdebug("setInitialized ("+a+")");u=a;!0!==u||y?B.ctatdebug("Not wrapping, initialized="+u+", divWrapper = "+y):(B.ctatdebug("Wrapping a component and appending it to the top container div if one was never set ..."),(a=findPointOfAttachment(this.getName()))?(B.ctatdebug("Attaching component to existing MovieClip ..."),B.wrapComponent(a.getDivWrapper())):(B.ctatdebug("Attaching component to main div ..."),0<$("#"+ctatcontainer).length&&B.wrapComponent(getSafeElementById(ctatcontainer))));
B.getDivWrap().classList.add("CTATComponent");B.ctatdebug("setInitialized () done")};this.addSafeEventListener=function(a,c,b){B.ctatdebug("addSafeEventListener ("+a+")");B.ctatdebug("Adding event listener to: "+b);b?b.addEventListener(a,c):(J?(B.ctatdebug("Adding eventlistener to component instead of target"),J.addEventListener(a,c)):B.ctatdebug("Error: pointer to component is null, can't add event listener"),B.ctatdebug("addSafeEventListener () done"))};this.drawComponent=function(){};this.addComponentReference=
function(a,c){B.ctatdebug("addComponentReference ("+a.getName()+" -> "+c.getAttribute("id")+")");CTATComponentReference.add(a,c);B.ctatdebug("addComponentReference ()")};this.getComponentFromID=function(a){return CTATComponentReference.getComponentFromID(a)};this.processSerialization=function(){B.ctatdebug("processSerialization()");B.ctatdebug("implement in child class")};this.move=function(a,c){f=Number(a);h=Number(c);if(void 0===c||null===c||isNaN(h))if(0<=a.indexOf(",")){var b=a.split(",");f=Number(b[0]);
h=Number(b[1])}else h=0;f=isNaN(f)?0:f;h=isNaN(h)?0:h;y&&(y.style.left=f+"px",y.style.top=h+"px")};this.setSize=function(a,c){var b=Number(a),d=Number(c);(void 0===c||null===c||isNaN(d))&&0<=a.indexOf(",")&&(d=a.split(","),b=Number(d[0]),d=Number(d[1]));B.ctatdebug("setSize ("+b+","+d+")");isNaN(b)||B.setWidth(b);isNaN(d)||B.setHeight(d)};this.SetVisible=this.setVisible=function(a){a=CTATGlobalFunctions.toBoolean(a);H=!0===a?"block":"hidden";D&&D.setAttribute("style","border: 0px; position: absolute; "+
(a?"":"visibility:hidden; ")+"; left:"+f+"px; top:"+h+"px; z-index:"+z+";");y.style.visibility=!0===a?"unset":"hidden"};this.FadeIn=function(a){B.SetVisible(!0)};this.FadeOut=function(a){B.SetVisible(!1)};this.reset=function(){};this.setX=function(a){this.x=a;y.style.left=this.x+"px";!0===u&&this.render()};this.setY=function(a){this.y=a;y.style.top=this.y+"px";!0===u&&this.render()};this.setWidth=function(a){B.ctatdebug("setWidth ("+a+")");m=a;y?y.style.width=m+"px":B.ctatdebug("Internal error: no div wrapper available to set width")};
this.setHeight=function(a){B.ctatdebug("setHeight ("+a+")");l=a;y?y.style.height=l+"px":B.ctatdebug("Internal error: no div wrapper available to set height")};this.setText=function(a){v=a;return this};this.getValue=function(){return J?J.value:""};this.backgrade=!1;this.unHighlightAll=function(){$(".CTAT--hint").each(function(){for(var a=$(this),c=null;0<a.length&&null===c;)a.data("CTATComponent")?c=a.data("CTATComponent"):a=a.parent();c&&c.setHintHighlight&&c.setHintHighlight(!1,null)})};this.processOnFocus=
function(){B.ctatdebug("processOnFocus ("+B.getName()+")");CTATGlobals.Tab.previousFocus=CTATGlobals.Tab.Focus;CTATGlobals.Tab.Focus!=B?(B.ctatdebug("CTATGlobals.Tab.Focus!=pointer, updating CTATGlobals.Tab.Focus ..."),CTATGlobals.Tab.Focus=B):B.ctatdebug("CTATGlobals.Tab.Focus==pointer");B.ctatdebug("processOnFocus () done")};this.processFocus=function(a){B.ctatdebug("processFocus ()");a.currentTarget.getAttribute("id");if(B){mobileAPI&&!0===mobileAPI.getEnabled()&&B.hideKeyboard();CTATCommShell.commShell&&
CTATCommShell.commShell.processComponentFocus(B);if(CTATGlobals.Tab.Focus){B.ctatdebug("old focus: "+CTATGlobals.Tab.Focus.getName()+", new focus:"+B.getName()+", correct: "+CTATGlobals.Tab.Focus.isCorrect());if(1==CTATGlobals.Tab.Focus.isCorrect()){B.ctatdebug("Previous focus is a correct component, don't backgrade!");return}if(CTATGlobals.Tab.Focus==B){B.ctatdebug("We're already there!");return}CTATGlobals.Tab.Focus.backgrade&&CTATGlobals.Tab.Focus.processAction()}else B.ctatdebug("No previously focused component yet, can't grade");
"hint"==B.getClassName()||"CTATHintButton"==B.getClassName()?B.ctatdebug("Info: focus moved to hint, bump"):(CTATGlobals.Tab.previousFocus=CTATGlobals.Tab.Focus,CTATGlobals.Tab.Focus=B,B.ctatdebug("processFocus () done"))}else B.ctatdebug("Error: component reference is null")};this.processTabOrder=function(){B.ctatdebug("processTabOrder ("+r+")");!0===x?B.ctatdebug("Component is an abstract component, bump"):J?(B.ctatdebug("We have a component, actually assigning to html component ..."),null!==r&&
(J.tabIndex=r),J.onfocus=B.processOnFocus):B.ctatdebug("Error: we don't have an html component yet, can't assign tab index")};this.hideKeyboard=function(){document.activeElement.blur();$("input").blur()}};CTATCompBase.prototype=Object.create(CTATBase.prototype);CTATCompBase.prototype.constructor=CTATCompBase;var CTATCSS=function(){var a=0,b=[],d=0,e=[],g=0,c=[];this.resetSelectors=function(){d=0;e=[];e[d]=[]};this.resetCSSStringArray=function(){c=[];g=0};this.clearCSS=function(){this.resetSelectors();this.resetCSSStringArray();b=[];a=0};this.addStringCSS=function(a){c[g]=a;g++};this.addCSSAttribute=function(c,d){b[a]=c;b[a+1]=d;a+=2};this.removeStringCSS=function(a){a=c.indexOf(a);0<=a&&c.splice(a,1)};this.removeCSSAttribute=function(a){a=b.indexOf(a);0<=a&&b.splice(a,2)};this.modifyCSSAttribute=function(a,
c){var d=b.indexOf(a);-1==d?this.addCSSAttribute(a,c):b[d+1]=c};this.addSelector=function(a){e[d]=[];e[d][0]=a;d++};this.addSelectorAttribute=function(a,c,b){var f=1;a:if(0===d)a=0;else{for(var g=0;g<e.length&&null!==e[g][0];g++)if(e[g][0]==a){a=g;break a}a=-1}for(;void 0!==e[a][f];)f++;e[a][f]=c;e[a][f+1]=b};this.toCSSString=function(){for(var a="",d=0;d<e.length;d++){for(var a=a+(e[d][0]+" { "),g=1;g<e[d].length;g++)a+=e[d][g],a=0===g%2?a+"; ":a+": ";a+=" }; "}for(d=0;d<b.length;d++)a+=b[d],a=0===
d%2?a+": ":a+"; ";for(d=0;d<c.length;d++)a+=c[d]+" ";return a}};CTAT.Component={};CTAT.Component.Base={};
CTAT.Component.Base.Style=function(a,b,d,e,g,c){CTATCompBase.call(this,a,b,d,e,g,c);var f=new CTATCSS;this.addCSSAttribute=function(a,c){f.addCSSAttribute(a,c);this.render()};this.removeCSSAttribute=function(a){f.removeCSSAttribute(a);this.render()};this.addStringCSS=function(a){f.addStringCSS(a);this.render()};this.removeStringCSS=function(a){f.removeStringCSS(a);this.render()};this.modifyCSSAttribute=function(a,c){f.modifyCSSAttribute(a,c);this.render()};this.getCSS=function(){return f.toCSSString()};
this.render=function(){!0===this.isAbstractComponent()?this.ctatdebug("Component is an abstract component, bump"):this.getInitialized()&&(this.getComponent()?this.ctatdebug(f.toCSSString()):this.ctatdebug("Internal error, html component not available for rendering"))};this.setStyleAll=function(a,c){this.getSubCanvas()&&this.getSubCanvas().setAttribute(a,c);this.modifyCSSAttribute(a,c)}};CTAT.Component.Base.Style.prototype=Object.create(CTATCompBase.prototype);
CTAT.Component.Base.Style.prototype.constructor=CTAT.Component.Base.Style;CTAT.Component.Base.Graphical=function(a,b,d,e,g,c,f){CTAT.Component.Base.Style.call(this,a,b,e,g,c,f);var h=d||(new CTATComponentDescription).setGenericDefaults();this.getGrDescription=function(){return h};this.setGrDescription=function(a){h=a;this.processDescription(h)};var m={},l={};this.getAlign=function(){return this.component?$(this.component).css("text-align"):$(this.getDivWrap()).css("text-align")};this.setAlign=function(a){this.component&&(this.component.style.textAlign=a);return this};this.getBackgroundColor=
function(){return $(this.getComponent()).css("background-color")};this.setBackgroundColor=function(a){a=a?CTATGlobalFunctions.formatColor(a):null;this.component&&(this.component.style.backgroundColor=a);return this};this.setDisabledBGColor=function(a){return this};this.setDisabledTextColor=function(a){return this};this.getBorderColor=function(){return $(this.getComponent()).css("border-color")};this.setBorderColor=function(a){a&&(a=CTATGlobalFunctions.formatColor(a),this.getComponent()?$(this.getComponent()).css("border-color",
a):this.getDivWrap().style.borderColor=a);return this};this.getBorderRoundness=function(){return $(this.getComponent()).css("border-radius")};this.setBorderRoundness=function(a){a=parseInt(a,10);isNaN(a)?a=m.roundness=0:m.roundness=a;a+="px";this.component&&this.getBorderRoundness()!==a&&($(this.component).css("border-radius",a),this.component.style.borderRadius=m.roundness);return this};this.getBorderStyle=function(){return $(this.getComponent()).css("borderStyle")};this.setBorderStyle=function(a){this.component&&
(this.component.style.borderStyle=a);return this};this.getBorderWidth=function(){return this.getComponent()?$(this.getComponent()).css("borderWidth"):m.width};this.setBorderWidth=function(a){m.width=a;/(\d*(px)? ?){1,3}(\d*(px)? ?)?/.test(a)||(a="0px",console.log("invalid width string"));this.component&&this.getBorderWidth()!==a&&$(this.component).css("borderWidth",a);return this};this.setPadding=function(a){a=parseInt(a);isNaN(a)&&(a=0);this.component&&(this.component.style.padding=a+"px");return this};
this.getFontColor=function(){if(this.component)return $(this.component).css("color")};this.setFontColor=function(a){console.log("setFontColor( )");l.color=CTATGlobalFunctions.formatColor(a);this.component&&(console.log("got comp"),this.getFontColor()!==l.color&&$(this.component).css("color",l.color));return l.color};this.setFontFamily=function(a){this.component&&(this.component.style.fontFamily=a);return this};this.getFontFamily=function(){if(this.component)return this.component.style.fontFamily;
console.warn("component not found");return null};this.setFontSize=function(a){a=parseInt(a);isNaN(a)?this.component.style.fontSize=null:(l.size=a,this.component&&(this.component.style.fontSize=a+"pt"));return this};this.setShowBorder=function(a){a=CTATGlobalFunctions.toBoolean(a);this.component&&(a?this.setBorderStyle("solid"):this.setBorderStyle("none"));return this};this.setUnderlined=function(a){p_underlined=CTATGlobalFunctions.toBoolean(a);this.component&&(this.component.style.textDecoration=
p_underlined?"underline":null);return this};this.setBolded=function(a){a=CTATGlobalFunctions.stringToBoolean(a);this.component&&(this.component.style.fontWeight=a?"bold":null);return this};this.setItalicized=function(a){CTATGlobalFunctions.toBoolean(a);this.component&&(this.component.style.fontStyle=l.italicized?"italic":null);return this};var n=this;a=function(a){var c=a||{};return{setHandler:function(a,b){c[a]=b},set:function(a){if(c.hasOwnProperty(a)){if(c[a]){var b=Array.prototype.slice.call(arguments,
1);return c[a].apply(n,b)}n.ctatdebug("Error: NULL handler for "+a)}else n.ctatdebug("Error: No handler set for "+a)}}};this.style_handlers=a({BackgroundColor:this.setBackgroundColor,BorderColor:this.setBorderColor,borderRoundness:this.setBorderRoundness,DrawBorder:this.setShowBorder,FontFace:this.setFontFamily,FontSize:this.setFontSize,FontBold:this.setBolded,FontItalic:this.setItalicized,FontUnderlined:this.setUnderlined,labelText:this.setText,padding:this.setPadding,showBorder:this.setShowBorder,
TextAlign:this.setAlign,TextColor:this.setFontColor});this.setStyle=function(a,c){this.style_handlers.set(a,c)};this.setStyleHandler=function(a,c){this.style_handlers.setHandler(a,c)};this.parameter_handlers=a({group:this.setComponentGroup});this.setParameter=function(a,c){this.parameter_handlers.set(a,c)};this.setParameterHandler=function(a,c){this.parameter_handlers.setHandler(a,c)};this.data_ctat_handlers={};this.processAttributes=function(){if(this.getDivWrap()){var a=$(this.getDivWrap()),c=parseInt(a.attr("tabindex"),
10)||parseInt(a.attr("data-ctat-tabindex"),10);isNaN(c)||(this.setTabIndex(c),a.attr("tabindex",null));c=a.attr("name");void 0!==c&&this.setComponentGroup(c);for(var b in this.data_ctat_handlers)c=a.data("ctat-"+b),void 0!==c&&this.data_ctat_handlers[b].apply(this,[c])}};this.data_ctat_handlers.enabled=function(a){this.setEnabled(CTATGlobalFunctions.toBoolean(a))};this.processParameters=function(a){if(a)if(a instanceof CTATComponentDescription){n.setName(a.name);a=a.params;for(var c in a)this.setParameter(c,
a[c])}else this.ctatdebug("Error: Invalid description sent to CTAT.Components.Hierarchy.Graphical.processDescription: "+a)};this.processStyles=function(a){if(a)if(a instanceof CTATComponentDescription){a=a.styles;for(var c in a)this.setStyle(c,a[c])}else this.ctatdebug("Error: Invalid description sent to CTAT.Components.Hierarchy.Graphical.processDescription: "+a)};this.processDescription=function(a){this.processParameters(a);this.processStyles(a)};this.configFromDescription=function(){this.processParameters(h)};
this.processSerialization=function(){this.processStyles(h)};this.addClass=function(a){this.getDivWrap()&&null!=this.getDivWrap()&&this.getDivWrap().classList.add(a)};this.removeClass=function(a){this.getDivWrap()&&null!=this.getDivWrap().classList&&this.getDivWrap().classList.remove(a)}};CTAT.Component.Base.Graphical.prototype=Object.create(CTAT.Component.Base.Style.prototype);CTAT.Component.Base.Graphical.prototype.constructor=CTAT.Component.Base.Graphical;CTAT.Component.Base.SAIHandler=function(a,b,d,e,g,c,f){CTAT.Component.Base.Graphical.call(this,a,b,d,e,g,c,f);var h=new CTATSAI(this.getName(),CTAT.Component.Base.SAIHandler.DefaultAction,CTAT.Component.Base.SAIHandler.DefaultInput,CTAT.Component.Base.SAIHandler.DefaultPrompt),m=this.setName;this.setName=function(a){m(a);h.setSelection(this.getName())};this.getSAI=function(){return h};this.setSAI=function(a,c,b){a instanceof CTATSAI?h=a:(a=null===a||void 0===a?this.getName():a,h=new CTATSAI(a,c,b,
CTAT.Component.Base.SAIHandler.DefaultPrompt));return this};this.setInput=function(a){h instanceof CTATSAI?h.setInput(a):h=new CTATSAI(this.getName(),CTAT.Component.Base.SAIHandler.DefaultAction,a,CTAT.Component.Base.SAIHandler.DefaultPrompt);return this};this.setAction=function(a){h instanceof CTATSAI?h.setAction(a):h=new CTATSAI(this.getName(),a,CTAT.Component.Base.SAIHandler.DefaultInput,CTAT.Component.Base.SAIHandler.DefaultPrompt);return this};this.setActionInput=function(a,c){this.setAction(a);
this.setInput(c);return this};this.setSelection=function(a){h instanceof CTATSAI?h.setSelection(a):h=new CTATSAI(a,CTAT.Component.Base.SAIHandler.DefaultAction,CTAT.Component.Base.SAIHandler.DefaultInput,CTAT.Component.Base.SAIHandler.DefaultPrompt)};this.updateSAI=function(){};this.executeSAI=function(a){this.ctatdebug("executeSAI ()");var c;c=a instanceof CTATMessage?a.getSAI():a;if(c instanceof CTATSAI){var b=c.getAction();this.ctatdebug("Processing "+b+"("+c.getInput()+") on: "+c.getSelection());
if("function"==typeof this[b]){c=c.getArgumentsTyped();this.ctatdebug("JSON args: "+JSON.stringify(c));try{this.ctatdebug("Executing "+b+"("+c+","+typeof a+")..."),c.push(a),this[b].apply(this,c)}catch(x){return this.ctatdebug("ERROR: failed to execute action: "+x.message),!1}this.component&&(a=new CustomEvent("CTAT_EXECUTE_SAI",{detail:{sai:a,component:this},bubbles:!0,cancelable:!0}),this.component.dispatchEvent(a));return!0}this.ctatdebug("ERROR: Unsupported action: "+b+" from "+c.toLSxmlString());
return!1}this.ctatdebug("ERROR: Non-SAI sent to executeSAI("+typeof a+")");return!1}};CTAT.Component.Base.SAIHandler.DefaultAction="ButtonPressed";CTAT.Component.Base.SAIHandler.DefaultInput="-1";CTAT.Component.Base.SAIHandler.DefaultPrompt="";CTAT.Component.Base.SAIHandler.prototype=Object.create(CTAT.Component.Base.Graphical.prototype);CTAT.Component.Base.SAIHandler.prototype.constructor=CTAT.Component.Base.SAIHandler;CTAT.Component.Base.Tutorable=function(a,b,d,e,g,c,f){CTAT.Component.Base.SAIHandler.call(this,a,b,d,e,g,c,f);var h=!0,m=!0,l=!0,n=CTAT.Component.Base.Tutorable.Options.TutorComponent.TUTOR,p=this,x=!1;this.setTutorComponent=function(a){n=a;a=CTAT.Component.Base.Tutorable.Options.TutorComponent;switch(n){case a.TUTOR:l=h=m=!0;break;case a.TUTOR_NO_FEEDBACK:h=m=!0;l=!1;break;case a.DO_NOT_TUTOR:h=!1,m=!0}};this.setParameterHandler("tutorComponent",this.setTutorComponent);this.data_ctat_handlers.tutor=
function(a){h=CTATGlobalFunctions.toBoolean(a)};this.data_ctat_handlers["show-feedback"]=function(a){l=CTATGlobalFunctions.toBoolean(a)};this.getTutorComponent=function(){var a=CTAT.Component.Base.Tutorable.Options.TutorComponent;return h&&m&&l?a.TUTOR:h&&m&&!l?a.TUTOR_NO_FEEDBACK:!h&&m?a.DO_NOT_TUTOR:n};this.getDisableOnCorrect=function(){var a=$(this.getDivWrap()).attr("data-ctat-disable-on-correct");return a?CTATGlobalFunctions.toBoolean(a):!0};this.setDisableOnCorrect=function(a){$(this.getDivWrap()).attr("data-ctat-disable-on-correct",
a)};this.setParameterHandler("DisableOnCorrect",this.setDisableOnCorrect);var q=!0;this.getShowHintHighlight=function(){return q};this.setShowHintHighlight=function(a){q=CTATGlobalFunctions.toBoolean(a)};this.setParameterHandler("ShowHintHighlight",this.setShowHintHighlight);this.data_ctat_handlers["show-hint-highlight"]=function(a){q=CTATGlobalFunctions.toBoolean(a)};var v=CTAT.Component.Base.Tutorable.Options.Status.NOTGRADED;this.getComponentStatus=function(){return v};this.setComponentStatus=
function(a){v=a};this.isCorrect=function(){return v===CTAT.Component.Base.Tutorable.Options.Status.CORRECT};this.isIncorrect=function(){return v===CTAT.Component.Base.Tutorable.Options.Status.INCORRECT};this.isNotGraded=function(){return v===CTAT.Component.Base.Tutorable.Options.Status.NOTGRADED};this.setCorrect=function(a){this.setNotGraded();"CTATTableGoogle"!=this.getClassName()&&this.executeSAI(a);v=CTAT.Component.Base.Tutorable.Options.Status.CORRECT;!0===this.getDisableOnCorrect()&&this.setEnabled(!1);
!1===CTATGlobals.suppressStudentFeedback&&l&&this.showCorrect(a);this.ctatdebug("setCorrect() post showCorrect");this.component&&(a=new CustomEvent(CTAT.Component.Base.Tutorable.EventType.correct,{detail:{sai:a,component:this},bubbles:!0,cancelable:!0}),this.getDivWrap().dispatchEvent(a))};this.setIncorrect=function(a){this.ctatdebug("setIncorrect()");this.setNotGraded();"CTATTableGoogle"!=this.getClassName()&&this.executeSAI(a);v=CTAT.Component.Base.Tutorable.Options.Status.INCORRECT;!1===CTATGlobals.suppressStudentFeedback&&
l&&this.showInCorrect(a);this.component&&(a=new CustomEvent(CTAT.Component.Base.Tutorable.EventType.incorrect,{detail:{sai:a,component:this},bubbles:!0,cancelable:!0}),this.getDivWrap().dispatchEvent(a))};this.setNotGraded=function(){this.ctatdebug("setNotGraded ()");this.setHintHighlight(!1);if(!this.isNotGraded()&&(v=CTAT.Component.Base.Tutorable.Options.Status.NOTGRADED,this.removeCorrect(),this.removeInCorrect(),this.component)){var a=new CustomEvent(CTAT.Component.Base.Tutorable.EventType.ungrade,
{detail:{component:this},bubbles:!0,cancelable:!0});this.getDivWrap().dispatchEvent(a)}};this.showHintHighlight=function(a,c){this.component.classList.remove("CTAT--correct");this.component.classList.remove("CTAT--incorrect");a?this.component.classList.add("CTAT--hint"):this.component.classList.remove("CTAT--hint")};this.setHintHighlight=function(a,c){this.ctatdebug("setHintHighlight ("+a+")");if(q){var b=CTATGlobalFunctions.toBoolean(a);if(this.component){var d=new CustomEvent(CTAT.Component.Base.Tutorable.EventType.highlight,
{detail:{isHighlighted:b,component:this},bubbles:!0,cancelable:!0});this.getDivWrap().dispatchEvent(d)}b!==x&&(x=b,this.showHintHighlight(b,c))}};this.moveHintHighlight=function(a,c){this.ctatdebug("moveHintHighlight ("+a+")");CTATGlobals.Tab.previousFocus=CTATGlobals.Tab.Focus;CTATGlobals.Tab.Focus=p;p.component.focus?CTATGlobals.Tab.Focus.getComponent().focus():CTATGlobals.Tab.Focus.getDivWrap().focus();if(q){var b=CTATGlobalFunctions.toBoolean(a);if(this.component){var d=new CustomEvent(CTAT.Component.Base.Tutorable.EventType.highlight,
{detail:{isHighlighted:b,component:this},bubbles:!0,cancelable:!0});this.getDivWrap().dispatchEvent(d)}b!==x&&(x=b,this.showHintHighlight(b,c))}};this.highlight=function(a){ctatdebug("highlight ()");this.component.classList.add("CTAT--highlight")};this.unhighlight=function(a){ctatdebug("unhighlight ()");this.component.classList.remove("CTAT--highlight")};this.showCorrect=function(a){this.ctatdebug("showCorrect("+a+")");this.getComponent().classList.remove("CTAT--incorrect");this.getComponent().classList.remove("CTAT--hint");
this.getComponent().classList.add("CTAT--correct")};this.removeCorrect=function(){this.getComponent()&&this.getComponent().classList.remove("CTAT--correct")};this.showInCorrect=function(a){this.ctatdebug("showInCorrect("+a+")");this.getComponent().classList.remove("CTAT--correct");this.getComponent().classList.remove("CTAT--hint");this.getComponent().classList.add("CTAT--incorrect")};this.removeInCorrect=function(){this.getComponent()&&this.getComponent().classList.remove("CTAT--incorrect")};this.resetTutoring=
function(){this.showHintHighlight(!1);this.removeCorrect();this.removeInCorrect();v=CTAT.Component.Base.Tutorable.Options.Status.NOTGRADED};this.grade=function(){this.updateSAI();this.processAction(!0)};this.processAction=function(a,c){this.ctatdebug("processAction("+a+","+c+")");p.unHighlightAll();var b=CTATShellTools.findComponentByClass("CTATDoneButton");b&&b instanceof CTAT.Component.Base.Tutorable&&b!=this&&b.setNotGraded();this.ctatdebug("processAction() finished checking doneButton");ctatdebug("Clearing hint window ...");
CTATCommShell.commShell&&CTATCommShell.commShell.clearFeedbackComponents();a=void 0===a||null===a?!1:a;c=void 0===c||null===c?!1:c;""!==this.getComponentGroup()?CTATShellTools.findComponent(this.getComponentGroup()).forEach(function(a){a.setNotGraded&&a.setNotGraded()}):this.setNotGraded();this.ctatdebug("processAction() finished setNotGraded");CTATCommShell.commShell&&(a?CTATCommShell.commShell.processComponentAction(this.getSAI(),!0,!0):c?CTATCommShell.commShell.processComponentAction(this.getSAI(),
!1,!0):CTATCommShell.commShell.processComponentAction(this.getSAI(),h,m));this.ctatdebug("processAction() finished call to commShell.processComponentAction");this.component&&(b=new CustomEvent(CTAT.Component.Base.Tutorable.EventType.action,{detail:{sai:this.getSAI(),component:this},bubbles:!0,cancelable:!0}),this.component.dispatchEvent(b))};this.addEventScreen=function(a){var c=document.createElement("div");c.style.position="absolute";c.style.top="0";c.style.left="0";c.style.bottom="0";c.style.right=
"0";a&&c.addEventListener("dblclick",function(){setTimeout(function(){var a=p.getDivWrap().getAttribute("data-ctat-enabled");p.setEnabled(!0);var c=p.getComponent();c.hasEditListeners||(c.addEventListener("blur",function(){p.setEnabled(!1);p.getDivWrap().setAttribute("data-ctat-enabled",a);p.getDivWrap().setAttribute("value",c.value)}),"CTATTextArea"===p.getClassName()&&c.addEventListener("keydown",function(a){13==(a.keyCode||a.charCode)&&(a.preventDefault(),this.value+="\n")}),c.hasEditListeners=
!0);c.focus()},410)});this.getDivWrap().appendChild(c)}};CTAT.Component.Base.Tutorable.Options={TutorComponent:{TUTOR:"Tutor",TUTOR_NO_FEEDBACK:"Tutor but no visual feedback",DO_NOT_TUTOR:"Do not tutor"},Status:{CORRECT:"CORRECT",INCORRECT:"INCORRECT",NOTGRADED:"NOTGRADED"}};CTAT.Component.Base.Tutorable.EventType={correct:"CTAT_CORRECT",incorrect:"CTAT_INCORRECT",highlight:"CTAT_HIGHLIGHT",ungrade:"CTAT_NOTGRADED",action:"CTAT_ACTION"};CTAT.Component.Base.Tutorable.prototype=Object.create(CTAT.Component.Base.SAIHandler.prototype);
CTAT.Component.Base.Tutorable.prototype.constructor=CTAT.Component.Base.Tutorable;CTAT.Component.Base.Clickable=function(a,b,d,e,g,c,f){CTAT.Component.Base.Tutorable.call(this,a,b,d,e,g,c,f);var h=this;this.processClick=function(a){h.ctatdebug("processClick ("+a.currentTarget.getAttribute("id")+" -> "+a.eventPhase+")");!0===h.getEnabled()?h.processAction():h.ctatdebug("Component is disabled, not grading")};this.setClickable=function(a){h.setEnabled(a)}};CTAT.Component.Base.Clickable.prototype=Object.create(CTAT.Component.Base.Tutorable.prototype);
CTAT.Component.Base.Clickable.prototype.constructor=CTAT.Component.Base.Clickable;var CTATButtonBasedComponent=function(a,b,d,e,g,c,f){CTAT.Component.Base.Clickable.call(this,a,b,d,e,g,c,f);var h=this,m="",l="black";this.setActionInput("ButtonPressed","-1");this.setImage=function(a){h.ctatdebug("assignImage ("+a+")");h.getDivWrap().setAttribute("data-ctat-img",a);a&&(a="url('"+a+"')");$(h.getComponent()).css("background-image",a);$(h.getComponent()).css("background-size","cover")};this.assignImage=function(a){h.ctatdebug("assignImage ()");h.assignImages(a,a,a,a)};this.assignImageURL=
function(a){h.ctatdebug("assignImageURL ()");h.assignImages(a,a,a,a)};this.assignImages=function(a,c,b,d){h.ctatdebug("assignImages ()");h.getDivWrap().setAttribute("data-ctat-image-hover",a);h.getDivWrap().setAttribute("data-ctat-image-clicked",c);h.getDivWrap().setAttribute("data-ctat-image-default",b);h.getDivWrap().setAttribute("data-ctat-image-disabled",d);this.setImage(b)};this.processBaseMousedown=function(){h.ctatdebug("processMousedown ()");h.component.classList.add("CTAT-button--clicked");
var a=h.getDivWrap().getAttribute("data-ctat-image-clicked");h.getEnabled()&&a&&void 0!==a&&""!==a&&null!==a&&(h.getComponent().style.backgroundImage="url('"+a+"')")};this.processBaseMouseup=function(){h.ctatdebug("processMouseup ()");h.component.classList.remove("CTAT-button--clicked");var a=h.getDivWrap().getAttribute("data-ctat-image-default");h.getEnabled()&&a&&void 0!==a&&""!==a&&null!==a&&(h.getComponent().style.backgroundImage="url('"+a+"')")};this.processBaseMouseover=function(){h.ctatdebug("processBaseMouseover ()");
h.component.classList.add("CTAT-button--hover");var a=h.getDivWrap().getAttribute("data-ctat-image-hover");h.getEnabled()&&a&&void 0!==a&&""!==a&&(h.getComponent().style.backgroundImage="url('"+a+"')")};this.processBaseMouseout=function(){h.ctatdebug("processBaseMouseout ()");h.component.classList.remove("CTAT-button--hover");h.component.classList.remove("CTAT-button--clicked");var a=h.getDivWrap().getAttribute("data-ctat-image-default");h.getEnabled()&&a&&void 0!==a&&""!==a&&(h.getComponent().style.backgroundImage=
"url('"+a+"')")};this.setText=function(a){h.ctatdebug("setText ("+a+")");m=a;null!==h.getComponent()&&(h.getComponent().innerHTML=m)};this.setFontColor=function(a){l=a;$(h.getComponent()).css("color",a)};this.getFontColor=function(){return l};this.setStyleHandler("labelText",this.setText);this.getText=function(){return m};this.processClick=function(a){h.ctatdebug("processClick ("+a.currentTarget.getAttribute("id")+" -> "+a.eventPhase+")");!0===h.getEnabled()?(null!==CTATGlobals.Tab.Focus&&("CTATTextArea"==
CTATGlobals.Tab.Focus.getClassName()||"CTATTextInput"==CTATGlobals.Tab.Focus.getClassName()||"CTATTextField"==CTATGlobals.Tab.Focus.getClassName()?CTATGlobals.Tab.Focus.processAction():h.ctatdebug("Info: CTATGlobals.Tab.Focus==null")),a=$(h.getDivWrap()).attr("value"),h.setInput(a?a:"-1"),h.processAction()):h.ctatdebug("Component is disabled, not grading")};this.ButtonPressed=function(){}};CTATButtonBasedComponent.prototype=Object.create(CTAT.Component.Base.Clickable.prototype);
CTATButtonBasedComponent.prototype.constructor=CTATButtonBasedComponent;CTAT.ComponentRegistry={};CTAT.ComponentRegistry.addComponentType=function(){};Object.defineProperty(CTAT.ComponentRegistry,"addComponentType",{enumerable:!1,value:function(a,b){"string"==typeof a&&(this.hasOwnProperty(a)?alert(a+" is already a registered component"):this[a]=b)}});var CTATAudioButton=function(a,b,d,e,g){CTATButtonBasedComponent.call(this,"CTATAudioButton","audiobutton",a,b,d,e,g);var c=this;c.setActionInput("play","-1");var f=null,h="",m=CTATConfiguration.get("previewMode");this.setSource=function(a){this.getDivWrap().setAttribute("data-ctat-src",a);return this};this.getSource=function(){return this.getDivWrap().getAttribute("data-ctat-src")};this.setParameterHandler("SoundFile",this.setSource);this.init=function(){var a=document.createElement("button");a.value=
"-1";a.name=c.getName();a.setAttribute("id",CTATGlobalFunctions.gensym.div_id());a.setAttribute("onkeypress","return noenter(event)");a.classList.add("CTAT-button");if(this.getDivWrap().getAttribute("data-ctat-label"))a.textContent=this.getDivWrap().getAttribute("data-ctat-label");else if(c.getText())a.textContent=c.getText();else if(c.getDivWrap()&&c.getDivWrap().innerHTML&&!m){var b=c.getDivWrap().innerHTML;c.getDivWrap().innerHTML="";a.innerHTML=b}c.setInitialized(!0);c.setComponent(a);c.addComponentReference(c,
a);c.getDivWrap().appendChild(a);c.ctatdebug("Final location: "+c.getX()+","+c.getY()+" with text: "+c.getText());m||(a.addEventListener("click",c.processClick),a.addEventListener("focus",c.processFocus));f=document.createElement("audio");f.addEventListener("canplay",function(){c.ctatdebug("Audio loaded and ready for play");""!==h&&(c.logAudioEvent(h),h="")},!0);f.onended=function(){c.ctatdebug("Audio ended");c.logAudioEvent("end")};this.getDivWrap().appendChild(f)};this.getConfigurationActions=function(){var a=
[],c;0<this.component.innerHTML.trim().length&&(c=new CTATSAI,c.setSelection(this.getName()),c.setInput(this.component.innerHTML.toString()),c.setAction("setText"),a.push(c));0<this.getSource().trim().length&&(c=new CTATSAI,c.setSelection(this.getName()),c.setInput(this.getSource()),c.setAction("setSource"),a.push(c));return a};this.reset=function(){c.configFromDescription();c.processSerialization();c.setEnabled(!0);h="reset"};this.logAudioEvent=function(a){c.ctatdebug("logAudioEvent ("+a+")");if(void 0!==
f.duration)if(null!==CTATCommShell.commShell){a=new CTATSAI(c.getName(),a,c.toHHMMSS(f.currentTime)+".000","");a.addSelection(encodeURIComponent(f.currentSrc),"media_file");a.addSelection(c.toHHMMSS(f.duration)+".000","clip_length");var b=a.getInputObject();null!==b&&b.setType("time");CTATCommShell.commShell.processComponentAction(a,!1,!0,c,"AUDIO_ACTION","USER")}else c.ctatdebug("Error: commShell is null, can't send untutored tool message");else c.ctatdebug("Error: audio file not loaded yet, can't obtain duration")};
this.processClick=function(a){c.ctatdebug("processClick ("+a.currentTarget.getAttribute("id")+" -> "+a.eventPhase+")");!0===c.getEnabled()?(a=this.getSource(),c.ctatdebug("Playing audio file: "+a),f.setAttribute("src",a),f.play(),h="play",c.processAction()):c.ctatdebug("Component is disabled, not grading")}.bind(this);this.play=function(){c.ctatdebug("play");var a=this.getSource();f.setAttribute("src",a);f.load();f.play();h="play"};this.playClip=function(a){c.ctatdebug("playClip");f.setAttribute("src",
a);f.load();f.play();h="play"};this.pause=function(){c.ctatdebug("pause");f.pause();h="pause"}};CTATAudioButton.prototype=Object.create(CTATButtonBasedComponent.prototype);CTATAudioButton.prototype.constructor=CTATAudioButton;CTAT.ComponentRegistry.addComponentType("CTATAudioButton",CTATAudioButton);var CTATButton=function(a,b,d,e,g){CTATButtonBasedComponent.call(this,"CTATButton","aButton",a,b,d,e,g);var c=this,f=null,h=CTATConfiguration.get("previewMode");this.init=function(){c.ctatdebug("init ("+c.getName()+")");c.setActionInput("ButtonPressed","-1");f=document.createElement("button");f.type="button";f.name=c.getName();f.value=$(this.getDivWrap()).attr("value")||"-1";this.setInput(f.value);f.id=CTATGlobalFunctions.gensym.div_id();f.setAttribute("onkeypress","return noenter(event)");f.classList.add("CTAT-button");
c.setInitialized(!0);if(c.getDivWrap().getAttribute("data-ctat-label"))f.innerHTML=c.getDivWrap().getAttribute("data-ctat-label");else if(c.getText())f.innerHTML=c.getText();else if(c.getDivWrap()&&c.getDivWrap().innerHTML&&!h){var a=c.getDivWrap().innerHTML;c.getDivWrap().innerHTML="";f.innerHTML=a}c.setComponent(f);c.addComponentReference(c,f);c.getDivWrap().appendChild(f);f.addEventListener("click",c.processClick);f.addEventListener("focus",c.processFocus);f.addEventListener("mousedown",this.processBaseMousedown);
f.addEventListener("mouseup",this.processBaseMouseup);f.addEventListener("mouseover",c.processBaseMouseover);f.addEventListener("mouseout",c.processBaseMouseout)}.bind(this);this.render=function(){};this.getConfigurationActions=function(){var a=[],c;0<f.innerHTML.trim().length&&(c=new CTATSAI,c.setSelection(this.getName()),c.setInput(f.innerHTML.toString()),c.setAction("setText"),a.push(c));return a};this.reset=function(){c.configFromDescription();c.processSerialization();c.setEnabled(!0)}};
CTATButton.prototype=Object.create(CTATButtonBasedComponent.prototype);CTATButton.prototype.constructor=CTATButton;CTAT.ComponentRegistry.addComponentType("CTATButton",CTATButton);var CTATCheckBox=function(a,b,d,e,g){CTAT.Component.Base.Clickable.call(this,"CTATCheckBox","__undefined__",a,b,d,e,g);var c=null,f=null,h=CTATConfiguration.get("previewMode");this.setStyleHandler("inspBackgroundColor",null);this.setStyleHandler("BackgroundColor",null);this.setStyleHandler("DrawBorder",null);this.setStyleHandler("showBorder",null);this.setStyleHandler("BorderColor",null);this.setStyleHandler("TextAlign",null);var m=this;this.setSelection(this.getComponentGroup());this.setAction("UpdateCheckBox");
this.getCheckBox=function(){return c};this.setStyleHandler("labelPlacement",null);var l=function(a){this.updateSAI();this.processClick(a)};this.init=function(){m.setInitialized(!0);c=document.createElement("input");c.type="checkbox";c.setAttribute("id",this.getName()+"_check");c.classList.add("CTATCheckBox--button");this.getText()?c.value=m.getText():this.getDivWrap()&&this.getDivWrap().textContent?c.value=this.getDivWrap().textContent:c.value=c.id;this.getComponentGroup()?c.name=m.getComponentGroup():
this.getDivWrap()&&$(this.getDivWrap()).attr("name")?c.name=$(this.getDivWrap()).attr("name"):c.name="checkBoxGroup";!0===m.getEnabled()?c.disabled=!1:c.disabled=!0;m.ctatdebug("Final location: "+m.getX()+","+m.getY()+" with text: "+m.getText());m.addComponentReference(m,c);if(!h){var a=this.getDivWrap().innerHTML;this.getDivWrap().innerHTML=""}$(m.getDivWrap()).append(c);f=document.createElement("label");f.htmlFor=c.id;f.classList.add("CTATCheckBox--label");this.getText()?f.textContent=this.getText():
a&&!h?f.innerHTML=a:this.getDivWrap().getAttribute("data-ctat-label")&&this.setText(this.getDivWrap().getAttribute("data-ctat-label"));$(this.getDivWrap()).append(f);m.setComponent(c);c.addEventListener("click",l.bind(this));c.addEventListener("focus",m.processFocus);c.onfocus=this.processOnFocus;this.setSelection(this.getComponentGroup())};this.resize=function(){var a=$(this.getDivWrap()).height();$(f).css("font-size",a-5+"px");$(this.getComponent()).css("height",a-10+"px");$(this.getComponent()).css("width",
a-10+"px")};this.getConfigurationActions=function(){var a=[],c;0<f.innerHTML.trim().length&&(c=new CTATSAI,c.setSelection(this.getName()),c.setInput(f.innerHTML.toString()),c.setAction("setText"),a.push(c));return a};var n=this.setText;this.setText=function(a){m.ctatdebug("setText ("+a+")");n(a);c&&(c.value=a,f.innerHTML=a)};this.setStyleHandler("labelText",this.setText);var p=this.setEnabled;this.setEnabled=function(a){p(a);c&&(c.disabled=!this.getEnabled())};this.getCheckBoxInput=function(){return f.innerHTML+
": "+c.checked};this.reset=function(){c.checked=!1;m.setEnabled(!0)};this.UpdateCheckBox=function(a){var b=new RegExp("(^|;)"+CTATCheckBox.escape(c.value)+"\\s*:\\s*true");c.checked=0<=a.search(b)};this.SetSelected=function(a){a=CTATGlobalFunctions.toBoolean(a);c.checked=a};this.updateSAI=function(){var a=$('div[data-ctat-component]:has(input[type="checkbox"][name="'+c.name+'"])').sort(function(a,c){var b=a.id,d=c.id;return b>d?1:b<d?-1:0}),a=$.map(a,function(a){a=$(a).data("CTATComponent").getCheckBox();
return a.value+": "+a.checked});this.setSelection(c.name);this.setAction("UpdateCheckBox");this.setInput(a.join(";"))};var x=function(a){f.classList.add(a);c.classList.add(a)},q=function(a){f.classList.remove(a);c.classList.remove(a)};this.showCorrect=function(a){q("CTAT--incorrect");q("CTAT--hint");x("CTAT--correct")};this.removeCorrect=q.bind(this,"CTAT--correct");this.showInCorrect=function(a){q("CTAT--correct");q("CTAT--hint");x("CTAT--incorrect")};this.removeInCorrect=q.bind(this,"CTAT--incorrect");
this.showHintHighlight=function(a){q("CTAT--incorrect");q("CTAT--correct");a?x("CTAT--hint"):q("CTAT--hint")}};CTATCheckBox.prototype=Object.create(CTAT.Component.Base.Clickable.prototype);CTATCheckBox.prototype.constructor=CTATCheckBox;CTATCheckBox.escape=function(a){return a.replace(/[-[\]{}()*+?.,\\^$|#\s\/]/g,"\\$&")};CTAT.ComponentRegistry.addComponentType("CTATCheckBox",CTATCheckBox);var CTATComboBox=function(a,b,d,e,g){CTAT.Component.Base.Clickable.call(this,"CTATComboBox","__undefined__",a,b,d,e,g);var c=this,f=null;this.component=null;var h="",m=CTATConfiguration.get("previewMode");this.setAction("UpdateComboBox");var l=",";a=function(a){l=a;f&&(f.innerHTML="",this.addLabels(n,l))}.bind(this);this.setStyleHandler("SplitCharacter",a);this.data_ctat_handlers["split-on"]=a;var n=null;this.setLabels=function(a){n=a;f&&(f.innerHTML="",this.addLabels(n,l))}.bind(this);this.setStyleHandler("Labels",
this.setLabels);this.data_ctat_handlers.labels=this.setLabels;var p=null;a=function(a){a=parseInt(a);p=isNaN(a)?null:a;f&&f.setAttribute("size",p)};this.setStyleHandler("DropDownSize",a);this.data_ctat_handlers.size=a;this.setStyleHandler("DropDownWidth",null);this.setNumOptions=a;this.setGradeOnNextClick=function(a){c.ctatdebug("CTATComboBox["+c.getName()+"].setGradeOnNextClick("+a+")");h=a};this.getGradeOnNextClick=function(){c.ctatdebug("CTATComboBox["+c.getName()+"].getGradeOnNextClick() to return "+
h);return h};this.processAssociatedRules=function(a,b,d){a=a.getProperty("OutOfOrder");c.ctatdebug("CB["+c.getName()+"] processAssociatedRules indicator "+b+", outOfOrder "+a+", tutorAdvice '"+d+"'");b&&"incorrect"==b.toString().toLowerCase()&&(a||d&&d.toString().toLowerCase().includes(" the step you "))&&c.setGradeOnNextClick("at "+(new Date).toString()+": sai "+c.getSAI().toString())};this.init=function(){c.setInitialized(!0);f=document.createElement("select");f.name=c.getName();f.setAttribute("id",
CTATGlobalFunctions.gensym.div_id());f.setAttribute("onkeypress","return noenter(event)");f.onchange=this.processComboSelection;f.addEventListener("click",function(a){c.ctatdebug("CB["+c.getName()+"].onclick() "+a+", gradeOnNextClickInfo "+c.getGradeOnNextClick());c.getGradeOnNextClick()&&c.processComboSelection()});f.classList.add("CTAT-combobox");p&&!m&&f.setAttribute("size",p);if(!m){var a=this.getDivWrap().innerHTML;this.getDivWrap().innerHTML="";a.trim()&&(f.innerHTML=a)}n&&this.addLabels(n,
l);!0===c.getEnabled()?f.disabled=!1:f.disabled=!0;c.addComponentReference(c,f);c.setComponent(f);c.getDivWrap().appendChild(f);this.component=f;f.addEventListener("focus",c.processFocus)};this.getConfigurationActions=function(){var a=[];if(n){var c=new CTATSAI;c.setSelection(this.getName());c.setInput(n);c.setAction("setLabels");a.push(c)}return a};this.getHTMLComponent=function(){return f};this.addLabels=function(a,c){for(var b=a.split(c?c:l),d=0;d<b.length;d++)this.addItem(b[d])};this.addBlank=
function(a){for(var c=0;c<a;c++)this.addItem("")};this.addItem=function(a){c.ctatdebug("addItem ("+a+")");var b=document.createElement("option");b.setAttribute("value",a);b.textContent=a;f.appendChild(b)};this.setFontSize=function(a){isNaN(a)||($(this.getComponent()).css("font-size",a+"px"),this.getDivWrap().setAttribute("data-ctat-font-size",a))};this.valid_selection=function(){return 0<=f.selectedIndex&&!CTATGlobalFunctions.isBlank(f.value)};this.processComboSelection=function(){c.ctatdebug("processComboSelection ()");
c.setGradeOnNextClick("");c.setInput(f.options[f.selectedIndex].value);c.valid_selection()?c.processAction():this.ctatdebug("Empty component, nothing to grade")};this.UpdateComboBox=function(a){f.value=a};this.updateSAI=function(){c.setInput(f.value)}};CTATComboBox.prototype=Object.create(CTAT.Component.Base.Clickable.prototype);CTATComboBox.prototype.constructor=CTATComboBox;CTAT.ComponentRegistry.addComponentType("CTATComboBox",CTATComboBox);var CTATDoneButton=function(a,b,d,e,g){CTAT.Component.Base.Clickable.call(this,"done","CTATDoneButton",a,b,d,e,g);this.setName("done");this.setClassName("CTATDoneButton");this.setText(CTATGlobals.languageManager.getString("DONE"));this.setStyleHandler("BackgroundColor",null);this.setStyleHandler("TextAlign",null);var c=this;this.init=function(){this.setInitialized(!0);var a=document.createElement("button");a.classList.add("unselectable");a.classList.add("CTAT-done-button");this.setComponent(a);var c=
document.createElement("div");c.classList.add("CTAT-done-button--content");a.appendChild(c);var b=document.createElement("div");b.textContent="\u2714";b.classList.add("CTAT-done-button--icon");c.appendChild(b);this.getText()&&(b=document.createElement("div"),b.classList.add("CTAT-done-button--text"),b.textContent=this.getText(),c.appendChild(b));this.getDivWrap().appendChild(a);a.addEventListener("mouseenter",function(a){a.target.classList.add("CTAT-done-button--hover")});a.addEventListener("mouseleave",
function(a){a.target.classList.remove("CTAT-done-button--hover");a.target.classList.remove("CTAT-done-button--clicked")});a.addEventListener("mousedown",function(a){a.target.classList.add("CTAT-done-button--clicked")});a.addEventListener("mouseup",function(a){a.target.classList.remove("CTAT-done-button--clicked")});a.addEventListener("click",function(a){a.target.classList.remove("CTAT-done-button--clicked")});a.addEventListener("click",this.processClick);a.addEventListener("focus",this.processFocus)};
this.processClick=function(a){c.getEnabled()&&CTATCommShell.commShell&&CTATCommShell.commShell.processDone(c.getCompletionStatus())};this.getCompletionStatus=function(){return this.getDivWrap()?this.getDivWrap().getAttribute("data-ctat-completion-status"):""};this.setCompletionStatus=function(a){this.getDivWrap()&&this.getDivWrap().setAttribute("data-ctat-completion-status",String(a));return this}};CTATDoneButton.prototype=Object.create(CTAT.Component.Base.Clickable.prototype);
CTATDoneButton.prototype.constructor=CTATDoneButton;CTAT.ComponentRegistry.addComponentType("CTATDoneButton",CTATDoneButton);var CTATDragNDrop=function(){CTAT.Component.Base.Tutorable.call(this,"CTATDragNDrop","aDnD");this.setParameterHandler("groupname",function(a){this.getDivWrap()&&$(this.getDivWrap()).attr("name",a)});this.set_child_limit=function(a){a=parseInt(a);isNaN(a)||$(this.component).attr("data-ctat-max-cardinality",a)};this.setParameterHandler("MaxObjects",this.set_child_limit);this.get_child_limit=function(){var a=parseInt($(this.component).attr("data-ctat-max-cardinality"));return isNaN(a)?-1:a};var a=function(a){return a.split("").reduce(function(a,
c){a=(a<<5)-a+c.charCodeAt(0);return a&a},0)},b=function(c){var b=$(this).parent().attr("name"),d=$(this).parent().attr("id");c.dataTransfer.setData("ctat/group",b);c.dataTransfer.setData("ctat/source",d);c.dataTransfer.setData("text",this.id);var f=a(this.id);CTATDragNDrop.dragging[f]={id:this.id,group:b,source:d};c.dataTransfer.setData("ctat/id/"+f,f)},d=function(a){for(var c,b=0;b<a.dataTransfer.types.length;b++)if(c=/^ctat\/id\/(.+)$/.exec(a.dataTransfer.types[b]))c=c[1],CTATDragNDrop.dragging.hasOwnProperty(c)&&
delete CTATDragNDrop.dragging[c]},e=null;this.init=function(){e=this.getDivWrap();if(!$(e).attr("name")){var a=CTATDragNDrop.default_groupname;this.getComponentGroup()&&(a=this.getComponentGroup());$(e).attr("name",a)}this.setComponent(e);CTATComponentReference.add(this,e);CTATConfiguration.get("previewMode")||$(e).children().addClass("CTATDragNDrop--item").attr({unselectable:"on",draggable:!0}).each(function(){this.id||(this.id=CTATGlobalFunctions.gensym.div_id());this.addEventListener("dragstart",
b,!1);this.addEventListener("dragend",d,!1)});this.component.addEventListener("dragover",function(a){var c=!1;if($(this).data("CTATComponent").getEnabled()){var b=parseInt($(this).attr("data-ctat-max-cardinality"));if((isNaN(b)||0>b||$(this).children().length<b)&&(new Set(a.dataTransfer.types)).has("ctat/group"))if(a.dataTransfer.getData("text"))a.dataTransfer.getData("ctat/group")===$(this).attr("name")&&a.dataTransfer.getData("ctat/source")!==this.id&&(c=!0);else for(var d,b=0;b<a.dataTransfer.types.length;b++)if(d=
/^ctat\/id\/(.+)$/.exec(a.dataTransfer.types[b]))d=d[1],CTATDragNDrop.dragging.hasOwnProperty(d)&&CTATDragNDrop.dragging[d].group===$(this).attr("name")&&CTATDragNDrop.dragging[d].source!==this.id&&(c=!0)}c&&(a.preventDefault(),a.dataTransfer.effectAllowed="move",a.dataTransfer.dropEffect="move",this.classList.add("CTATDragNDrop--valid-drop"))},!1);this.component.addEventListener("drop",function(a){a.preventDefault();this.classList.remove("CTATDragNDrop--valid-drop");var c=$(this).data("CTATComponent");
if(c.getEnabled()){var b=a.dataTransfer.getData("text");a.dataTransfer.getData("ctat/source");a=document.getElementById(b);this.appendChild(a);$("#"+b).removeClass("CTAT--correct CTAT--incorrect CTAT--hint");c.setActionInput("Add",b);c.processAction()}},!1);this.component.addEventListener("dragleave",function(a){this.classList.remove("CTATDragNDrop--valid-drop")},!1);this.setInitialized(!0)};this.getConfigurationActions=function(){var a=[],c=[];$(this.component).children().each(function(){c.push($(this).attr("id"))});
if(0<c.length){var b=new CTATSAI;b.setSelection(this.getName());b.setAction("SetChildren");b.setInput(c.sort().join(";"));a.push(b)}return a};var g=this.setEnabled;this.setEnabled=function(a){g(a);e&&($(e).children().attr("draggable",a),this.getDisableOnCorrect()&&$(e).find(".CTAT--correct").attr("draggable",!1))};this.Add=function(a){a=$("#"+a);0<a.length&&a.appendTo(this.getDivWrap());$(a).hasClass("CTATDragNDrop--item")||($(a).addClass("CTATDragNDrop--item").attr({unselectable:"on",draggable:!0}),
a.addEventListener("dragstart",b,!1),a.addEventListener("dragend",d,!1))};this.SetChildren=function(a){a.split(";").forEach(function(a){this.Add(a)},this)};this.updateSAI=function(){var a=[];$(this.component).children().each(function(){a.push($(this).attr("id"))});this.setActionInput("SetChildren",a.sort().join(";"))};var c=this.showCorrect.bind(this);this.showCorrect=function(a){switch(a.getAction()){case "Add":this.setEnabled(!0);a=a.getInput();$("#"+a).addClass("CTAT--correct");this.getDisableOnCorrect()&&
$("#"+a).attr("draggable",!1);break;default:c(a)}};var f=this.showInCorrect.bind(this);this.showInCorrect=function(a){switch(a.getAction()){case "Add":a=a.getInput();$("#"+a).addClass("CTAT--incorrect");break;default:f(a)}}};CTATDragNDrop.dragging={};CTATDragNDrop.default_groupname="DragNDropGroup";CTATDragNDrop.prototype=Object.create(CTAT.Component.Base.Tutorable.prototype);CTATDragNDrop.prototype.constructor=CTATDragNDrop;CTAT.ComponentRegistry.addComponentType("CTATDragNDrop",CTATDragNDrop);CTAT.Math={LeastCommonMultiple:function(a,b){return a*b/CTAT.Math.GreatestCommonDivisor(a,b)},GreatestCommonDivisor:function(a,b){if(0>a||0>b)return CTAT.Math.GreatestCommonDivisor(Math.abs(a),Math.abs(b));if(1===a||1===b)return 1;if(0===a)return b;if(0===b)return a;var d=function(a,b){return b?d(b,a%b):a};return d(a,b)},round10:function(a,b){if("undefined"===typeof b||0===Number(b))return Math.round(a);a=Number(a);b=Number(b);if(isNaN(a)||"number"!==typeof b||0!==b%1)return NaN;a=a.toString().split("e");
a=Math.round(Number(a[0])+"e"+(a[1]?Number(a[1])-b:-b));a=a.toString().split("e");return Number(a[0]+"e"+(a[1]?Number(a[1])+b:b))},precision:4,round:function(a){return CTAT.Math.round10(a,-CTAT.Math.precision)},rad2deg:function(a){return CTAT.Math.round(180*a/Math.PI)},deg2rad:function(a){return a*Math.PI/180}};CTAT.Math.Fraction=function(a,b){this._numerator=0;this._denominator=1;this.set(a,b)};
CTAT.Math.Fraction.prototype=Object.create(CTAT.Math.Fraction.prototype,{numerator:{get:function(){return this._numerator},set:function(a){this._numerator=a}},denominator:{get:function(){return this._denominator},set:function(a){this._denominator=a}},toString:{value:function(){return 1===this.denominator?String(this._numerator):String(this._numerator)+"/"+String(this._denominator)}},valueOf:{value:function(){return this.numerator/this.denominator}},fromString:{value:function(a){var b=a.match(/(\d*\.?\d*)\s*\/\s*(\d*\.?\d*)/);
b?(this._numerator=Number(b[1]),this._denominator=Number(b[2])):this.fromValue(a)}},fromValue:{value:function(a){this._numerator=Number(a.valueOf());this._denominator=1}},toMathML:{value:function(){var a=document.createElementNS("http://www.w3.org/1998/Math/MathML","math"),b=document.createElementNS("http://www.w3.org/1998/Math/MathML","mn");b.textContent=this.numerator;if(1==this.denominator)a.appendChild(b);else{var d=document.createElementNS("http://www.w3.org/1998/Math/MathML","mfrac"),e=document.createElementNS("http://www.w3.org/1998/Math/MathML",
"mrow");e.appendChild(b);d.appendChild(e);b=document.createElementNS("http://www.w3.org/1998/Math/MathML","mrow");e=document.createElementNS("http://www.w3.org/1998/Math/MathML","mn");e.textContent=this.denominator;b.appendChild(e);d.appendChild(b);a.appendChild(d)}return a}},is_proper:{get:function(){return Math.abs(this._numerator)<Math.abs(this._denominator)}},whole_part:{get:function(){return Math.floor(this.valueOf())}},remainder_part:{get:function(){return new CTAT.Math.Fraction(this._numerator%
this._denominator,this._denominator)}},set_denominator:{value:function(a){this._numerator=this.numerator*a/this.denominator;1E-9>Math.abs(this.numerator-Math.round(this.numerator))&&(this.numerator=Math.round(this.numerator));this._denominator=a;return this}},scale:{value:function(a){this._numerator*=a;this._denominator=0===a?1:Math.abs(this._denominator*a)}},set:{value:function(a,b){this._numerator=0;this._denominator=1;"undefined"!==typeof a&&b?(this.numerator="number"===typeof a?a:"string"===typeof a?
Number(a):a?a.valueOf():0,this.denominator="number"===typeof b?b:"string"===typeof b?Number(b):b.valueOf()):a&&(a instanceof CTAT.Math.Fraction?(this.numerator=a.numerator,this.denominator=a.denominator):"number"===typeof a?(this.numerator=a,this.denominator=1):"string"===typeof a?this.fromString(a):(this.numerator=a?a.valueOf():0,this.denominator=1));isNaN(this._numerator)&&(this._numerator=0);isNaN(this._denominator)&&(this._denominator=1);return this}},reduce:{value:function(){var a=CTAT.Math.GreatestCommonDivisor(this.numerator,
this.denominator);this._numerator/=a;this._denominator/=a;return this}},reduced:{value:function(){var a=new CTAT.Math.Fraction(this);a.reduce();return a}},reciprocal:{value:function(){return new CTAT.Math.Fraction(this.denominator,this.numerator)}},negative:{value:function(){return new CTAT.Math.Fraction(-this.numerator,this.denominator)}},add:{value:function(a){var b=new CTAT.Math.Fraction;a instanceof CTAT.Math.Fraction?0===this.numerator||isNaN(this.numerator)?b.set(a.numerator,a.denominator):
0===a.numerator||isNaN(a.numerator)?b.set(this.numerator,this.denominator):this.denominator==a.denominator?b.set(this.numerator+a.numerator,this.denominator):(b.set(this.numerator*a.denominator+a.numerator*this.denominator,this.denominator*a.denominator),b.reduce()):"string"===typeof a?(a=new CTAT.Math.Fraction(a),b=this.add(a)):b.set(a.valueOf()*this.denominator+this.numerator,this.denominator);return b}},subtract:{value:function(a){return a instanceof CTAT.Math.Fraction?this.add(a.negative()):"string"===
typeof a?(a=new CTAT.Math.Fraction(a),this.add(a.negative())):this.add(-a.valueOf())}},multiply:{value:function(a){a instanceof CTAT.Math.Fraction?(a=new CTAT.Math.Fraction(this.numerator*a.numerator,this.denominator*a.denominator),a.reduce()):"string"===typeof a?(a=new CTAT.Math.Fraction(a),a=this.multiply(a)):(a=new CTAT.Math.Fraction(a.valueOf()*this.numerator,this.denominator),a.reduce());return a}},divide:{value:function(a){return a instanceof CTAT.Math.Fraction?this.multiply(a.reciprocal()):
"string"===typeof a?(a=new CTAT.Math.Fraction(a),this.multiply(a.reciprocal())):this.multiply(new CTAT.Math.Fraction(1,a.valueOf()))}},equals:{value:function(a){return CTAT.Math.round(this.valueOf())===CTAT.Math.round(a.valueOf())}},deepEquals:{value:function(a){return a instanceof CTAT.Math.Fraction&&this.numerator===a.numerator&&this.denominator===a.denominator}},clone:{value:function(){return new CTAT.Math.Fraction(this.numerator,this.denominator)}}});
CTAT.Math.Fraction.FromString=function(a){var b=new CTAT.Math.Fraction;b.setFromString(String(a));return b};CTAT.Math.Fraction.FromNumber=function(a){a=new CTAT.Math.Fraction(a);a.reduce();return a};CTAT.Math.Fraction.Sum=function(){for(var a=new CTAT.Math.Fraction,b=0;b<arguments.length;b++)a=a.add(arguments[b]);return a};CTAT.Math.Fraction.Product=function(){for(var a=new CTAT.Math.Fraction(1,1),b=0;b<arguments.length;b++)a=a.multiply(arguments[b]);return a};CTAT.Component.Base.SVG=function(a,b,d,e,g,c,f){CTAT.Component.Base.Clickable.call(this,a,b,d,e,g,c,f);var h=null;this.initSVG=function(){this.setInitialized(!0);var a=CTATGlobals.NameSpace.svg,c=CTATGlobals.NameSpace.xml,b=CTATGlobals.NameSpace.xlink,d=CTATGlobals.NameSpace.ev,f=document.createDocumentFragment();h=document.createElementNS(a,"svg");f.appendChild(h);h.classList.add("CTAT-gen-component");h.classList.add("CTAT-svg");h.classList.add("unselectable");h.setAttributeNS(c,"xmlns",a);h.setAttributeNS(c,
"xmlns:xlink",b);h.setAttributeNS(c,"xmlns:ev",d);a=document.createElementNS(a,"defs");h.appendChild(a);this.getDivWrap().appendChild(f);this.setComponent(h)};this.genName=function(a){return this.getName()+"_"+a};this.getBoundingBox=function(){var a=new DOMRect(0,0,this.getWidth(),this.getHeight()),c=this.getComponent(),b=window.getComputedStyle(c),c=parseInt(b.getPropertyValue("padding-left")),d=parseInt(b.getPropertyValue("padding-right")),f=parseInt(b.getPropertyValue("padding-bottom")),e=parseInt(b.getPropertyValue("padding-right")),
g=parseInt(b.getPropertyValue("border-left-width")),h=parseInt(b.getPropertyValue("border-right-width")),A=parseInt(b.getPropertyValue("border-bottom-width")),b=parseInt(b.getPropertyValue("border-right-width"));a.width-=c+e+g+b;a.height-=d+f+h+A;return a}};CTAT.Component.Base.SVG.prototype=Object.create(CTAT.Component.Base.Clickable.prototype);CTAT.Component.Base.SVG.prototype.constructor=CTAT.Component.Base.SVG;CTAT.Component.Base.UnitDisplay=function(a,b,d,e,g,c,f){CTAT.Component.Base.SVG.call(this,a,b,d,e,g,c,f);var h="1/2+1/4+(0*1/8)";this.setActionInput("SetPieces",h);var m="#800080";this.color=m;var l=1;this.colorAlpha=l;var n="#800080";this.deselectedColor=n;var p=.3;this.deselectedColorAlpha=p;var x="black";this.piece_border_color=x;this.piece_border_thickness=1;this.getPieceBorderColor=function(){return x};this.setPieceBorderColor=function(a){x=CTATGlobalFunctions.formatColor(a);return this};var q=
[],v=this;this.generateClassname=function(){return this.getName()+" UnitPart"};this.getPieces=function(){return q};var u=function(a){if(a.hasAttributeNS(null,"data-selected"))return CTATGlobalFunctions.toBoolean(a.getAttributeNS(null,"data-selected"));a.setAttributeNS(null,"data-selected",!0);return!0};this.getPiecesBySelected=function(a){for(var c=this.getPieces(),b=[],d,f=0;f<c.length;f++)d=c[f],u(d)===a&&b.push(d);return b};this.getSelectedPieces=this.getPiecesBySelected.bind(this,!0);this.getDeselectedPieces=
this.getPiecesBySelected.bind(this,!1);this.getColor=function(){return m};this.getColorAlpha=function(){return l};this.getDeselectedColor=function(){return n};this.getDeselectedColorAlpha=function(){return p};this.setColor=function(a){this.color=m=CTATGlobalFunctions.formatColor(a);a=this.getSelectedPieces();for(var c=0;c<a.length;c++)$(a[c]).css("fill",m)};this.setColorAlpha=function(a){l=Number(a);this.colorAlpha=l=isNaN(l)?1:l;a=this.getSelectedPieces();for(var c=0;c<a.length;c++)$(a[c]).css("fill-opacity",
l)};this.setDeselectedColor=function(a){this.deselectedColor=n=CTATGlobalFunctions.formatColor(a);a=this.getDeselectedPieces();for(var c=0;c<a.length;c++)$(a[c]).css("fill",m)};this.setDeselectedColorAlpha=function(a){p=Number(a);isNaN(p)&&(p=.3);this.deselectedColorAlpha=p;a=this.getDeselectedPieces();for(var c=0;c<a.length;c++)$(a[c]).css("fill-opacity",p)};this.valueOf=function(){return this.evaluate()};this.getValue=function(){return h};this.setValue=function(a){h=String(a);this.setInput(h);this.clear();
this.drawPieces();return h};this.setParameterHandler("Value",this.setValue);this.data_ctat_handlers.value=function(a){this.setValue(a)};this.drawPieces=function(){};this.evaluate=function(){return this.parseValue().reduce(function(a,c){return c.selected?a.add(c):a},new CTAT.Math.Fraction)};this.numActive=function(){return this.getSelectedPieces().length};this.parseValue=function(){var a=[];h.split("+").forEach(function(c){var b=!0;-1!=c.search(/(\(\s*0\s*\*)|(\*\s*0\s*\))/)&&(b=!1,c=c.replace(/(\(\s*0\s*\*)|(\*\s*0\s*\))/,
""),c=c.replace(/[() ]/g,""));c=new CTAT.Math.Fraction(c);c.selected=b;0<c&&a.push(c);return c});return a};this.updateValue=function(){return h=this.getPieces().map(function(a){return C(a.getAttributeNS(null,"data-value"),CTATGlobalFunctions.toBoolean(a.getAttributeNS(null,"data-selected")))}).join("+")};var A=function(a,c){var b=CTATGlobalFunctions.toBoolean(c);CTATGlobalFunctions.toBoolean(a.getAttributeNS(null,"data-selected"));!0===b?(a.setAttributeNS(null,"data-selected",!0),$(a).css("fill",
v.color),$(a).css("fill-opacity",v.colorAlpha)):($(a).css("fill",v.deselectedColor),$(a).css("fill-opacity",v.deselectedColorAlpha),a.setAttributeNS(null,"data-selected",!1))};this.clickHandler=function(a){!0===v.getEnabled()&&(a=CTATGlobalFunctions.toBoolean(this.getAttributeNS(null,"data-selected")),A(this,!a),v.setActionInput("SetPieces",v.updateValue()),v.processAction())};this.updateSAI=function(){v.setActionInput("SetPieces",v.updateValue())};this.addPieceElem=function(a,c,b){a.setAttributeNS(null,
"data-selected",b);a.setAttributeNS(null,"data-value",c.toString());a.dataValue=c;this.getEnabled()&&(a.style.cursor="pointer");a.addEventListener("click",this.clickHandler);q.push(a)};var y=this.setEnabled;this.setEnabled=function(a){y(a);q.forEach(function(c){c.style.cursor=a?"pointer":"default"})};this.clear=function(){q=[]};var C=function(a,c){var b=a.toString();!1===c&&(b="(0*"+b+")");return b};this.AddPiece=function(a,c){if(a){var b=new CTAT.Math.Fraction(a);if(0<CTAT.Math.round(b.valueOf())){var d=
h.split("+");d.push(C(b,c));v.setValue(d.join("+"))}}};this.AddToValue=function(a,c){if(a){var b=new CTAT.Math.Fraction(a);if(0<CTAT.Math.round(b.valueOf())){var d=h.split("+");d.push(C(b,c));h=d.join("+")}}return h};var r=-1,I=function(a){isNaN(a)&&this.get_denominator();a=Math.max(a,1);1<r&&(a=Math.min(a,r));return a}.bind(this);this.set_max_denominator=function(a){a=parseInt(a);isNaN(a)||(r=a)};this.set_denominator=function(a){v.setHintHighlight(!1);var c="string"===typeof a?parseInt(a):a;if(!isNaN(c)&&
(c=I(c),this.get_denominator()!=a)){var b=v.evaluate();v.clear();a=[];b.set_denominator(c);for(var d=new CTAT.Math.Fraction(1,c),f=Math.floor(b.numerator),e=c-f,g=0;g<f;g++)a.push(C(d,!0));c=new CTAT.Math.Fraction(b.numerator-f,c);c.equals(0)||(a.push(C(c,!0)),a.push(C(d.subtract(c),!1)),e--);for(c=0;c<e;c++)a.push(C(d,!1));this.setValue(a.join("+"));v.setActionInput("SetPieces",h);v.processAction();return h}};this.get_denominator=function(){return q.reduce(function(a,c,b,d){return Math.min(a,c.dataValue.denominator)},
Infinity)};this.change_denominator=function(a){return this.set_denominator(this.get_denominator()+Number(a))};this.set_number_pieces=function(a){v.setHintHighlight(!1);a="string"===typeof a?parseInt(a):a;if(!isNaN(a)){a=I(a);var c=v.numActive();v.clear();for(var b=[],d=new CTAT.Math.Fraction(1,a),f=0;f<a;f++)b.push(C(d,0<c)),c--;this.setValue(b.join("+"));v.setActionInput("SetPieces",h);v.processAction();return h}};this.change_number_pieces=function(a){this.set_number_pieces(q.length+a)};this.set_numerator=
function(a){return this.change_numerator(a-this.getSelectedPieces().length)};this.change_numerator=function(a){0!==a&&(0<a?q.every(function(c){!1===u(c)&&(A(c,!0),a--);return 0<a}):(q.reverse(),q.every(function(c){!0===u(c)&&(A(c,!1),a++);return 0>a}),q.reverse()))};this.SetPieces=function(a){v.setValue(a)};d=function(a){return(a=$(this.getDivWrap()).attr(a))?a.split(/\s*;\s*/).map(function(a){return a.trim()}):[]};a=d.bind(this,"data-ctat-ctrl-denominator");b=d.bind(this,"data-ctat-ctrl-partition");
d=d.bind(this,"data-ctat-ctrl-numerator");e=function(a,c){return 0<=a().indexOf(c)};var J=e.bind(null,a),B=e.bind(null,b),D=e.bind(null,d),H=function(a){var c=null;if(a instanceof CTAT.Component.Base.Tutorable)a!=this&&(c=a.getName());else if(a instanceof CTATSAI)a.getSelection()!=v.getName()&&(c=a.getSelection());else if(a instanceof String)a!=v.getName()&&(c=a);else if(a instanceof Element)a!=v.getComponent()&&(c=a.id);else return null;if(c){if(J(c))return E.bind(this,this.change_denominator,this.set_denominator);
if(D(c))return E.bind(this,this.change_numerator,this.set_numerator);if(B(c))return E.bind(this,this.change_number_pieces,this.set_number_pieces)}return null}.bind(this);a=CTAT.Component.Base.Tutorable.EventType;CTATConfiguration.get("previewMode")||document.addEventListener(a.action,function(a){var c=a.detail.sai;a=H(a.detail.component);c&&null!==a&&a(c)},!1);var E=function(a,c,b){var d=parseInt(b.getInput());if(!isNaN(d)){switch(b.getAction()){case "ButtonPressed":a.call(this,d);break;case "Update":case "UpdateTextField":case "UpdateTextArea":c.call(this,
d)}this.updateSAI();this.processAction()}};this.setNumeratorControllers=function(a){this.getDivWrap().setAttribute("data-ctat-ctrl-numerator",a);return this};this.setParameterHandler("NumeratorControllers",this.setNumeratorControllers);this.setDenominatorControllers=function(a){this.getDivWrap().setAttribute("data-ctat-ctrl-denominator",a);return this};this.setParameterHandler("DenominatorControllers",this.setDenominatorControllers);this.setPartitionControllers=function(a){this.getDivWrap().setAttribute("data-ctat-ctrl-partition",
a);return this};this.setParameterHandler("PartitionControllers",this.setPartitionControllers);this.getConfigurationActions=function(){var a=this.getDivWrap().getAttribute("data-ctat-value");if(a){var c=new CTATSAI;c.setSelection(this.getName());c.setAction("SetPieces");c.setInput(a);return[c]}this.updateSAI();return[this.getSAI()]}};CTAT.Component.Base.UnitDisplay.prototype=Object.create(CTAT.Component.Base.SVG.prototype);CTAT.Component.Base.UnitDisplay.prototype.constructor=CTAT.Component.Base.UnitDisplay;var CTATFractionBar=function(a,b,d,e,g){CTAT.Component.Base.UnitDisplay.call(this,"CTATFractionBar","aFractionBar",a,b,d,e,g);var c=CTATGlobals.NameSpace.svg;this.init=function(){this.initSVG();this.baseGroup=document.createElementNS(c,"g");this.getComponent().appendChild(this.baseGroup);this.getComponent().classList.add("CTATFractionBar--container");this.drawPieces();this.addComponentReference(this,this.getDivWrap());this.component.addEventListener("focus",this.processFocus)};this.render=function(){this.drawPieces()};
this.drawPieces=function(){if(this.baseGroup){this.clear();for(var a=this.parseValue(),b=0,d=document.createDocumentFragment(),e=0;e<a.length;e++){var g=a[e],p=100*g,x=document.createElementNS(c,"rect");x.classList.add("CTATFractionBar--piece");x.setAttributeNS(null,"height","100%");x.setAttributeNS(null,"width",p+"%");x.setAttributeNS(null,"y",0);x.setAttributeNS(null,"x",b+"%");this.addPieceElem(x,g,g.selected);d.appendChild(x);var q=document.createElementNS(c,"text");q.classList.add("CTATFractionBar--label");
q.setAttributeNS(null,"text-anchor","middle");q.setAttributeNS(null,"dominant-baseline","middle");d.appendChild(q);var x=""+String(g.numerator),g=""+String(g.denominator),v=document.createElementNS(c,"tspan"),u=document.createElementNS(c,"tspan");v.appendChild(document.createTextNode(x));u.appendChild(document.createTextNode(g));q.appendChild(v);q.appendChild(u);q=b+p/2;v.setAttributeNS(null,"x",q+"%");v.setAttributeNS(null,"y","60%");v.setAttributeNS(null,"dy","-1em");u.setAttributeNS(null,"x",q+
"%");u.setAttributeNS(null,"y","60%");x.length>g.length?v.style.textDecoration="underline":u.style.textDecoration="overline";b+=p}this.baseGroup.innerHTML="";this.baseGroup.appendChild(d);var A=this.baseGroup.getBBox().width-1;Array.prototype.slice.call(this.baseGroup.childNodes).forEach(function(a){if("rect"==a.nodeName){var c=window.getComputedStyle(a),b=parseFloat(c.getPropertyValue("padding-left")),d=parseFloat(c.getPropertyValue("stroke-width")),c=a.getBBox();a.setAttributeNS(null,"y",c.y+d/
2);a.setAttributeNS(null,"height",c.height-d);var f=c.x+d/2,d=c.width-d;1>c.x?d-=b/2:(f+=b/2,d=c.x+c.width>=A?d-b/2:d-b);a.setAttributeNS(null,"x",f);a.setAttributeNS(null,"width",d)}})}};this.setShowFractionLabel=function(a){};this.setStyleHandler("showFractionLabel",this.setShowFractionLabel)};CTATFractionBar.prototype=Object.create(CTAT.Component.Base.UnitDisplay.prototype);CTATFractionBar.prototype.constructor=CTATFractionBar;CTAT.ComponentRegistry.addComponentType("CTATFractionBar",CTATFractionBar);var CTATGroupingComponent=function(a,b,d,e,g){CTAT.Component.Base.SAIHandler.call(this,"CTATGroupingComponent","__undefined__",a,b,d,e,g);var c=this,f=c.executeSAI;this.isTabIndexable=!1;this.getComponentList=function(){var a=[],b=c.getDivWrap().getAttribute("data-ctat-componentlist");b&&(a=b.split(/\s*[,;]\s*/).map(function(a){return $("#"+a.trim()).data("CTATComponent")}));$(c.getDivWrap()).children(".CTATComponent").each(function(){a.push($(this).data("CTATComponent"))});return[].concat($jscomp.arrayFromIterable(new Set(a)))};
this.init=function(){c.setInitialized(!0)};this.executeSAI=function(a){c.getComponentList().forEach(function(c){null!=c&&c.executeSAI(a)});f.call(c,a)}};CTATGroupingComponent.prototype=Object.create(CTAT.Component.Base.SAIHandler.prototype);CTATGroupingComponent.prototype.constructor=CTATGroupingComponent;CTAT.ComponentRegistry.addComponentType("CTATGroupingComponent",CTATGroupingComponent);var CTATHintButton=function(a,b,d,e,g){CTAT.Component.Base.Clickable.call(this,"hint","CTATHintButton",a,b,d,e,g);this.setName("hint");this.setClassName("CTATHintButton");this.isTabIndexable=!1;this.setText(CTATGlobals.languageManager.getString("HINT"));this.setStyleHandler("BackgroundColor",null);this.setStyleHandler("TextAlign",null);this.setStyleHandler("BorderColor",null);this.setStyleHandler("FontFace",null);this.setStyleHandler("TextColor",null);this.init=function(){this.setInitialized(!0);
var a=document.createElement("button");this.setComponent(a);a.classList.add("unselectable");a.classList.add("CTAT-hint-button");var c=document.createElement("div");c.classList.add("CTAT-hint-button--icon");c.textContent="?";a.appendChild(c);this.getText()&&(c=document.createElement("div"),c.textContent=this.getText(),a.appendChild(c));this.getDivWrap().appendChild(a);a.addEventListener("mouseenter",function(a){a.target.classList.add("CTAT-hint-button--hover")});a.addEventListener("mouseleave",function(a){a.target.classList.remove("CTAT-hint-button--hover");
a.target.classList.remove("CTAT-hint-button--clicked")});a.addEventListener("mousedown",function(a){a.target.classList.add("CTAT-hint-button--clicked")});a.addEventListener("mouseup",function(a){a.target.classList.remove("CTAT-hint-button--clicked")});a.addEventListener("click",function(a){a.target.classList.remove("CTAT-hint-button--clicked")});a.addEventListener("click",this.processClick)};var c=this;this.processClick=function(a){c.getEnabled()&&CTATCommShell.commShell&&CTATCommShell.commShell.requestHint()}};
CTATHintButton.prototype=Object.create(CTAT.Component.Base.Clickable.prototype);CTATHintButton.prototype.constructor=CTATHintButton;CTAT.ComponentRegistry.addComponentType("CTATHintButton",CTATHintButton);var CTATHintWindow=function(a,b,d,e,g){CTAT.Component.Base.Graphical.call(this,"CTATHintWindow","__undefined__",a,b,d,e,g);var c=this;c.isTabIndexable=!1;var f=CTATConfig.parserType_is_XML()?new CTATXML:new CTATJSON,h=new CTATTutorMessageBuilder,m=null,l=null,n=null,p=null,x=CTATGlobals.languageManager.getString("NEXT"),q=CTATGlobals.languageManager.getString("PREVIOUS"),v=null;this.data_ctat_handlers["next-content"]=function(a){v=a;n&&(n.innerHTML=a)};var u=null;this.data_ctat_handlers["previous-content"]=
function(a){u=a;l&&(l.innerHTML=a)};this.getCurrentHint=function(){return m.innerHTML};this.init=function(){c.ctatdebug("init ("+c.getName()+")");c.setInitialized(!0);c.setIsAbstractComponent(!0);p=this.getDivWrap();p.id||p.setAttribute("id",CTATGlobalFunctions.gensym.div_id());p.setAttribute("onkeypress","return noenter(event)");c.setComponent(p);c.addComponentReference(c,p);m=document.createElement("div");p.appendChild(m);m.classList.add("CTATHintWindow--hint-content");var a=document.createElement("div");
a.classList.add("CTATHintWindow--hint-button-area");p.appendChild(a);if(u)l=document.createElement("button"),l.classList.add("CTATHintWindow--previous"),l.innerHTML=u;else{l=document.createElement("button");l.classList.add("CTATHintWindow--previous");var b=document.createElement("span");b.classList.add("CTATHintWindow--button-icon");b.textContent="\u25c0";l.appendChild(b);q&&(b.style.cssFloat="left",l.appendChild(document.createTextNode(q)))}l.addEventListener("click",function(a){CTATShellTools.showPrevHint()},
!1);a.appendChild(l);v?(n=document.createElement("button"),n.classList.add("CTATHintWindow--next"),n.innerHTML=v):(n=document.createElement("button"),n.classList.add("CTATHintWindow--next"),b=document.createElement("span"),b.classList.add("CTATHintWindow--button-icon"),b.textContent="\u25b6",x&&(b.style.cssFloat="right",n.appendChild(document.createTextNode(x))),n.appendChild(b));n.addEventListener("click",function(a){CTATShellTools.showNextHint()},!1);a.appendChild(n);var d=function(a){this.disabled=
!a;a||(this.classList.remove("CTAT-hint-button--hover"),this.classList.remove("CTAT-hint-button--clicked"))};[l,n].forEach(function(a){a.setEnabled=d.bind(a);a.classList.add("CTATHintWindow--button");a.classList.add("CTAT-hint-button");a.addEventListener("mouseenter",function(a){a.target.classList.add("CTAT-hint-button--hover")});a.addEventListener("mouseleave",function(a){a.target.classList.remove("CTAT-hint-button--hover");a.target.classList.remove("CTAT-hint-button--clicked")});a.addEventListener("mousedown",
function(a){a.target.classList.add("CTAT-hint-button--clicked")});a.addEventListener("mouseup",function(a){a.target.classList.remove("CTAT-hint-button--clicked")});a.addEventListener("click",function(a){a.target.classList.remove("CTAT-hint-button--clicked")})});CTATShellTools.registerFeedbackComponent(this,this.goNext,this.goPrevious,this.showHint,this.showFeedback);c.ctatdebug("Disabling previous and next ...");l.setEnabled(!1);n.setEnabled(!1)};this.setStyleHandler("OuterBorderColor",this.setBorderColor);
this.SetText=this.showFeedback=function(a){c.ctatdebug("showFeedback ("+a+")");m&&(m.innerHTML=CTATGlobals.languageManager.filterString(a));l.setEnabled(!1);n.setEnabled(!1)};this.showHint=function(a){c.ctatdebug("showHint ()");hints=a;hintIndex=0;l.setEnabled(!1);n.setEnabled(!1);hints?(this.setEnabled(!0),""===hints[hintIndex]?c.ctatdebug("Empty hint in list, bump"):(m.innerHTML=CTATGlobals.languageManager.filterString(hints[hintIndex]),1<hints.length?(c.ctatdebug("We have more than one hint, enabling next button"),
n.setEnabled(!0)):c.ctatdebug("We only have one hint, leaving next button disabled"))):(hints=[],m.innerHTML="")};this.setEnabled=function(a){c.assignEnabled(a);null===c.getComponent()?c.ctatdebug("Error pointer.getComponent()==null"):c.getComponent().disabled=!a};this.goPrevious=function(){c.ctatdebug("goPrevious ()");hintIndex--;n.setEnabled(!0);0>=hintIndex?(hintIndex=0,l.setEnabled(!1)):l.setEnabled(!0);m.innerHTML=CTATGlobals.languageManager.filterString(hints[hintIndex]);var a=new CTATTutoringServiceMessageBuilder,
b=CTATGuid.guid(),d=new CTATSAI("previousButton","ButtonPressed","-1"),a=a.createInterfaceActionMessage(b,d),d=new CTATSAI("previousButton","ButtonPressed","hint request");commLoggingLibrary.logSemanticEvent(b,d,"HINT_REQUEST","");CTATCommShell.commShell.propagateShellEvent("InterfaceAction",a);d=c.getCurrentHint();b=h.createAssociatedRulesMessageForHint([d],logHintSAI,"student",null,"",b,hints.length,hintIndex+1);b=new CTATMessage(f.parse(b));CTATCommShell.commShell.processAssociatedRules(b,"HintWindow",
d);CTATCommShell.commShell.propagateShellEvent("PreviousPressed",b)};this.goNext=function(){c.ctatdebug("goNext ()");hintIndex++;l.setEnabled(!0);hintIndex>hints.length-1&&(hintIndex=hints.length-1);hintIndex>hints.length-2?n.setEnabled(!1):n.setEnabled(!0);m.innerHTML=CTATGlobals.languageManager.filterString(hints[hintIndex]);var a=new CTATTutoringServiceMessageBuilder,b=CTATGuid.guid(),d=new CTATSAI("nextButton","ButtonPressed","-1"),a=a.createInterfaceActionMessage(b,d),d=new CTATSAI("nextButton",
"ButtonPressed","hint request");commLoggingLibrary.logSemanticEvent(b,d,"HINT_REQUEST","");CTATCommShell.commShell.propagateShellEvent("InterfaceAction",a);d=c.getCurrentHint();b=h.createAssociatedRulesMessageForHint([d],logHintSAI,"student",null,"",b,hints.length,hintIndex+1);b=new CTATMessage(f.parse(b));CTATCommShell.commShell.processAssociatedRules(b,"HintWindow",d);CTATCommShell.commShell.propagateShellEvent("NextPressed",b)}};CTATHintWindow.prototype=Object.create(CTAT.Component.Base.Graphical.prototype);
CTATHintWindow.prototype.constructor=CTATHintWindow;CTAT.ComponentRegistry.addComponentType("CTATHintWindow",CTATHintWindow);var CTATIFrameManager=function(){var a={},b=this;this.initFrame=function(b,e,g){var c=b?b.getAttribute("id"):null;c?a[c]={domNode:b,initialDom:e,initialMode:g}:console.error("iFrames managed by CTATIFrameManager must exist and have unique ids");b.setAttribute("data-ctat-target",g);this.writeData(b,e)};this.refresh=function(b){var d=a[b];d.domNode?(d.domNode.setAttribute("src","about:blank"),this.writeData(d.domNode,d.initialDom)):console.warn("CTATIFrameManager: iFrame id "+b+" not found")};this.writeData=
function(a,b){if(a){var d=a.contentDocument||a.contentWindow.document;d.open();d.write(b);d.close()}};document.addEventListener("refreshIframe",function(a){a=a.detail;console.log("refresh event for iframe "+a);b.refresh(a)})};var CTATImageButton=function(a,b,d,e,g){CTATButtonBasedComponent.call(this,"CTATImageButton","__undefined__",a,b,d,e,g);var c=this;this.init=function(){c.setInitialized(!0);c.setComponent(c.getDivWrap());c.addComponentReference(c,c.getDivWrap());c.setImage(c.getDivWrap().getAttribute("data-ctat-image-default"));var a=c.component;a.setAttribute("role","button");a.classList.add("CTAT-button");a.addEventListener("click",c.processClick);a.addEventListener("focus",c.processFocus);a.addEventListener("mousedown",
c.processBaseMousedown);a.addEventListener("mouseup",c.processBaseMouseup);a.addEventListener("mouseover",c.processBaseMouseover);a.addEventListener("mouseout",c.processBaseMouseout)};var f=this.setEnabled;this.setEnabled=function(a){f(a);c.getEnabled()?c.setImage(c.getDivWrap().getAttribute("data-ctat-image-default")):c.setImage(c.getDivWrap().getAttribute("data-ctat-image-disabled"))};this.getConfigurationActions=function(){var a=this.getDivWrap(),c=a.getAttribute("data-ctat-image-hover"),b=a.getAttribute("data-ctat-image-clicked"),
d=a.getAttribute("data-ctat-image-default"),a=a.getAttribute("data-ctat-image-disabled");if(d){var f=new CTATSAI;f.setSelection(this.getName());c||b||a?(f.setAction("assignImages"),f.setInputArray([c,b,d,a])):(f.setAction("assignImage"),f.setInput(d));return[f]}return[]}};CTATImageButton.prototype=Object.create(CTATButtonBasedComponent.prototype);CTATImageButton.prototype.constructor=CTATImageButton;CTAT.ComponentRegistry.addComponentType("CTATImageButton",CTATImageButton);var CTATJumble=function(a,b,d,e,g){CTAT.Component.Base.Tutorable.call(this,"CTATJumble","aJumble",a,b,d,e,g);var c=this;this.setActionInput("SetOrder","");var f=null;this.init=function(){this.setInitialized(!0);f=this.getDivWrap();this.setComponent(f);this.addComponentReference(this,f);CTATConfiguration.get("previewMode")||$(f).children().addClass("CTATJumble--item").attr({unselectable:"on",draggable:!0}).each(function(){this.addEventListener("dragstart",m,!1);this.addEventListener("dragenter",n,
!1);this.addEventListener("dragover",l,!1);this.addEventListener("dragleave",p,!1);this.addEventListener("drop",x,!1);this.addEventListener("dragend",q,!1)});this.component.addEventListener("focus",this.processFocus)};this.getConfigurationActions=function(){this.updateSAI();return[this.getSAI()]};var h=null,m=function(a){a.target.classList.add("CTATJumble--item--home");h=a.target;a.dataTransfer.effectAllowed="move";a.dataTransfer.setData("text/html",a.target.innerHTML)},l=function(a){a.preventDefault&&
a.preventDefault();a.dataTransfer.dropEffect="move";return!1},n=function(a){this.classList.add("CTATJumble--item--over")},p=function(a){this.classList.remove("CTATJumble--item--over")},x=function(a){a.stopPropagation&&a.stopPropagation();$(f).children().removeClass("CTATJumble--item--over");if(h!=this){h.innerHTML=this.innerHTML;var b=h.id;h.id=this.id;this.innerHTML=a.dataTransfer.getData("text/html");this.id=b;c.setInput(c.getOrder());c.processAction()}return!1},q=function(a){this.classList.remove("CTATJumble--item--home");
$(f).children().removeClass("CTATJumble--item--over")},v=this.setEnabled;this.setEnabled=function(a){v(a);f&&$(f).children().attr("draggable",a)};this.init_items=function(a){if(f){var c=document.createDocumentFragment();a=a.split(";");for(var b=a.length,d=0;d<b;d++){var e=document.createElement("div");e.textContent=a[d];e.id=this.getName()+d;e.setAttribute("unselectable","on");e.setAttribute("draggable",!0);e.classList.add("CTATJumble--item");e.addEventListener("dragstart",m,!1);e.addEventListener("dragenter",
n,!1);e.addEventListener("dragover",l,!1);e.addEventListener("dragleave",p,!1);e.addEventListener("drop",x,!1);e.addEventListener("dragend",q,!1);c.appendChild(e)}f.innerHTML="";f.appendChild(c)}};this.setParameterHandler("textItems",this.init_items);this.SetOrder=function(a){a.split(";").forEach(function(a){$(f).append($("#"+a))})};this.getOrder=function(){var a=[];$(f).children().each(function(){this.draggable&&(this.id?a.push(this.id):console.log("ERROR: The CTATJumble "+c.getName()+" has a child with no id attribute: "+
this+"!!!"))});return a.join(";")};this.updateSAI=function(){c.setInput(c.getOrder())}};CTATJumble.prototype=Object.create(CTAT.Component.Base.Tutorable.prototype);CTATJumble.prototype.constructor=CTATJumble;CTAT.ComponentRegistry.addComponentType("CTATJumble",CTATJumble);var CTATMobileTutorHandler=function(a,b){CTATBase.call(this,"CTATMobileTutorHandler","mobiletutorhandler");this.ctatdebug("CTATMobileTutorHandler ()");var d="",e=b?b:"disabled",g=!1;/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)&&(g=!0);this.error=function(a){this.ctatdebug(a);alert(a)};this.processOrientationChange=function(a){this.ctatdebug("processOrientationChange ("+a+")")};this.getEnabled=function(){return"disabled"==e||"auto"==e&&0==g?!1:!0};this.processTextFocus=
function(a,b,h,m,l){this.ctatdebug("processTextFocus ("+a+","+b+","+h+","+m+","+l+")");"disabled"==e||"auto"==e&&0==g||(d="",this.manipulateKeyboard())};this.processEnter=function(){this.ctatdebug("processEnter ()");if("disabled"!=e&&("auto"!=e||0!=g)){var c=getSafeElementById(a);if(null!=c)try{c.processExternalEnter(),this.ctatdebug("Successfully called AS3 method")}catch(f){this.ctatdebug("Error description: "+f.message)}else this.ctatdebug("Error: unable to obtain reference to swf object")}};this.setText=
function(c){this.ctatdebug("setText ("+c+")");if("disabled"!=e&&("auto"!=e||0!=g))if(null!=CTATGlobals.selectedTextInput){this.ctatdebug("Attempting to call HTML5 method on text object ...");var b=CTATGlobals.selectedTextInput.getText();CTATGlobals.selectedTextInput.setText(b+c)}else if(this.ctatdebug("Attempting to call AS3 method ..."),b=getSafeElementById(a),null!=b)try{d+=c,this.ctatdebug(d),b.processExternalKeyboard(d),this.ctatdebug("Successfully called AS3 method")}catch(h){this.ctatdebug("Error description: "+
h.message)}else this.ctatdebug("Error: unable to obtain reference to swf object")};this.manipulateKeyboard=function(){this.ctatdebug("manipulateKeyboard()");if("disabled"!=e&&("auto"!=e||0!=g)){this.hideKeyboard();var a=getSafeElementById("keyboardUI");a&&(a.style.visibility="visible")}};this.hideKeyboard=function(){document.activeElement.blur();var a=getSafeElementById("input");a&&a.blur()};this.hideCustomKeyboard=function(){getSafeElementById("keyboardUI").style.visibility="visible"}};
CTATMobileTutorHandler.prototype=Object.create(CTATBase.prototype);CTATMobileTutorHandler.prototype.constructor=CTATMobileTutorHandler;function processTextFocus(a,b,d,e,g){mobileAPI.processTextFocus(a,b,d,e,g)}function processFocusOut(){closeK()};var CTATMovieClip=function(a,b,d,e,g){CTATBase.call(this,"CTATMovieClip",a);var c=CTATGlobalFunctions.gensym.z_index(),f=CTATGlobalFunctions.gensym.div_id(),h=CTATGlobalFunctions.gensym.z_index();CTATGlobalFunctions.gensym.div_id();var m=[],l=this,n=null;this.wrapComponent=function(a){n=document.createElement("div");n.setAttribute("id",f);n.setAttribute("name",this.getName());n.setAttribute("style","z-index: "+c);n.setAttribute("width",e+"px");n.setAttribute("height",g+"px");n.setAttribute("style",
"border: 0px; position: absolute; left:"+b+"px; top:"+d+"px; z-index:"+h+";");a.appendChild(n);return n};this.getDivWrapper=function(){return n};this.addComponent=function(a){l.ctatdebug("addComponent ("+a+")");m.push(a)};this.isRegistered=function(a){for(var c=0;c<m.length;c++)if(m[c]==a)return!0;return!1}};CTATMovieClip.prototype=Object.create(CTATBase.prototype);CTATMovieClip.prototype.constructor=CTATMovieClip;CTAT.Geom={};CTAT.Geom.Point={};try{new DOMPoint}catch(a){if(console.log("WARNING: new DOMPoint():",a,typeof a),a instanceof ReferenceError||a instanceof TypeError){console.log("   Using shim!");var DOMPoint=function(b,d,e,g){this.z=this.y=this.x=0;this.w=1;if(b instanceof DOMPoint)for(var c in b)this[c]=b[c];else this.x=b||0,this.y=d||0,this.z=e||0,this.w=g||1}}}CTAT.Geom.Point.useDOMMatrix=!0;try{new DOMMatrix}catch(a){a instanceof ReferenceError&&(CTAT.Geom.Point.useDOMMatrix=!1)}
CTAT.Geom.Point.add=function(){if(CTAT.Geom.Point.useDOMMatrix){for(var a=new DOMMatrix,b,d=0;d<arguments.length;d++)b=arguments[d],a.translateSelf(b.x/b.w,b.y/b.w,b.z/b.w);return a.transformPoint(new DOMPoint)}return Array.prototype.reduce.call(arguments,function(a,b){for(var c in a)"w"!=c&&0!==b[c]&&(a[c]+=b[c]/b.w);return a},new DOMPoint)};
DOMPoint.prototype.add||Object.defineProperty(DOMPoint.prototype,"add",{enumerable:!1,value:function(a){return CTAT.Geom.Point.useDOMMatrix?(new DOMMatrix).translate(a.x/a.w,a.y/a.w,a.z/a.w).transformPoint(this):CTAT.Geom.Point.add(this,a)}});CTAT.Geom.Point.angle=function(a,b){return Math.acos(DOMPoint.dot(a,b)/(a.magnitude*b.magnitude))};CTAT.Geom.Point.angle_degrees=function(a,b){return CTAT.Math.rad2deg(CTAT.Geom.Point.angle(a,b))};
CTAT.Geom.Point.angle_between_2d=function(a,b){return CTAT.Math.rad2deg(Math.atan2(b.y,b.x)-Math.atan2(a.y,a.x))};DOMPoint.prototype.clone||Object.defineProperty(DOMPoint.prototype,"clone",{value:function(){return new DOMPoint(this.x,this.y,this.z,this.w)}});CTAT.Geom.Point.distance=function(a,b){var d=CTAT.Geom.Point.add(a,CTAT.Geom.Point.scale(b,-1));return Math.sqrt(CTAT.Geom.Point.dot(d,d))};
DOMPoint.prototype.distance||Object.defineProperty(DOMPoint.prototype,"distance",{value:function(a){return CTAT.Geom.Point.distance(this,a)}});CTAT.Geom.Point.dot=function(a,b){return(a.x*b.x+a.y*b.y+a.z*b.z)/(a.w*b.w)};CTAT.Geom.Point.equals=function(a,b){var d=!0,e;for(e in a)if(e in b?"w"!=e&&(d&=a[e]/a.w==b[e]/b.w):d=!1,!d)break;return d};CTAT.Geom.Point.interpolate=function(a,b,d){return CTAT.Geom.Point.add(a.scale(d),b.scale(1-d))};
"magnitude"in DOMPoint.prototype||Object.defineProperty(DOMPoint.prototype,"magnitude",{enumerable:!1,get:function(){return CTAT.Math.round(Math.sqrt(CTAT.Geom.Point.dot(this,this)))}});DOMPoint.prototype.normalize||Object.defineProperty(DOMPoint.prototype,"normalize",{value:function(a){return this.scale((a?a:1)/this.magnitude)}});
CTAT.Geom.Point.scale=function(a,b){if(CTAT.Geom.Point.useDOMMatrix)return(new DOMMatrix).scale(b).transformPoint(a);var d=new DOMPoint(a),e;for(e in d)"w"!=e&&(d[e]=CTAT.Math.round(a[e]*b));return d};DOMPoint.prototype.scale||Object.defineProperty(DOMPoint.prototype,"scale",{value:function(a){return CTAT.Geom.Point.scale(this,a)}});CTAT.Geom.Point.polar=function(a,b){return new DOMPoint(CTAT.Math.round(a*Math.cos(b)),CTAT.Math.round(a*Math.sin(b)))};
CTAT.Geom.Point.is_on_line=function(a,b,d){return 1E-4>Math.abs(a.distance(d)+b.distance(d)-a.distance(b))};CTAT.Geom.Point.circle_intersection=function(a,b,d,e){b=b.add(a.scale(-1)).normalize();var g=CTAT.Geom.Point.dot(b,d.add(a.scale(-1))),c=a.add(b.scale(g));d=CTAT.Geom.Point.distance(d,c);return d<e?(e=Math.sqrt(e*e-d*d),[a.add(b.scale(g-e)),a.add(b.scale(g+e))]):d==e?[c]:[]};CTAT.Geom.Point.to2DString=function(a,b){var d=[a.x/a.w,a.y/a.w].join();b&&(d="("+d+")");return d};CTAT.Geom.Rectangle={};try{new DOMRect}catch(a){if(console.log("WARNING: new DOMRect():",a,typeof a),a instanceof ReferenceError||a instanceof TypeError){console.log("    Using shim!");var DOMRect=function(b,d,e,g){this.x=b||0;this.y=d||0;this.width=e||0;this.height=g||0;return this}}}"left"in DOMRect.prototype||Object.defineProperty(DOMRect.prototype,"left",{get:function(){return Math.min(this.x,this.x+this.width)}});
"right"in DOMRect.prototype||Object.defineProperty(DOMRect.prototype,"right",{get:function(){return Math.max(this.x,this.x+this.width)}});"top"in DOMRect.prototype||Object.defineProperty(DOMRect.prototype,"top",{get:function(){return Math.min(this.y,this.y+this.height)}});"bottom"in DOMRect.prototype||Object.defineProperty(DOMRect.prototype,"bottom",{get:function(){return Math.max(this.y,this.y+this.height)}});
CTAT.Geom.Rectangle.contains=function(a,b,d){var e=CTAT.Geom.Rectangle.contains;if(b instanceof DOMRect)return e(a,b.left,b.top)&e(a,b.right,b.bottom);if(b instanceof DOMPoint){var g=!0;if(d instanceof DOMPoint)g=e(a,d.x/d.w,d.y/d.w);else if("number"==typeof d)return e(a,b.x-d,b.y-d)&e(a,b.x+d,b.y+d);return g&e(a,b.x,b.y)}return a.left<=b&a.right>=b&a.top<=d&a.bottom>=d};
DOMRect.prototype.contains||Object.defineProperty(DOMRect.prototype,"contains",{value:function(a,b){return CTAT.Geom.Rectangle.contains(this,a,b)}});DOMRect.prototype.clone||Object.defineProperty(DOMRect.prototype,"clone",{value:function(){return new DOMRect(this.x,this.y,this.width,this.height)}});DOMRect.prototype.copyFrom||Object.defineProperty(DOMRect.prototype,"copyFrom",{value:function(a){this.x=a.x;this.y=a.y;this.width=a.width;this.height=a.height;return this}});
CTAT.Geom.Rectangle.equals=function(a,b){return a.left==b.left&&a.top==b.top&&a.right==b.right&&a.bottom==b.bottom};CTAT.Geom.Rectangle.inflate=function(a,b,d){b=b?b:0;d=d?d:0;b instanceof DOMPoint&&(d=b.y,b=b.x);a=a.clone();a.x-=b;a.y-=d;a.width+=2*b;a.height+=2*d;return a};CTAT.Geom.Rectangle.isEmpty=function(a){return 0===a.width||0===a.height};CTAT.Geom.Rectangle.setEmpty=function(a){a.x=0;a.y=0;a.width=0;a.height=0;return a};
CTAT.Geom.Rectangle.setTo=function(a,b,d,e,g){a.x=b;a.y=d;a.width=e;a.height=g;return a};CTAT.Geom.Rectangle.offset=function(a,b,d){b=b?b:0;d=d?d:0;b instanceof DOMPoint&&(d=b.y,b=b.x);a=a.clone();a.x+=b;a.y+=d;return a};CTAT.Geom.Rectangle.union=function(a,b){var d=new DOMRect;d.x=Math.min(a.x,b.x);d.y=Math.min(a.y,b.y);d.width=Math.max(a.right,b.right)-d.x;d.height=Math.max(a.bottom,b.bottom)-d.y;return d};var CTATNumberLine=function(a,b,d,e,g){CTAT.Component.Base.SVG.call(this,"CTATNumberLine","aNumberLine",a,b,d,e,g);var c=CTAT.Math.Fraction,f=CTATGlobals.NameSpace.svg;a=function(a,b,d,e,g){this.numberline=a;this.step=new c(b);this.size=d;this.origin=new c(0);e=e?e:null;g=g?g:null;this.g=null;this.setStep=function(a){this.step=new c(a)};this.setSize=function(a){a=Number(a);isNaN(a)&&(a=d);this.size=a};this.setOrigin=function(a){this.origin=new c(a)};this.generate=function(){if(this.numberline){var a=
new c,b=document.createDocumentFragment(),d=document.createElementNS(f,"g");d.setAttributeNS(null,"data-step-size",this.step.toString());d.setAttributeNS(null,"pointer-events","none");e&&d.classList.add(e);b.appendChild(d);if(0<this.step){for(a.set(this.origin).reduce();a<=this.numberline.Maximum;)a>=this.numberline.Minimum&&d.appendChild(this.numberline.genTickmark(a,null,this.size)),a=a.add(this.step);a.set(this.origin).reduce();for(a=a.subtract(this.step);a>=this.numberline.Minimum;)a<=this.numberline.Maximum&&
d.appendChild(this.numberline.genTickmark(a,null,this.size)),a=a.subtract(this.step)}g&&$(d).find("text.CTATNumberLine--tickmark-label").each(function(){this.classList.add(g)});return b}}};var h=new a(this,new c(1),30,"CTATNumberLine--large-tickmark","CTATNumberLine--large-tickmark-label");this.setLargeTickSize=function(a){h.setSize(s);this.render();return this};this.setParameterHandler("LargeTickmarkSize",this.setLargeTickSize);this.setParameterHandler("LargeTickmarkStep",function(a){h.setStep(a);
this.render();return this});this.data_ctat_handlers["large-tick-step"]=function(a){h.setStep(a);this.render()};var m=new a(this,new c(1,2),20,"CTATNumberLine--small-tickmark","CTATNumberLine--small-tickmark-label");this.setSmallTickSize=function(a){m.setSize(s);this.render();return this};this.setParameterHandler("SmallTickmarkSize",this.setSmallTickSize);this.setParameterHandler("SmallTickmarkStep",function(a){m.setStep(a);this.render();return this});this.data_ctat_handlers["small-tick-step"]=function(a){m.setStep(a);
this.render()};var l=new a(this,new c(0),25,"CTATNumberLine--denominator-tickmark","CTATNumberLine--denominator-tickmark-label");this.setParameterHandler("DenominatorTickmarkSize",function(a){l.setSize(a);this.render();return this});this.setParameterHandler("DenominatorTickmarkStep",function(a){l.setStep((new c(a)).reciprocal())});this.data_ctat_handlers.denominator=function(a){a=new c(a);l.setStep(a.reciprocal())};this.setColor=function(a){console.log("numberline.setColor");this.color=a=CTATGlobalFunctions.formatColor(a);
for(var c=$(this.getDivWrap()).find("g"),b=0;b<c.length;b++)$(c[b]).css("stroke",a)};this.getColor=function(){console.log("numberline.getColor");return this.color};this.X_Axis=new function(a,c,b,d){var f={};this.svg_group=null;var e=a;Object.defineProperty(this,"start",{get:function(){return e},set:function(a){f={};e=a}});Object.defineProperty(this,"min_loc",{get:function(){if(!f.hasOwnProperty("min_loc")){var a=this.start.clone(),c=CTAT.Geom.Point.polar(20,this.angle()),a=a.add(c);a.x=CTAT.Math.round(a.x);
a.y=CTAT.Math.round(a.y);f.min_loc=a}return f.min_loc}});var g=c;Object.defineProperty(this,"end",{get:function(){return g},set:function(a){f={};g=a}});Object.defineProperty(this,"max_loc",{get:function(){if(!f.hasOwnProperty("max_loc")){var a=this.end.clone(),c=CTAT.Geom.Point.polar(20,this.angle()),a=a.add(c.scale(-1));a.x=CTAT.Math.round(a.x);a.y=CTAT.Math.round(a.y);f.max_loc=a}return f.max_loc}});var h=b;Object.defineProperty(this,"min",{get:function(){return h},set:function(a){f={};h=a}});var l=
d;Object.defineProperty(this,"max",{get:function(){return l},set:function(a){f={};l=a}});Object.defineProperty(this,"length",{get:function(){f.hasOwnProperty("length")||(f.length=CTAT.Math.round(this.min_loc.distance(this.max_loc)));return f.length}});this.isHorizontal=function(){return this.start.y===this.end.y};this.isVertical=function(){return this.start.x===this.end.x};Object.defineProperty(this,"range",{get:function(){return this.max.subtract(this.min)}});Object.defineProperty(this,"step_size",
{get:function(){return CTAT.Geom.Point.equals(this.min_loc,this.max_loc)?this.length:CTAT.Math.round(this.length/this.range)}});this.s_vec=function(){return this.max_loc.add(this.min_loc.scale(-1))};this.slope=function(){var a=this.s_vec();return a.y/a.x};this.step=function(){f.hasOwnProperty("step")||(f.step=this.s_vec().normalize(this.step_size));return f.step};this.scalar=function(){f.hasOwnProperty("scalar")||(f.scalar=this.range/this.length);return f.scalar};this.zero=function(){f.hasOwnProperty("zero")||
(f.zero=this.min_loc.add(this.step().scale(-this.min)),f.zero.x=CTAT.Math.round(f.zero.x),f.zero.y=CTAT.Math.round(f.zero.y));return f.zero};this.angle=function(){if(!f.hasOwnProperty("angle")){var a=this.end.add(this.start.scale(-1));f.angle=Math.atan2(a.y,a.x)}return f.angle};this.angle_deg=function(){return CTAT.Math.rad2deg(this.angle())};this.getPosition=function(a){a=this.zero().add(this.step().scale(1*a));a.x=CTAT.Math.round(a.x);a.y=CTAT.Math.round(a.y);return a};this.projected_point=function(a){var c=
this.s_vec(),b=a.add(this.min_loc.scale(-1)),b=0+(c.y*b.x-c.x*b.y)/(c.y*c.y+c.x*c.x);return a.add(new DOMPoint(-b*c.y,b*c.x))};this.getProjectedPoint=function(a){a=this.projected_point(a);return a.distance(this.max_loc)>this.length?this.min_loc:a.distance(this.min_loc)>this.length?this.max_loc:a};this.getAxisValue=function(a){return CTAT.Math.round(h+this.scalar()*this.min_loc.distance(this.getProjectedPoint(a)))}}(new DOMPoint(0,0),new DOMPoint(0,0),new c(0),new c(3));Object.defineProperty(this,
"Maximum",{get:function(){return this.X_Axis.max},set:function(a){this.X_Axis.max=new c(a)}});this.setMaximum=function(a){this.Maximum=a};this.setParameterHandler("Maximum",this.setMaximum);this.data_ctat_handlers.maximum=this.setMaximum;Object.defineProperty(this,"Minimum",{get:function(){return this.X_Axis.min},set:function(a){this.X_Axis.min=new c(a)}});this.setMinimum=function(a){this.Minimum=a};this.setParameterHandler("Minimum",this.setMinimum);this.data_ctat_handlers.minimum=this.setMinimum;
var n=1;Object.defineProperty(this,"Max_Points",{get:function(){return n},set:function(a){a=parseInt(a);isNaN(a)||(n=a)}});this.setMaxPoints=function(a){this.Max_Points=a};this.setParameterHandler("Max_Points",this.setMaxPoints);this.data_ctat_handlers["max-points"]=this.setMaxPoints;var p=7;this.setPointSize=function(a){p=Number(a);u&&(u.setAttributeNS(null,"r",p),$(this._point_group).find("circle").each(function(){$(this).attr("r",p)}))};this.setStyleHandler("PointSize",this.setPointSize);this.data_ctat_handlers["point-size"]=
this.setPointSize;var x=!1;this.setSnapToTickMark=function(a){x=CTATGlobalFunctions.toBoolean(a)};this.setParameterHandler("SnapToTickmark",this.setSnapToTickMark);this.data_ctat_handlers.snap=this.setSnapToTickMark;this.theta=0;Object.defineProperty(this,"Orientation",{get:function(){return 180*this.theta/Math.PI},set:function(a){a=Number(a);isNaN(a)&&(a=0);this.theta=Math.PI*a/180}});this.setOrientation=function(a){this.Orientation=a;this.render()};this.setParameterHandler("Orientation",this.setOrientation);
this.data_ctat_handlers.rotation=this.setOrientation;this._tickmarks=[];this.genTickmark=function(a,c,b){var d=document.createDocumentFragment();if(!this._tickmarks.some(function(c){return c.data.equals(a)})){var e=document.createElementNS(f,"line"),g=this.X_Axis.getPosition(a),h=CTAT.Geom.Point.polar(b/2,this.theta+Math.PI/2).add(g);b=CTAT.Geom.Point.polar(-b/2,this.theta+Math.PI/2).add(g);e.setAttributeNS(null,"x1",h.x);e.setAttributeNS(null,"y1",h.y);e.setAttributeNS(null,"x2",b.x);e.setAttributeNS(null,
"y2",b.y);e.setAttributeNS(null,"data-value",a.toString());e.data=a;e.location=g;e.label=null;this._tickmarks.push(e);d.appendChild(e);if(""!==c){g=document.createElementNS(f,"text");g.classList.add("CTATNumberLine--tickmark-label");g.setAttributeNS(null,"text-anchor","middle");d.appendChild(g);if(null===c||void 0===c)if(1==a.denominator)g.appendChild(document.createTextNode(String(a.numerator.toPrecision(P)))),g.setAttributeNS(null,"x",b.x),g.setAttributeNS(null,"y",b.y);else{c=""+String(a.numerator);
h=""+String(a.denominator);g.style.fontSize="0.6em";g.setAttributeNS(null,"text-align","center");var l=document.createElementNS(f,"tspan"),m=document.createElementNS(f,"tspan");l.appendChild(document.createTextNode(c));m.appendChild(document.createTextNode(h));g.appendChild(l);g.appendChild(m);l.setAttributeNS(null,"text-anchor","middle");l.setAttributeNS(null,"x",b.x);l.setAttributeNS(null,"y",b.y);l.setAttributeNS(null,"dy","-1em");m.setAttributeNS(null,"text-anchor","middle");m.setAttributeNS(null,
"x",b.x);m.setAttributeNS(null,"y",b.y);c.length>h.length?l.style.textDecoration="underline":m.style.textDecoration="overline"}else g.appendChild(document.createTextNode(c.toString())),d.appendChild(tlabel),g.setAttributeNS(null,"x",b.x),g.setAttributeNS(null,"y",b.y);e.label=g}}return d};var q=function(){if(null!==this.X_Axis&&null!==this.X_Axis.svg_group){var a=this.getBoundingBox(),c=window.getComputedStyle(this._axis_line_group),c=parseInt(c.getPropertyValue("stroke-width")),a=CTAT.Geom.Rectangle.inflate(a,
-c,-c),b=new DOMPoint(a.width/2,a.height/2),d=b.add(CTAT.Geom.Point.polar(Math.min(40,a.height,a.width)/4,this.theta)),e=Math.sin(this.theta),g=-Math.cos(this.theta),q=e*b.x+g*b.y,n=-a.height*g,v=-e*a.width,c=new DOMPoint(a.left,b.y),b=new DOMPoint(a.right,b.y);if(0<Math.abs(CTAT.Math.round(n))){var n=new DOMPoint(a.left,(q-e*a.left)/g),p=new DOMPoint(a.right,(q-e*a.right)/g);if(a.contains(n)||a.contains(p))d.distance(n)<d.distance(p)?(c=p,b=n):(c=n,b=p)}0<Math.abs(CTAT.Math.round(v))&&(v=new DOMPoint((q-
g*a.top)/e,a.top),e=new DOMPoint((q-g*a.bottom)/e,a.bottom),a.contains(v)||a.contains(e))&&(d.distance(v)<d.distance(e)?(c=e,b=v):(c=v,b=e));if(this.X_Axis.start.x!=c.x||this.X_Axis.start.y!=c.y||this.X_Axis.end.x!=b.x||this.X_Axis.end.y!=b.y)this.X_Axis.start=c,this.X_Axis.end=b,this.X_Axis.svg_group.innerHTML="",a=document.createDocumentFragment(),d=document.createElementNS(f,"line"),d.setAttributeNS(null,"x1",c.x),d.setAttributeNS(null,"y1",c.y),d.setAttributeNS(null,"x2",b.x),d.setAttributeNS(null,
"y2",b.y),a.appendChild(d),d=document.createElementNS(f,"path"),d.setAttributeNS(null,"d","M 10,6 L 0,0 L 10,-6"),d.setAttributeNS(null,"transform","translate("+CTAT.Geom.Point.to2DString(c)+") rotate("+this.Orientation+")"),a.appendChild(d),c=document.createElementNS(f,"path"),c.setAttributeNS(null,"d","M -10,6 L 0,0 L -10,-6"),c.setAttributeNS(null,"transform","translate("+CTAT.Geom.Point.to2DString(b)+") rotate("+this.Orientation+")"),a.appendChild(c),this.X_Axis.svg_group.appendChild(a);this._tickmarks=
[];c=document.createDocumentFragment();c.appendChild(h.generate());c.appendChild(m.generate());c.appendChild(l.generate());this._tick_mark_group.innerHTML="";this._tick_mark_group.appendChild(c);c=this._point_group.children;for(b=0;b<c.length;b++)a=c[b],d=this.X_Axis.getPosition(a.value),e=new DOMPoint(a.cx.baseVal.value,a.cy.baseVal.value),1<d.distance(e)&&(a.cx.baseVal.value=d.x,a.cy.baseVal.value=d.y)}}.bind(this),v=0,u=null,A=new DOMPoint(-30,-30),y=!1,C=function(a){A.x=a.clientX;A.y=a.clientY},
r=function(a){cancelAnimationFrame(v);u.style.visibility="hidden";y=!1},I=function(a){if(!0===this.getEnabled()&&0<n){this.setHintHighlight(!1);var c;x?(a=H(a.clientX,a.clientY),c=a.location,a=a.data):(a=B(a.clientX,a.clientY),c=this.X_Axis.getProjectedPoint(a),a=this.X_Axis.getAxisValue(a));var b=document.createElementNS(f,"circle");b.classList.add("CTATNumberLine--point");b.setAttributeNS(null,"cx",c.x);b.setAttributeNS(null,"cy",c.y);b.setAttributeNS(null,"r",p);b.value=a;if(this._point_group.children.length>=
this.Max_Points){c=[].slice.call(this._point_group.children);var d=c.filter(function(a,c,b){return a.classList.contains("CTAT--incorrect")});0<d.length?this._point_group.removeChild(d[0]):(c=c.filter(function(a,c,b){return!a.classList.contains("CTAT--correct")}),0<c.length&&this._point_group.removeChild(c[0]))}this._point_group.appendChild(b);this.setActionInput("AddPoint",a.toString());this.processAction()}}.bind(this);this.init=function(){this.initSVG();this.component.classList.add("CTATNumberLine--container");
this._axis_line_group=document.createElementNS(f,"g");this._axis_line_group.classList.add("CTATNumberLine--axis");this._tick_mark_group=document.createElementNS(f,"g");this._tick_mark_group.classList.add("CTATNumberLine--tickmark");this._point_group=document.createElementNS(f,"g");u=document.createElementNS(f,"circle");u.setAttributeNS(null,"r",p);u.classList.add("CTATNumberLine--cursor");u.setAttributeNS(null,"transform","translate(-30,-30)");this.component.appendChild(this._axis_line_group);this.component.appendChild(this._tick_mark_group);
this.component.appendChild(this._point_group);this.component.appendChild(u);this.X_Axis.svg_group=this._axis_line_group;q();this.addComponentReference(this,this.getDivWrap());this.component.addEventListener("mousemove",C);this.component.addEventListener("mouseleave",r);var a=this.getEnabled;this.component.addEventListener("mouseenter",function(){!0===a()&&0<n&&(y=!0,u.style.visibility=null,v=requestAnimationFrame(E))});this.component.addEventListener("click",I);this.component.addEventListener("focus",
this.processFocus)};this.getConfigurationActions=function(){var a=[],c,b=$(this.getDivWrap());b.attr("data-ctat-minimum")&&(c=new CTATSAI,c.setSelection(this.getName()),c.setAction("set_minimum"),c.setInput(b.attr("data-ctat-minimum")),a.push(c));b.attr("data-ctat-maximum")&&(c=new CTATSAI,c.setSelection(this.getName()),c.setAction("set_maximum"),c.setInput(b.attr("data-ctat-maximum")),a.push(c));b.attr("data-ctat-max-points")&&(c=new CTATSAI,c.setSelection(this.getName()),c.setAction("set_max_user_entries"),
c.setInput(b.attr("data-ctat-max-points")),a.push(c));b.attr("data-ctat-large-tick-step")&&(c=new CTATSAI,c.setSelection(this.getName()),c.setAction("set_large_step"),c.setInput(b.attr("data-ctat-large-tick-step")),a.push(c));b.attr("data-ctat-small-tick-step")&&(c=new CTATSAI,c.setSelection(this.getName()),c.setAction("set_small_step"),c.setInput(b.attr("data-ctat-small-tick-step")),a.push(c));b.attr("data-ctat-denominator")&&(c=new CTATSAI,c.setSelection(this.getName()),c.setAction("set_denominator"),
c.setInput(b.attr("data-ctat-denominator")),a.push(c));return a};var J=-1<navigator.userAgent.toLowerCase().indexOf("firefox"),B=function(a,c){this.svgPoint=this.svgPoint?this.svgPoint:this.component.createSVGPoint();this.svgPoint.x=a;this.svgPoint.y=c;var b=this._axis_line_group.getScreenCTM().inverse();this.svgPoint=this.svgPoint.matrixTransform(b);b=new DOMPoint(this.svgPoint.x,this.svgPoint.y);if(J){var d=$(this.component),f=parseInt(d.css("borderLeftWidth"))+parseInt(d.css("paddingLeft"))+parseInt(d.css("marginLeft")),
d=parseInt(d.css("borderTopWidth"))+parseInt(d.css("paddingTop"))+parseInt(d.css("marginTop"));b.x-=f;b.y-=d}return b}.bind(this),D=function(a,c){return this.getProjectedPoint(B(a,c))}.bind(this.X_Axis),H=function(a,c){for(var b=D(a,c),d=null,f=Number.POSITIVE_INFINITY,e,g,h=0;h<this._tickmarks.length;h++)e=this._tickmarks[h],g=b.distance(e.location),g<f&&(d=e,f=g);return d}.bind(this),E=function(){if(y&&!0===this.getEnabled()){if(x){var a=H(A.x,A.y);u.setAttributeNS(null,"transform","translate"+
CTAT.Geom.Point.to2DString(a.location,!0))}else u.setAttributeNS(null,"transform","translate"+CTAT.Geom.Point.to2DString(D(A.x,A.y),!0));v=requestAnimationFrame(E)}}.bind(this);this.render=function(){q()};this.calcXCoordinate=function(a){a=new c(a);var b=this.getWidth()-30,b=Math.abs(b-30),d=max.subtract(min);return 30+a.subtract(min).divide(d)/b};this.calcNum=function(a){var c=this.getWidth()-30,c=Math.abs(c-30);a=max.subtract(min).multiply((a-30)/c);return min.add(a)};var w=function(a,c){switch(c.getClassName()){case "CTATMessage":c=
c.getSAI()}var b=c.clone();b.setAction(a.getSAI().getAction());b.setSelection(a.getName());return b};this.showCorrect=function(a){a.getInput();var c=a.getAction(),b=function(c){c.setCorrect(w(c,a))};switch(c){case "AddPoint":0<this._point_group.children.length&&(c=[].slice.call(this._point_group.children),b=c[c.length-1],b.classList.remove("CTAT--incorrect"),b.classList.remove("CTAT--hint"),b.classList.add("CTAT--correct"),this.getDisableOnCorrect()&&(c.length>=this.Max_Points&&c.every(function(a){return a.classList.contains("CTAT--correct")})?
this.setEnabled(!1):this.setEnabled(!0)));break;case "Points":c=this._point_group.children;for(b=0;b<c.length;b++){var d=c[b];d.classList.remove("CTAT--incorrect");d.classList.remove("CTAT--hint");d.classList.add("CTAT--correct")}break;case "set_minimum":V(X()).forEach(b);break;case "set_maximum":V(N()).forEach(b);break;case "set_large_step":V(F()).forEach(b);break;case "set_small_step":V(Q()).forEach(b);break;case "set_denominator":V(T()).forEach(b);break;default:console.log("Unhandled Action in",
this.getName(),c)}};this.showInCorrect=function(a){a.getInput();var c=a.getAction(),b=function(c){c.setIncorrect(w(c,a))};switch(c){case "AddPoint":0<this._point_group.children.length&&(c=[].slice.call(this._point_group.children),c=c[c.length-1],c.classList.remove("CTAT--correct"),c.classList.remove("CTAT--hint"),c.classList.add("CTAT--incorrect"));break;case "Points":c=this._point_group.children;for(b=0;b<c.length;b++){var d=c[b];d.classList.remove("CTAT--correct");d.classList.remove("CTAT--hint");
d.classList.add("CTAT--incorrect")}break;case "set_minimum":V(X()).forEach(b);break;case "set_maximum":V(N()).forEach(b);break;case "set_large_step":V(F()).forEach(b);break;case "set_small_step":V(Q()).forEach(b);break;case "set_denominator":V(T()).forEach(b);break;default:console.log("Unhandled Action in",this.getName(),c)}};var z=this.setEnabled;this.setEnabled=function(a){z(a);u&&y&&(u.style.visibility=this.getEnabled()?null:"hidden")};this.set_minimum=function(a){this.Minimum=a;this.render()};
this.change_minimum=function(a){a=new c(a);0!==a.valueOf()&&(this.Minimum=this.Minimum.add(a),this.render())};var K=function(){this.setActionInput("set_minimum",this.Minimum)}.bind(this);this.set_maximum=function(a){this.Maximum=a;this.render()};this.change_maximum=function(a){a=new c(a);0!==a.valueOf()&&(this.Maximum=this.Maximum.add(a),this.render())};var M=function(){this.setActionInput("set_maximum",this.Maximum)}.bind(this);this.set_max_user_entries=function(a){this.setMaxPoints(parseInt(a))};
a=function(a,c){a.setStep(c);this.render()};this.set_large_step=a.bind(this,h);var L=function(){this.setActionInput("set_large_step",h.step.toString())}.bind(this);this.set_small_step=a.bind(this,m);var G=function(){this.setActionInput("set_small_step",m.step.toString())}.bind(this);this.set_denominator=function(a){0===parseInt(a)?l.setStep(0):l.setStep((new c(a)).reciprocal());this.render()};var U=function(){var a=0===l.step.valueOf()?0:l.step.reciprocal();this.setActionInput("set_denominator",a.toString())}.bind(this);
a=function(a,b){if(0!==(new c(b)).valueOf()){var d=a.step.add(b);0>d.valueOf()&&d.set(0,1);a.setStep(d);this.render()}};this.change_large_step=a.bind(this,h);this.change_small_step=a.bind(this,m);this.change_denominator=function(a){a=new c(a);0!==a.valueOf()&&(a=a.add(l.step.denominator),l.setStep(a.reciprocal()),this.render())};var P=void 0;this.set_precision=function(a){P=parseInt(a);this.render()};this.AddPoint=function(a,b){var d=new c(a),e=this.X_Axis.getPosition(d),g=document.createElementNS(f,
"circle");g.classList.add("CTATNumberLine--point");g.setAttributeNS(null,"cx",e.x);g.setAttributeNS(null,"cy",e.y);g.setAttributeNS(null,"r",p);g.value=d;[].slice.call(this._point_group.children).some(function(a){return d.equals(a.value)})||this._point_group.appendChild(g)};this.Points=function(a,c){this._point_group.innerHTML="";var b=a.split(";"),d;for(d in b)this.AddPoint(b[d],c)};var S=function(a,c,b,d){switch(d.getAction()){case "ButtonPressed":a.call(this,d.getInput());break;case "Update":case "UpdateTextField":case "UpdateTextArea":c.call(this,
d.getInput())}b.call();this.processAction(!1,!0)};a=function(a){return(a=$(this.getDivWrap()).attr(a))?a.split(/\s*;\s*/).map(function(a){return a.trim()}):[]};var N=a.bind(this,"data-ctat-ctrl-max"),X=a.bind(this,"data-ctat-ctrl-min"),F=a.bind(this,"data-ctat-ctrl-large-tick"),Q=a.bind(this,"data-ctat-ctrl-small-tick"),T=a.bind(this,"data-ctat-ctrl-denominator"),V=function(a){return a.map(function(a){return $("#"+a).data("CTATComponent")})},Y=function(a){var c=null;if(a instanceof CTAT.Component.Base.Tutorable)a!=
this&&(c=a.getName());else if(a instanceof CTATSAI)a.getSelection()!=pointer.getName()&&(c=a.getSelection());else if(a instanceof String)a!=pointer.getName()&&(c=a);else if(a instanceof Element)a!=pointer.getComponent()&&(c=a.id);else return null;if(c){if(R(c))return S.bind(this,this.change_denominator,this.set_denominator,U);if(Z(c))return S.bind(this,this.change_small_step,this.set_small_step,G);if(W(c))return S.bind(this,this.change_large_step,this.set_large_step,L);if(ba(c))return S.bind(this,
this.change_minimum,this.set_minimum,K);if(O(c))return S.bind(this,this.change_maximum,this.set_maximum,M)}return null}.bind(this);CTATConfiguration.get("previewMode")||document.addEventListener(CTAT.Component.Base.Tutorable.EventType.action,function(a){var c=a.detail.sai;a=Y(a.detail.component);c&&null!==a&&a(c)},!1);this.setMaxControllers=function(a){$(this.getDivWrap()).attr("data-ctat-ctrl-max",a)};this.setParameterHandler("MaxValueControllers",this.setMaxControllers);this.setMinControllers=function(a){$(this.getDivWrap()).attr("data-ctat-ctrl-min",
a)};this.setParameterHandler("MinValueControllers",this.setMinControllers);this.setLargeTickControllers=function(a){$(this.getDivWrap()).attr("data-ctat-ctrl-large-tick",a)};this.setParameterHandler("LargeTickmarkControllers",this.setLargeTickControllers);this.setSmallTickControllers=function(a){$(this.getDivWrap()).attr("data-ctat-ctrl-small-tick",a)};this.setParameterHandler("SmallTickmarkControllers",this.setSmallTickControllers);this.setDenominatorControllers=function(a){$(this.getDivWrap()).attr("data-ctat-ctrl-denominator",
a)};this.setParameterHandler("DenominatorTickmarkControllers",this.setDenominatorControllers);a=function(a,c){return 0<=a().indexOf(c)};var O=a.bind(null,N),ba=a.bind(null,X),W=a.bind(null,F),Z=a.bind(null,Q),R=a.bind(null,T);this.grade=function(a){a=a.getDivWrap().id;O(a)?(this.setAction("set_maximum"),this.setInput(this.Maximum.toString())):ba(a)?(this.setAction("set_minimum"),this.setInput(this.Minimum.toString())):W(a)?(this.setAction("set_large_step"),this.setInput(h.step.toString())):Z(a)?(this.setAction("set_small_step"),
this.setInput(m.step.toString())):R(a)?(this.setAction("set_denominator"),this.setInput(l.step.reciprocal().toString())):this.updateSAI();this.processAction(!0)};this.updateSAI=function(){for(var a=this._point_group.children,c=[],b=0;b<a.length;b++)c.push(a[b].value);c.sort(function(a,c){return a-c});this.setActionInput("Points",c.join(";"))}};CTATNumberLine.prototype=Object.create(CTAT.Component.Base.SVG.prototype);CTATNumberLine.prototype.constructor=CTATNumberLine;
CTAT.ComponentRegistry.addComponentType("CTATNumberLine",CTATNumberLine);var CTATNumericStepper=function(a,b,d,e,g){CTAT.Component.Base.Tutorable.call(this,"CTATNumericStepper","__undefined__",a,b,d,e,g);this.setAction("Update");var c=document.createElement("input");c.type="number";this.set_maximum=function(a){a=Number(a);isNaN(a)||(c.max=a)};this.setParameterHandler("maximum",this.set_maximum);this.set_minimum=function(a){a=Number(a);isNaN(a)||(c.min=a)};this.setParameterHandler("minimum",this.set_minimum);this.set_step=function(a){a=Number(a);isNaN(a)||(c.step=a)};this.setParameterHandler("stepSize",
this.set_step);this.update_value=function(a){a=Number(a);isNaN(a)||(c.value=a,this.setInput(a))};this.setParameterHandler("value",this.update_value);this.updateSAI=function(){this.setInput(c.value)};this.Update=this.update_value;this.init=function(){c.id=this.getName()+"_spinner";this.setComponent(c);this.setInitialized(!0);var a=$(this.getDivWrap()),b=$(c);"autofocus defaultValue placeholder value max min readOnly step".split(" ").forEach(function(c){var d=a.attr(c);d&&b.attr(c,d)});CTATConfiguration.get("previewMode")||
(this.getDivWrap().innerHTML="");this.getDivWrap().appendChild(c);this.component.addEventListener("focus",this.processFocus);var d=this;c.addEventListener("change",function(a){var c=Number(this.min);isNaN(c)&&(c=0);a=Number(this.value);if(isNaN(a))this.value=c;else if(""!==this.min&&a<c)this.value=c;else if(""!==this.max&&!isNaN(Number(this.max))&&a>Number(this.max))this.value=this.max;else{var b=Number(this.step);if(isNaN(b)||0>=b)b=1;c=(a-c)%b;0!==c&&(this.value=a-c)}d.updateSAI();d.processAction();
return!1});CTATConfiguration.get("previewMode")&&this.addEventScreen(!1)};this.getConfigurationActions=function(){var a=[],c,b=$(this.getDivWrap());b.attr("min")&&(c=new CTATSAI,c.setSelection(this.getName()),c.setAction("set_minimum"),c.setInput(b.attr("min")),a.push(c));b.attr("max")&&(c=new CTATSAI,c.setSelection(this.getName()),c.setAction("set_maximum"),c.setInput(b.attr("max")),a.push(c));b.attr("step")&&(c=new CTATSAI,c.setSelection(this.getName()),c.setAction("set_step"),c.setInput(b.attr("step")),
a.push(c));b.attr("value")&&(c=new CTATSAI,c.setSelection(this.getName()),c.setAction("Update"),c.setInput(b.attr("value")),a.push(c));return a}};CTATNumericStepper.prototype=Object.create(CTAT.Component.Base.Tutorable.prototype);CTATNumericStepper.prototype.constructor=CTATNumericStepper;CTAT.ComponentRegistry.addComponentType("CTATNumericStepper",CTATNumericStepper);var CTATPieChart=function(a,b,d,e,g){CTAT.Component.Base.UnitDisplay.call(this,"CTATPieChart","aPieChart",a,b,d,e,g);var c=3,f=3,h=this,m,l,n,p=null,x=CTATGlobals.NameSpace.svg;this.init=function(){this.initSVG();this.baseGroup=document.createElementNS(x,"g");this.getComponent().appendChild(this.baseGroup);this.getComponent().classList.add("CTATPieChart--container");m=document.createElementNS(x,"filter");m.id=this.genName("Shadow");l="#"+m.id;n="url("+l+")";m.setAttributeNS(null,"width","200%");m.setAttributeNS(null,
"height","200%");p=document.createElementNS(x,"feOffset");p.setAttributeNS(null,"in","SourceAlpha");p.setAttributeNS(null,"result","offOut");p.setAttributeNS(null,"dx",f);p.setAttributeNS(null,"dy",f);m.appendChild(p);var a=document.createElementNS(x,"feGaussianBlur");a.setAttributeNS(null,"in","offOut");a.setAttributeNS(null,"result","blurOut");a.setAttributeNS(null,"stdDeviation",4);m.appendChild(a);a=document.createElementNS(x,"feBlend");a.setAttributeNS(null,"in","SourceGraphic");a.setAttributeNS(null,
"in2","blurOut");a.setAttributeNS(null,"mode","normal");m.appendChild(a);this.getComponent().getElementsByTagName("defs")[0].appendChild(m);0<f&&this.baseGroup.setAttributeNS(null,"filter",n);this.drawPieces();this.addComponentReference(this,this.getDivWrap());this.component.addEventListener("focus",this.processFocus)};this.render=function(){this.drawPieces()};this.drawPieces=function(){if(this.baseGroup){this.clear();var a=window.getComputedStyle(this.getComponent()),a=parseFloat(a.getPropertyValue("stroke-width")),
b=this.getBoundingBox(),d=Math.min(b.width/2,b.height/2)-(a+f+4),e=new DOMPoint(b.width/2,b.height/2),a=this.parseValue(),g=document.createDocumentFragment();a.reduce(function(a,b,f,l){if(1<=b.valueOf())f=document.createElementNS(x,"circle"),f.classList.add("CTATPieChart--piece"),f.cx.baseVal.value=e.x,f.cy.baseVal.value=e.y,f.r.baseVal.value=d,this.addPieceElem(f,b,b.selected),g.appendChild(f);else{f=document.createElementNS(x,"path");f.classList.add("CTATPieChart--piece");g.appendChild(f);window.getComputedStyle(f);
var m=2*Math.PI*a.valueOf();l=e.add(CTAT.Geom.Point.polar(d,m));b.reduce();var q=e.add(CTAT.Geom.Point.polar(d,2*Math.PI*b.valueOf()+m)),n=e.clone();if(0<c&&c<d){m=CTAT.Geom.Point.polar(c,m+Math.PI*b.valueOf());n=n.add(m);l=l.add(m);var v=function(a,c,b){return a.distance(c)<a.distance(b)?c:b};l=CTAT.Geom.Point.circle_intersection(n,l,e,d).reduce(v.bind(this,l));q=q.add(m);q=CTAT.Geom.Point.circle_intersection(n,q,e,d).reduce(v.bind(this,q))}m=CTAT.Geom.Point.to2DString;n="M "+m(n);v=new DOMPoint(d,
d);n+=" L "+m(l);n+=" A "+m(v)+" 0 "+(.5<b.valueOf()?1:0)+",1 "+m(q);f.setAttributeNS(null,"d",n+" Z");h.addPieceElem(f,b,b.selected)}return a.add(b)},new CTAT.Math.Fraction);this.baseGroup.innerHTML="";this.baseGroup.appendChild(g)}};this.getExplode=function(){return c};this.getDropShadowDistance=function(){return f};this.setExplode=function(a){a=Number(a);if(!isNaN(a)){var b=a!==c;c=a;b&&this.drawPieces()}return this};this.setStyleHandler("explode",this.setExplode);this.data_ctat_handlers.explode=
function(a){this.setExplode(a)};this.setDropShadowDistance=function(a){f=parseInt(a);f=isNaN(f)?0:f;p&&(p.setAttributeNS(null,"dx",f),p.setAttributeNS(null,"dy",f),0>=f&&this.baseGroup?this.baseGroup.removeAttributeNS(null,"filter"):this.baseGroup.hasAttributeNS(null,"filter")||this.baseGroup.setAttributeNS(null,"filter",n))};this.data_ctat_handlers["shadow-distance"]=function(a){this.setDropShadowDistance(a)}};CTATPieChart.prototype=Object.create(CTAT.Component.Base.UnitDisplay.prototype);
CTATPieChart.prototype.constructor=CTATPieChart;CTAT.ComponentRegistry.addComponentType("CTATPieChart",CTATPieChart);var CTATRadioButton=function(a,b,d,e,g){CTAT.Component.Base.Clickable.call(this,"CTATRadioButton","__undefined__",a,b,d,e,g);var c=CTATConfiguration.get("previewMode"),f=this,h=null,m=null,l="#000000";this.setSelection(this.getComponentGroup());this.setAction("UpdateRadioButton");this.setStyleHandler("BackgroundColor",null);this.init=function(){f.setInitialized(!0);h=document.createElement("input");h.type="radio";h.id=this.getName()+"_radio";h.value=f.getName();this.getComponentGroup()?h.name=f.getComponentGroup():
this.getDivWrap()&&$(this.getDivWrap()).attr("name")?h.name=$(this.getDivWrap()).attr("name"):h.name="radioButtonGroup";!0===f.getEnabled()?h.disabled=!1:h.disabled=!0;f.addComponentReference(f,h);var a;c||(a=this.getDivWrap().innerHTML,this.getDivWrap().innerHTML="");f.getDivWrap().appendChild(h);m=document.createElement("label");m.htmlFor=h.id;this.getText()?m.textContent=f.getText():a&&!c?m.innerHTML=a:this.getDivWrap().getAttribute("data-ctat-label")&&(m.textContent=this.getDivWrap().getAttribute("data-ctat-label"));
f.setComponent(h);this.getDivWrap().appendChild(m);h.addEventListener("click",function(a){f.updateSAI();f.processAction()});h.addEventListener("focus",this.processFocus);h.onfocus=this.processOnFocus;this.setSelection(this.getComponentGroup());this.component.addEventListener("focus",this.processFocus)};this.getConfigurationActions=function(){var a=[];if(0<m.innerHTML.trim().length){var c=new CTATSAI;c.setSelection(this.getName());c.setInput(m.innerHTML.toString());c.setAction("setText");a.push(c)}return a};
this.setFontColor=function(a){l=a;$(m).css("color",a)};this.getFontColor=function(){return l};this.resize=function(){var a=$(this.getDivWrap()).height();$(m).css("font-size",a-5+"px");$(this.getComponent()).css("height",a-10+"px");$(this.getComponent()).css("width",a-10+"px")};var n=this.setText;this.setText=function(a){n(a);null!==m&&(m.innerHTML=this.getText())};this.setStyleHandler("buttonLabel",this.setText);var p=this.setEnabled;this.setEnabled=function(a){p(a);null!==h&&(h.disabled=!this.getEnabled())};
this.setChecked=function(a){null!==h&&(h.checked=a)};this.getChecked=function(){return h.checked};this.getRadioInput=function(){return h.checked?h.value+": "+m.textContent:""};this.setStyleHandler("labelPlacement",null);this.reset=function(){f.ctatdebug(" reset ( "+f.getName()+")");h.checked=!1;f.setEnabled(!0)};this.UpdateRadioButton=function(a){0<=a.indexOf(h.value)&&f.setChecked(!0);f.ctatdebug("UpdateRadioButton ()")};this.updateSAI=function(){var a=$('div[data-ctat-component]:has(input[type="radio"][name="'+
h.name+'"]:checked)'),c="";1===a.length&&(c=$(a[0]).data("CTATComponent").getRadioInput());f.setSelection(h.name);f.setInput(c)};var x=function(a){m&&m.classList.add(a);h&&h.classList.add(a)},q=function(a){m&&m.classList.remove(a);h&&h.classList.remove(a)};this.showCorrect=function(a){q("CTAT--hint");q("CTAT--incorrect");(a?0===a.getInput().indexOf(h.value):1)?x("CTAT--correct"):q("CTAT-correct")};this.removeCorrect=function(){q("CTAT--correct")};this.showInCorrect=function(a){q("CTAT--hint");q("CTAT--correct");
(a?0===a.getInput().indexOf(h.value):1)?x("CTAT--incorrect"):q("CTAT-incorrect")};this.removeInCorrect=q.bind(this,"CTAT--incorrect");this.showHintHighlight=function(a){this.removeCorrect();this.removeInCorrect();a?x("CTAT--hint"):q("CTAT--hint")}};CTATRadioButton.prototype=Object.create(CTAT.Component.Base.Clickable.prototype);CTATRadioButton.prototype.constructor=CTATRadioButton;CTAT.ComponentRegistry.addComponentType("CTATRadioButton",CTATRadioButton);var CTATScrollPaneComponent=function(a,b,d,e,g){CTAT.Component.Base.Tutorable.call(this,"CTATScrollPaneComponent","__undefined__",a,b,d,e,g);var c=0,f=this;f.isTabIndexable=!1;this.getAlpha=function(){return c};this.setAlpha=function(a){c=a};this.init=function(){f.ctatdebug("init ("+f.getName()+")");f.ctatdebug("Final location: "+f.getX()+","+f.getY()+" with text: "+f.getText());f.setInitialized(!0)};this.processCommShellEvent=function(a,c){f.ctatdebug("processCommShellEvent ("+a+")")};this.processSerialization=
function(){f.ctatdebug("processSerialization()")};this.postProcess=function(){f.ctatdebug("postProcess ()");for(var a in this.parameters){var c=this.parameters[a];f.ctatdebug("Checking style name: "+a);if("TargetMovieClip"==a)if(f.ctatdebug("Loading sub element: ["+c.trim()+"] ..."),c=findMovieClip(c.trim()),null!==c){if(f.ctatdebug("Found target movieclip, temporarily removing ..."),null!==c.getDivWrapper().parentNode){try{c.getDivWrapper().parentNode.removeChild(c.getDivWrapper())}catch(p){CTATScrim.scrim.errorScrimUp(p.message);
return}f.getDivWrap().setAttribute("id","scrollsubdiv");f.ctatdebug("Adding ...");f.getDivWrap().appendChild(c.getDivWrapper());var b=c.getDivWrapper().style.left,d=c.getDivWrapper().style.top;c.getDivWrapper().style.left="0px";c.getDivWrapper().style.top="0px";f.ctatdebug("Moving canvas from: "+b+","+d+" to: 0,0");c=c.getDivWrapper().childNodes;for(b=0;b<c.length;b++);}}else f.ctatdebug("Unable to find the target movieclip to reparent the content from")}f.ctatdebug("Final location: "+f.getX()+","+
f.getY()+" with text: "+f.getText());null===CTATCommShell.commShell||void 0===CTATCommShell.commShell?f.ctatdebug("Error: can't add event listener to commshell, pointer is invalid"):CTATCommShell.commShell.addGlobalEventListener(this)};this.configFromDescription()};CTATScrollPaneComponent.prototype=Object.create(CTAT.Component.Base.Tutorable.prototype);CTATScrollPaneComponent.prototype.constructor=CTATScrollPaneComponent;CTAT.ComponentRegistry.addComponentType("CTATScrollPaneComponent",CTATScrollPaneComponent);var CTATSkillWindow=function(a,b,d,e,g){CTAT.Component.Base.Graphical.call(this,"CTATSkillWindow","__undefined__",a,b,d,e,g);var c=this;c.isTabIndexable=!1;this.getThreshold=function(){var a=parseFloat($(this.getDivWrap()).attr("data-ctat-threshold"));return isNaN(a)?.95:a};this.setThreshold=function(a){$(this.getDivWrap()).attr("data-ctat-threshold",a)};var f=null;this.init=function(){c.ctatdebug("init ("+c.getName()+")");c.setIsAbstractComponent(!0);c.setInitialized(!0);f=this.getDivWrap();this.setComponent(f);
this.drawComponent();this.component.addEventListener("focus",this.processFocus)};this.assignSkillSet=function(a){CTATSkillSet.skills=a;this.drawComponent()};this.updateSkillSet=function(a){if(CTATSkillSet.skills){c.ctatdebug("updateSkillSet ("+a.getSkillSet().length+")");a=a.getSkillSet();for(var b=0;b<a.length;b++){var d=a[b];c.ctatdebug("Updating skill "+d.getSkillName()+" to level: "+d.getLevel()+" ...");CTATSkillSet.skills.setSkillLevel(d.getSkillName(),d.getLevel(),1)}this.drawComponent()}else c.ctatdebug("Error: updateSkillSet () no initial skill set given, can't update")};
this.drawComponent=function(){c.ctatdebug("drawComponent ()");if(null===CTATSkillSet.skills)ctatdebug("Info: no skillSet object available, bumping out");else{var a=CTATSkillSet.skills.getSkillSet();if(null===a)c.ctatdebug("Error: list of skills is null in skills object");else if(0>=a.length)c.ctatdebug("Error: list of skills is 0 length");else{for(var b=document.createDocumentFragment(),d=this.getThreshold(),e=0;e<a.length;e++){var g=a[e];c.ctatdebug("Drawing skill "+e+" "+g.getDisplayName()+" level: "+
g.getLevel()+" ...");var x=document.createElement("div");x.classList.add("CTATSkillWindow--skill");var q=document.createElement("div");q.classList.add("CTATSkillWindow--bar");var v=document.createElement("div"),u=g.getLevel();u<d?v.classList.add("CTATSkillWindow--bar--nonmastered"):v.classList.add("CTATSkillWindow--bar--mastery");v.style.width=u>d?"100%":100*u+"%";q.appendChild(v);x.appendChild(q);b.appendChild(x);q=document.createElement("div");q.textContent=g.getDisplayName()||"no-name";q.classList.add("CTATSkillWindow--label");
x.appendChild(q)}f.innerHTML="";f.appendChild(b)}}}};CTATSkillWindow.prototype=Object.create(CTAT.Component.Base.Graphical.prototype);CTATSkillWindow.prototype.constructor=CTATSkillWindow;CTAT.ComponentRegistry.addComponentType("CTATSkillWindow",CTATSkillWindow);var CTATSubmitButton=function(a,b,d,e,g){CTATButton.call(this,a,b,d,e,g);this.setClassName("CTATSubmitButton");CTATConfiguration.get("previewMode");var c=this;this.setParameterHandler("target_components",function(a){this.getDivWrap().setAttribute("data-ctat-target",a);return this});var f=this.init;this.init=function(){f();this.setParameter("tutorComponent",CTAT.Component.Base.Tutorable.Options.DO_NOT_TUTOR);this.component.addEventListener("focus",this.processFocus)};var h=function(a){var b=c.getTargets();
return 0===Object.keys(b).length?!1:a===c?!1:a instanceof CTAT.Component.Base.Tutorable?b.hasOwnProperty(a.getName())||b.hasOwnProperty(a.getComponentGroup()):a instanceof CTATSAI?a.getSelection()!=c.getName()&&b.hasOwnProperty(a.getSelection()):a instanceof String?a!=c.getName()&&b.hasOwnProperty(a):a instanceof Element?a!=c.getComponent()&&(b.hasOwnProperty(a.id)||b.hasOwnProperty(a.getAttribute("name"))):!1};a=CTAT.Component.Base.Tutorable.EventType;document.addEventListener(a.correct,function(a){a.detail.sai&&
h(a.detail.component)&&c.isNotGraded()&&c.setCorrect()},!1);document.addEventListener(a.incorrect,function(a){a.detail.sai&&h(a.detail.component)&&(c.setIncorrect(),c.setEnabled(!0))},!1);document.addEventListener(a.ungrade,function(a){(a=a.detail.component)&&h(a)&&c.setNotGraded()},!1);document.addEventListener(a.highlight,function(a){var b=a.detail.component;b&&h(b)&&c.setHintHighlight(a.detail.isHighlighted)},!1);this.getTargets=function(){var a={},c=this.getDivWrap().getAttribute("data-ctat-target");
c&&String(c).split(/\s*[;,]\s*/).forEach(function(c){return a[c.trim()]=1});return a};this.processClick=function(a){if(!0===c.getEnabled()){a=c.getTargets();for(var b in a)a=CTATShellTools.findComponent(b),null!==a&&0<a.length&&(a=a[0],a instanceof CTAT.Component.Base.Tutorable?a.getEnabled()&&a.grade(c):c.ctatdebug("Invalid target component: "+a))}}};CTATSubmitButton.prototype=Object.create(CTATButtonBasedComponent.prototype);CTATSubmitButton.prototype.constructor=CTATSubmitButton;
CTAT.ComponentRegistry.addComponentType("CTATSubmitButton",CTATSubmitButton);var CTATTextBasedComponent=function(a,b,d,e,g,c,f){CTAT.Component.Base.Tutorable.call(this,a,b,d,e,g,c,f);var h=this,m="",l="#000000",n=16,p=!0,x=255,q=!0;this.setAction("UpdateTextField");this.backgrade=!0;this.setFontColor=function(a){l=a;$(h.getComponent()).css("color",a)};this.getFontColor=function(){return l};this.setFontSize=function(a){a.includes("px")||(a+="px");n=a;$(h.getComponent()).css("font-size",a)};this.getFontSize=function(){return n};this.assignText=function(a){m=a;this.setInput(a)};
this.UpdateTextArea=this.UpdateTextField=function(a){this.setText(a)};this.setTabOnEnter=function(a){p=CTATGlobalFunctions.toBoolean(a)};this.setStyleHandler("TabOnEnter",this.setTabOnEnter);this.data_ctat_handlers["tab-on-enter"]=this.setTabOnEnter;this.assignEditable=function(a){q=a};this.setMaxCharacters=function(a){x=a};this.setStyleHandler("MaxCharacters",this.setMaxCharacters);this.getText=function(){return m};this.getEditable=function(){return q};this.getTabOnEnter=function(){return p};this.getMaxCharacters=
function(){return x};this.setEditable=function(a){h.assignEditable(CTATGlobalFunctions.toBoolean(a));null!==h.getComponent()&&(!0===h.getEditable()?h.getComponent().contentEditable="true":h.getComponent().contentEditable="false")};this.setStyleHandler("Enabled",this.setEditable);this.setEnabled=function(a){h.assignEnabled(a);null!==h.getComponent()&&(h.getComponent().disabled=!a,this.setEditable(a))};var v=this.processAction.bind(this);this.processAction=function(a,c){h.ctatdebug("processAction ()");
this.updateSAI();CTATGlobalFunctions.isBlank(this.getValue())||v(a,c)};this.processKeypress=function(a){h.ctatdebug("processKeypress ()");var c=a.target.getAttribute("id");h.ctatdebug(c);var b=h.getComponentFromID(c);if(null===b)h.ctatdebug("Error: component reference is null");else switch(h.ctatdebug(b.getName()+" keydown ("+("google"==CTATConfig.platform?0:window.event?window.event.keyCode:a.which)+" -> "+a.eventPhase+") ID: "+c),a.which){case 37:h.ctatdebug("left arrow key pressed!");break;case 39:h.ctatdebug("right arrow key pressed!");
break;case 13:return p?(h.component.blur(),CTATGlobals.Tab.Focus=null,h.processAction(),!1):!0;case 0:h.component.blur();CTATGlobals.Tab.Focus=null;h.processAction();break;default:h.ctatdebug('Key pressed! "'+a.which+'"')}};this.updateSAI=function(){h.ctatdebug("updateSAI ()");this.setInput(this.getValue());var a=this.getSAI();h.ctatdebug("SAI: "+a.toTSxmlString())}};CTATTextBasedComponent.prototype=Object.create(CTAT.Component.Base.Tutorable.prototype);
CTATTextBasedComponent.prototype.constructor=CTATTextBasedComponent;var CTATTextArea=function(a,b,d,e,g){CTATTextBasedComponent.call(this,"CTATTextArea","__undefined__",a,b,d,e,g);this.setDefaultWidth(100);this.setDefaultHeight(44);var c=this,f=null,h=null,m=CTATConfiguration.get("previewMode");this.setAction("UpdateTextArea");this.init=function(b){f=document.createElement("textarea");a&&(f.name=a.name);f.setAttribute("id",CTATGlobalFunctions.gensym.div_id());(b=this.getDivWrap())&&$(b).attr("maxlength")&&(f.maxlength=$(b).attr("maxlength"));b&&$(b).attr("rows")&&
(f.rows=$(b).attr("rows"));b&&$(b).attr("cols")&&(f.cols=$(b).attr("cols"));c.setComponent(f);b&&$(b).attr("value")?this.setText($(b).attr("value")):f.value=this.getText();c.setInitialized(!0);c.addComponentReference(c,f);b.appendChild(f);$(f).keypress(c.processKeypress);f.addEventListener("focus",c.processFocus);$(f).on("input",function(a){c.setNotGraded()});m&&this.addEventScreen(!1)};this.processBlur=function(a){c.processAction()};this.setCellContainer=function(a){h=a};this.getCellContainer=function(){return h};
this.setText=function(a){c.ctatdebug("setText ("+a+")");c.assignText(a);f.value=a};this.getValue=function(){return f.value};this.reset=function(){c.configFromDescription();c.processSerialization();f.value=""}};CTATTextArea.prototype=Object.create(CTATTextBasedComponent.prototype);CTATTextArea.prototype.constructor=CTATTextArea;CTAT.ComponentRegistry.addComponentType("CTATTextArea",CTATTextArea);var CTATTable=function(a,b,d,e,g){CTAT.Component.Base.Tutorable.call(this,"CTATTable","__undefined__",a,b,d,e,g);var c=this,f=[],h=[],m=0;this.get_first_row_is_header=function(){return CTATGlobalFunctions.toBoolean($(this.getDivWrap()).attr("data-ctat-has-header"))};this.set_first_row_is_header=function(a){$(this.getDivWrap()).attr("data-ctat-has-header",a);this.get_first_row_is_header()?(p(),m=1):(x(),m=0)};this.setParameterHandler("FirstRowIsHeader",this.set_first_row_is_header);a=function(a){a=
parseInt($(this.getDivWrap()).attr(a));return isNaN(a)?2:a};var l=a.bind(this,"data-ctat-num-rows");this.get_row_count=l;this.set_row_count=function(a){$(this.getDivWrap()).attr("data-ctat-num-rows",a)};this.setNumRows=function(a){a=Number(a);if(!isNaN(a)){for(;this.get_row_count()<a;)this.addRow();for(;this.get_row_count()>a;)this.deleteRow()}};var n=a.bind(this,"data-ctat-num-cols");this.get_col_count=n;this.set_col_count=function(a){$(this.getDivWrap()).attr("data-ctat-num-cols",a)};this.setNumCols=
function(a){a=Number(a);if(!isNaN(a)){for(;this.get_col_count()<a;)this.addColumn();for(;this.get_col_count()>a;)this.deleteColumn()}};this.super_setName=this.setName;this.setName=function(a){this.super_setName(a);if(f&&f[0])for(var c=0;c<f.length;c++)for(var b=0;b<f[0].length;b++)f[c][b].setAttribute("id",a+".R"+c+"C"+b)};this.init=function(){c.ctatdebug("init ("+c.getName()+")");c.setInitialized(!0);var a=c.getDivWrap();c.setComponent(a);c.addComponentReference(c,a);c.render();c.ctatdebug("table name = "+
this.getName());this.adjustTableContents();this.get_first_row_is_header()?(p(),m=1):m=0};this.getConfigurationActions=function(){var a=[],c,b=$(this.getDivWrap());b.attr("data-ctat-num-rows")&&(c=new CTATSAI,c.setSelection(this.getName()),c.setAction("setNumRows"),c.setInput(b.attr("data-ctat-num-rows")),a.push(c));b.attr("data-ctat-num-cols")&&(c=new CTATSAI,c.setSelection(this.getName()),c.setAction("setNumCols"),c.setInput(b.attr("data-ctat-num-cols")),a.push(c));b.attr("data-ctat-has-header")&&
(c=new CTATSAI,c.setSelection(this.getName()),c.setAction("set_first_row_is_header"),c.setInput(b.attr("data-ctat-has-header")),a.push(c));return a};var p=function(){c.ctatdebug("fix_header()");h[0].classList.add("CTATTable--headers");for(var a=0;a<f[0].length;a++)f[0][a].classList.add("CTATTable--header")}.bind(this),x=function(){c.ctatdebug("remove_header()");h[0].classList.remove("CTATTable--headers");for(var a=0;a<f[0].length;a++)f[0][a].classList.remove("CTATTable--header")}.bind(this);this.fixHeader=
p;this.removeHeader=x;var q=function(a,c){var b=document.createElement("div"),d=this.getName()+".R"+a+"C"+c;b.id=d;b.classList.add("CTATTable--cell");b.classList.add("CTATTextArea");var e=new CTATTextArea;e.setName(d);e.setDivWrapper(b);(d=this.getTabIndex())&&e.setTabIndex(d);e.processAttributes();e.init(!0);e.processTabOrder();e.setEnabled(this.getEnabled());$(b).data("CTATComponent",e);return b}.bind(this);this.addRow=function(){var a=document.createElement("div");a.classList.add("CTATTable--row");
var c=l();parseInt(c,10);f[c]=[];for(var b=0;b<n();b++){var d=q(c,b);f[c].push(d);a.appendChild(d)}$(this.getDivWrap()).append(a);h.push(a);this.set_row_count(c+1)};this.deleteRow=function(){var a=this.getDivWrap();a.removeChild(a.lastChild);h.pop();f.pop();this.set_row_count(this.get_row_count()-1)};this.addColumn=function(){var a=n(),c=0;h.forEach(function(b){var d=q(c,a);f[c].push(d);c<m&&d.classList.add("CTATTable--header");b.appendChild(d);c++});this.set_col_count(a+1)};this.deleteColumn=function(){this.getDivWrap();
for(var a=h.length,c=0;c<a;c++)h[c].removeChild(h[c].lastChild),f[c].pop();this.set_col_count(this.get_col_count()-1)};this.adjustTableContents=function(){c.ctatdebug("adjustTableContents()");for(var a=l(),b=0;b<a;b++){var d=document.createElement("div");d.classList.add("CTATTable--row");$(this.getDivWrap()).append(d);h.push(d);for(var e=0;e<n();e++){var g=c.getName()+".R"+b+"C"+e,m=CTATShellTools.findComponent(g);m&&0!==m.length&&m[0].getName()===g?(g=m[0].getDivWrap(),g.classList.add("CTATTable--cell")):
g=q(b,e);d.appendChild(g);f[b]||(f[b]=[]);f[b].push(g)}}}};CTATTable.prototype=Object.create(CTAT.Component.Base.Graphical.prototype);CTATTable.prototype.constructor=CTATTable;CTAT.ComponentRegistry.addComponentType("CTATTable",CTATTable);var CTATTextField=function(a,b,d,e,g){CTATTextBasedComponent.call(this,"CTATTextBasedComponent","__undefined__",a,b,d,e,g);var c=this,f=null,h,m,l=null;this.setAction("UpdateTextArea");this.init=function(){f=this.getDivWrap();c.setComponent(f);this.getText()&&(f.innerHTML=c.getText());var a=f.getAttribute("data-ctat-selectable");a&&"true"==a.toLowerCase()&&n();c.setInitialized(!0);c.addComponentReference(c,f);c.setEditable(!1);c.setEnabled(!1);c.render();c.addSafeEventListener("focus",c.processFocus,
f)};var n=function(){[h,m].forEach(function(a,c){var b=document.createElement("span"),d=document.createElement("div"),e=0==c;b.className="marker";b.id=e?"start-marker":"end-marker";d.className="handle";b.appendChild(d);e?(d.className+=" start-handle",h=b):(d.className+=" end-handle",m=b);b.addEventListener("click",function(a){a.stopPropagation()});b.addEventListener("mouseup",function(a){a.stopPropagation()})});c.addSafeEventListener("mouseup",p,f)},p=function(a){a=null;c.clearSelectionMarkers();
if(window.getSelection){var b=window.getSelection();b.getRangeAt&&(a=b.getRangeAt(0))}else document.selection&&document.selection.createRange&&(a=document.selection.createRange());a&&!a.collapsed&&f.contains(a.startContainer)&&a.startContainer==a.endContainer&&(l=a.startOffset+","+a.endOffset,c.processAction(),c.setSelectionMarkers(a))};this.setSelectionMarkers=function(a){a.insertNode(h);a.collapse(!1);a.insertNode(m)};this.clearSelectionMarkers=function(){h.parentNode&&h.parentNode.removeChild(h);
m.parentNode&&m.parentNode.removeChild(m);f.normalize();l=null};this.getConfigurationActions=function(){return 0<f.innerHTML.trim().length?(console.log(f.innerHTML),this.setInput(f.innerHTML.toString()),[this.getSAI()]):[]};this.setText=function(a){c.ctatdebug("setText ("+a+")");c.assignText(a);null!==f&&(f.innerHTML=a)};this.getValue=function(){var a=this.getDivWrap().innerHTML;return l?l+";"+a:a};var x=this.updateSAI.bind(this);this.updateSAI=function(){l?c.setAction("TextSelected"):c.setAction("UpdateTextArea");
x()};this.setStyleHandler("ShowScrollbars",function(a){!0===CTATGlobalFunctions.toBoolean(a)?c.modifyCSSAttribute("overflow","scroll"):c.modifyCSSAttribute("overflow","hidden")})};CTATTextField.prototype=Object.create(CTATTextBasedComponent.prototype);CTATTextField.prototype.constructor=CTATTextField;CTAT.ComponentRegistry.addComponentType("CTATTextField",CTATTextField);var CTATTextInput=function(a,b,d,e,g){CTATTextBasedComponent.call(this,"CTATTextInput","__undefined__",a,b,d,e,g);var c=this,f=null,h=null,m=CTATConfiguration.get("previewMode");this.init=function(){this.ctatdebug("init ("+c.getName()+")");f=document.createElement("input");f.type="text";a&&(f.name=a.name);f.setAttribute("maxlength",c.getMaxCharacters());f.setAttribute("id",CTATGlobalFunctions.gensym.div_id());c.setComponent(f);this.ctatdebug("Final location: "+c.getX()+","+c.getY()+" with text: "+
c.getText());var b=$(this.getDivWrap());b.attr("value")&&this.setText(b.attr("value"));var d=$(f);"autofocus defaultValue maxLength pattern placeholder readOnly size title".split(" ").forEach(function(a){var c=b.attr(a);c&&d.attr(a,c)});c.setInitialized(!0);c.addComponentReference(c,f);c.getDivWrap().appendChild(f);c.addSafeEventListener("keypress",c.processKeypress,f);c.addSafeEventListener("focus",c.processFocus,f);$(f).on("input",function(a){c.setNotGraded()});m&&this.addEventScreen(!1)};this.getConfigurationActions=
function(){var a=[],c=$(this.getDivWrap());if(c.attr("value")){var b=new CTATSAI;b.setSelection(this.getName());b.setAction("UpdateTextField");b.setInput(c.attr("value"));a.push(b)}return a};this.setCellContainer=function(a){h=a};this.getCellContainer=function(){return h};this.setText=function(a){c.ctatdebug("setText ("+a+")");c.assignText(a);f.value=a};this.getValue=function(){return f.value};this.reset=function(){c.configFromDescription();c.processSerialization();f.value=""};this.setStyleHandler("DrawBorder",
null)};CTATTextInput.prototype=Object.create(CTATTextBasedComponent.prototype);CTATTextInput.prototype.constructor=CTATTextInput;CTAT.ComponentRegistry.addComponentType("CTATTextInput",CTATTextInput);var CTATVideo=function(a,b,d,e,g){CTAT.Component.Base.Tutorable.call(this,"CTATVideo","__undefined__",a,b,d,e,g);var c=0,f=this,h=null;this.getAlpha=function(){return c};this.setAlpha=function(a){c=a};this.ctatdebug(this.getClassName()+" ("+this.getX()+","+this.getY()+","+this.getWidth()+","+this.getHeight()+")");this.setTutorComponent(CTAT.Component.Base.Tutorable.Options.TutorComponent.DO_NOT_TUTOR);this.configFromDescription();this.init=function(){f.ctatdebug("init ("+f.getName()+")");f.addCSSAttribute("z-index",
CTATGlobalFunctions.gensym.z_index());h=document.createElement("video");this.getDivWrap()&&$(this.getDivWrap()).attr("src")&&!CTATConfiguration.get("previewMode")&&(h.src=$(this.getDivWrap()).attr("src"));this.getDivWrap()&&$(f.getDivWrap()).attr("data-ctat-controls")?h.controls=CTATGlobalFunctions.toBoolean($(this.getDivWrap()).attr("data-ctat-controls")):h.controls=!0;h.autocontrols=!1;f.ctatdebug("Auto play: "+$(f.getDivWrap()).attr("data-ctat-autoplay"));this.getDivWrap()&&$(f.getDivWrap()).attr("data-ctat-autoplay")?
h.autoplay=CTATGlobalFunctions.toBoolean($(this.getDivWrap()).attr("data-ctat-autoplay")):h.autoplay=!0;f.setComponent(h);h.name=f.getName();h.setAttribute("id",CTATGlobalFunctions.gensym.div_id());h.setAttribute("onkeypress","return noenter(event)");f.addComponentReference(f,h);f.ctatdebug("Final location: "+f.getX()+","+f.getY()+" with text: "+f.getText());f.setInitialized(!0);f.getDivWrap().appendChild(h);f.ctatdebug("Resizing component to: "+$(f.getDivWrap()).width()+","+$(f.getDivWrap()).height());
h.addEventListener("focus",this.processFocus);h.addEventListener("canplay",function(){f.ctatdebug("Video loaded and ready for play")},!0);h.addEventListener("play",function(){f.ctatdebug("Video loaded and ready for play");f.logVideoEvent("play")},!0);h.addEventListener("pause",function(){f.ctatdebug("Video loaded and ready for play");f.logVideoEvent("pause")},!0);f.sizeToDiv()};this.sizeToDiv=function(){h&&(h.setAttribute("width",$(f.getDivWrap()).width()),h.setAttribute("height",$(f.getDivWrap()).height()))};
var m=this.render;this.render=function(){m.call(this);this.sizeToDiv()};this.getConfigurationActions=function(){var a=[],c;$(f.getDivWrap()).attr("data-ctat-controls")&&(c=new CTATSAI,c.setSelection(this.getName()),c.setAction("showControls"),c.setInput($(f.getDivWrap()).attr("data-ctat-controls")),a.push(c));$(f.getDivWrap()).attr("data-ctat-autoplay")&&(c=new CTATSAI,c.setSelection(this.getName()),c.setAction("setAutoplay"),c.setInput($(f.getDivWrap()).attr("data-ctat-autoplay")),a.push(c));$(this.getDivWrap()).attr("src")&&
(c=new CTATSAI,c.setSelection(this.getName()),c.setAction("setURL"),c.setInput($(this.getDivWrap()).attr("src")),a.push(c));return a};this.logVideoEvent=function(a){f.ctatdebug("logVideoEvent ("+a+")");if(void 0!==h.duration)if(null!==CTATCommShell.commShell){a=new CTATSAI(f.getName(),a,f.toHHMMSS(h.currentTime)+".000","");a.addSelection(encodeURIComponent(h.currentSrc),"media_file");a.addSelection(f.toHHMMSS(h.duration)+".000","clip_length");var c=a.getInputObject();null!==c&&c.setType("time");CTATCommShell.commShell.processComponentAction(a,
f.getTutorComponent(),!0,f,"VIDEO_ACTION","USER")}else f.ctatdebug("Error: commShell is null, can't send untutored tool message");else f.ctatdebug("Error: audio file not loaded yet, can't obtain duration")};this.PlayMedia=function(a){h.src=a};this.showControls=function(a){a=CTATGlobalFunctions.toBoolean(a);$(f.getDivWrap()).attr("data-ctat-controls",a);h.controls=a};this.setAutoplay=function(a){a=CTATGlobalFunctions.toBoolean(a);$(f.getDivWrap()).attr("data-ctat-autoplay",a);h.autoplay=a};this.setURL=
function(a){$(this.getDivWrap()).attr("src",a);h.src=a};this.play=function(a){f.ctatdebug("play ()");var c="0";a&&(c="number"===typeof a?String(a):"string"===typeof a?a:"0");h.currentTime=c;h.play()};this.pause=function(a){f.ctatdebug("pause ()");h.pause();var c="0";a&&(c="number"===typeof a?String(a):"string"===typeof a?a:"0");h.currentTime=c};this.stop=function(){f.ctatdebug("stop ()");f.pause()}};CTATVideo.prototype=Object.create(CTAT.Component.Base.Tutorable.prototype);
CTATVideo.prototype.constructor=CTATVideo;CTAT.ComponentRegistry.addComponentType("CTATVideo",CTATVideo);var CTATAssistments={},assistmentsTimerVar,assistmentsJSONpreface='{ "version" : "AS.1", "action" : ';function iframeToParent(a){window.parent.postMessage(a,"https://test1.assistments.org")}function iframeLoaded(){iframeToParent(assistmentsJSONpreface+'"loaded" }');assistmentsTimerVar=window.setInterval("iframeHeartbeat()",1E4)}function iframeHeartbeat(){iframeToParent(assistmentsJSONpreface+'"heartbeat"}')}
function iframeCompleted(){var a=document.getElementById("MyScore").value;iframeToParent(assistmentsJSONpreface+'"completed", "answer" : "<b>Student worked hard on this problem.</b>","score" : '+a+" }");window.clearTimeout(assistmentsTimerVar)};var CTATEnabledInPreview={},ctatEnabledInPreview={CTATButton:!0,CTATComboBox:!0,CTATAudioButton:!0,CTATImageButton:!0,CTATSubmitButton:!0,CTATTextArea:!0,CTATTextInput:!0,CTATNumericStepper:!0,CTATTable:!0,CTATHintButton:!0,CTATDoneButton:!0};var CTATTutor={drawing:!1,onMobile:!1,tutorInitialized:!1,flashVars:null};Object.defineProperty(CTATTutor,"parser",{get:function(){this._parser||(CTATConfig.parserType_is_XML()?(ctatdebug("Creating XML parser ..."),this._parser=new CTATXML):CTATConfig.parserType_is_JSON()&&(this._parser=new CTATJSON));return this._parser}});
CTATTutor.initializeHTMLComponents=function(){for(var a in CTAT.ComponentRegistry){var b=CTAT.ComponentRegistry[a];$("."+a).each(function(){if(!$(this).data("CTATComponent")){var a=new b;$(this).attr("id")?a.setName($(this).attr("id")):(this.setAttribute("id",CTATGlobalFunctions.gensym.div_id()),a.setName(this.getAttribute("id")));a.setDivWrapper(this);a.processAttributes();a.init();a.processTabOrder();a.setEnabled(a.getEnabled());if(0==a.isFeedbackComponent()){var e=new CTATComponentDescription;
e.type=a.getClassName();e.name=a.getName();e.setComponentPointer(a);CTATShellTools.registerComponentDescription(e)}$(this).data("CTATComponent",a);if(CTATConfiguration.get("previewMode")){var e=a.getDivWrap().getAttribute("data-ctat-enabled"),g=ctatEnabledInPreview[a.getClassName()];g||(g=!1);a.setEnabled(g);a.getDivWrap().setAttribute("data-ctat-enabled",e)}}})}CTATShellTools.listComponents();ctatdebug("initializeHTMLComponents () done")};
CTATTutor.callComponentFunction=function(a,b,d){if((a=CTATShellTools.findComponent(a.id))&&0<a.length){a=a[0];var e=null;b&&(e=b(a,d));return e}};function assignNameTranslator(a){nameTranslator=a}CTATTutor.drawTutor=function(){if(!0!==this.drawing){this.drawing=!0;for(var a in CTATShellTools.component_descriptions){var b=CTATShellTools.component_descriptions[a].getComponentPointer();null!==b&&b.drawComponent()}this.drawing=!1}};
CTATTutor.initialize=function(){var a=navigator.userAgent.toLowerCase();0<a.search("iphone")?CTATTutor.onMobile=!0:0<a.search("ipod")?CTATTutor.onMobile=!0:0<a.search("android")&&(CTATTutor.onMobile=!0);a=getSafeElementById("pageor");null!==a&&!1===CTATTutor.onMobile&&(a.style.display="none");ctatdebug("initialize ()");this.initializeHTMLComponents();flashVars.getRawFlashVars();a=!0;CTATConfiguration.get("previewMode")&&(ctatdebug("In preview mode..."),a=!1);1==a?(CTATCommShell.commShell=new CTATCommShell,
CTATCommShell.commShell.init(CTATTutor)):CTATScrim.scrim.scrimDown()};
CTATTutor.createInterface=function(){ctatdebug("createInterface ("+Object.keys(CTATShellTools.component_descriptions).length+")");if(1==CTATGlobals.ignoreInterfaceDescriptions)ctatdebug("No need to process interface description messages, the interface should already be ready."),this.postProcess(),this.drawTutor();else{if(CTATGlobals.interfaceElement){ctatdebug("Re-creating interface ...");var a=CTATTutor.parser.getElementChildren(CTATGlobals.interfaceElement);CTATTutor.createStaticInterface(null,
a,null)}for(var b in CTATShellTools.component_descriptions){a=CTATShellTools.component_descriptions[b];if(!a){alert("Internal error parsing component at index "+b);return}if(!a.name){alert("Internal error parsing component at index "+b+" (no name attribute available)");return}if(-1==a.name.indexOf("null."))if(ctatdebug("Component: "+a.name+", type: "+a.type),"CTATCommShell"==a.type){if(CTATCommShell.commShell&&CTATCommShell.commShell.setName(a.name),"CTATCommShell"==a.type){ctatdebug("Tutor dimensions: "+
a.width+"x"+a.height);var d=getSafeElementById(ctatcontainer);null!==d?(ctatdebug("Setting canvas dimensions from: "+d.width+"px, "+d.height+"px, to: "+a.width+"px, "+a.height+"px"),d.width=a.width,d.height=a.height,d.style.width=a.width,d.style.height=a.height,ctatdebug("Canvas dimensions now: "+d.width+"px, "+d.height+"px")):ctatdebug("Error: tutor canvas is null, can't adjust size");d=getSafeElementById(ctatcontainer);null!==d?(d.style.width=a.width+"px",d.style.height=a.height+"px"):ctatdebug("Error: tutor container is null, can't adjust size")}}else CTAT.ComponentRegistry.hasOwnProperty(a.type)?
(ctatdebug("Creating ("+a.type+") :"+a.name),d=new CTAT.ComponentRegistry[a.type](a,a.x,a.y,a.width,a.height),d.setName(a.name),"CTATTextInput"!=a.type&&"CTATTextArea"!=a.type||d.setEnabled(!0),d.setTabIndex(a.tabIndex),a.setComponentPointer(d),d.initialize(),ctatdebug(d.getDivWrap())):ctatdebug("ERROR: Unrecognized component type "+a.type+" for "+a.name)}this.postProcess();this.drawTutor();ctatdebug("Tutor has been intialized from BRD, recalculating canvas position and size ...")}};
CTATTutor.postProcess=function(){ctatdebug("postProcess ()");for(var a in CTATShellTools.component_descriptions){var b=CTATShellTools.component_descriptions[a].getComponentPointer();null!==b?(b.getClassName(),b.postProcess&&b.postProcess()):ctatdebug("Error: component pointer "+a+" is null")}};
CTATTutor.createStaticInterface=function(a,b,d){ctatdebug("createStaticInterface ()");var e=getSafeElementById(ctatcontainer);null!==a&&(e=a);for(a=0;a<b.length;a++){var g=b[a];ctatdebug(this.parser.getElementName(g));if("timeline"==this.parser.getElementName(g)){ctatdebug("Timeline node found, obtaining visual elements ...");b=this.parser.getElementChildren(g);this.createStaticInterface(null,b,null);break}if("ctatcomponent"==this.parser.getElementName(g)){var c=this.parser.getElementAttr("instance");
d&&(ctatdebug("Registering existence of CTAT component on MovieClip container: "+c),d.addComponent(c))}var f,h,m,l;"shape"==this.parser.getElementName(g)&&(f=this.parser.getElementAttr(g,"x"),h=this.parser.getElementAttr(g,"y"),m=this.parser.getElementAttr(g,"width"),l=this.parser.getElementAttr(g,"height"),c=this.parser.getElementAttr(g,"instance"),ctatdebug("Creating shape: "+c+" at: "+f+","+h+","+m+","+l),m="data:image/png;base64, "+this.parser.getNodeTextValue(g),l=new Image,l.setAttribute("style",
"position: absolute; top: "+h+"px; left:"+f+"px; z-index:"+CTATGlobalFunctions.gensym.z_index()+";"),l.setAttribute("id",c),l.setAttribute("src",m),e.appendChild(l));"statictext"==this.parser.getElementName(g)&&(f=this.parser.getElementAttr(g,"x"),h=this.parser.getElementAttr(g,"y"),m=this.parser.getElementAttr(g,"width"),l=this.parser.getElementAttr(g,"height"),c=this.parser.getElementAttr(g,"instance"),ctatdebug("Creating static text: "+c+" at: "+f+","+h+","+m+","+l),m="data:image/png;base64, "+
this.parser.getNodeTextValue(g),l=new Image,l.setAttribute("style","position: absolute; top: "+h+"px; left:"+f+"px; z-index:"+CTATGlobalFunctions.gensym.z_index()+";"),l.setAttribute("id",c),l.setAttribute("src",m),e.appendChild(l));"statictext"==this.parser.getElementName(g)&&(c=this.parser.getElementAttr("instance"),ctatdebug("Creating movieclip: "+c),f=this.parser.getElementAttr(g,"x"),h=this.parser.getElementAttr(g,"y"),m=this.parser.getElementAttr(g,"width"),l=this.parser.getElementAttr(g,"height"),
f=new CTATMovieClip(c,f,h,m,l),h=f.wrapComponent(e),ctatdebug("Created movieclip: "+c+" at: "+f.x+","+f.y+","+f.width+","+f.height),movieclips.push(f),g=this.parser.getElementChildren(g),this.createStaticInterface(h,g,f))}};
CTATTutor.runTutor=function(){ctatdebug("runTutor ()");!0===CTATGlobals.tutorRunning?ctatdebug("The tutor is already running"):(null==CTATSkillSet.skills&&(CTATSkillSet.skills=new CTATSkillSet),window.onerror=function(a,b,d){var e=new CTATHTMLManager;ctatdebug(e.htmlEncode(a)+" in "+b+", line "+d);ctatdebug(e.htmlEncode(a)+" in "+b+", line "+d)},centerTutorContainer(),CTATTutor.initialize(),CTATGlobals.tutorRunning=!0,ctatdebug("runTutor () ... all set"))};
CTATTutor.initTutor=function(a,b,d,e){console.trace("CTATTutor.initTutor() CTATTarget, aFlashVars: ",CTATTarget,a);ctatdebug("initTutor() #aFlashVars "+(a?a.length:null)+", usingFlash "+e);if(1==CTATTutor.tutorInitialized)ctatdebug("Tutor already initialized, probably in author mode"),"undefined"!=typeof a&&a.previewMode&&(CTATScrim.scrim.scrimDown(),ctatdebug("In preview mode..."));else{CTATConfiguration.generateDefaultConfigurationObject(a,"undefined"==typeof CTATTarget?void 0:CTATTarget);switch(CTATConfiguration.get("show_debug_traces")){case "true":case "basic":useDebuggingBasic=
!0;break;case "on":case "full":useDebugging=!0;break;case "false":case "off":useDebuggingBasic=useDebugging=!1;break;default:useDebuggingBasic=!0}null==e&&(e=CTATConfiguration.usingFlash());e&&CTATScrim.scrim.scrimDown();CTATCommLibrary.setAuthenticityToken(CTATConfiguration.get("authenticity_token"));b&&(ctatcontainer=b);(a=document.getElementById(ctatcontainer))&&a.classList.add("CTATTutorContainer");a=getSafeElementById("debugtraces");null!==a&&(useDebugging=!0===a.checked?!0:!1);ctatdebug("initTutor() CTATConfiguration.get('mode')="+
CTATConfiguration.get("mode")+", window.sendToTutor="+window.sendToTutor);CTATConfiguration.get("swf_name")&&!window.sendToTutor&&(window.sendToTutor=function(a){ctatdebug("window.sendToTutor("+a+") CTAT.ToolTutor.tutor "+CTAT.ToolTutor.tutor);return CTAT.ToolTutor.tutor?CTAT.ToolTutor.tutor.receiveFromInterface(a):CTAT.ToolTutor.tutorMessages.push(a)},window.registerInterface=function(a){CTAT.ToolTutor.registerInterfaceMessageHandler(a)});"javascript"==String(CTATConfiguration.get("tutoring_service_communication")).toLowerCase()&&
("undefined"!=typeof CTATExampleTracer&&CTATExampleTracer?CTAT.ToolTutor.registerTutor(new CTATExampleTracer):CTATScrim.scrim.warningScrimUp('Tutoring service communication parameter is "JavaScript" but class\nCTATExampleTracer is missing. Use a different ctat-*.js script.'));ctatdebug("initTutor ()");"applet"==CTATConfiguration.get("tutoring_service_communication")&&deployJava.runApplet({id:"TSApplet",width:150,height:10},{jnlp_href:"/ctat_applet/TSApplet.jnlp"},"1.6");e||CTATTutor.runTutor();CTATTutor.tutorInitialized=
!0}};window.hasOwnProperty("initTutor")||(window.initTutor=CTATTutor.initTutor);function receiveFromTutor(){ctatdebug("receiveFromTutor ()")}function saveAndQuit(){ctatdebug("saveAndQuit ()")}function prepTutorArea(){initTutor()}window.prepTutorArea=prepTutorArea;function assignAnonymousGradingProcessor(a){CTATCommShell.commShell.assignAnonymousGradingProcessor(a)}
function gradeAnonymousComponent(a,b,d){ctatdebug("gradeAnonymousComponent ()");a=new CTATSAI(a,b,d);CTATCommShell.commShell.processComponentAction(a)}function testTutor(a){ctatdebug("testTutor ()");window.onerror=function(a,d,e){var b=new CTATHTMLManager;ctatdebug(b.htmlEncode(a)+" in "+d+", line "+e)};null==CTATSkillSet.skills&&(CTATSkillSet.skills=new CTATSkillSet);(new CTATCommLibrary).send("http://augustus.pslc.cs.cmu.edu/crossdomain.xml")}
function centerTutorContainer(){ctatdebug("centerTutorContainer ()");var a=getSafeElementById(ctatcontainer);if(null==a)ctatdebug("Tutor container not found, bump");else{var b;if(flashVars){b=flashVars.getRawFlashVars();var d,e;d=a.offsetWidth;e=a.offsetHeight;b&&b.width&&b.height&&(ctatdebug("We have raw width and height variables in our flashvars: "+b.width+","+b.height),d=b.width,e=b.height);b.centerTutor?1==b.centerTutor&&(ctatdebug("Moving tutor over by: "+("-"+Number(d/2)+"px 0 0 -"+Number(e/
2)+"px;")),a.style.position="absolute",a.style.top="0",a.style.left="0",a.style.right="0",a.style.bottom="0",a.style.margin="auto"):ctatdebug("The tutor is not configured to center the container, bump")}else ctatdebug("No flashvars yet, bump")}}
function checkTutorCanvas(){ctatdebug("checkTutorCanvas ()");var a=getSafeElementById(ctatcontainer),b=getSafeElementById("main-canvas"),d=flashVars.getRawFlashVars(),e="550",g="450";a&&(ctatdebug("Recording the actual CSS width and height: "+a.offsetWidth+" , "+a.offsetHeight),e=a.offsetWidth,g=a.offsetHeight);d&&d.width&&d.height&&(ctatdebug("We have tutor size flashvars, using those instead: "+d.width+" , "+d.height),e=d.width,g=d.height);null===b?(ctatdebug("No canvas available, creating ..."),
b=document.createElement("canvas"),b.id="main-canvas",b.innerHTML="Your browser does not support CTAT. Please update or use another browser.",ctatdebug("Setting canvas to: 0,0,"+e+" , "+g),getSafeElementById(ctatcontainer).appendChild(b)):(ctatdebug("Setting canvas to: 0 , 0, "+e+" , "+g),b.style.top="0",b.style.left="0");b.style.width=e+"px";b.style.height=g+"px";return b};(function(a){function b(){var a=arguments[0],c=b.cache;c[a]&&c.hasOwnProperty(a)||(c[a]=b.parse(a));return b.format.call(null,c[a],arguments)}function d(a){return Object.prototype.toString.call(a).slice(8,-1).toLowerCase()}var e=/[^s]/,g=/[def]/,c=/^[^\x25]+/,f=/^\x25{2}/,h=/^\x25(?:([1-9]\d*)\$|\(([^\)]+)\))?(\+)?(0|'[^$])?(-)?(\d+)?(?:\.(\d+))?([b-fosuxX])/,m=/^([a-z_][a-z_\d]*)/i,l=/^\.([a-z_][a-z_\d]*)/i,n=/^\[(\d+)\]/,p=/^[\+\-]/;b.format=function(a,c){var f=1,h=a.length,l,m=[],n,q,v,x,D=!0,
H="";for(n=0;n<h;n++)if(l=d(a[n]),"string"===l)m[m.length]=a[n];else if("array"===l){v=a[n];if(v[2])for(l=c[f],q=0;q<v[2].length;q++){if(!l.hasOwnProperty(v[2][q]))throw Error(b("[sprintf] property '%s' does not exist",v[2][q]));l=l[v[2][q]]}else l=v[1]?c[v[1]]:c[f++];"function"==d(l)&&(l=l());if(e.test(v[8])&&"number"!=d(l)&&isNaN(l))throw new TypeError(b("[sprintf] expecting number but found %s",d(l)));g.test(v[8])&&(D=0<=l);switch(v[8]){case "b":l=l.toString(2);break;case "c":l=String.fromCharCode(l);
break;case "d":l=parseInt(l,10);break;case "e":l=v[7]?l.toExponential(v[7]):l.toExponential();break;case "f":l=v[7]?parseFloat(l).toFixed(v[7]):parseFloat(l);break;case "o":l=l.toString(8);break;case "s":l=(l=String(l))&&v[7]?l.substring(0,v[7]):l;break;case "u":l>>>=0;break;case "x":l=l.toString(16);break;case "X":l=l.toString(16).toUpperCase()}if(!D||g.test(v[8])&&v[3])H=D?"+":"-",l=l.toString().replace(p,"");q=v[4]?"0"==v[4]?"0":v[4].charAt(1):" ";x=v[6]-(H+l).length;x=v[6]?Array(x+1).join(q):
"";m[m.length]=v[5]?H+l+x:0==q?H+x+l:x+H+l}return m.join("")};b.cache={};b.parse=function(a){for(var b,d=[],e=0;a;){if(null!==(b=c.exec(a)))d[d.length]=b[0];else if(null!==(b=f.exec(a)))d[d.length]="%";else if(null!==(b=h.exec(a))){if(b[2]){var e=e|1,g=[],q=b[2],p;if(null!==(p=m.exec(q)))for(g[g.length]=p[1];""!==(q=q.substring(p[0].length));)if(null!==(p=l.exec(q)))g[g.length]=p[1];else if(null!==(p=n.exec(q)))g[g.length]=p[1];else throw new SyntaxError("[sprintf] failed to parse named argument key");
else throw new SyntaxError("[sprintf] failed to parse named argument key");b[2]=g}else e|=2;if(3===e)throw Error("[sprintf] mixing positional and named placeholders is not (yet) supported");d[d.length]=b}else throw new SyntaxError("[sprintf] unexpected placeholder");a=a.substring(b[0].length)}return d};var x=function(a,c,d){d=(c||[]).slice(0);d.splice(0,0,a);return b.apply(null,d)};"undefined"!==typeof exports?(exports.sprintf=b,exports.vsprintf=x):(a.sprintf=b,a.vsprintf=x,"function"===typeof define&&
define.amd&&define(function(){return{sprintf:b,vsprintf:x}}))})("undefined"===typeof window?this:window);var CTATNoolsTracerUtil=function(){var a={},b=/^(?:[a-z]+:\/)?\//i;this.setTypes=function(b,e){console.log("setTypes()");e.forEach(function(d){a[d]=b.getDefined(d);a[d]?console.log("set type "+d):console.log("couldn't get "+d)})};this.getFactType=function(b){var d=typeof b;if("object"===d)if(d=null,b instanceof Array)d="Array";else if(b instanceof RegExp)d="RegExp";else if(b instanceof Date)d="Date";else for(t in a)if(a.hasOwnProperty(t)&&a[t]===b.constructor){d=t;break}return d};this.getTypeConstructor=
function(b){return a[b]};this.relativeToAbsolute=function(a,b){if(this.isAbsoluteURL(a))return a;b=b||window.location.origin+window.location.pathname;var d=b.split("/"),c=a.split("/");d.pop();for(var e=0;e<c.length;e++)"."!=c[e]&&(".."==c[e]?d.pop():d.push(c[e]));return d.join("/")};this.isAbsoluteURL=function(a){return b.test(a)};this.buildStartStateMsg=function(){var a=0,b=new CTATTutoringServiceMessageBuilder;return function(d){return b.createInterfaceActionMessage(a++,new CTATSAI(d.selection,
d.action,d.input))}}();this.buildStateGraphMsg=function(a){var b="<message><verb>SendNoteProperty</verb><properties><MessageType>StateGraph</MessageType>",d;for(d in a)a.hasOwnProperty(d)&&(b+="<"+d+">"+a[d]+"</"+d+">");return b+"</properties></message>"};this.printAgenda=function(a){return JSON.stringify(a.getAgenda())};this.printConflictTree=function(a,b){return a.getConflictTree().toString(b)};this.printFact=function(a,b,g){var c=a.getFact(b),d="";if(c){g&&(d="id: "+b+", ");var d=d+("type: "+a.getFactType(c.object)+
", "),e;try{e="values: "+JSON.stringify(c.object)}catch(m){e="< Error converting fact to JSON >"}d+=e}else d="no fact found with ID "+b;return d};this.printFacts=function(a,b){var d=b,c="";if(Array.isArray(d)){for(var d=$jscomp.makeIterator(d),e=d.next();!e.done;e=d.next())b=e.value,c+=Number.isInteger(b)?this.printFact(a,b,!0):this.printFacts(a,b);return c}if(Number.isInteger(b))return this.printFact(a,b);d=a.getFacts(b,!0);c="got "+d.length+(b?" "+b:"")+" fact(s):\n";d.forEach(function(d){c+="id: "+
d.id+", "+(b?"":"type: "+a.getFactType(d.object)+", ");var e;try{e="values: "+JSON.stringify(d.object)+"\n"}catch(l){e="< Error converting fact to JSON >\n"}c+=e});return c};this.printCtNodeMatch=function(a,b){var d=a.getNodeMatcherResult(b),c,e;d&&"no match"!==d?(c=d.student,e=d.tutor,d="rule: "+d.rule+"\nstudent: "+c.selection+", "+c.action+", "+c.input+"\ntutor:   "+e.selection+", "+e.action+", "+e.input+"\nresult: "+(d.isMatch?"match":"no match")):d="no match"===d?"No match found at node "+b:
"No conflict tree node found for ID "+b;return d};this.printRuleNodes=function(){function a(a){var c={};a.facts.forEach(function(b,d){var e;for(d=0;!e&&d<a.aliases.length;d++)a.factHash[a.aliases[d]]===b.object&&(e=a.aliases[d]);e?c[e]=b:console.warn("no alias found for "+JSON.stringify(b))});return c}function b(b,c){var d={},e="NotNode"===c.nodeType||"FromNotNode"===c.nodeType;switch(c.nodeType){case "BetaNode":case "NotNode":case "ExistsNode":var g=c.rightMemory,l,n=[],p;for(p in g)l=g[p].data.match,
n.push(a(l));d.factBindings=n;break;case "JoinNode":var n=c.leftMemory,x,q=[];for(g in n)for(l in x=n[g].data.rightMatches,x)p=x[l].match,q.push(a(p));d.factBindings=q;break;case "FromNode":case "FromNotNode":g=c.fromMemory;q=[];for(n in g)for(x in l=g[n],l)p=l[x][1],p.match&&q.push(a(p.match));d.factBindings=q;break;default:d.factBindings=[]}d.isMatch=d.factBindings.length&&!e||!d.factBindings.length&&e;return d}return function(a,c){var d=!0,e=a.getRuleData(c),g="";if(e){var l=e.memoryNodes,e=[].concat(e.patterns),
n={},p=null,x,q,v,u=/("([^"]*)"):/g;try{for(var A=0;A<e.length;A++){var g=g+(p?"\n\t":'\npattern: "'),y=e[A];y.disjuncts&&(g+="or (\n\t",p=A-1+y.disjuncts.length,e.splice.apply(e,[].concat([A,1],$jscomp.arrayFromIterable(y.disjuncts))),y=e[A]);g+=y.string+(p?"":'"');x=y.alias;n[x]||(n[x]=0);q=b(y,l[x][n[x]++]);q.isMatch||(g+=" NOT");g+=" MATCHED";(v=q.factBindings).length&&(g+=" - Possible bindings: ",v.forEach(function(a,c){for(var b in a)if("__i__"!==b){for(var d=JSON.stringify(a[b].object),e;e=
u.exec(d);)d=d.replace(e[1],e[2]);g+="\n\t"+(p?"\t":"")+b+": "+d+" (fact ID "+a[b].id+")"}g+="\n"}));A===p&&(g+='\n)"',p=null);if(!q.isMatch){d=!1;break}}return g+"\nRule "+(d?"":"not ")+"matched"}catch(C){throw console.log("got here: "+g),C;}}else return"Rule "+c+" not found"}}()};var CTATNoolsTracerWrapper=function(a){this.printAgenda=function(){a.printAgenda("override")};this.printConflictTree=function(b){a.printConflictTree("override",b)};this.printFact=function(b){a.printFact(b)};this.printFacts=function(b){a.printFacts(b)};this.printMatch=function(b){a.printCtNodeMatch(b)};this.printRuleNodes=function(b){a.printRuleNodes(b)};this.setStepperMode=function(b){a.setInStepMode(b)};this.takeSteps=function(b,d){a.takeSteps(b,d)};this.setBreakpoint=function(b,d){a.setBreakpoint(b,
d)};this.resume=function(){a.resume()}};var CTATNoolsTracer=function(a,b){function d(a){ka=[];aa={};O.setDoBacktracking(!1);F("debug","starting initial match");oa=function(){F("debug","done initial match");ha=fa=!0;O.setPruneOldActivations(aa.prune_old_activations);O.setDoBacktracking(aa.use_backtracking);O.setSearchMode(aa.search_mode);V=!0;"function"===typeof a&&a()};p()}function e(a){"string"===typeof a&&(R.links[R.links.length-1].successOrBugMsg=a)}function g(a){var c=R.links[R.links.length-1].sai;a.selection&&(c.selection=a.selection);
a.action&&(c.action=a.action);a.input&&(c.input=a.input)}function c(a,b,d,e,g,h,l){F("debug","handleImports for "+b);d=d||{};g=g||{count:0,chunks:[]};h=h||0;l=l||0;for(var m=/\bimport\s?\(('|")?([^()'"\s]*)\1?\);/g,n,q=[];null!=(n=m.exec(a));){var p=ca.relativeToAbsolute(n[2],b);d[p]?F("debug","skipping duplicate import: "+p):(q.push(p),d[p]=!0);a=a.replace(n[0],"");m.lastIndex-=n[0].length}g.chunks[h]||(g.chunks[h]=[]);g.chunks[h][l]=a;g.count+=q.length;F("debug",b+" is importing "+q.length+" files");
if(0<q.length)for(a={i:0};a.i<q.length;a={url$10:a.url$10,i:a.i},a.i++)a.url$10=q[a.i],$.ajax(a.url$10,{dataType:"text",success:function(a){return function(b){c(b,a.url$10,d,e,g,h+1,a.i);g.count--;0==g.count&&e(f(g.chunks))}}(a),error:function(a,c,b){F("error","Error in _handleImports() : ");F("error",c)}});else 0==h&&e(f(g.chunks))}function f(a){for(var c="",b;0<a.length;)for(b=a.pop();0<b.length;)c+=b.shift()+"\n";return c}function h(a,c){var b={getStudentInput:function(){return T.getLastStudentSAI()},
getStudentSAIs:function(){return T.getStudentSAIs()},checkSAI:u,setTutorSAI:g,setSuccessOrBugMsg:e,setProblemAttribute:C,getInitialized:function(){return T.getInitialized()},backtrack:function(){O.setAboutToBacktrack()},assert:I,modify:B,retract:J,halt:D};try{Y=nools.compile(a,{name:c||"CTATFlow",scope:b})}catch(pa){return F("error","Error compiling rule file"),V=!1,pa}m();Y.__scope.custom_fields&&(da=Y.__scope.custom_fields);return!0}function m(){var a,c;a=Y.__scope;var b={};Y.__rules.forEach(function(a){b[a.name]=
!0});if(a&&a.skill_definitions)if(a=a.skill_definitions,a instanceof Array)a.forEach(function(a){c=a.ruleName.split(",");c.forEach(function(c){c=c.trim();if(b[c])ma[c]={name:a.skillName||a.ruleName,category:a.category,label:a.label||a.skillName,description:a.description||"",mastery:a.mastery||CTATExampleTracerSkill.DEFAULT_MASTERY_THRESHOLD,level:a.pKnown||CTATExampleTracerSkill.DEFAULT_P_KNOWN,pGuess:a.pGuess||CTATExampleTracerSkill.DEFAULT_P_GUESS,pLearn:a.pLearn||CTATExampleTracerSkill.DEFAULT_P_LEARN,
pSlip:a.pSlip||CTATExampleTracerSkill.DEFAULT_P_SLIP};else throw Error("Rule "+a.ruleName+" named by skill "+a.skillName+" does not exist in model");})});else throw Error("Global variable 'skill_definitions' must be of type Array");}function l(a,c){F("debug","Assert sai ("+(c?"":"un")+"tutored) : "+JSON.stringify(a));var b=ba[a.selection];if(b)b.input=a.input,b.tutored=c,O.modify(b);else{b=Y.getDefined("StudentValues");if(!b)throw Error("StudentValues type not defined");b=new b(a.selection,a.action,
a.input);b.tutored=c;O.assert(b,"_"+a.selection+"_sai");ba[a.selection]=b}Z=a}function n(){F("debug","Asserting hint fact...");if(!ia){var a=Y.getDefined("IsHintMatch");if(!a)throw Error("IsHintMatch type not defined");ia=new a}O.assert(ia,"_isHintMatch")}function p(a){ea=!1;O.match(function(a){if(a)throw F("error","nools encountered an error: "+a),a;ea&&(ga&&F("override","search complete, returning result"),oa())},a,!1,ha);ha=!1}function x(a){var c="no_model",b,d;W.matchChain?(b=W.matchChain,c="correct"):
(W.bugMatchChain&&(b=W.bugMatchChain,c="bug",d=b.msg),b=v(!1),d&&(b.msg=d));fa="correct"===c;b.tpas=na;ha=!0;Z=null;a(c,b)}function q(a,c,b){b=v(!0,b);c&&(fa=la=!1,ha=!0,Z=null,aa.use_hint_fact&&O.retract(ia));a(b)}function v(a,c){var b,d=W.selectionMap,e=c||(Z?Z.selection:""),f=W.firstTutorSelection,g=function(c){c=d[c];for(var b=0;b<c.length;b++)if(c[b].sai.isCorrect&&(!a||0<c[b].hints.length))return c[b];return null};"hint"!==e&&d[e]&&(b=g(e));if(!b){f&&(b=g(f));for(s in d){if(b)break;b=g(s)}b||
(b=X)}return b}function u(a,c,b){var d=!1,e=a.selection,f=a.action,g=a.input,h="not_specified"===e||"not_specified"===f||"not_specified"===g;F("sai_check","checking SAI");if(!Z)return F("sai_check","no student input to check, returning false"),!1;F("sai_check","student: "+JSON.stringify(Z));F("sai_check","tutor  : "+JSON.stringify(a));R.links[R.links.length-1].sai={selection:e&&"not_specified"!==e&&"don't_care"!==e?e:"",action:f&&"not_specified"!==f&&"don't_care"!==f?f:"",input:g&&"not_specified"!==
g&&"don't_care"!==g?g:"",isCorrect:!b&&!h};la?F("sai_check","Skipping check, we're hint matching"):(d=A(Z,a,c),F("sai_check",(d.isMatch?"Match":"No match")+", "+(b?"was":"was not")+" a buggy step"),R.matchType=d.isMatch?b?"buggy":"match":null,O.setNodeMatcherResult(d));return d.isMatch}function A(a,c,b){var d=c.selection,e=c.action,f=c.input,g=a.selection,h=a.action,l=a.input,m=["-","-","-"],n={student:a,tutor:c,isMatch:!1,matchedFields:null},l=isNaN(l)?l:parseInt(l,10),f=isNaN(f)?f:parseInt(f,10),
q=function(a,c,b){return"don't_care"===a?"*":"not_specified"===a?" ":a===c?b:"-"};m[0]=q(d.toLowerCase(),g.toLowerCase(),"S");m[1]=q(e.toLowerCase(),h.toLowerCase(),"A");m[2]=q(f,l,"I");n.matchedFields=m;if(b&&"function"===typeof b)n.isMatch=b(a,c);else for(n.isMatch=!0,a=0;3>a;a++)if("-"===m[a]){n.isMatch=!1;break}return n}function y(){W.firstTutorSelection=null;W.selectionMap={};W.matchChain=null;W.bugMatchChain=null;R.links=[];R.lengthAtBranchStack=[];R.matchType=null;if(da){for(var a in da)da.hasOwnProperty(a)&&
(da[a]=null);O.modify(da)}ea=!1}function C(a,c){F("debug","setProblemAttribute ("+a+", "+c+")");aa[a]=c}function r(){for(var a=R.links,c=W.selectionMap,b,d,e,f=[],g=[],h=[],l=[],m,n={selection:"",action:"",input:""},q=0;q<a.length;q++)b=a[q],d=b.sai,f.push(b.ruleName),(e=ma[b.ruleName])&&g.push(e.name+" "+e.category),h=h.concat(b.hints),l=l.concat(b.tpas),b=b.successOrBugMsg,d&&(d.selection&&(m=n.selection=d.selection),d.action&&(n.action=d.action),d.input&&(n.input=d.input),n.isCorrect=d.isCorrect);
h.sort(function(a,c){var b=c.precedence-a.precedence;0===b&&(b=a.pos-c.pos);return b});c[m]||(c[m]=[],W.firstTutorSelection||(W.firstTutorSelection=m));a={sai:n,rules:f,skills:g,hints:h,msg:b||"",customFields:JSON.parse(JSON.stringify(da))};c[m].push(a);switch(R.matchType){case "buggy":W.bugMatchChain=a;break;case "match":W.matchChain=a}na=l;F("debug","stored last chain: \n\trules: "+f+"\n\tskills: "+g+"\n\tfinalSAI: "+JSON.stringify(n)+"\n\tmatchType: "+R.matchType)}function I(a){aa.use_backtracking&&
O.pushUndo("assert",a);return O.assert(a)}function J(a){aa.use_backtracking&&O.pushUndo("retract",a);return O.retract(a)}function B(a,c,b){if(aa.use_backtracking)O.pushUndo("modify",a,c);else if(3>arguments.length)return O.modify.apply(O,arguments);a[c]=b;return O.modify(a)}function D(){O.halt(!0);ea=!0}function H(){r()}function E(a){ja||R.lengthAtBranchStack.pop();ja=!1;na=[];F("backtrack","backtracking, initiated by "+(a?"model":"engine"))}function w(a,c,b,d){var e;try{e=JSON.stringify(a)}catch(qa){e=
"< Error converting fact to JSON >"}F("assert",c+" fact asserted with ID "+d+": "+e);switch(c){case "tpa":F("tpa","TPA asserted: "+JSON.stringify(a));V?aa.use_backtracking?R.links[R.links.length-1].tpas.push(a):Q(a):ka.push(ca.buildStartStateMsg(a));break;case "hint":V&&(c=R.links[R.links.length-1],a.pos=R.links.length+c.hints.length/(c.hints.length+1),c.hints.push(a))}}function z(a,c,b,d){F("modify",c+" fact modified with ID "+d)}function K(a,c,b,d){F("retract",c+" fact retracted with ID "+d)}function M(a){F("state_save",
"Hit branch point, agenda: "+JSON.stringify(a.agenda)+", factIdCntr: "+a.state.factIdCounter);R.lengthAtBranchStack.push({numLinks:R.links.length,matchType:R.matchType})}function L(a){F("state_restore","State restored, agenda: "+JSON.stringify(a.agenda)+", factIdCntr: "+a.state.factIdCounter);a=R.lengthAtBranchStack;a=a[a.length-1];links=R.links;links.splice(a.numLinks);R.matchType=a.matchType}function G(a,c,b){F("fire","Firing activation: "+b);R.links.push({ruleName:a,hints:[],tpas:[]});ja=!0}function U(a,
c,b){F("agenda_insert",a+" added to agenda, is "+(c?" ":"not ")+"new, was "+(b?" ":"not ")+"skipped")}function P(a){F("agenda_retract",a+" removed from agenda")}function S(){F("agenda_empty","No more activations in agenda, all branches have been explored");ea=!0}function N(a){F("override","hit breakpoint on rule "+a+" (call resume() to resume matching)")}var X={sai:{selection:"",action:"",input:""},rules:[],skills:[],hints:[],msg:"",customFields:{}},F=a,Q=b,T=this,V=!1,Y=null,O=null,ba={},W={selectionMap:{}},
Z=null,R={links:[],lengthAtBranchStack:[],matchType:null},ja=!1,ca=null,ka=[],aa={use_backtracking:!1,prune_old_activations:!1,use_hint_fact:!1,search_mode:"combination"},fa=!0,la=!1,ia=null,ma={},da=null,na=[],ga=!1,ha=!0,oa=function(){},ea=!1;this.getInitialized=function(){return V};this.getSkills=function(){return ma};this.init=function(a,b,e){F("debug","noolstracer init w/ source file: "+a);if(nools){ca=new CTATNoolsTracerUtil;var f=ca.relativeToAbsolute(a);$.ajax(a,{dataType:"text",success:function(g){c(g,
f,null,function(c){F("debug","compiling model...");!0!==(c=h(c,a))?(F("error","CTATNoolsTracer: Error compiling model"),e(c)):(F("debug","done compile"),T.createSession()||e("CTATNoolsTracer: Error creating session"),d(function(){registerTracerWrapper(new CTATNoolsTracerWrapper(T));b(ka,aa)}))})},error:function(a,c,b){ctatdebug("Error retrieving rule file: ");ctatdebug(c);e(c)}})}else F("error","Error: nools is not defined"),e("nools is not defined")};this.createSession=function(){F("debug","creating session...");
(O=Y.getSession({iAmEventListeners:!0,assert:w,retract:K,modify:z,state_save:M,state_restore:L,backtrack:E,fire:G,agenda_insert:U,agenda_retract:P,agenda_empty:S,endOfChain:H,breakpoint:N}))&&F("debug","session created");return!!O};this.evaluate=function(a,c,b){F("debug","noolsTracer.evaluate, matchType = "+b+", sai "+a+", "+fa);var d=x.bind(T,c);O.prepForMatch();switch(b){case "hint":if(fa||aa.use_hint_fact)la=!0,d=q.bind(T,c,!0),aa.use_hint_fact&&n();else return F("debug","re-using hints from last match"),
q(c,!1,a.selection),!0;case "tutored_action":y();l(a,!0);oa=function(){T.printAgenda("agenda_post");d()};ga||(T.printAgenda("agenda_pre"),p());break;case "untutored_action":return l(a,!1),!0}return!1};this.setListener=function(a,c){O&&O.on(a,c)};this.getStudentSAIs=function(){return ba};this.getLastStudentSAI=function(){return Z};this.getTutorSAIs=function(){return W.selectionMap};this.reset=function(a){T.createSession();V=!1;ba={};W.selectionMap={};W.firstTutorSelection=null;W.matchChain=null;Z=
W.bugMatchChain=null;fa=!0;d(a)};this.printAgenda=function(a){F(a,("override"!==a?a+": ":"")+ca.printAgenda(O))};this.printConflictTree=function(a,c){F(a,ca.printConflictTree(O,c))};this.printFact=function(a){F("override",ca.printFact(O,a))};this.printFacts=function(a){F("override",ca.printFacts(O,a))};this.printCtNodeMatch=function(a){F("override",ca.printCtNodeMatch(O,a))};this.printRuleNodes=function(a){F("override",ca.printRuleNodes(O,a))};this.setInStepMode=function(a){a=a&&"false"!==a;F("override",
"Stepper mode "+(a?"on":"off"));!ga||a||ea||p();ga=a};this.takeSteps=function(a){ga?Z?(a=a||1,F("override","taking "+a+" steps"),p(a)):F("override","no new student input, ignoring"):F("override","not in step mode, ignoring")};this.setBreakpoint=function(a,c){a?(c=c||"first",O.setBreakpoint(a,c)?F("override","breakpoint "+("none"===c?"cleared":"set")+" for rule "+a):F("override","breakpoint not "+("none"===c?"cleared":"set")+" -- rule "+a+" doesn't exist")):F("override","need a rule name to break on")};
this.resume=function(){ga?F("override","can't resume; engine is in stepper mode"):ea?F("override","not at a breakpoint, ignoring"):p()}};var CTATLogger=function(){var a={};this.isSet=function(b){return!!a[b]};this.set=function(b){a[b]=!0};this.unset=function(b){a[b]=!1};this.log=function(b,d){(a[b]||"override"===b)&&console.log(d)}};var CTATRuleTracerGlobals={},CTATNoolsTracerLogger=new CTATLogger,globalTracerRef=null;function registerTracerWrapper(a){globalTracerRef=a}function setTracerLogFlag(a){CTATNoolsTracerLogger.set(a)}function setTracerLogFlags(a){(a instanceof Array?a:Array.prototype.slice.call(arguments)).forEach(function(a){setTracerLogFlag(a)})}function unsetTracerLogFlag(a){CTATNoolsTracerLogger.unset(a)}
function unsetTracerLogFlags(a){(a instanceof Array?a:Array.prototype.slice.call(arguments)).forEach(function(a){unsetTracerLogFlag(a)})}function printAgenda(){globalTracerRef.printAgenda()}function printConflictTree(a){globalTracerRef.printConflictTree(a)}function printFact(a){globalTracerRef.printFact(a)}function printFacts(a){globalTracerRef.printFacts(a)}function printMatch(a){globalTracerRef.printMatch(a)}function whyNot(a){globalTracerRef.printRuleNodes(a)}
function setStepperMode(a){globalTracerRef.setStepperMode(a)}function takeSteps(a,b){globalTracerRef.takeSteps(a,b)}function setBreakpoint(a,b){globalTracerRef.setBreakpoint(a,b)}function resume(){globalTracerRef.resume()};var CTATRuleTracer=function(a,b){function d(a,b,d,f){var g=f.msg,h=f.sai,l=new CTATSAI(h.selection,h.action,h.input),n=a.getStudentSAI(),q=f.customFields;m("debug","ruleTracer.handleResult, result = "+d+"\n\ttutorSAI = "+JSON.stringify(h)+"\n\tmsg = "+g+"\n\tassociated rules = "+f.rules+"\n\tassociated skills = "+f.skills+"\n\ttpas = "+f.tpas+"\n\tcustom fields = "+JSON.stringify(q));a.setStepID("["+h.selection+","+h.action+"]");a.setTutorSAI(l);a.setSuccessOrBuggyMsg(g);a.setAssociatedRules(f.rules);
a.setAssociatedSkills(f.skills);a.setCustomFields(q);switch(d){case "correct":a.setResult(CTATExampleTracerLink.CORRECT_ACTION);a.setTraceOutcome(CTATExampleTracerLink.CORRECT_ACTION);break;case "bug":e(a,n,!0);break;case "no_model":e(a,n,!1)}f.tpas.forEach(function(a){c(a)});b()}function e(a,c,b){c.getSelection().includes("done")&&"ButtonPressed"===c.getAction()&&a.setDoneStepFailed(!0);b?(a.setResult(CTATExampleTracerLink.BUGGY_ACTION),a.setTraceOutcome(CTATExampleTracerLink.BUGGY_ACTION)):(a.setResult(CTATExampleTracerLink.NO_MODEL),
a.setTraceOutcome(CTATExampleTracerLink.NO_MODEL))}function g(a,c,b){var d=b.hints.map(function(a){return a.msg}),e=b.rules,f=b.skills;b=b.sai;a.getStudentSAI();m("debug","ruleTracer.handleHintResult,\n\ttutorSAI = "+JSON.stringify(b)+"\n\tassociated rules = "+e+"\n\tassociated skills = "+f+"\n\thints = "+JSON.stringify(d));a.setTutorSAI(new CTATSAI(b.selection,b.action,b.input));a.setResult(CTATExampleTracerLink.HINT_ACTION);a.setTraceOutcome(d.length?CTATExampleTracerLink.HINT_ACTION:CTATExampleTracerLink.NO_MODEL);
a.setReportableHints(d);a.setActor(CTATMsgType.DEFAULT_STUDENT_ACTOR);a.setStepID("["+b.selection+","+b.action+"]");a.setAssociatedSkills(f);a.setAssociatedRules(e);c(a,a.getTransactionID())}function c(a){h&&h.addTPAToMessageTank(a.selection,a.action,a.input,"tutor-performed")}function f(a){var c={selection:a.getSelection()||"",action:a.getAction()||"",input:a.getInput()||""};console.log("_simplifySAI("+a+") rtns {"+c.selection+","+c.action+","+c.input+")");return c}var h=b,m=CTATNoolsTracerLogger.log,
l=null,n=null,p=this;this.initEngine=function(b,d,e){switch(a){case "nools":l=new CTATNoolsTracer(m,c)}var f=function(a,c){var b=l.getSkills();if(!CTATConfiguration.get("skills"))if(CTATSkillSet.skills){m("debug","skills not defined in flashVars, using model definitions");var e=[];for(skillName in b){var f=b[skillName];CTATSkillSet.skills.addSkillAsObject(f);e.push(new CTATExampleTracerSkill(f.category,f.name,f.pGuess,f.level,f.pSlip,f.pLearn,null))}h.getProblemSummary().setSkills(new CTATSkills(e));
CTATCommShell.commShell.updateSkillWindow(null)}else m("debug","CTATSkillSet.skills not defined, skipping initSkills");d(a,c)};l&&l.init(b,f,e)};this.getModelInitialized=function(){return l&&l.getInitialized()};this.setListener=function(a,c){l.setListener(a,c)};this.evaluate=function(a,c){l.evaluate(f(a.getStudentSAI()),d.bind(p,a,c),"tutored_action")};this.doHint=function(a,c,b){a.setTransactionID(c);return l.evaluate(f(a.getStudentSAI()),g.bind(this,a,b),"hint")};this.handleUntutoredAction=function(a){m("debug",
"ruleTracer.handleUntutoredAction( "+JSON.stringify(a)+" )");l.evaluate({selection:a.selection[0],action:a.action[0],input:a.input[0]},null,"untutored_action")};this.checkOutOfOrder=function(a,c){var b=f(a.getStudentSAI()),b=!l.getTutorSAIs()[b.selection];c(b)};this.setDefaultBuggyMsg=function(a){a&&"string"===typeof a&&(n=a)};this.getDefaultBuggyMsg=function(){return n};this.reset=function(a){l.reset(a)}};var CTATHintPolicyEnum=function(){};Object.defineProperty(CTATHintPolicyEnum,"HINTS_UNBIASED",{enumerable:!0,configurable:!1,writable:!1,value:"Always Follow Best Path"});Object.defineProperty(CTATHintPolicyEnum,"HINTS_BIASED_BY_CURRENT_SELECTION_ONLY",{enumerable:!0,configurable:!1,writable:!1,value:"Bias Hints by Current Selection Only"});Object.defineProperty(CTATHintPolicyEnum,"HINTS_BIASED_BY_PRIOR_ERROR_ONLY",{enumerable:!0,configurable:!1,writable:!1,value:"Bias Hints by Prior Error Only"});
Object.defineProperty(CTATHintPolicyEnum,"HINTS_BIASED_BY_ALL",{enumerable:!0,configurable:!1,writable:!1,value:"Use Both Kinds of Bias"});Object.defineProperty(CTATHintPolicyEnum,"DEFAULT",{enumerable:!0,configurable:!1,writable:!1,value:CTATHintPolicyEnum.HINTS_BIASED_BY_ALL});CTATHintPolicyEnum.prototype=Object.create(Object.prototype);CTATHintPolicyEnum.prototype.constructor=CTATHintPolicyEnum;
CTATHintPolicyEnum.lookup=function(a){for(policy in CTATHintPolicyEnum)if(CTATHintPolicyEnum[policy]==a)return CTATHintPolicyEnum[policy];return CTATHintPolicyEnum.DEFAULT};"undefined"!==typeof module&&(module.exports=CTATHintPolicyEnum);var CTATMsgType=function(){CTATBase.call(this,"CTATMsgType","")};CTATMsgType.findProperty=function(a,b){var d=a.toLowerCase(),e="<"+b.toLowerCase()+">",g=d.indexOf(e)+e.length,d=d.indexOf("</"+b.toLowerCase()+">");if(g<e.length||0>d)return null;e={};e.start=g;e.end=d;return e};
CTATMsgType.makeValues=function(a){if(null==a)return"";if("string"==typeof a)return a;if(a.constructor&&"Array"==a.constructor.name){if(!a.length)return"";for(var b=0,d,e="<value>"+(null==(d=a[b++])?"":d.toString());b<a.length;)e+="</value><value>"+(null==(d=a[b++])?"":d.toString());return e+"</value>"}return a.outerHTML?a.outerHTML:a.toString()};
CTATMsgType.setProperty=function(a,b,d){var e=CTATMsgType.findProperty(a,b),g;e?(g=a.slice(0,e.start),g+=CTATMsgType.makeValues(d),g+=a.slice(e.end,a.length)):(e=a.indexOf("</properties>"),g=a.slice(0,e),g+="<"+b+">"+CTATMsgType.makeValues(d)+"</"+b+">",g+=a.slice(e,a.length));return g};CTATMsgType.getProperty=function(a,b){var d=CTATMsgType.findProperty(a,b);return d?a.slice(d.start,d.end):""};
CTATMsgType.valueToArray=function(a){if(!a.startsWith("<value>"))return null;var b=a.substring(7);if(!a.endsWith("</value>"))return null;b=b.substring(0,b.length-8);b=b.split("</value><value>");ctatdebug("valueToArray("+a+") returns "+b);return b};CTATMsgType.getValue=function(a,b){var d=CTATMsgType.valueToArray(a);return!d||d.length<=b?null:d[b]};CTATMsgType.getMessageType=function(a){return CTATMsgType.getProperty(a,"MessageType")};
CTATMsgType.getTransactionID=function(a){return CTATMsgType.getProperty(a,CTATMessage.TRANSACTION_ID_TAG)};CTATMsgType.setTransactionID=function(a,b){return CTATMsgType.setProperty(a,CTATMessage.TRANSACTION_ID_TAG,b)};CTATMsgType.isCorrectOrIncorrect=function(a){return"string"==typeof a?CTATMsgType.CorrectTypes[a.toLowerCase()]?!0:!1:!1};CTATMsgType.hasTextFeedback=function(a){return"string"==typeof a?CTATMsgType.TextFeedbackTypes[a.toLowerCase()]?!0:!1:!1};
CTATMsgType.isHintResponse=function(a){return"string"==typeof a?CTATMsgType.HintResponseTypes[a.toLowerCase()]?!0:!1:!1};CTATMsgType.isDoneMessage=function(a){var b=CTATMsgType.getProperty(a,"Selection");a=CTATMsgType.getProperty(a,"Action");if(!b||!a)return!1;b=b.toString().toLowerCase();a=a.toString().toLowerCase();var d=CTATMsgType.DONE.toLowerCase();if(d!=b&&d!=CTATMsgType.getValue(b,0))return!1;b=CTATMsgType.BUTTON_PRESSED.toLowerCase();return b!=a&&b!=CTATMsgType.getValue(a,0)?!1:!0};
CTATMsgType.getSAIArraysFromElement=function(a,b){for(var d={selection:[],action:[],input:[]},e=b.getElementChildren(a),g=0;g<e.length;g++){var c=e[g];switch(b.getElementName(c)){case "Selection":for(var c=b.getElementChildren(c),f=0;f<c.length;f++)d.selection.push(b.getNodeTextValue(c[f]));break;case "Action":c=b.getElementChildren(c);for(f=0;f<c.length;f++)d.action.push(b.getNodeTextValue(c[f]));break;case "Input":c=b.getElementChildren(c);for(f=0;f<c.length;f++)d.input.push(b.getNodeTextValue(c[f]));
break;case "properties":return CTATMsgType.getSAIArraysFromElement(c,b)}}return d};Object.defineProperty(CTATMsgType,"CorrectTypes",{enumerable:!1,configurable:!1,writable:!1,value:{correctaction:1,incorrectaction:1,lispcheckaction:1}});Object.defineProperty(CTATMsgType,"TextFeedbackTypes",{enumerable:!1,configurable:!1,writable:!1,value:{showhintsmessage:1,successmessage:1,buggymessage:1,wrongusermessage:1,nohintmessage:1,highlightmsg:1,showhintsmessagefromlisp:1}});
Object.defineProperty(CTATMsgType,"HintResponseTypes",{enumerable:!1,configurable:!1,writable:!1,value:{showhintsmessage:1,nohintmessage:1,showhintsmessagefromlisp:1}});Object.defineProperty(CTATMsgType,"BUGGY_MSG",{enumerable:!1,configurable:!1,writable:!1,value:"BuggyMsg"});Object.defineProperty(CTATMsgType,"DONE",{enumerable:!1,configurable:!1,writable:!1,value:"Done"});Object.defineProperty(CTATMsgType,"BUTTON_PRESSED",{enumerable:!1,configurable:!1,writable:!1,value:"ButtonPressed"});
Object.defineProperty(CTATMsgType,"DEFAULT_STUDENT_ACTOR",{enumerable:!1,configurable:!1,writable:!1,value:"Student"});Object.defineProperty(CTATMsgType,"DEFAULT_TOOL_ACTOR",{enumerable:!1,configurable:!1,writable:!1,value:"Tutor"});Object.defineProperty(CTATMsgType,"UNGRADED_TOOL_ACTOR",{enumerable:!1,configurable:!1,writable:!1,value:"Tutor (unevaluated)"});Object.defineProperty(CTATMsgType,"DEFAULT_ACTOR",{enumerable:!1,configurable:!1,writable:!1,value:CTATMsgType.DEFAULT_STUDENT_ACTOR});
Object.defineProperty(CTATMsgType,"ANY_ACTOR",{enumerable:!1,configurable:!1,writable:!1,value:"Any"});Object.defineProperty(CTATMsgType,"SHOW_ALL_FEEDBACK",{enumerable:!1,configurable:!1,writable:!1,value:"Show All Feedback"});Object.defineProperty(CTATMsgType,"DELAY_FEEDBACK",{enumerable:!1,configurable:!1,writable:!1,value:"Delay Feedback"});Object.defineProperty(CTATMsgType,"HIDE_ALL_FEEDBACK",{enumerable:!1,configurable:!1,writable:!1,value:"Hide All Feedback"});
Object.defineProperty(CTATMsgType,"HIDE_BUT_COMPLETE",{enumerable:!1,configurable:!1,writable:!1,value:"Hide feedback but require all steps"});Object.defineProperty(CTATMsgType,"HIDE_BUT_ENFORCE",{enumerable:!1,configurable:!1,writable:!1,value:"Hide feedback but enforce constraints"});Object.defineProperty(CTATMsgType,"DEFAULT_OUT_OF_ORDER_MESSAGE",{enumerable:!1,configurable:!1,writable:!1,value:CTATLanguageManager.theSingleton.filterString("HIGHLIGHTEDSTEP")});
Object.defineProperty(CTATMsgType,"NOT_DONE_MSG",{enumerable:!1,configurable:!1,writable:!1,value:CTATLanguageManager.theSingleton.filterString("NOTDONE")});Object.defineProperty(CTATMsgType,"TRACE_OUTCOME",{enumerable:!1,configurable:!1,writable:!1,value:"TraceOutcome"});Object.defineProperty(CTATMsgType,"PREVIOUS_FOCUS",{enumerable:!1,configurable:!1,writable:!1,value:"PreviousFocus"});Object.defineProperty(CTATMsgType,"ASSOCIATED_RULES",{enumerable:!1,configurable:!1,writable:!1,value:"AssociatedRules"});
Object.defineProperty(CTATMsgType,"BEGIN_RESTORE",{enumerable:!1,configurable:!1,writable:!1,value:"BeginRestore"});Object.defineProperty(CTATMsgType,"BEGIN_GO_TO_STATE",{enumerable:!1,configurable:!1,writable:!1,value:"BeginGoToState"});Object.defineProperty(CTATMsgType,"END_GO_TO_STATE",{enumerable:!1,configurable:!1,writable:!1,value:"EndGoToState"});Object.defineProperty(CTATMsgType,"BUGGY_MESSAGE",{enumerable:!1,configurable:!1,writable:!1,value:"BuggyMessage"});
Object.defineProperty(CTATMsgType,"CORRECT_ACTION",{enumerable:!1,configurable:!1,writable:!1,value:"CorrectAction"});Object.defineProperty(CTATMsgType,"HINT_REQUEST",{enumerable:!1,configurable:!1,writable:!1,value:"HintRequest"});Object.defineProperty(CTATMsgType,"INCORRECT_ACTION",{enumerable:!1,configurable:!1,writable:!1,value:"InCorrectAction"});Object.defineProperty(CTATMsgType,"INTERFACE_ACTION",{enumerable:!1,configurable:!1,writable:!1,value:"InterfaceAction"});
Object.defineProperty(CTATMsgType,"INTERFACE_IDENTIFICATION",{enumerable:!1,configurable:!1,writable:!1,value:"InterfaceIdentification"});Object.defineProperty(CTATMsgType,"PROBLEM_RESTORE_END",{enumerable:!1,configurable:!1,writable:!1,value:"ProblemRestoreEnd"});Object.defineProperty(CTATMsgType,"PROBLEM_SUMMARY_REQUEST",{enumerable:!1,configurable:!1,writable:!1,value:"ProblemSummaryRequest"});
Object.defineProperty(CTATMsgType,"PROBLEM_SUMMARY_RESPONSE",{enumerable:!1,configurable:!1,writable:!1,value:"ProblemSummaryResponse"});Object.defineProperty(CTATMsgType,"SET_PREFERENCES",{enumerable:!1,configurable:!1,writable:!1,value:"SetPreferences"});Object.defineProperty(CTATMsgType,"SHOW_HINTS_MESSAGE",{enumerable:!1,configurable:!1,writable:!1,value:"ShowHintsMessage"});Object.defineProperty(CTATMsgType,"SUCCESS_MESSAGE",{enumerable:!1,configurable:!1,writable:!1,value:"SuccessMessage"});
Object.defineProperty(CTATMsgType,"START_STATE_END",{enumerable:!1,configurable:!1,writable:!1,value:"StartStateEnd"});Object.defineProperty(CTATMsgType,"STATE_GRAPH",{enumerable:!1,configurable:!1,writable:!1,value:"StateGraph"});Object.defineProperty(CTATMsgType,"UNTUTORED_ACTION",{enumerable:!1,configurable:!1,writable:!1,value:"UntutoredAction"});Object.defineProperty(CTATMsgType,"GO_TO_STATE",{enumerable:!1,configurable:!1,writable:!1,value:"GoToState"});
Object.defineProperty(CTATMsgType,"INTERFACE_REBOOT",{enumerable:!1,configurable:!1,writable:!1,value:"InterfaceReboot"});Object.defineProperty(CTATMsgType,"CompletionValue",{enumerable:!1,configurable:!1,writable:!1,value:["incomplete","complete"]});CTATMsgType.prototype=Object.create(CTATBase.prototype);CTATMsgType.prototype.constructor=CTATMsgType;"undefined"!==typeof module&&(module.exports=CTATMsgType);var CTATVersionComparator=function(){CTATBase.call(this,"CTATVersionComparator","");this.compare=function(a,b){if(null===a||"undefined"===typeof a)return null===b||"undefined"===typeof b?0:-1;if(null===b||"undefined"===typeof b)return 1;var d=0,e=a.split("."),g=b.split("."),c;for(c=0;c<Math.min(e.length,g.length);c++)try{var f=parseInt(e[c]),h=parseInt(g[c]),d=f<h?-1:f>h?1:0;if(0!==d)return d}catch(m){if(d=e[c].toString()<g[c].toString()?-1:e[c].toString()>g[c].toString()?1:0,0!==d)return d}return c<
e.length?1:c<g.length?-1:a.toString()<b.toString()?-1:a.toString()>b.toString()?1:0}};CTATVersionComparator.prototype=Object.create(CTATBase.prototype);CTATVersionComparator.prototype.constructor=CTATVersionComparator;CTATVersionComparator.vc=new CTATVersionComparator;"undefined"!==typeof module&&(module.exports=CTATVersionComparator);var CTATExampleTracerSkill=function(a,b,d,e,g,c,f){CTATBase.call(this,"CTATExampleTracerSkill",b);var h=null==a||""==a.trim()?b:b+" "+a,m=Number(d);Number.isNaN(m)&&(m=CTATExampleTracerSkill.DEFAULT_P_GUESS);var l=Number(e);Number.isNaN(l)&&(l=CTATExampleTracerSkill.DEFAULT_P_KNOWN);var n=Number(c);Number.isNaN(n)&&(n=CTATExampleTracerSkill.DEFAULT_P_LEARN);var p=Number(g);Number.isNaN(p)&&(p=CTATExampleTracerSkill.DEFAULT_P_SLIP);var x=/^0*[xX]([0-9a-fA-F]+)$/.test(f)?parseInt(f,16):/^(\-|\+)?[0-9]+$/.test(f)?
parseInt(f,10):CTATExampleTracerSkill.DEFAULT_HISTORY,q=0,v=0,u=CTATExampleTracerSkill.SKILL_BAR_DELIMITER_v2_11,A=CTATExampleTracerSkill.DEFAULT_MASTERY_THRESHOLD,y=null,C=null,r=this;this.getSkillName=function(){return h};this.getCategory=function(){var a=h.indexOf(" ");return 0>a?"":h.substring(a+1)};this.setTransactionNumber=function(a){q=a};this.updatePKnown=function(a){return l=CTATExampleTracerSkill.updatePKnownStatic(a,m,l,p,n)};this.updateHistory=function(a){return x=CTATExampleTracerSkill.updateHistoryStatic(a,
x)};this.changeOpportunityCount=function(a){return v+=a};this.getTransactionNumber=function(){return q};this.getSkillBarString=function(a){var c=this.getSkillName(),c=c+this.getSkillBarDelimiter()+l,c=c+this.getSkillBarDelimiter()+(this.hasReachedMastery()?"1":"0");!0===a&&(c=c+this.getSkillBarDelimiter()+this.getLabel());return c.toString()};this.getSkillBarDelimiter=function(){return u};this.toXML=function(a){var c;c=""+(' name="'+CTATExampleTracerSkill.getName(h)+'"');c+=' category="'+r.getCategory()+
'"';c+=' label="'+r.getLabel()+'"';c+=' description="'+r.getDescription()+'"';c+=' pKnown="'+Number(l).toString()+'"';c+=' pLearn="'+Number(n).toString()+'"';c+=' pGuess="'+Number(m).toString()+'"';c+=' pSlip="'+Number(p).toString()+'"';c+=' history="'+x+'"';c+=' opportunityCount="'+v+'"';return a?"&lt;Skill"+c+" /&gt;":"<Skill"+c+" />"};this.getPKnown=function(){return l};this.getPLearn=function(){return n};this.getPGuess=function(){return m};this.getPSlip=function(){return p};this.getHistory=function(){return x};
this.getOpportunityCount=function(){return v};this.hasReachedMastery=function(){return null===l||"undefined"===typeof l?!1:l>=A};this.getLabel=function(){return!y||1>y.length?CTATExampleTracerSkill.getName(h):y};this.getDescription=function(){return!C||1>C.length?h:C};this.setVersion=function(a){null!==a&&"undefined"!==typeof a&&0<a.length&&(u=CTATExampleTracerSkill.versionToSkillBarDelimiter(a))};this.setLabel=function(a){y=a};this.setDescription=function(a){C=a};CTATExampleTracerSkill.makeStepID=
function(a,c){for(var b="",d=0,e=a;2>d++;e=c)if(!(null===e||"undefined"===typeof e||1>e.length)){for(var f=!1,g=0;g<e.length;g++)if(null!==e[g]&&"undefined"!==typeof e[g]){var h=e[g].toString();1>h.length||e===a&&("hint".toString().toUpperCase()===h.toString().toUpperCase()||"help".toString().toUpperCase()===h.toString().toUpperCase())||e===c&&CTATMsgType.PREVIOUS_FOCUS.toString().toUpperCase()===h.toString().toUpperCase()||(b=b+(f?",":"[")+h,f=!0)}!0===f&&(b+="]")}return b.toString()};CTATExampleTracerSkill.updateHistoryStatic=
function(a,c){var b,d=1<<CTATExampleTracerSkill.MAX_INTEGER_SHIFT;b=c<<1|(a.toString().toUpperCase()===CTATExampleTracerSkill.CORRECT.toString().toUpperCase()?1:0);return b&d?b^d:b};CTATExampleTracerSkill.updatePKnownStatic=function(a,c,b,d,e){var f=0;if(a.toString().toUpperCase()===CTATExampleTracerSkill.CORRECT.toString().toUpperCase())a=+(b*(1-d)),f=+(a/(a+ +(c*(1-b))));else if(a.toString().toUpperCase()===CTATExampleTracerSkill.INCORRECT.toString().toUpperCase()||a.toString().toUpperCase()===
CTATExampleTracerSkill.HINT.toString().toUpperCase())a=+(b*d),f=+(a/(a+ +((1-b)*(1-c))));return+(f+e*(1-f))};CTATExampleTracerSkill.getName=function(a){var c=a.indexOf(" ");return 0>c?a:a.substring(0,c)};CTATExampleTracerSkill.versionToSkillBarDelimiter=function(a){return null===a||"undefined"===typeof a?CTATExampleTracerSkill.SKILL_BAR_DELIMITER_v2_10:0<=CTATVersionComparator.vc.compare(a,"2.11")?CTATExampleTracerSkill.SKILL_BAR_DELIMITER_v2_11:CTATExampleTracerSkill.SKILL_BAR_DELIMITER_v2_10}};
Object.defineProperty(CTATExampleTracerSkill,"MAX_INTEGER_SHIFT",{enumerable:!1,configurable:!1,writable:!1,value:31});Object.defineProperty(CTATExampleTracerSkill,"HINT",{enumerable:!1,configurable:!1,writable:!1,value:"hint"});Object.defineProperty(CTATExampleTracerSkill,"CORRECT",{enumerable:!1,configurable:!1,writable:!1,value:"correct"});Object.defineProperty(CTATExampleTracerSkill,"INCORRECT",{enumerable:!1,configurable:!1,writable:!1,value:"incorrect"});
Object.defineProperty(CTATExampleTracerSkill,"SKILL_BAR_DELIMITER_v2_10",{enumerable:!1,configurable:!1,writable:!1,value:"="});Object.defineProperty(CTATExampleTracerSkill,"SKILL_BAR_DELIMITER_v2_11",{enumerable:!1,configurable:!1,writable:!1,value:"`"});Object.defineProperty(CTATExampleTracerSkill,"DEFAULT_MASTERY_THRESHOLD",{enumerable:!1,configurable:!1,writable:!1,value:.95});Object.defineProperty(CTATExampleTracerSkill,"DEFAULT_P_GUESS",{enumerable:!1,configurable:!1,writable:!1,value:.2});
Object.defineProperty(CTATExampleTracerSkill,"DEFAULT_P_KNOWN",{enumerable:!1,configurable:!1,writable:!1,value:.3});Object.defineProperty(CTATExampleTracerSkill,"DEFAULT_P_SLIP",{enumerable:!1,configurable:!1,writable:!1,value:.3});Object.defineProperty(CTATExampleTracerSkill,"DEFAULT_P_LEARN",{enumerable:!1,configurable:!1,writable:!1,value:.15});Object.defineProperty(CTATExampleTracerSkill,"DEFAULT_HISTORY",{enumerable:!1,configurable:!1,writable:!1,value:0});CTATExampleTracerSkill.prototype=Object.create(CTATBase.prototype);
CTATExampleTracerSkill.prototype.constructor=CTATExampleTracerSkill;"undefined"!==typeof module&&(module.exports=CTATExampleTracerSkill);var CTATVariableTableCount=0,CTATVariableTable=function(){function a(b){var d={},c;for(c in b)!0===b.hasOwnProperty(c)&&(d[c]="object"!==typeof b[c]?b[c]:a(b[c]));return d}CTATBase.call(this,"CTATVariableTable","");CTATVariableTableCount++;var b={},d=this;this.toString=function(){var a="",d;for(d in b)0<a.length&&(a+=", "),a=a+d+"="+b[d];return"{ "+a+" }"};this.clone=function(){ctatdebug("CTATVariableTable --\x3e in clone; this "+this+", this.getTable() "+this.getTable);var d=new CTATVariableTable;
ctatdebug("CTATVariableTable --\x3e in clone; copy "+d+", copy.setTable() "+d.setTable);d.setTable(a(b));ctatdebug("CTATVariableTable --\x3e out of clone");return d};this.put=function(a,g){d.ctatdebug("CTATVariableTable.put("+a+", "+g+") typeof value "+typeof g);var c;if(a)if(0>a.indexOf("."))b[a]=g;else{var e=a.split(".");if("object"!==typeof b[e[0]]||null===b[e[0]])b[e[0]]={};c=b[e[0]];for(var h=1;h<e.length-1;h++)if("object"!==typeof c[e[h]]||null===c[e[h]])c[e[h]]={},c=c[e[h]];c[e[h]]=g}else console.log("CTATVariableTable.put() warning: null or empty variable name '"+
a+"'");return d};this.getTable=function(){return b};this.setTable=function(a){b=a};this.get=function(a){if(0>a.indexOf("."))return null===b[a]||"undefined"===typeof b[a]?null:b[a];var d=a.split(".");if(null===b[d[0]]||"undefined"===typeof b[d[0]])return null;a=b[d[0]];for(var c=1;c<d.length-1;c++){if(null===a[d[c]]||"undefined"===typeof a[d[c]])return null;a=a[d[c]]}return null===a[d[c]]||"undefined"===typeof a[d[c]]?null:a[d[c]]}};
Object.defineProperty(CTATVariableTable,"serialVersionUID",{enumerable:!1,configurable:!1,writable:!1,value:"201403071830L"});CTATVariableTable.standardizeType=function(a){if("string"!=typeof a||1>a.trim().length)return a;if((!0).toString()==a)return!0;if((!1).toString()==a)return!1;if("null"==a)return null;var b=Number(a);return isNaN(b)?a:b};CTATVariableTable.valueAsString=function(a){return"string"==typeof a?a:String(a)};CTATVariableTable.nameAsString=function(a){return a?a+"_String":null};
CTATVariableTable.prototype=Object.create(CTATBase.prototype);CTATVariableTable.prototype.constructor=CTATVariableTable;"undefined"!==typeof module&&(module.exports=CTATVariableTable);var CTATMatcher=function(a,b,d){CTATBase.call(this,"CTATMatcher","");this.lastResult=null;var e=new CTATSAI("","",""),g=d,c=CTATMsgType.DEFAULT_ACTOR,f=!1,h=this;this.resetMatcher=function(){};this.getSelection=function(){return h.getDefaultSelection()};this.getAction=function(){return h.getDefaultAction()};this.getInput=function(){return h.getDefaultInput()};this.getActor=function(){return c};this.setCaseInsensitive=function(a){g=a};this.getEvaluatedInput=function(a,c){return h.getInput()};this.getTraversalIncrement=
function(){return 1};this.getTutorSAI=function(a,c,b){a=String(b).toLowerCase()==CTATExampleTracerLink.CORRECT_ACTION.toLowerCase()?a:h.getDefaultSAI();console.log("CTATMatcher.getTutorSAI() superclass method called, should be subclass;\n  returning: "+a);return a};this.getDefaultSelection=function(){return h.getDefaultSAI().getSelection()};this.getDefaultAction=function(){return h.getDefaultSAI().getAction()};this.getDefaultInput=function(){return h.getDefaultSAI().getInput()};this.getDefaultSAI=
function(){return e};this.setDefaultSAI=function(a){e=a};this.getDefaultActor=function(){switch(String(getActor()).toLowerCase()){case CTATMsgType.DEFAULT_STUDENT_ACTOR.toLowerCase():return CTATMsgType.DEFAULT_STUDENT_ACTOR;case CTATMsgType.DEFAULT_TOOL_ACTOR.toLowerCase():return CTATMsgType.DEFAULT_TOOL_ACTOR;case CTATMsgType.UNGRADED_TOOL_ACTOR.toLowerCase():return CTATMsgType.DEFAULT_TOOL_ACTOR;case CTATMsgType.ANY_ACTOR.toLowerCase():return CTATMsgType.DEFAULT_TOOL_ACTOR;default:return console.log("CTATMatcher.getDefaultActor() unexpected value for actor: "+
c+"; returning "+CTATMsgType.DEFAULT_ACTOR),CTATMsgType.DEFAULT_ACTOR}};this.getInput=function(){return h.getDefaultInput()};this.getCaseInsensitive=function(){return g};this.match=function(a,c,b,d,e){console.log("CTATMatcher superclass method called: match("+a+", "+c+", "+b+", "+d+")");return!1};this.matchForHint=function(a,c,b,d){console.log("CTATMatcher superclass method called: matchForHint("+a+", "+c+", "+b+", vt)");return!1};this.matchActor=function(a){a=String(a).toUpperCase();var c=String(h.getActor()).toUpperCase();
ctatdebug("CTATMatcher.matchActor("+a+") myActor is "+c);return CTATMsgType.ANY_ACTOR.toString().toUpperCase()==c||CTATMsgType.UNGRADED_TOOL_ACTOR.toString().toUpperCase()==c&&CTATMsgType.DEFAULT_TOOL_ACTOR.toString().toUpperCase()==a||CTATMsgType.UNGRADED_TOOL_ACTOR.toString().toUpperCase()==a&&CTATMsgType.DEFAULT_TOOL_ACTOR.toString().toUpperCase()==c?!0:c==a};this.getDefaultSelectionArray=function(){return h.getDefaultSAI().getSelectionArray()};this.getDefaultActionArray=function(){return h.getDefaultSAI().getActionArray()};
this.getDefaultInputArray=function(){return h.getDefaultSAI().getInputArray()};this.getLastResult=function(){return null===h.lastResult||"undefined"===typeof h.lastResult?"":h.lastResult.toString()};this.setActor=function(a){ctatdebug("CTATMatcher --\x3e in setActor("+a+")");if(null===a||"undefined"===typeof a)a=CTATMsgType.DEFAULT_ACTOR;a=String(a).toLowerCase().trim();c="tool"==a?CTATMsgType.DEFAULT_TOOL_ACTOR:a==CTATMsgType.DEFAULT_STUDENT_ACTOR.toLowerCase()?CTATMsgType.DEFAULT_STUDENT_ACTOR:
a==CTATMsgType.DEFAULT_TOOL_ACTOR.toLowerCase()?CTATMsgType.DEFAULT_TOOL_ACTOR:a==CTATMsgType.UNGRADED_TOOL_ACTOR.toLowerCase()?CTATMsgType.UNGRADED_TOOL_ACTOR:a==CTATMsgType.ANY_ACTOR.toLowerCase()?CTATMsgType.ANY_ACTOR:CTATMsgType.DEFAULT_ACTOR};this.array2ConcatString=function(a){var c="";if(null==a)return c;if(!Array.isArray(a))return a.toString();a.forEach(function(a){null!=a&&(c+=a.toString()+"\n")});return c.substring(0,0<c.length?c.length-1:0)};this.matchConcatenation=function(a){return h.matchSingle(h.array2ConcatString(a))};
this.isLinkTriggered=function(){return f};this.setLinkTriggered=function(a){f=a};this.evaluateReplacement=function(a,c,b){return""};this.replaceInput=function(){return!!h.getReplacementFormula()};this.getReplacementFormula=function(){return""}};CTATMatcher.prototype.toString=function(){console.log("Error: CTATMatcher.toString() called; should be overridden in subclass");return"This is CTATMatcher."};CTATMatcher.prototype.setParameter=function(a,b,d){};
CTATMatcher.isTutorActor=function(a,b){return CTATMsgType.DEFAULT_TOOL_ACTOR.toUpperCase()===a.toUpperCase()||CTATMsgType.UNGRADED_TOOL_ACTOR.toUpperCase()===a.toUpperCase()||b&&CTATMsgType.ANY_ACTOR.toUpperCase()===a.toUpperCase()?!0:!1};Object.defineProperty(CTATMatcher,"NON_SINGLE",{enumerable:!1,configurable:!1,writable:!1,value:-1});Object.defineProperty(CTATMatcher,"SELECTION",{enumerable:!1,configurable:!1,writable:!1,value:0});
Object.defineProperty(CTATMatcher,"ACTION",{enumerable:!1,configurable:!1,writable:!1,value:1});Object.defineProperty(CTATMatcher,"INPUT",{enumerable:!1,configurable:!1,writable:!1,value:2});Object.defineProperty(CTATMatcher,"VECTOR",{enumerable:!1,configurable:!1,writable:!1,value:3});Object.defineProperty(CTATMatcher,"ACTOR",{enumerable:!1,configurable:!1,writable:!1,value:"Actor"});CTATMatcher.prototype=Object.create(CTATBase.prototype);CTATMatcher.prototype.constructor=CTATMatcher;
"undefined"!==typeof module&&(module.exports=CTATMatcher);var CTATTreeNode={};
(function(){var a;a=function(){function a(){}a.operators=[["CONST"],["VAR"],["EXP","ROOT"],["UPLUS","UMINUS"],["ITIMES","TIMES","DIVIDE"],["IDIVIDE","REM"],["PLUS","MINUS"],"LESS LESSEQUAL EQUAL NOTEQUAL GREATEREQUAL GREATER".split(" ")];a.relationalOperators="LESS LESSEQUAL EQUAL NOTEQUAL GREATEREQUAL GREATER".split(" ");a.operatorPrecedence=function(a,b){return Math.sign(this.operators.findIndex(function(b){return b.includes(a)})-this.operators.findIndex(function(a){return a.includes(b)}))};a.operatorStrings=
{EXP:"^",ROOT:"|",UPLUS:"+",UMINUS:"-",ITIMES:"",TIMES:"*",DIVIDE:"/",IDIVIDE:"//",REM:"%",PLUS:"+",MINUS:"-",LESS:"<",LESSEQUAL:"<=",EQUAL:"=",NOTEQUAL:"!=",GREATEREQUAL:">=",GREATER:">"};a.toOperatorString=function(a){return this.operatorStrings[a]||""};a.diff=function(a,b){return a.filter(function(a){return!b.includes(a)})};a.prototype.addParens=function(){this.parens++;return this};a.prototype.toString=function(a){var b,d;this.checkParens()&&(a="("+a+")");this.inverted()&&(a="1/"+a);this.negated()&&
(a="-"+a);b=0;for(d=this.parens;0<=d?b<d:b>d;0<=d?++b:--b)a="("+a+")";return a};a.prototype.setParens=function(a,b){null==b&&(b=!1);this.checkParens(a,b)&&(this.parens=1);return this};a.prototype.checkParens=function(b,e){var d;null==e&&(e=!1);null!=b?d=this.negated()?"UMINUS":this.inverted()?"DIVIDE":this.operator:(b=this.negated()?"MINUS":this.inverted()?"DIVIDE":null,d=this.operator);d=a.operatorPrecedence(b,d);return null!=b&&(0>d||0===d&&e)};a.prototype.evaluate=function(a){return this.sign*
Math.pow(a,this.exp)};a.prototype.applyOperator=function(a,b){switch(this.operator){case "LESS":return a<b;case "GREATER":return a>b;case "LESSEQUAL":return a<=b;case "GREATEREQUAL":return a>=b;case "EQUAL":return a===b;case "NOTEQUAL":return a!==b;case "PLUS":return a+b;case "MINUS":return a-b;case "TIMES":case "ITIMES":return a*b;case "DIVIDE":return a/b;case "EXP":return Math.pow(a,b);case "ROOT":return Math.pow(a,1)/b;case "REM":return a%b;case "IDIVIDE":return Math.floor(a/b);case "UPLUS":return a;
case "UMINUS":return-a}};a.prototype.equals=function(a){return a&&this.operator===a.operator&&this.sign===a.sign&&this.exp===a.exp&&this.parens===a.parens};a.prototype.simplify=function(a){this.methods=a;return this.simplifyNode(this.methods)};a.prototype.simplifyNode=function(a){var b,d,c,f;this.methods=a;f=this;c=this.methods;a=0;for(b=c.length;a<b;a++)d=c[a],f=f[d].call(f),f.methods=this.methods;delete f.methods;return f};a.prototype.simpleFlatten=function(){return this};a.prototype.flatten=function(){this.parens=
0;return this};a.prototype.computeConstants=function(){return this};a.prototype.combineSimilar=function(){return this};a.prototype.expand=function(){return this};a.prototype.distribute=function(){return this};a.prototype.removeIdentity=function(){return this};a.prototype.sort=function(){return this};a.prototype.spreadIdentity=function(){return this};a.prototype.stripIdentity=function(){return this};a.prototype.multiplyOne=function(a){null==a&&(a=!1);return(new CTATMultiplicationNode("TIMES",[new CTATConstantNode(1,
a),this])).popNegation().pushNegation()};a.prototype.powerOne=function(a){null==a&&(a=!1);return(new CTATPowerNode("EXP",this,new CTATConstantNode(1,a))).popInversion().pushInversion().popNegation()};a.prototype.compare=function(b,e){return a.operatorPrecedence(this.operator,b.operator)};a.prototype.compareSigns=function(a,b){return(Math.sign(this.sign-a.sign)||Math.sign(this.exp-a.exp))*b};a.prototype.countVariables=function(){return 0};a.prototype.pushNegation=function(){return this};a.prototype.popNegation=
function(){return this};a.prototype.pushInversion=function(){return this};a.prototype.popInversion=function(){return this};a.prototype.negate=function(){this.sign=-this.sign;return this};a.prototype.invert=function(){this.exp=-this.exp;return this};a.prototype.addition=function(){return"PLUS"===this.operator};a.prototype.subtraction=function(){return"MINUS"===this.operator};a.prototype.multiplication=function(){return"TIMES"===this.operator};a.prototype.division=function(){return"DIVIDE"===this.operator};
a.prototype.intDivision=function(){return"IDIVIDE"===this.operator};a.prototype.power=function(){return"EXP"===this.operator};a.prototype.root=function(){return"ROOT"===this.operator};a.prototype.negation=function(){return"UMINUS"===this.operator};a.prototype.unary=function(){var a;return"UPLUS"===(a=this.operator)||"UMINUS"===a};a.prototype.constant=function(a){return!1};a.prototype.integer=function(){return!1};a.prototype.negated=function(){return 0>this.sign};a.prototype.inverted=function(){return 0>
this.exp};a.prototype.parented=function(){return 0<this.parens};a.prototype.even=function(){return!1};return a}();"undefined"!==typeof module&&null!==module?module.exports=a:this.CTATTreeNode=a}).call(this);var CTATRelationNode={};
(function(){var a,b=function(a,b){function c(){this.constructor=a}for(var e in b)d.call(b,e)&&(a[e]=b[e]);c.prototype=b.prototype;a.prototype=new c;a.__super__=b.prototype;return a},d={}.hasOwnProperty;a=function(a){function d(a,b,d,e,g,n){this.operator=a;this.left=b;this.right=d;this.parens=null!=e?e:0;this.sign=null!=g?g:1;this.exp=null!=n?n:1}b(d,a);d.prototype.clone=function(){return new d(this.operator,this.left.clone(),this.right.clone(),this.parens,this.sign,this.exp)};d.prototype.toString=
function(){this.left.setParens(this.operator);this.right.setParens(this.operator);return d.__super__.toString.call(this,""+this.left.toString()+CTATTreeNode.toOperatorString(this.operator)+this.right.toString())};d.prototype.evaluate=function(){return this.applyOperator(this.left.evaluate(),this.right.evaluate())};d.prototype.equals=function(a){return d.__super__.equals.call(this,a)&&this.left.equals(a.left)&&this.right.equals(a.right)};d.prototype.simplify=function(a){this.methods=a;this.left=this.left.simplify(this.methods);
this.right=this.right.simplify(this.methods);return d.__super__.simplify.apply(this,arguments)};d.prototype.computeConstants=function(){return this.left.constant()&&this.right.constant()?new CTATConstantNode(this.evaluate()):this};d.prototype.sort=function(){var a;switch(this.operator){case "GREATER":this.operator="LESS";a=[this.right,this.left];this.left=a[0];this.right=a[1];break;case "GREATEREQUAL":this.operator="LESSEQUAL";a=[this.right,this.left];this.left=a[0];this.right=a[1];break;case "EQUAL":case "NOTEQUAL":0>
this.left.compare(this.right)&&(a=[this.right,this.left],this.left=a[0],this.right=a[1])}return this};d.prototype.countVariables=function(){return this.left.countVariables()+this.right.countVariables()};return d}(CTATTreeNode);"undefined"!==typeof module&&null!==module?module.exports=a:this.CTATRelationNode=a}).call(this);var CTATAdditionNode={};
(function(){var a,b=function(a,b){function c(){this.constructor=a}for(var e in b)d.call(b,e)&&(a[e]=b[e]);c.prototype=b.prototype;a.prototype=new c;a.__super__=b.prototype;return a},d={}.hasOwnProperty;a=function(a){function d(a,b,d,e,g){this.operator=a;this.terms=b;this.parens=null!=d?d:0;this.sign=null!=e?e:1;this.exp=null!=g?g:1}b(d,a);d.prototype.clone=function(){return new d(this.operator,this.terms.map(function(a){return a.clone()}),this.parens,this.sign,this.exp)};d.prototype.toString=function(){return d.__super__.toString.call(this,
this.terms.reduce(function(a){return function(c,b){b.setParens(a.operator);return""+c+(c&&!b.negated()?"+":"")+b.toString()}}(this)))};d.prototype.evaluate=function(){return d.__super__.evaluate.call(this,this.terms.reduce(function(a){return function(c,b){return a.applyOperator(c,b.evaluate())}}(this),0))};d.prototype.equals=function(a){return d.__super__.equals.call(this,a)&&this.terms.length===a.terms.length&&this.terms.every(function(c,b){return c.equals(a.terms[b])})};d.prototype.simplify=function(a){this.methods=
a;this.terms=this.terms.map(function(a){return function(c){return c.simplify(a.methods)}}(this));return d.__super__.simplify.apply(this,arguments)};d.prototype.simpleFlatten=function(){this.terms[0].negation()&&!this.terms[0].inverted()&&(this.terms[0]=this.terms[0].base.negate());this.subtraction()&&(this.terms[1].negate(),this.operator="PLUS");this.terms=this.terms.reduce(function(a,b){b.inverted()||b.parented()||!b.addition()?a.push(b):a.push.apply(a,b.pushNegation().terms);return a},[]);return this};
d.prototype.flatten=function(){d.__super__.flatten.apply(this,arguments);this.simpleFlatten();return this.pushNegation()};d.prototype.computeConstants=function(){var a,b;0<=(b=this.terms.findIndex(function(a){return a.constant()}))&&(a=this.terms[b].evaluate(),this.terms=this.terms.filter(function(c,d){return d<=b||!c.constant()||(a+=c.evaluate())&&!1}),0===a&&1<this.terms.length?this.terms.splice(b,1):this.terms[b].set(a));return 1<this.terms.length?this:this.pushInversion().terms[0]};d.prototype.combineSimilar=
function(){var a;a=[];this.terms.forEach(function(c){var b,d;d=c.constant()?[null,c]:(c=c.multiplyOne(),[c,c.factors.shift()]);return(b=a.find(function(a){var c;return null!=(c=a[0])?c.equals(d[0]):void 0}))?b[1]+=d[1].evaluate():a.push([d[0],d[1].evaluate()])});this.terms=a.reduce(function(a,c){0!==c[1]&&(c[1]=(new CTATConstantNode(c[1])).popNegation(),c[0]?(c[0].factors.unshift(c[1]),a.push(c[0].removeIdentity())):a.push(c[1]));return a},[]);if(1<this.terms.length)return this;1!==this.terms.length&&
(this.terms[0]=new CTATConstantNode(0));return this.pushInversion().terms[0]};d.prototype.removeIdentity=function(a){var c;null==a&&(a=!1);c=this.terms.filter(function(c){return!c.constant(0,a)});this.terms=c.length?c:this.terms.slice(0,1);return 1<this.terms.length?this:this.pushInversion().terms[0]};d.prototype.sort=function(){this.spreadIdentity();this.terms=this.terms.sort(function(a,b){return-a.compare(b,!0)});return this.stripIdentity()};d.prototype.spreadIdentity=function(){this.terms=this.terms.map(function(a){return a.multiplyOne(!0)});
return this};d.prototype.stripIdentity=function(){this.terms=this.terms.map(function(a){return a.removeIdentity(!0)});return this};d.prototype.compare=function(a,b){var c;return(c=d.__super__.compare.apply(this,arguments))||this.countVariables()-a.countVariables()||this.terms.some(function(d,e){return c=d.compare(a.terms[e],b)})&&c||this.compareSigns(a,b)};d.prototype.countVariables=function(){return this.terms.reduce(function(a,b){return a+b.countVariables()},0)};d.prototype.pushNegation=function(){this.negated()&&
(this.negate(),this.terms.forEach(function(a){return a.negate()}));return this};d.prototype.popNegation=function(){this.terms[0].negated()&&(this.negate(),this.terms.forEach(function(a){return a.negate()}));return this};d.prototype.pushInversion=function(){this.inverted()&&(this.invert(),this.terms[0].invert());return this};d.prototype.even=function(){return!this.inverted&&this.terms.every(function(a){return a.even()})};return d}(CTATTreeNode);"undefined"!==typeof module&&null!==module?module.exports=
a:this.CTATAdditionNode=a}).call(this);var CTATMultiplicationNode={};
(function(){var a,b=function(a,b){function c(){this.constructor=a}for(var e in b)d.call(b,e)&&(a[e]=b[e]);c.prototype=b.prototype;a.prototype=new c;a.__super__=b.prototype;return a},d={}.hasOwnProperty;a=function(a){function d(a,b,d,e,g){this.operator=a;this.factors=b;this.parens=null!=d?d:0;this.sign=null!=e?e:1;this.exp=null!=g?g:1}b(d,a);d.prototype.clone=function(){return new d(this.operator,this.factors.map(function(a){return a.clone()}),this.parens,this.sign,this.exp)};d.prototype.toString=
function(){return d.__super__.toString.call(this,this.factors.reduce(function(a){return function(c,b){var d,e;e=b.inverted()?(b.invert(),b.setParens("DIVIDE",!!c),d=b.toString(),b.invert(),"/"):(b.setParens(a.operator,!!c),/^[\d+-]/.test(d=b.toString())&&/\d$/.test(c)?"*":"");return""+c+e+d}}(this),this.factors[0].inverted()?"1":""))};d.prototype.evaluate=function(){return d.__super__.evaluate.call(this,this.factors.reduce(function(a){return function(c,b){return a.applyOperator(c,b.evaluate())}}(this),
1))};d.prototype.equals=function(a){return d.__super__.equals.call(this,a)&&this.factors.length===a.factors.length&&this.factors.every(function(c,b){return c.equals(a.factors[b])})};d.prototype.simplify=function(a){this.methods=a;this.factors=this.factors.map(function(a){return function(c){return c.simplify(a.methods)}}(this));return d.__super__.simplify.apply(this,arguments)};d.prototype.simpleFlatten=function(){this.division()&&this.factors[1].invert();this.operator="TIMES";this.factors=this.factors.reduce(function(a,
b){b.parented()||!b.multiplication()?a.push(b):a.push.apply(a,b.pushNegation().pushInversion().factors);return a},[]);return this};d.prototype.flatten=function(){d.__super__.flatten.apply(this,arguments);this.simpleFlatten();return this.popNegation()};d.prototype.computeConstants=function(){var a,b;0<=(b=this.factors.findIndex(function(a){return a.constant()}))&&(a=this.factors[b].evaluate(),this.factors=this.factors.filter(function(c,d){return d<=b||!c.constant()||(a*=c.evaluate())&&!1}),1===a&&
1<this.factors.length?this.factors.splice(b,1):this.factors[b].set(a));return 1<this.factors.length?this:this.pushNegation().pushInversion().factors[0]};d.prototype.combineSimilar=function(){var a;a=[];this.factors.forEach(function(c){var b,d,e,f;f=c.constant()?[null,c]:c.power()?c.exponent.constant()?(c.pushInversion(),[c.base,c.exponent]):(c.exponent=c.exponent.multiplyOne(),[c,c.exponent.factors.shift()]):(c=c.powerOne(),[c.base,c.exponent]);return(b=a.find(function(a){var c;return null!=(c=a[0])?
c.equals(f[0]):void 0}))?b[1]+=(null!=(d=f[1])?d.evaluate():void 0)||1:a.push([f[0],(null!=(e=f[1])?e.evaluate():void 0)||1])});this.factors=a.reduce(function(a,c){0!==c[1]&&(c[1]=(new CTATConstantNode(c[1])).popNegation(),c[0]?c[1].constant(1)?a.push(c[0]):c[0].power()?(c[0].exponent.factors.unshift(c[1]),a.push(c[0])):a.push((new CTATPowerNode("EXP",c[0],c[1])).popInversion()):a.push(c[1]));return a},[]);if(1<this.factors.length)return this;1!==this.factors.length&&(this.factors[0]=new CTATConstantNode(1));
return this.pushNegation().pushInversion().factors[0]};d.prototype.distribute=function(){var a,b;a=this.factors.filter(function(a){return!a.inverted()});b=this.factors.filter(function(a){return a.inverted()});return!this.distributedOrSingle(a)||!this.distributedOrSingle(b)||this.single(a)&&b.length&&this.distributed(b)?(this.distributed(b)?(a=this.distributeFactors(this.factors),b=[]):this.distributed(a)?(b=this.distributeFactors(this.factors),a=[]):(a=this.distributeFactors(a),b=this.distributeFactors(b)),
this.factors=b.length?a.length?[this.packTerms(a),this.packTerms(b).invert()]:[this.packTerms(b).invert()]:[this.packTerms(a)],1<this.factors.length?this:this.pushNegation().pushInversion().factors[0]):this};d.prototype.distributedOrSingle=function(a){return this.distributed(a)||this.single(a)};d.prototype.distributed=function(a){return a.every(function(a){return!a.addition()})};d.prototype.single=function(a){return 1===a.length&&a[0].addition()};d.prototype.distributeFactors=function(a){var c;c=
a[0].addition()?a[0].terms.map(function(a){return a.multiplication()?a.pushNegation().factors:[a]}):[[a[0]]];a.slice(1).forEach(function(a){var b;return a.addition()?1===c.length?c=a.terms.map(function(a){var b;b=c[0].map(function(a){return a.clone()});a.multiplication()?b.push.apply(b,a.pushNegation().factors):b.push(a);return b}):c=c.reduce(function(c,b){c.push.apply(c,a.terms.map(function(a){var c;c=b.map(function(a){return a.clone()});a.multiplication()?c.push.apply(c,a.pushNegation().factors.map(function(a){return a.clone()})):
c.push(a.clone());return c}));return c},[]):1===c.length?a.multiplication()?(b=c[0]).push.apply(b,a.pushNegation().factors):c[0].push(a):c.forEach(function(b,d){var e;return a.multiplication()?(e=c[d]).push.apply(e,a.pushNegation().factors.map(function(a){return a.clone()})):c[d].push(a.clone())})});return c};d.prototype.packTerms=function(a){var c;c=CTATTreeNode.diff(this.methods,["flatten","distribute"]);return(new CTATAdditionNode("PLUS",a.map(function(a){return(new d("TIMES",a)).popNegation().simplifyNode(c)}))).simplifyNode(c)};
d.prototype.removeIdentity=function(a){var c;null==a&&(a=!1);this.popNegation();c=this.factors.filter(function(c){return!c.constant(1,a)});this.factors=c.length?c:this.factors.slice(0,1);(c=this.factors.find(function(c){return c.constant(0,a)}))&&this.factors.every(function(a){return!a.inverted()&&(!a.power()||a.exponent.constant())})&&(this.factors=[c]);return 1<this.factors.length?this:this.pushNegation().pushInversion().factors[0]};d.prototype.sort=function(){this.spreadIdentity();this.factors=
this.factors.sort(function(a,b){return a.compare(b)});return this.stripIdentity()};d.prototype.spreadIdentity=function(){this.factors=this.factors.map(function(a){return a.powerOne(!0)});return this};d.prototype.stripIdentity=function(){this.factors=this.factors.map(function(a){return a.removeIdentity(!0)});return this.popNegation()};d.prototype.multiplyOne=function(a){null==a&&(a=!1);this.factors[0].constant()||this.factors.unshift(new CTATConstantNode(1,a));return this.pushNegation()};d.prototype.compare=
function(a,b){var c,e;return(e=d.__super__.compare.apply(this,arguments))||this.countVariables()-a.countVariables()||(c=a.factors.slice(0).reverse())&&this.factors.slice(0).reverse().some(function(a,d){return e=a.compare(c[d],b)})&&e||this.compareSigns(a,b)};d.prototype.countVariables=function(){return this.factors.reduce(function(a,b){return a+b.countVariables()},0)};d.prototype.pushNegation=function(){this.negated()&&(this.negate(),this.factors[0].negate());return this};d.prototype.popNegation=
function(){this.factors.forEach(function(a){return function(c){if(c.negated())return a.negate(),c.negate()}}(this));return this};d.prototype.pushInversion=function(){this.inverted()&&(this.invert(),this.factors.forEach(function(a){return a.invert()}));return this};d.prototype.even=function(){return!this.inverted()&&this.factors.every(function(a){return a.integer()})&&this.factors.some(function(a){return a.even()})};return d}(CTATTreeNode);"undefined"!==typeof module&&null!==module?module.exports=
a:this.CTATMultiplicationNode=a}).call(this);var CTATIntDivisionNode={};
(function(){var a,b=function(a,b){function c(){this.constructor=a}for(var e in b)d.call(b,e)&&(a[e]=b[e]);c.prototype=b.prototype;a.prototype=new c;a.__super__=b.prototype;return a},d={}.hasOwnProperty;a=function(a){function d(a,b,d,e,g,n){this.operator=a;this.dividend=b;this.divisor=d;this.parens=null!=e?e:0;this.sign=null!=g?g:1;this.exp=null!=n?n:1}b(d,a);d.prototype.clone=function(){return new d(this.operator,this.dividend.clone(),this.divisor.clone(),this.parens,this.sign,this.exp)};d.prototype.toString=
function(){this.dividend.setParens(this.operator);this.divisor.setParens(this.operator,!0);return d.__super__.toString.call(this,""+this.dividend.toString()+CTATTreeNode.toOperatorString(this.operator)+this.divisor.toString())};d.prototype.evaluate=function(){return d.__super__.evaluate.call(this,this.applyOperator(this.dividend.evaluate(),this.divisor.evaluate()))};d.prototype.equals=function(a){return d.__super__.equals.call(this,a)&&this.dividend.equals(a.dividend)&&this.divisor.equals(a.divisor)};
d.prototype.simplify=function(a){this.methods=a;this.dividend=this.dividend.simplify(this.methods);this.divisor=this.divisor.simplify(this.methods);return d.__super__.simplify.apply(this,arguments)};d.prototype.computeConstants=function(){return this.dividend.constant()&&this.divisor.constant()?new CTATConstantNode(this.evaluate()):this};d.prototype.removeIdentity=function(a){null==a&&(a=!1);return this.divisor.constant(1,a)?(this.intDivision()||(this.dividend=new CTATConstantNode(0,a)),this.pushNegation().pushInversion().dividend):
this.popNegation()};d.prototype.compare=function(a,b){return d.__super__.compare.apply(this,arguments)||this.dividend.compare(a.dividend,b)||this.divisor.compare(a.divisor,b)||this.operator!==a.operator&&(this.intDivision()&&-1||1)||this.compareSigns(a,b)};d.prototype.countVariables=function(){return this.dividend.countVariables()+divisor.countVariables()};d.prototype.pushNegation=function(){this.intDivision()&&this.negated()&&(this.negate(),this.dividend.negate());return this};d.prototype.pushInversion=
function(){this.intDivision()&&this.inverted()&&(this.invert(),this.dividend.invert());return this};d.prototype.popNegation=function(){this.divisor.negated()&&(this.divisor.negate(),this.intDivision()&&this.dividend.negate());return this};d.prototype.even=function(){return!this.inverted&&"REM"===this.operator&&this.dividend.even()&&this.divisor.even()};return d}(CTATTreeNode);"undefined"!==typeof module&&null!==module?module.exports=a:this.CTATIntDivisionNode=a}).call(this);var CTATUnaryNode={};
(function(){var a,b=function(a,b){function c(){this.constructor=a}for(var e in b)d.call(b,e)&&(a[e]=b[e]);c.prototype=b.prototype;a.prototype=new c;a.__super__=b.prototype;return a},d={}.hasOwnProperty;a=function(a){function d(a,b,d,e,g){this.operator=a;this.base=b;this.parens=null!=d?d:0;this.sign=null!=e?e:1;this.exp=null!=g?g:1}b(d,a);d.prototype.clone=function(){return new d(this.operator,this.base,this.parens,this.sign,this.exp)};d.prototype.toString=function(){return d.__super__.toString.call(this,""+
CTATTreeNode.toOperatorString(this.operator)+this.base.toString())};d.prototype.evaluate=function(){return d.__super__.evaluate.call(this,this.applyOperator(this.base.evaluate()))};d.prototype.equals=function(a){return d.__super__.equals.call(this,a)&&this.base.equals(a.base)};d.prototype.simplify=function(a){this.methods=a;this.base=this.base.simplify(this.methods);return d.__super__.simplify.apply(this,arguments)};d.prototype.flatten=function(){d.__super__.flatten.apply(this,arguments);this.negation()&&
(this.negate(),this.operator="UPLUS");return this.pushNegation().pushInversion().base};d.prototype.compare=function(a,b){return a.unary()&&this.base.compare(a.base,b)||d.__super__.compare.apply(this,arguments)||this.compareSigns(a,b)};d.prototype.countVariables=function(){return this.base.countVariables()};d.prototype.pushNegation=function(){this.negated()&&(this.negate(),this.base.negate());return this};d.prototype.pushInversion=function(){this.inverted()&&(this.invert(),this.base.invert());return this};
d.prototype.constant=function(a,b){null==b&&(b=!1);return this.base.constant(a,b)};return d}(CTATTreeNode);"undefined"!==typeof module&&null!==module?module.exports=a:this.CTATUnaryNode=a}).call(this);var CTATPowerNode={};
(function(){var a,b=function(a,b){function c(){this.constructor=a}for(var e in b)d.call(b,e)&&(a[e]=b[e]);c.prototype=b.prototype;a.prototype=new c;a.__super__=b.prototype;return a},d={}.hasOwnProperty;a=function(a){function d(a,b,d,e,g,n){this.operator=a;this.base=b;this.exponent=d;this.parens=null!=e?e:0;this.sign=null!=g?g:1;this.exp=null!=n?n:1}b(d,a);d.prototype.clone=function(){return new d(this.operator,this.base.clone(),this.exponent.clone(),this.parens,this.sign,this.exp)};d.prototype.toString=
function(){this.base.setParens(this.operator);this.exponent.setParens(this.operator);return d.__super__.toString.call(this,""+this.base.toString()+CTATTreeNode.toOperatorString(this.operator)+this.exponent.toString())};d.prototype.evaluate=function(){return d.__super__.evaluate.call(this,this.applyOperator(this.base.evaluate(),this.exponent.evaluate()))};d.prototype.equals=function(a){return d.__super__.equals.call(this,a)&&this.base.equals(a.base)&&this.exponent.equals(a.exponent)};d.prototype.simplify=
function(a){this.methods=a;this.base=this.base.simplify(this.methods);this.exponent=this.exponent.simplify(this.methods);return d.__super__.simplify.apply(this,arguments)};d.prototype.flatten=function(){var a,b;d.__super__.flatten.apply(this,arguments);this.root()&&(this.exponent.invert(),this.operator="EXP");this.popNegation().popInversion();return this.base.power()?(b=CTATTreeNode.diff(this.methods,["flatten"]),a=this.base.exponent.multiplication()?this.base.exponent.pushNegation().pushInversion().factors:
[this.base.exponent],this.exponent.multiplication()?a.push.apply(a,this.exponent.pushNegation().pushInversion().factors):a.push(this.exponent),this.base.exponent=(new CTATMultiplicationNode("TIMES",a)).simplifyNode(b),this.pushBaseNegation().pushBaseInversion().base):this};d.prototype.computeConstants=function(){return this.base.constant()&&(this.exponent.constant()||this.exponent.multiplication()&&this.exponent.factors[0].constant())?(this.exponent.constant()?(this.base=new CTATConstantNode(this.evaluate()),
this.exponent=null):(this.base=new CTATConstantNode((new d("EXP",this.base,this.exponent.factors.shift())).evaluate()),1===this.exponent.factors.length&&(this.exponent=this.exponent.pushNegation().pushInversion().factors[0])),this.exponent?this:this.pushBaseNegation().pushBaseInversion().base):this};d.prototype.powerOne=function(a){null==a&&(a=!1);this.exponent=this.exponent.multiplyOne(a);return this.pushInversion()};d.prototype.expand=function(){var a,b,d;if(this.base.addition()&&(this.exponent.integer()&&
1<this.exponent.value||this.exponent.multiplication()&&this.exponent.factors[0].integer()&&1<this.exponent.factors[0].value)){this.exponent.integer()?(a=this.exponent,this.exponent=null):(a=this.exponent.factors.shift(),1===this.exponent.factors.length&&(this.exponent=this.exponent.pushNegation().pushInversion().factors[0]));b=[this.base];d=1;for(a=a.evaluate();1<=a?d<a:d>a;1<=a?++d:--d)b.push(this.base.clone());this.base=(new CTATMultiplicationNode("TIMES",b)).simplifyNode(["distribute"]);return this.exponent?
this:this.pushBaseNegation().pushBaseInversion().base}return this};d.prototype.distribute=function(){var a;return this.base.multiplication()||this.exponent.addition()?(a=this.base.multiplication()?this.base.pushNegation().pushInversion().factors:[this.base],a=this.exponent.addition()?a.reduce(function(a){return function(b,c){b.push.apply(b,a.exponent.terms.map(function(a){return[c.clone(),a.clone()]}));return b}}(this),[]):a.map(function(a){return function(b){return[b,a.exponent.clone()]}}(this)),
this.base=this.packFactors(a),this.pushBaseNegation().pushBaseInversion().base):this};d.prototype.packFactors=function(a){var b;b=CTATTreeNode.diff(this.methods,["flatten"]);return new CTATMultiplicationNode("TIMES",a.map(function(a){return(new d("EXP",a[0],a[1])).simplifyNode(b)}))};d.prototype.removeIdentity=function(a){null==a&&(a=!1);this.popInversion();if(this.exponent.constant(0,a))return this.base=new CTATConstantNode(1,a),this.pushBaseNegation().base;if(this.base.constant(0,a))return this.pushBaseInversion().base;
if(this.exponent.constant(1,a))return this.pushBaseNegation().pushBaseInversion().base;this.exponent=this.exponent.removeIdentity(a);return this};d.prototype.compare=function(a,b){return d.__super__.compare.apply(this,arguments)||(this.countVariables()-a.countVariables())*(b?-1:1)||this.exponent.compare(a.exponent,b)||this.base.compare(a.base,b)||this.compareSigns(a,b)};d.prototype.countVariables=function(){return this.base.countVariables()*(this.exponent.constant()?Math.abs(this.exponent.evaluate()):
Infinity)};d.prototype.pushBaseNegation=function(){this.negated()&&(this.negate(),this.base.negate());return this};d.prototype.pushInversion=function(){this.inverted()&&(this.invert(),this.exponent.negate());return this};d.prototype.pushBaseInversion=function(){this.inverted()&&(this.invert(),this.base.invert());return this};d.prototype.popNegation=function(){this.base.negated()&&this.exponent.constant()&&(this.base.negate(),this.exponent.even()||this.negate());return this};d.prototype.popInversion=
function(){this.exponent.negated()&&(this.invert(),this.exponent.negate());this.base.inverted()&&(this.invert(),this.base.invert());return this};d.prototype.even=function(){return!this.inverted()&&this.base.even()&&this.exponent.integer()};return d}(CTATTreeNode);"undefined"!==typeof module&&null!==module?module.exports=a:this.CTATPowerNode=a}).call(this);var CTATVariableNode={};
(function(){var a,b=function(a,b){function c(){this.constructor=a}for(var e in b)d.call(b,e)&&(a[e]=b[e]);c.prototype=b.prototype;a.prototype=new c;a.__super__=b.prototype;return a},d={}.hasOwnProperty;a=function(a){function d(a,b,d,e,g){this.variableTable=a;this.variable=b;this.parens=null!=d?d:0;this.sign=null!=e?e:1;this.exp=null!=g?g:1;this.operator="VAR"}b(d,a);d.prototype.clone=function(){return new d(this.variableTable,this.variable,this.parens,this.sign,this.exp)};d.prototype.toString=function(){return d.__super__.toString.call(this,
this.variable)};d.prototype.evaluate=function(){var a;return d.__super__.evaluate.call(this,(null!=(a=this.variableTable)?a.get(this.variable):void 0)||function(){try{return eval(this.variable)}catch(f){return NaN}}.call(this))};d.prototype.equals=function(a){return d.__super__.equals.call(this,a)&&this.variable===a.variable};d.prototype.compare=function(a,b){b=null!=b?-1:1;return d.__super__.compare.apply(this,arguments)||this.variable>a.variable&&b||this.variable<a.variable&&-b||this.compareSigns(a,
b)};d.prototype.countVariables=function(){return 1};return d}(CTATTreeNode);"undefined"!==typeof module&&null!==module?module.exports=a:this.CTATVariableNode=a}).call(this);var CTATConstantNode={};
(function(){var a,b=function(a,b){function c(){this.constructor=a}for(var e in b)d.call(b,e)&&(a[e]=b[e]);c.prototype=b.prototype;a.prototype=new c;a.__super__=b.prototype;return a},d={}.hasOwnProperty;a=function(a){function d(a,b,d,e,g){this.value=a;this.marked=null!=b?b:!1;this.parens=null!=d?d:0;this.sign=null!=e?e:1;this.exp=null!=g?g:1;this.operator="CONST"}b(d,a);d.prototype.clone=function(){return new d(this.value,this.marked,this.parens,this.sign,this.exp)};d.prototype.toString=function(){return d.__super__.toString.call(this,
this.value.toString())};d.prototype.evaluate=function(){return d.__super__.evaluate.call(this,this.value)};d.prototype.equals=function(a){return d.__super__.equals.call(this,a)&&this.value===a.value};d.prototype.multiplyOne=function(){return this};d.prototype.powerOne=function(){return this};d.prototype.compare=function(a,b){b=null!=b?1:-1;return d.__super__.compare.apply(this,arguments)||Math.sign(Math.abs(this.evaluate())-Math.abs(a.evaluate()))*b||this.compareSigns(a,b)};d.prototype.popNegation=
function(){0>this.value&&(this.negate(),this.value=-this.value);return this};d.prototype.constant=function(a,b){null==b&&(b=!1);return null==a||this.evaluate()===a&&this.marked===b};d.prototype.integer=function(){return Math.floor(this.evaluate())===this.value};d.prototype.even=function(){return 0===this.evaluate()%2};d.prototype.set=function(a){this.value=Math.abs(a);return this.sign=Math.sign(a)};return d}(CTATTreeNode);"undefined"!==typeof module&&null!==module?module.exports=a:this.CTATConstantNode=
a}).call(this);var CTATAlgebraGrammar=function(){function a(){this.yy={}}var b=function(a,b,c,d){c=c||{};for(d=a.length;d--;c[a[d]]=b);return c},d=[1,6],e=[1,7],g=[1,10],c=[1,11],f=[1,12],h=[1,13],m=[1,21],l=[1,22],n=[5,7,8,9,10,11,12,13,15,26],p=[1,23],x=[1,24],q=[1,26],v=[1,27],u=[5,7,8,9,10,11,12,13,15,16,18,20,21,24,25,26,27,28],A=[5,7,8,9,10,11,12,13,15,16,18,20,21,23,24,25,26,27,28],b={trace:function(){},yy:{},symbols_:{error:2,expression:3,relational:4,EOF:5,arithmetic:6,LESS:7,GREATER:8,LESSEQUAL:9,GREATEREQUAL:10,
EQUAL:11,NOTEQUAL:12,PLUS:13,term:14,MINUS:15,TIMES:16,signedfactor:17,DIVIDE:18,factor:19,IDIVIDE:20,REM:21,atom:22,EXP:23,SQRT:24,LPAREN:25,RPAREN:26,VARIABLE:27,NUMBER:28,$accept:0,$end:1},terminals_:{2:"error",5:"EOF",7:"LESS",8:"GREATER",9:"LESSEQUAL",10:"GREATEREQUAL",11:"EQUAL",12:"NOTEQUAL",13:"PLUS",15:"MINUS",16:"TIMES",18:"DIVIDE",20:"IDIVIDE",21:"REM",23:"EXP",24:"SQRT",25:"LPAREN",26:"RPAREN",27:"VARIABLE",28:"NUMBER"},productions_:[0,[3,2],[4,3],[4,3],[4,3],[4,3],[4,3],[4,3],[4,1],[6,
3],[6,3],[6,1],[14,3],[14,3],[14,2],[14,3],[14,3],[14,1],[17,2],[17,2],[17,1],[19,3],[19,2],[19,1],[22,3],[22,1],[22,1]],performAction:function(a,b,c,d,e,f,g){b=f.length-1;switch(e){case 1:return f[b-1];case 2:this.$=new d.CTATRelationNode("LESS",f[b-2],f[b]);break;case 3:this.$=new d.CTATRelationNode("GREATER",f[b-2],f[b]);break;case 4:this.$=new d.CTATRelationNode("LESSEQUAL",f[b-2],f[b]);break;case 5:this.$=new d.CTATRelationNode("GREATEREQUAL",f[b-2],f[b]);break;case 6:this.$=new d.CTATRelationNode("EQUAL",
f[b-2],f[b]);break;case 7:this.$=new d.CTATRelationNode("NOTEQUAL",f[b-2],f[b]);break;case 8:case 11:case 17:case 20:case 23:this.$=f[b];break;case 9:this.$=new d.CTATAdditionNode("PLUS",[f[b-2],f[b]]);break;case 10:this.$=new d.CTATAdditionNode("MINUS",[f[b-2],f[b]]);break;case 12:this.$=new d.CTATMultiplicationNode("TIMES",[f[b-2],f[b]]);break;case 13:this.$=new d.CTATMultiplicationNode("DIVIDE",[f[b-2],f[b]]);break;case 14:this.$=new d.CTATMultiplicationNode("ITIMES",[f[b-1],f[b]]);break;case 15:this.$=
new d.CTATIntDivisionNode("IDIVIDE",f[b-2],f[b]);break;case 16:this.$=new d.CTATIntDivisionNode("REM",f[b-2],f[b]);break;case 18:this.$=new d.CTATUnaryNode("UPLUS",f[b]);break;case 19:this.$=new d.CTATUnaryNode("UMINUS",f[b]);break;case 21:this.$=new d.CTATPowerNode("EXP",f[b-2],f[b]);break;case 22:this.$=new d.CTATPowerNode("ROOT",f[b],2);break;case 24:this.$=f[b-1].addParens();break;case 25:this.$=new d.CTATVariableNode(d.variableTable,a);break;case 26:this.$=new d.CTATConstantNode(Number(a))}},
table:[{3:1,4:2,6:3,13:d,14:4,15:e,17:5,19:8,22:9,24:g,25:c,27:f,28:h},{1:[3]},{5:[1,14]},{5:[2,8],7:[1,15],8:[1,16],9:[1,17],10:[1,18],11:[1,19],12:[1,20],13:m,15:l},b(n,[2,11],{22:9,19:25,16:p,18:x,20:q,21:v,24:g,25:c,27:f,28:h}),b(u,[2,17]),{13:d,15:e,17:28,19:8,22:9,24:g,25:c,27:f,28:h},{13:d,15:e,17:29,19:8,22:9,24:g,25:c,27:f,28:h},b(u,[2,20]),b(u,[2,23],{23:[1,30]}),{13:d,15:e,17:31,19:8,22:9,24:g,25:c,27:f,28:h},{6:32,13:d,14:4,15:e,17:5,19:8,22:9,24:g,25:c,27:f,28:h},b(A,[2,25]),b(A,[2,26]),
{1:[2,1]},{6:33,13:d,14:4,15:e,17:5,19:8,22:9,24:g,25:c,27:f,28:h},{6:34,13:d,14:4,15:e,17:5,19:8,22:9,24:g,25:c,27:f,28:h},{6:35,13:d,14:4,15:e,17:5,19:8,22:9,24:g,25:c,27:f,28:h},{6:36,13:d,14:4,15:e,17:5,19:8,22:9,24:g,25:c,27:f,28:h},{6:37,13:d,14:4,15:e,17:5,19:8,22:9,24:g,25:c,27:f,28:h},{6:38,13:d,14:4,15:e,17:5,19:8,22:9,24:g,25:c,27:f,28:h},{13:d,14:39,15:e,17:5,19:8,22:9,24:g,25:c,27:f,28:h},{13:d,14:40,15:e,17:5,19:8,22:9,24:g,25:c,27:f,28:h},{13:d,15:e,17:41,19:8,22:9,24:g,25:c,27:f,28:h},
{13:d,15:e,17:42,19:8,22:9,24:g,25:c,27:f,28:h},b(u,[2,14]),{13:d,15:e,17:43,19:8,22:9,24:g,25:c,27:f,28:h},{13:d,15:e,17:44,19:8,22:9,24:g,25:c,27:f,28:h},b(u,[2,18]),b(u,[2,19]),{13:d,15:e,17:45,19:8,22:9,24:g,25:c,27:f,28:h},b(u,[2,22]),{13:m,15:l,26:[1,46]},{5:[2,2],13:m,15:l},{5:[2,3],13:m,15:l},{5:[2,4],13:m,15:l},{5:[2,5],13:m,15:l},{5:[2,6],13:m,15:l},{5:[2,7],13:m,15:l},b(n,[2,9],{22:9,19:25,16:p,18:x,20:q,21:v,24:g,25:c,27:f,28:h}),b(n,[2,10],{22:9,19:25,16:p,18:x,20:q,21:v,24:g,25:c,27:f,
28:h}),b(u,[2,12]),b(u,[2,13]),b(u,[2,15]),b(u,[2,16]),b(u,[2,21]),b(A,[2,24])],defaultActions:{14:[2,1]},parseError:function(a,b){if(b.recoverable)this.trace(a);else{var c=Error(a);c.hash=b;throw c;}},parse:function(a){var b=[0],c=[null],d=[],e=this.table,f="",g=0,l=0,h=0,m=d.slice.call(arguments,1),n=Object.create(this.lexer),q={},p;for(p in this.yy)Object.prototype.hasOwnProperty.call(this.yy,p)&&(q[p]=this.yy[p]);n.setInput(a,q);q.lexer=n;q.parser=this;"undefined"==typeof n.yylloc&&(n.yylloc=
{});p=n.yylloc;d.push(p);var v=n.options&&n.options.ranges;this.parseError="function"===typeof q.parseError?q.parseError:Object.getPrototypeOf(this).parseError;for(var u,x,y,A,N={},X,F;;){y=b[b.length-1];if(this.defaultActions[y])A=this.defaultActions[y];else{if(null===u||"undefined"==typeof u)u=n.lex()||1,"number"!==typeof u&&(u=this.symbols_[u]||u);A=e[y]&&e[y][u]}if("undefined"===typeof A||!A.length||!A[0]){var Q;F=[];for(X in e[y])this.terminals_[X]&&2<X&&F.push("'"+this.terminals_[X]+"'");Q=
n.showPosition?"Parse error on line "+(g+1)+":\n"+n.showPosition()+"\nExpecting "+F.join(", ")+", got '"+(this.terminals_[u]||u)+"'":"Parse error on line "+(g+1)+": Unexpected "+(1==u?"end of input":"'"+(this.terminals_[u]||u)+"'");this.parseError(Q,{text:n.match,token:this.terminals_[u]||u,line:n.yylineno,loc:p,expected:F})}if(A[0]instanceof Array&&1<A.length)throw Error("Parse Error: multiple actions possible at state: "+y+", token: "+u);switch(A[0]){case 1:b.push(u);c.push(n.yytext);d.push(n.yylloc);
b.push(A[1]);u=null;x?(u=x,x=null):(l=n.yyleng,f=n.yytext,g=n.yylineno,p=n.yylloc,0<h&&h--);break;case 2:F=this.productions_[A[1]][1];N.$=c[c.length-F];N._$={first_line:d[d.length-(F||1)].first_line,last_line:d[d.length-1].last_line,first_column:d[d.length-(F||1)].first_column,last_column:d[d.length-1].last_column};v&&(N._$.range=[d[d.length-(F||1)].range[0],d[d.length-1].range[1]]);y=this.performAction.apply(N,[f,l,g,q,A[1],c,d].concat(m));if("undefined"!==typeof y)return y;F&&(b=b.slice(0,-2*F),
c=c.slice(0,-1*F),d=d.slice(0,-1*F));b.push(this.productions_[A[1]][0]);c.push(N.$);d.push(N._$);A=e[b[b.length-2]][b[b.length-1]];b.push(A);break;case 3:return!0}}}},d=function(){return{EOF:1,parseError:function(a,b){if(this.yy.parser)this.yy.parser.parseError(a,b);else throw Error(a);},setInput:function(a,b){this.yy=b||this.yy||{};this._input=a;this._more=this._backtrack=this.done=!1;this.yylineno=this.yyleng=0;this.yytext=this.matched=this.match="";this.conditionStack=["INITIAL"];this.yylloc={first_line:1,
first_column:0,last_line:1,last_column:0};this.options.ranges&&(this.yylloc.range=[0,0]);this.offset=0;return this},input:function(){var a=this._input[0];this.yytext+=a;this.yyleng++;this.offset++;this.match+=a;this.matched+=a;a.match(/(?:\r\n?|\n).*/g)?(this.yylineno++,this.yylloc.last_line++):this.yylloc.last_column++;this.options.ranges&&this.yylloc.range[1]++;this._input=this._input.slice(1);return a},unput:function(a){var b=a.length,c=a.split(/(?:\r\n?|\n)/g);this._input=a+this._input;this.yytext=
this.yytext.substr(0,this.yytext.length-b);this.offset-=b;a=this.match.split(/(?:\r\n?|\n)/g);this.match=this.match.substr(0,this.match.length-1);this.matched=this.matched.substr(0,this.matched.length-1);c.length-1&&(this.yylineno-=c.length-1);var d=this.yylloc.range;this.yylloc={first_line:this.yylloc.first_line,last_line:this.yylineno+1,first_column:this.yylloc.first_column,last_column:c?(c.length===a.length?this.yylloc.first_column:0)+a[a.length-c.length].length-c[0].length:this.yylloc.first_column-
b};this.options.ranges&&(this.yylloc.range=[d[0],d[0]+this.yyleng-b]);this.yyleng=this.yytext.length;return this},more:function(){this._more=!0;return this},reject:function(){if(this.options.backtrack_lexer)this._backtrack=!0;else return this.parseError("Lexical error on line "+(this.yylineno+1)+". You can only invoke reject() in the lexer when the lexer is of the backtracking persuasion (options.backtrack_lexer = true).\n"+this.showPosition(),{text:"",token:null,line:this.yylineno});return this},
less:function(a){this.unput(this.match.slice(a))},pastInput:function(){var a=this.matched.substr(0,this.matched.length-this.match.length);return(20<a.length?"...":"")+a.substr(-20).replace(/\n/g,"")},upcomingInput:function(){var a=this.match;20>a.length&&(a+=this._input.substr(0,20-a.length));return(a.substr(0,20)+(20<a.length?"...":"")).replace(/\n/g,"")},showPosition:function(){var a=this.pastInput(),b=Array(a.length+1).join("-");return a+this.upcomingInput()+"\n"+b+"^"},test_match:function(a,b){var c,
d;this.options.backtrack_lexer&&(d={yylineno:this.yylineno,yylloc:{first_line:this.yylloc.first_line,last_line:this.last_line,first_column:this.yylloc.first_column,last_column:this.yylloc.last_column},yytext:this.yytext,match:this.match,matches:this.matches,matched:this.matched,yyleng:this.yyleng,offset:this.offset,_more:this._more,_input:this._input,yy:this.yy,conditionStack:this.conditionStack.slice(0),done:this.done},this.options.ranges&&(d.yylloc.range=this.yylloc.range.slice(0)));if(c=a[0].match(/(?:\r\n?|\n).*/g))this.yylineno+=
c.length;this.yylloc={first_line:this.yylloc.last_line,last_line:this.yylineno+1,first_column:this.yylloc.last_column,last_column:c?c[c.length-1].length-c[c.length-1].match(/\r?\n?/)[0].length:this.yylloc.last_column+a[0].length};this.yytext+=a[0];this.match+=a[0];this.matches=a;this.yyleng=this.yytext.length;this.options.ranges&&(this.yylloc.range=[this.offset,this.offset+=this.yyleng]);this._backtrack=this._more=!1;this._input=this._input.slice(a[0].length);this.matched+=a[0];c=this.performAction.call(this,
this.yy,this,b,this.conditionStack[this.conditionStack.length-1]);this.done&&this._input&&(this.done=!1);if(c)return c;if(this._backtrack)for(var e in d)this[e]=d[e];return!1},next:function(){if(this.done)return this.EOF;this._input||(this.done=!0);var a,b,c;this._more||(this.match=this.yytext="");for(var d=this._currentRules(),e=0;e<d.length;e++)if((b=this._input.match(this.rules[d[e]]))&&(!a||b[0].length>a[0].length))if(a=b,c=e,this.options.backtrack_lexer){a=this.test_match(b,d[e]);if(!1!==a)return a;
if(this._backtrack)a=!1;else return!1}else if(!this.options.flex)break;return a?(a=this.test_match(a,d[c]),!1!==a?a:!1):""===this._input?this.EOF:this.parseError("Lexical error on line "+(this.yylineno+1)+". Unrecognized text.\n"+this.showPosition(),{text:"",token:null,line:this.yylineno})},lex:function(){var a=this.next();return a?a:this.lex()},begin:function(a){this.conditionStack.push(a)},popState:function(){return 0<this.conditionStack.length-1?this.conditionStack.pop():this.conditionStack[0]},
_currentRules:function(){return this.conditionStack.length&&this.conditionStack[this.conditionStack.length-1]?this.conditions[this.conditionStack[this.conditionStack.length-1]].rules:this.conditions.INITIAL.rules},topState:function(a){a=this.conditionStack.length-1-Math.abs(a||0);return 0<=a?this.conditionStack[a]:"INITIAL"},pushState:function(a){this.begin(a)},stateStackSize:function(){return this.conditionStack.length},options:{},performAction:function(a,b,c,d){switch(c){case 1:return 25;case 2:return 26;
case 3:return 23;case 4:return 23;case 5:return 24;case 6:return 24;case 7:return 16;case 8:return 16;case 9:return 20;case 10:return 18;case 11:return 18;case 12:return 21;case 13:return 15;case 14:return 13;case 15:return 9;case 16:return 9;case 17:return 10;case 18:return 10;case 19:return 7;case 20:return 8;case 21:return 12;case 22:return 12;case 23:return 12;case 24:return 12;case 25:return 11;case 26:return 11;case 27:return 28;case 28:return 28;case 29:return 27;case 30:return 5}},rules:[/^(?:\s+)/,
/^(?:\()/,/^(?:\))/,/^(?:\*\*)/,/^(?:\^)/,/^(?:\|)/,/^(?:\u221a)/,/^(?:\*)/,/^(?:\u00d7)/,/^(?:\/\/)/,/^(?:\/)/,/^(?:\u00f7)/,/^(?:%)/,/^(?:-)/,/^(?:\+)/,/^(?:<=)/,/^(?:\u2264)/,/^(?:>=)/,/^(?:\u2265)/,/^(?:<)/,/^(?:>)/,/^(?:!=)/,/^(?:\/=)/,/^(?:<>)/,/^(?:\u2260)/,/^(?:==)/,/^(?:=)/,/^(?:(([0-9])+\.?([0-9])*|\.([0-9])+)([Ee][+-]?([0-9])+)?)/,/^(?:(0[Bb]([0-1])+|0[Oo]([0-7])+|0[Xx]([0-9A-Fa-f])+))/,/^(?:([A-Za-z]))/,/^(?:$)/],conditions:{INITIAL:{rules:[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,
18,19,20,21,22,23,24,25,26,27,28,29,30],inclusive:!0}}}}();b.lexer=d;a.prototype=b;b.Parser=a;return new a}();var CTATAlgebraParser={};
(function(){var a;a=function(){function a(a){this.parser=new CTATAlgebraGrammar.Parser;this.parser.yy={CTATRelationNode:CTATRelationNode,CTATAdditionNode:CTATAdditionNode,CTATMultiplicationNode:CTATMultiplicationNode,CTATIntDivisionNode:CTATIntDivisionNode,CTATUnaryNode:CTATUnaryNode,CTATPowerNode:CTATPowerNode,CTATVariableNode:CTATVariableNode,CTATConstantNode:CTATConstantNode,CTATTreeNode:CTATTreeNode};this.parser.yy.variableTable=a}a.none=["simpleFlatten"];a.partial=["flatten","removeIdentity"];
a.full="flatten computeConstants combineSimilar expand distribute removeIdentity".split(" ");a.prototype.algParse=function(b,e){null==e&&(e=!1);try{return this.parser.parse(String(b)).simplify(a.none.concat(e?"sort":[]))}catch(g){return null}};a.prototype.algEvaluate=function(b){try{return this.parser.parse(String(b)).simplify(a.none).evaluate()}catch(e){return null}};a.prototype.algPartialSimplify=function(b,e){null==e&&(e=!1);try{return this.parser.parse(String(b)).simplify(a.partial.concat(e?"sort":
[])).toString()}catch(g){return null}};a.prototype.algSimplify=function(b,e){null==e&&(e=!1);try{return this.parser.parse(String(b)).simplify(a.full.concat(e?"sort":[])).toString()}catch(g){return null}};a.prototype.algValid=function(a,b){var d,c;null==b&&(b=!1);return null!=(d=this.algParse(a,!0))&&null!=(c=this.algParse(a,!b))?d.toString()===c.toString():null};a.prototype.algValued=function(a){var b;return null!=(b=this.algEvaluate(a))?!isNaN(b):null};a.prototype.algPartialSimplified=function(a,
b){var d,c;null==b&&(b=!1);return null!=(d=this.algPartialSimplify(a,!0))&&null!=(c=this.algParse(a,!b))?d===c.toString():null};a.prototype.algSimplified=function(a,b){var d,c;null==b&&(b=!1);return null!=(d=this.algSimplify(a,!0))&&null!=(c=this.algParse(a,!b))?d===c.toString():null};a.prototype.algIdentical=function(a,b,g){var c,d;null==g&&(g=!1);return null!=(c=this.algParse(a,!g))&&null!=(d=this.algParse(b,!g))?c.toString()===d.toString():null};a.prototype.algEqual=function(a,b){var d,c;return null!=
(d=this.algEvaluate(a))&&null!=(c=this.algEvaluate(b))?d===c:null};a.prototype.algPartialEquivalent=function(a,b,g){var c,d;null==g&&(g=!1);return null!=(c=this.algPartialSimplify(a,!g))&&null!=(d=this.algPartialSimplify(b,!g))?c===d:null};a.prototype.algEquivalent=function(a,b,g){var c,d;null==g&&(g=!1);return null!=(c=this.algSimplify(a,!g))&&null!=(d=this.algSimplify(b,!g))?c===d:null};a.prototype.isAlgValid=a.prototype.algValid;a.prototype.algEval=a.prototype.algEvaluate;a.prototype.algStrictEquivTermsSameOrder=
function(a,b){return this.algPartialEquivalent(a,b,!0)};a.prototype.algEquivTermsSameOrder=a.prototype.algStrictEquivTermsSameOrder;a.prototype.algStrictEquivTerms=a.prototype.algPartialEquivalent;a.prototype.algEquivTerms=a.prototype.algStrictEquivTerms;a.prototype.algEquiv=a.prototype.algEquivalent;a.prototype.isSimplified=function(a){return this.algSimplified(a,!0)};a.prototype.calc=a.prototype.algEvaluate;a.prototype.calca=function(a){return(+this.algEvaluate(a)).toFixed(2)};a.prototype.simplify=
function(a){return this.algSimplify(a,!0)};a.prototype.algebraicEqual=a.prototype.algEqual;a.prototype.patternMatches=function(a,b){return this.algIdentical(a,b,!0)};a.prototype.polyTermsEqual=function(b,e){return this.parser.parse(b).simplify(a.partial).equals(this.parser.parse(e).simplify(a.partial))};a.prototype.algebraicMatches=function(a,b){return this.algEquivalent(a,b,!0)};a.prototype.expressionMatches=a.prototype.algebraicMatches;return a}();"undefined"!==typeof module&&null!==module?module.exports=
a:this.CTATAlgebraParser=a}).call(this);var CTATLogicTreeNode={};
(function(){var a;a=function(){function a(b){null!=this.string?a.operatorStrings[b]=this.string:this.string=a.operatorStrings[b]}a.operators=[["CONST"],["VAR"],["NOT"],["AND","OR","XOR","IF","IFF"]];a.operatorPrecedence=function(a,b){return Math.sign(this.operators.findIndex(function(b){return b.includes(a)})-this.operators.findIndex(function(a){return a.includes(b)}))};a.operatorStrings={NOT:"\u00ac",AND:"\u2227",OR:"\u2228",XOR:"\u2295",IF:"\u21d2",IFF:"\u21d4","true":"\u22a4","false":"\u22a5"};
a.toOperatorString=function(a){return this.operatorStrings[a]||""};a.prototype.addParens=function(){this.parens++;return this};a.prototype.toString=function(b,e){var d,c;null==e&&(e=!1);this.setParens(e);d=0;for(c=this.parens;0<=c?d<c:d>c;0<=c?++d:--d)b="("+b+")";this.negated&&(b=""+a.operatorStrings.NOT+b);return b};a.prototype.setParens=function(a){var b;if(a&&("AND"===(b=this.operator)||"OR"===b||"XOR"===b||"IF"===b||"IFF"===b))return this.parens=1};a.prototype.evaluate=function(a){return this.negated?
compute("NOT",a):a};a.prototype.compute=function(a,b,g){switch(a){case "NOT":return null!=b?!b:null;case "AND":return null!=b?b&&g:g&&b;case "OR":return null!=b?b||g:g||b}};a.prototype.equals=function(a,b){return a&&this.operator===a.operator&&this.parens===a.parens&&b!==(this.negated===a.negated)};a.prototype.inverse=function(a){return this.negationOp()?this.right.equals(a):a.negationOp()?this.equals(a.right):!1};a.prototype.findAllOperators=function(a,b){return this.operator===a?(this.path=b,[this]):
[]};a.prototype.findAllExpressions=function(a,b){return this.equals(a)?(this.path=b,[this]):[]};a.prototype.replaceExpression=function(a,b,g){return 0===g.length?b:null};a.prototype.simplify=function(a){return this.simplifyNode(a)};a.prototype.simplifyNode=function(a){var b,d,c,f;f=this;b=0;for(d=a.length;b<d;b++)c=a[b],f=f[c].call(f),f.methods=a;delete f.methods;return f};a.prototype.commutativity=function(){return this};a.prototype.associativity=function(){return this};a.prototype.distributivity=
function(){return this};a.prototype.deMorgan=function(){return this};a.prototype.doubleNegation=function(){return this};a.prototype.implication=function(){return this};a.prototype.biimplication=function(){return this};a.prototype.biimplicationToImplication=function(){return this};a.prototype.exclusiveDisjunction=function(){return this};a.prototype.exclusiveDisjunctionToImplication=function(){return this};a.prototype.disjunction=function(){return new CTATLogicRelationNode("OR",this,this)};a.prototype.conjunction=
function(){return new CTATLogicRelationNode("AND",this,this)};a.prototype.replaceNodes=function(){return this};a.prototype.flatten=function(){this.parens=0;return this};a.prototype.pushNegation=function(){return this};a.prototype.invertOperator=function(){this.operator=this.inverseOperator();this.string=a.operatorStrings[this.operator];return this};a.prototype.inverseOperator=function(){return this.conjunctionOp()?"OR":this.disjunctionOp()?"AND":this.operator};a.prototype.distributeDisjunction=function(){return this};
a.prototype.distributeConjunction=function(){return this};a.prototype.sort=function(){return this};a.prototype.absorb=function(){return this};a.prototype.compare=function(b){return this.countLevels()-b.countLevels()||a.operatorPrecedence(this.operator,b.operator)};a.prototype.compareNegations=function(a){return this.negated-a.negated};a.prototype.countVariables=function(){return 0};a.prototype.countLevels=function(){return 0};a.prototype.negateNode=function(){return new CTATLogicRelationNode("NOT",
null,this)};a.prototype.unnegateNode=function(){return this.negationOp()?this.right:this};a.prototype.negate=function(){this.negated=!this.negated;return this};a.prototype.negationOp=function(){return"NOT"===this.operator};a.prototype.conjunctionOp=function(){return"AND"===this.operator};a.prototype.disjunctionOp=function(){return"OR"===this.operator};a.prototype.junctionOp=function(){var a;return"AND"===(a=this.operator)||"OR"===a};a.prototype.exclusiveDisjunctionOp=function(){return"XOR"===this.operator};
a.prototype.implicationOp=function(){return"IF"===this.operator};a.prototype.biimplicationOp=function(){return"IFF"===this.operator};a.prototype.constant=function(a){return!1};return a}();"undefined"!==typeof module&&null!==module?module.exports=a:this.CTATLogicTreeNode=a}).call(this);var CTATLogicRelationNode={};
(function(){var a,b=function(a,b){function c(){this.constructor=a}for(var e in b)d.call(b,e)&&(a[e]=b[e]);c.prototype=b.prototype;a.prototype=new c;a.__super__=b.prototype;return a},d={}.hasOwnProperty;a=function(a){function d(a,b,e,g,l,n){this.operator=a;this.left=b;this.right=e;this.string=null!=g?g:null;this.parens=null!=l?l:0;this.negated=null!=n?n:!1;d.__super__.constructor.call(this,this.operator)}b(d,a);d.prototype.clone=function(){return new d(this.operator,this.left,this.right,this.string,
this.parens,this.negated)};d.prototype.toString=function(a){var b;null==a&&(a=!1);return d.__super__.toString.call(this,""+((null!=(b=this.left)?b.toString(!0):void 0)||"")+(""+this.string)+this.right.toString(!0),a)};d.prototype.evaluate=function(){var a,b,e;a=null!=(b=this.left)?b.evaluate():void 0;e=this.right.evaluate();return d.__super__.evaluate.call(this,function(){switch(this.operator){case "NOT":return this.applyOperator("NOT",e);case "AND":return this.applyOperator("AND",a,e);case "OR":return this.applyOperator("OR",
a,e);case "IF":return this.applyOperator("OR",this.applyOperator("NOT",a),e);case "XOR":return this.applyOperator("OR",this.applyOperator("AND",a,this.applyOperator("NOT",e)),this.applyOperator("AND",this.applyOperator("NOT",a),e));case "IFF":return this.applyOperator("OR",this.applyOperator("AND",a,e),this.applyOperator("AND",this.applyOperator("NOT",a),this.applyOperator("NOT",e)))}}.call(this))};d.prototype.equals=function(a,b){return d.__super__.equals.call(this,a,b)&&(null==this.left||this.left.equals(a.left,
!1))&&this.right.equals(a.right,!1)};d.prototype.findAllOperators=function(a,b){var c,e;return(null!=(c=null!=(e=this.left)?e.findAllOperators(a,b.concat(["left"])):void 0)?c:[]).concat(d.__super__.findAllOperators.apply(this,arguments)).concat(this.right.findAllOperators(a,b.concat(["right"])))};d.prototype.findAllExpressions=function(a,b){var c,e;return(null!=(c=null!=(e=this.left)?e.findAllExpressions(a,b.concat(["left"])):void 0)?c:[]).concat(d.__super__.findAllExpressions.apply(this,arguments)).concat(this.right.findAllExpressions(a,
b.concat(["right"])))};d.prototype.replaceExpression=function(a,b,e){var c,f;return d.__super__.replaceExpression.apply(this,arguments)||(f=e.shift(),Object.assign(this.clone(),(c={},c[""+f]=this[f].replaceExpression(a,b,e),c)))};d.prototype.simplify=function(a){var b;this.left=null!=(b=this.left)?b.simplify(a):void 0;this.right=this.right.simplify(a);return d.__super__.simplify.apply(this,arguments)};d.prototype.commutativity=function(){return this.junctionOp()?new d(this.operator,this.right,this.left):
this};d.prototype.associativity=function(){return this.junctionOp()&&this.left.junctionOp()&&this.operator===this.left.operator?new d(this.operator,this.left.left,new d(this.operator,this.left.right,this.right)):this.junctionOp()&&this.right.junctionOp()&&this.operator===this.right.operator?new d(this.operator,new d(this.operator,this.left,this.right.left),this.right.right):this};d.prototype.distributivity=function(){var a,b,e,g;return this.junctionOp()&&this.left.junctionOp()&&this.right.junctionOp()&&
this.inverseOperator()===(a=this.left.operator)&&a===this.right.operator&&this.left.left.equals(this.right.left)?new d(this.inverseOperator(),this.left.left,new d(this.left.inverseOperator(),this.left.right,this.right.right)):this.junctionOp()&&this.left.junctionOp()&&this.right.junctionOp()&&this.inverseOperator()===(b=this.left.operator)&&b===this.right.operator&&this.left.left.equals(this.right.right)?new d(this.inverseOperator(),this.left.left,new d(this.left.inverseOperator(),this.left.right,
this.right.left)):this.junctionOp()&&this.left.junctionOp()&&this.right.junctionOp()&&this.inverseOperator()===(e=this.left.operator)&&e===this.right.operator&&this.left.right.equals(this.right.left)?new d(this.inverseOperator(),new d(this.left.inverseOperator(),this.left.left,this.right.right),this.right.left):this.junctionOp()&&this.left.junctionOp()&&this.right.junctionOp()&&this.inverseOperator()===(g=this.left.operator)&&g===this.right.operator&&this.left.right.equals(this.right.right)?new d(this.inverseOperator(),
new d(this.left.inverseOperator(),this.left.left,this.right.left),this.right.right):this.junctionOp()&&this.left.junctionOp()&&this.operator!==this.left.operator?new d(this.inverseOperator(),new d(this.left.inverseOperator(),this.left.left,this.right),new d(this.left.inverseOperator(),this.left.right,this.right)):this.junctionOp()&&this.right.junctionOp()&&this.operator!==this.right.operator?new d(this.inverseOperator(),new d(this.right.inverseOperator(),this.left,this.right.left),new d(this.right.inverseOperator(),
this.left,this.right.right)):this};d.prototype.deMorgan=function(){return this.negationOp()&&this.right.junctionOp()?this.right.reverseNode():this.junctionOp()&&this.left.negationOp()&&this.right.negationOp()?this.reverseNode(!0).negateNode():this};d.prototype.doubleNegation=function(){return this.negationOp()&&this.right.negationOp()?this.unnegateNode().unnegateNode():this.negateNode().negateNode()};d.prototype.implication=function(){return this.implicationOp()?new d("OR",this.left.negateNode(),
this.right):this.disjunctionOp()&&this.left.negationOp()?new d("IF",this.left.unnegateNode(),this.right):this.disjunctionOp()&&this.right.negationOp()?new d("IF",this.right.unnegateNode(),this.left):this};d.prototype.biimplication=function(){return this.biimplicationOp()?new d("OR",new d("AND",this.left,this.right),new d("AND",this.left.negateNode(),this.right.negateNode())):this.disjunctionOp()&&this.left.conjunctionOp()&&this.right.conjunctionOp()&&(this.left.left.inverse(this.right.left)&&this.left.right.inverse(this.right.right)||
this.left.left.inverse(this.right.right)&&this.left.right.inverse(this.right.left))?this.left.left.negationOp()&&this.left.right.negationOp()?new d("IFF",this.left.left.unnegateNode(),this.left.right.unnegateNode()):new d("IFF",this.left.left,this.left.right):this};d.prototype.biimplicationToImplication=function(){return this.biimplicationOp()?new d("AND",new d("IF",this.left,this.right),new d("IF",this.right,this.left)):this.conjunctionOp()&&this.left.implicationOp()&&this.right.implicationOp()&&
this.left.left.equals(this.right.right)&&this.left.right.equals(this.right.left)?new d("IFF",this.left.left,this.left.right):this};d.prototype.exclusiveDisjunction=function(){return this.exclusiveDisjunctionOp()?new d("OR",new d("AND",this.left,this.right.negateNode()),new d("AND",this.left.negateNode(),this.right)):this.disjunctionOp()&&this.left.conjunctionOp()&&this.right.conjunctionOp()&&(this.left.left.inverse(this.right.left)&&this.left.right.inverse(this.right.right)||this.left.left.inverse(this.right.right)&&
this.left.right.inverse(this.right.left))?this.left.left.negationOp()?new d("XOR",this.left.left.unnegateNode(),this.left.right):new d("XOR",this.left.left,this.left.right.unnegateNode()):this};d.prototype.exclusiveDisjunctionToImplication=function(){return this.exclusiveDisjunctionOp()?new d("AND",new d("IF",this.left,this.right.negateNode()),new d("IF",this.right.negateNode(),this.left)):this.conjunctionOp()&&this.left.implicationOp()&&this.right.implicationOp()&&this.left.left.equals(this.right.right)&&
this.left.right.equals(this.right.left)?this.left.left.negationOp()?new d("XOR",this.left.left.unnegateNode(),this.left.right):this.left.right.negationOp()?new d("XOR",this.left.left,this.left.right.unnegateNode()):this:this};d.prototype.disjunction=function(){return this.disjunctionOp()&&this.left.inverse(this.right)?new CTATLogicConstantNode(!0):this.disjunctionOp()&&this.left.constant(!0)?this.left:this.disjunctionOp()&&this.right.constant(!0)?this.right:this.disjunctionOp()&&this.left.equals(this.right)?
this.left:this.disjunctionOp()&&(this.left.conjunctionOp()&&(this.left.left.equals(this.right)||this.left.right.equals(this.right))||this.left.constant(!1))?this.right:this.disjunctionOp()&&(this.right.conjunctionOp()&&(this.left.equals(this.right.left)||this.left.equals(this.right.right))||this.right.constant(!1))?this.left:d.__super__.disjunction.apply(this,arguments)};d.prototype.conjunction=function(){return this.conjunctionOp()&&this.left.inverse(this.right)?new CTATLogicConstantNode(!1):this.conjunctionOp()&&
this.left.constant(!1)?this.left:this.conjunctionOp()&&this.right.constant(!1)?this.right:this.conjunctionOp()&&this.left.equals(this.right)?this.left:this.conjunctionOp()&&(this.left.disjunctionOp()&&(this.left.left.equals(this.right)||this.left.right.equals(this.right))||this.left.constant(!0))?this.right:this.conjunctionOp()&&(this.right.disjunctionOp()&&(this.left.equals(this.right.left)||this.left.equals(this.right.right))||this.right.constant(!0))?this.left:d.__super__.conjunction.apply(this,
arguments)};d.prototype.reverseNode=function(a){null==a&&(a=!1);return new d(this.inverseOperator(),a?this.left.unnegateNode():this.left.negateNode(),a?this.right.unnegateNode():this.right.negateNode())};d.prototype.replaceNodes=function(){var a;switch(this.operator){case "NOT":return this.right.negate();case "AND":case "OR":return new CTATLogicFlattenNode(this.operator,[this.left,this.right]);case "IF":return new CTATLogicFlattenNode("OR",[this.left.negate(),this.right]);case "XOR":return a=CTATLogicTreeNode.diff(this.methods,
["replaceNodes"]),new CTATLogicFlattenNode("OR",[(new CTATLogicFlattenNode("AND",[this.left,this.right.clone().negate()])).simplifyNode(a),(new CTATLogicFlattenNode("AND",[this.left.clone().negate(),this.right])).simplifyNode(a)]);case "IFF":return a=CTATLogicTreeNode.diff(this.methods,["replaceNodes"]),new CTATLogicFlattenNode("OR",[(new CTATLogicFlattenNode("AND",[this.left,this.right])).simplifyNode(a),new CTATLogicFlattenNode("AND",[this.left.clone().negate(),this.right.clone().negate().simplifyNode(a)])])}};
d.prototype.countVariables=function(){var a;return(null!=(a=this.left)?a.countVariables():void 0)+this.right.countVariables()};d.prototype.countLevels=function(){var a;return 1+Math.max(null!=(a=this.left)?a.countLevels():void 0,this.right.countLevels())};return d}(CTATLogicTreeNode);"undefined"!==typeof module&&null!==module?module.exports=a:this.CTATLogicRelationNode=a}).call(this);var CTATLogicVariableNode={};
(function(){var a,b=function(a,b){function c(){this.constructor=a}for(var e in b)d.call(b,e)&&(a[e]=b[e]);c.prototype=b.prototype;a.prototype=new c;a.__super__=b.prototype;return a},d={}.hasOwnProperty;a=function(a){function d(a,b,d,e){this.variableTable=a;this.variable=b;this.parens=null!=d?d:0;this.negated=null!=e?e:!1;this.operator="VAR"}b(d,a);d.prototype.clone=function(){return new d(this.variableTable,this.variable,this.parens,this.negated)};d.prototype.toString=function(){return d.__super__.toString.call(this,
this.variable)};d.prototype.evaluate=function(){var a;return d.__super__.evaluate.call(this,(null!=(a=this.variableTable)?a.get(this.variable):void 0)||function(){try{return eval(this.variable)}catch(f){return null}}.call(this))};d.prototype.equals=function(a,b){return d.__super__.equals.call(this,a,b)&&this.variable===a.variable};d.prototype.compare=function(a){return d.__super__.compare.apply(this,arguments)||this.variable>a.variable&&1||this.variable<a.variable&&-1||this.compareNegations(a)};d.prototype.countVariables=
function(){return 1};return d}(CTATLogicTreeNode);"undefined"!==typeof module&&null!==module?module.exports=a:this.CTATLogicVariableNode=a}).call(this);var CTATLogicConstantNode={};
(function(){var a,b=function(a,b){function c(){this.constructor=a}for(var e in b)d.call(b,e)&&(a[e]=b[e]);c.prototype=b.prototype;a.prototype=new c;a.__super__=b.prototype;return a},d={}.hasOwnProperty;a=function(a){function d(a,b,e,g){this.value=a;this.string=null!=b?b:null;this.parens=null!=e?e:0;this.negated=null!=g?g:!1;this.operator="CONST";d.__super__.constructor.call(this,this.value)}b(d,a);d.prototype.clone=function(){return new d(this.value,this.string,this.parens,this.negated)};d.prototype.toString=
function(){return d.__super__.toString.call(this,this.string)};d.prototype.evaluate=function(){return d.__super__.evaluate.call(this,this.value)};d.prototype.equals=function(a,b){return d.__super__.equals.call(this,a,b)&&b!==(this.value===a.value)};d.prototype.compare=function(a){return d.__super__.compare.apply(this,arguments)||this.value-a.value};d.prototype.negate=function(){this.value=!this.value;return this};d.prototype.constant=function(a){return null==a||this.value===a};return d}(CTATLogicTreeNode);
"undefined"!==typeof module&&null!==module?module.exports=a:this.CTATLogicConstantNode=a}).call(this);var CTATLogicGrammar=function(){function a(){this.yy={}}var b=function(a,b,c,d){c=c||{};for(d=a.length;d--;c[a[d]]=b);return c},d=[1,3],e=[1,5],g=[1,6],c=[1,7],f=[1,8],h=[1,10],m=[1,11],l=[1,12],n=[1,13],p=[1,14],x=[5,6,7,8,9,10,14],b={trace:function(){},yy:{},symbols_:{error:2,expression:3,logical:4,EOF:5,AND:6,OR:7,XOR:8,IF:9,IFF:10,NOT:11,atom:12,LPAREN:13,RPAREN:14,VARIABLE:15,TRUE:16,FALSE:17,$accept:0,$end:1},terminals_:{2:"error",5:"EOF",6:"AND",7:"OR",8:"XOR",9:"IF",10:"IFF",11:"NOT",13:"LPAREN",
14:"RPAREN",15:"VARIABLE",16:"TRUE",17:"FALSE"},productions_:[0,[3,2],[4,3],[4,3],[4,3],[4,3],[4,3],[4,2],[4,1],[12,3],[12,1],[12,1],[12,1]],performAction:function(a,b,c,d,e,f,g){b=f.length-1;switch(e){case 1:return f[b-1];case 2:this.$=new d.CTATLogicRelationNode("AND",f[b-2],f[b],f[b-1]);break;case 3:this.$=new d.CTATLogicRelationNode("OR",f[b-2],f[b],f[b-1]);break;case 4:this.$=new d.CTATLogicRelationNode("XOR",f[b-2],f[b],f[b-1]);break;case 5:this.$=new d.CTATLogicRelationNode("IF",f[b-2],f[b],
f[b-1]);break;case 6:this.$=new d.CTATLogicRelationNode("IFF",f[b-2],f[b],f[b-1]);break;case 7:this.$=new d.CTATLogicRelationNode("NOT",null,f[b],f[b-1]);break;case 8:this.$=f[b];break;case 9:this.$=f[b-1].addParens();break;case 10:this.$=new d.CTATLogicVariableNode(d.variableTable,a);break;case 11:this.$=new d.CTATLogicConstantNode(!0,a);break;case 12:this.$=new d.CTATLogicConstantNode(!1,a)}},table:[{3:1,4:2,11:d,12:4,13:e,15:g,16:c,17:f},{1:[3]},{5:[1,9],6:h,7:m,8:l,9:n,10:p},{4:15,11:d,12:4,13:e,
15:g,16:c,17:f},b(x,[2,8]),{4:16,11:d,12:4,13:e,15:g,16:c,17:f},b(x,[2,10]),b(x,[2,11]),b(x,[2,12]),{1:[2,1]},{4:17,11:d,12:4,13:e,15:g,16:c,17:f},{4:18,11:d,12:4,13:e,15:g,16:c,17:f},{4:19,11:d,12:4,13:e,15:g,16:c,17:f},{4:20,11:d,12:4,13:e,15:g,16:c,17:f},{4:21,11:d,12:4,13:e,15:g,16:c,17:f},b(x,[2,7]),{6:h,7:m,8:l,9:n,10:p,14:[1,22]},b(x,[2,2]),b([5,7,8,9,10,14],[2,3],{6:h}),b([5,8,9,10,14],[2,4],{6:h,7:m}),b([5,10,14],[2,5],{6:h,7:m,8:l,9:n}),b([5,14],[2,6],{6:h,7:m,8:l,9:n,10:p}),b(x,[2,9])],
defaultActions:{9:[2,1]},parseError:function(a,b){if(b.recoverable)this.trace(a);else{var c=Error(a);c.hash=b;throw c;}},parse:function(a){var b=[0],c=[null],d=[],e=this.table,f="",g=0,l=0,h=0,n=d.slice.call(arguments,1),m=Object.create(this.lexer),q={},p;for(p in this.yy)Object.prototype.hasOwnProperty.call(this.yy,p)&&(q[p]=this.yy[p]);m.setInput(a,q);q.lexer=m;q.parser=this;"undefined"==typeof m.yylloc&&(m.yylloc={});p=m.yylloc;d.push(p);var x=m.options&&m.options.ranges;this.parseError="function"===
typeof q.parseError?q.parseError:Object.getPrototypeOf(this).parseError;for(var z,K,M,L,G={},U,P;;){M=b[b.length-1];if(this.defaultActions[M])L=this.defaultActions[M];else{if(null===z||"undefined"==typeof z)z=m.lex()||1,"number"!==typeof z&&(z=this.symbols_[z]||z);L=e[M]&&e[M][z]}if("undefined"===typeof L||!L.length||!L[0]){var S;P=[];for(U in e[M])this.terminals_[U]&&2<U&&P.push("'"+this.terminals_[U]+"'");S=m.showPosition?"Parse error on line "+(g+1)+":\n"+m.showPosition()+"\nExpecting "+P.join(", ")+
", got '"+(this.terminals_[z]||z)+"'":"Parse error on line "+(g+1)+": Unexpected "+(1==z?"end of input":"'"+(this.terminals_[z]||z)+"'");this.parseError(S,{text:m.match,token:this.terminals_[z]||z,line:m.yylineno,loc:p,expected:P})}if(L[0]instanceof Array&&1<L.length)throw Error("Parse Error: multiple actions possible at state: "+M+", token: "+z);switch(L[0]){case 1:b.push(z);c.push(m.yytext);d.push(m.yylloc);b.push(L[1]);z=null;K?(z=K,K=null):(l=m.yyleng,f=m.yytext,g=m.yylineno,p=m.yylloc,0<h&&h--);
break;case 2:P=this.productions_[L[1]][1];G.$=c[c.length-P];G._$={first_line:d[d.length-(P||1)].first_line,last_line:d[d.length-1].last_line,first_column:d[d.length-(P||1)].first_column,last_column:d[d.length-1].last_column};x&&(G._$.range=[d[d.length-(P||1)].range[0],d[d.length-1].range[1]]);M=this.performAction.apply(G,[f,l,g,q,L[1],c,d].concat(n));if("undefined"!==typeof M)return M;P&&(b=b.slice(0,-2*P),c=c.slice(0,-1*P),d=d.slice(0,-1*P));b.push(this.productions_[L[1]][0]);c.push(G.$);d.push(G._$);
L=e[b[b.length-2]][b[b.length-1]];b.push(L);break;case 3:return!0}}}},d=function(){return{EOF:1,parseError:function(a,b){if(this.yy.parser)this.yy.parser.parseError(a,b);else throw Error(a);},setInput:function(a,b){this.yy=b||this.yy||{};this._input=a;this._more=this._backtrack=this.done=!1;this.yylineno=this.yyleng=0;this.yytext=this.matched=this.match="";this.conditionStack=["INITIAL"];this.yylloc={first_line:1,first_column:0,last_line:1,last_column:0};this.options.ranges&&(this.yylloc.range=[0,
0]);this.offset=0;return this},input:function(){var a=this._input[0];this.yytext+=a;this.yyleng++;this.offset++;this.match+=a;this.matched+=a;a.match(/(?:\r\n?|\n).*/g)?(this.yylineno++,this.yylloc.last_line++):this.yylloc.last_column++;this.options.ranges&&this.yylloc.range[1]++;this._input=this._input.slice(1);return a},unput:function(a){var b=a.length,c=a.split(/(?:\r\n?|\n)/g);this._input=a+this._input;this.yytext=this.yytext.substr(0,this.yytext.length-b);this.offset-=b;a=this.match.split(/(?:\r\n?|\n)/g);
this.match=this.match.substr(0,this.match.length-1);this.matched=this.matched.substr(0,this.matched.length-1);c.length-1&&(this.yylineno-=c.length-1);var d=this.yylloc.range;this.yylloc={first_line:this.yylloc.first_line,last_line:this.yylineno+1,first_column:this.yylloc.first_column,last_column:c?(c.length===a.length?this.yylloc.first_column:0)+a[a.length-c.length].length-c[0].length:this.yylloc.first_column-b};this.options.ranges&&(this.yylloc.range=[d[0],d[0]+this.yyleng-b]);this.yyleng=this.yytext.length;
return this},more:function(){this._more=!0;return this},reject:function(){if(this.options.backtrack_lexer)this._backtrack=!0;else return this.parseError("Lexical error on line "+(this.yylineno+1)+". You can only invoke reject() in the lexer when the lexer is of the backtracking persuasion (options.backtrack_lexer = true).\n"+this.showPosition(),{text:"",token:null,line:this.yylineno});return this},less:function(a){this.unput(this.match.slice(a))},pastInput:function(){var a=this.matched.substr(0,this.matched.length-
this.match.length);return(20<a.length?"...":"")+a.substr(-20).replace(/\n/g,"")},upcomingInput:function(){var a=this.match;20>a.length&&(a+=this._input.substr(0,20-a.length));return(a.substr(0,20)+(20<a.length?"...":"")).replace(/\n/g,"")},showPosition:function(){var a=this.pastInput(),b=Array(a.length+1).join("-");return a+this.upcomingInput()+"\n"+b+"^"},test_match:function(a,b){var c,d;this.options.backtrack_lexer&&(d={yylineno:this.yylineno,yylloc:{first_line:this.yylloc.first_line,last_line:this.last_line,
first_column:this.yylloc.first_column,last_column:this.yylloc.last_column},yytext:this.yytext,match:this.match,matches:this.matches,matched:this.matched,yyleng:this.yyleng,offset:this.offset,_more:this._more,_input:this._input,yy:this.yy,conditionStack:this.conditionStack.slice(0),done:this.done},this.options.ranges&&(d.yylloc.range=this.yylloc.range.slice(0)));if(c=a[0].match(/(?:\r\n?|\n).*/g))this.yylineno+=c.length;this.yylloc={first_line:this.yylloc.last_line,last_line:this.yylineno+1,first_column:this.yylloc.last_column,
last_column:c?c[c.length-1].length-c[c.length-1].match(/\r?\n?/)[0].length:this.yylloc.last_column+a[0].length};this.yytext+=a[0];this.match+=a[0];this.matches=a;this.yyleng=this.yytext.length;this.options.ranges&&(this.yylloc.range=[this.offset,this.offset+=this.yyleng]);this._backtrack=this._more=!1;this._input=this._input.slice(a[0].length);this.matched+=a[0];c=this.performAction.call(this,this.yy,this,b,this.conditionStack[this.conditionStack.length-1]);this.done&&this._input&&(this.done=!1);
if(c)return c;if(this._backtrack)for(var e in d)this[e]=d[e];return!1},next:function(){if(this.done)return this.EOF;this._input||(this.done=!0);var a,b,c;this._more||(this.match=this.yytext="");for(var d=this._currentRules(),e=0;e<d.length;e++)if((b=this._input.match(this.rules[d[e]]))&&(!a||b[0].length>a[0].length))if(a=b,c=e,this.options.backtrack_lexer){a=this.test_match(b,d[e]);if(!1!==a)return a;if(this._backtrack)a=!1;else return!1}else if(!this.options.flex)break;return a?(a=this.test_match(a,
d[c]),!1!==a?a:!1):""===this._input?this.EOF:this.parseError("Lexical error on line "+(this.yylineno+1)+". Unrecognized text.\n"+this.showPosition(),{text:"",token:null,line:this.yylineno})},lex:function(){var a=this.next();return a?a:this.lex()},begin:function(a){this.conditionStack.push(a)},popState:function(){return 0<this.conditionStack.length-1?this.conditionStack.pop():this.conditionStack[0]},_currentRules:function(){return this.conditionStack.length&&this.conditionStack[this.conditionStack.length-
1]?this.conditions[this.conditionStack[this.conditionStack.length-1]].rules:this.conditions.INITIAL.rules},topState:function(a){a=this.conditionStack.length-1-Math.abs(a||0);return 0<=a?this.conditionStack[a]:"INITIAL"},pushState:function(a){this.begin(a)},stateStackSize:function(){return this.conditionStack.length},options:{},performAction:function(a,b,c,d){switch(c){case 1:return 13;case 2:return 14;case 3:return 10;case 4:return 10;case 5:return 10;case 6:return 10;case 7:return 10;case 8:return 10;
case 9:return 9;case 10:return 9;case 11:return 9;case 12:return 9;case 13:return 9;case 14:return 6;case 15:return 6;case 16:return 6;case 17:return 6;case 18:return 6;case 19:return 6;case 20:return 7;case 21:return 7;case 22:return 7;case 23:return 7;case 24:return 7;case 25:return 8;case 26:return 8;case 27:return 8;case 28:return 8;case 29:return 8;case 30:return 11;case 31:return 11;case 32:return 11;case 33:return 11;case 34:return 16;case 35:return 16;case 36:return 16;case 37:return 16;case 38:return 17;
case 39:return 17;case 40:return 17;case 41:return 17;case 42:return 15;case 43:return 5}},rules:[/^(?:\s+)/,/^(?:\()/,/^(?:\))/,/^(?:=)/,/^(?:<=>)/,/^(?:<->)/,/^(?:\u21d4)/,/^(?:\u2194)/,/^(?:\u2261)/,/^(?:=>)/,/^(?:->)/,/^(?:\u21d2)/,/^(?:\u2192)/,/^(?:\u2283)/,/^(?:A\b)/,/^(?:&&)/,/^(?:&)/,/^(?:\u2227)/,/^(?:\*)/,/^(?:\.)/,/^(?:V\b)/,/^(?:\|\|)/,/^(?:\|)/,/^(?:\u2228)/,/^(?:\+)/,/^(?:\u2260)/,/^(?:\u2262)/,/^(?:\u22bb)/,/^(?:\u2295)/,/^(?:<~>)/,/^(?:~)/,/^(?:\u00ac)/,/^(?:!)/,/^(?:-)/,/^(?:([Tt][Rr][Uu][Ee]))/,
/^(?:T\b)/,/^(?:\u22a4)/,/^(?:1\b)/,/^(?:([Ff][Aa][Ll][Ss][Ee]))/,/^(?:F\b)/,/^(?:\u22a5)/,/^(?:0\b)/,/^(?:([A-Za-z]))/,/^(?:$)/],conditions:{INITIAL:{rules:[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43],inclusive:!0}}}}();b.lexer=d;a.prototype=b;b.Parser=a;return new a}();var CTATLogicParser={};
(function(){var a;a=function(){function a(a){this.parser=new CTATLogicGrammar.Parser;this.parser.yy={CTATLogicRelationNode:CTATLogicRelationNode,CTATLogicVariableNode:CTATLogicVariableNode,CTATLogicConstantNode:CTATLogicConstantNode,CTATLogicTreeNode:CTATLogicTreeNode};this.parser.yy.variableTable=a}a.none=[];a.minimal=["replaceNodes","sort"];a.negation=["replaceNodes","pushNegation","flatten","sort","absorb"];a.conjunction="replaceNodes pushNegation flatten sort distributeDisjunction absorb".split(" ");a.disjunction=
"replaceNodes pushNegation flatten sort distributeConjunction absorb".split(" ");a.prototype.getTree=function(a){if(a instanceof CTATLogicTreeNode)return a;if(a instanceof String)try{return Object.assign(this.parser.parse(a),{path:a.path})}catch(e){return null}else try{return this.parser.parse(String(a))}catch(e){return null}};a.prototype.getExpression=function(a,b){if(a instanceof CTATLogicTreeNode)return b;if(null!=b&&b.path)return Object.assign(new String(b.toString()),{path:b.path});try{return null!=
b?b.toString():void 0}catch(g){return null}};a.prototype.logicParse=function(b){try{return this.parser.parse(String(b)).simplify(a.none)}catch(e){return null}};a.prototype.logicParseAndSort=function(b){try{return this.parser.parse(String(b)).simplify(a.minimal)}catch(e){return null}};a.prototype.logicEvaluate=function(a){try{return this.parser.parse(String(a)).evaluate()}catch(e){return null}};a.prototype.logicFindAllOperators=function(a,b){var d,c;return null!=(d=this.getTree(a))?null!=(c=d.findAllOperators(b,
[]))?c.map(function(b){return function(c){return b.getExpression(a,c)}}(this)):void 0:void 0};a.prototype.logicFindAllExpressions=function(a,b){var d,c;return null!=(d=this.getTree(a))?null!=(c=d.findAllExpressions(b,[]))?c.map(function(b){return function(c){return b.getExpression(a,c)}}(this)):void 0:void 0};a.prototype.logicReplaceExpression=function(a,b,g){var c;return this.getExpression(a,null!=(c=this.getTree(a))?c.replaceExpression(this.getTree(b),this.getTree(g),b.path.slice()):void 0)};a.prototype.logicApplyRule=
function(a,b){var d;return this.getExpression(a,null!=(d=this.getTree(a))?d.simplifyNode([b]):void 0)};a.prototype.logicSimplifyNNF=function(b){try{return this.parser.parse(String(b)).simplify(a.negation).toString()}catch(e){return null}};a.prototype.logicSimplifyCNF=function(b){try{return this.parser.parse(String(b)).simplify(a.conjunction).toString()}catch(e){return null}};a.prototype.logicSimplifyDNF=function(b){try{return this.parser.parse(String(b)).simplify(a.disjunction).toString()}catch(e){return null}};
a.prototype.logicValid=function(a){return null!=this.logicParse(a)};a.prototype.logicValued=function(a){var b;return null!=(b=this.logicEvaluate(a))?null!=b:null};a.prototype.logicSimplifiedNNF=function(a){var b,d;return null!=(b=this.logicSimplifyNNF(a))&&null!=(d=this.logicParseAndSort(a))?b.toString()===d.toString():null};a.prototype.logicSimplifiedCNF=function(a){var b,d;return null!=(b=this.logicSimplifyCNF(a))&&null!=(d=this.logicParseAndSort(a))?b.toString()===d.toString():null};a.prototype.logicSimplifiedDNF=
function(a){var b,d;return null!=(b=this.logicSimplifyDNF(a))&&null!=(d=this.logicParseAndSort(a))?b.toString()===d.toString():null};a.prototype.logicIdentical=function(a,b){var d,c;return null!=(d=this.logicParseAndSort(a))&&null!=(c=this.logicParseAndSort(b))?d.equals(c):null};a.prototype.logicEqual=function(a,b){var d,c;return null!=(d=this.logicEvaluate(a))&&null!=(c=this.logicEvaluate(b))?d===c:null};a.prototype.logicEquivalent=function(a,b){var d,c;return null!=(d=this.logicSimplifyDNF(a))&&
null!=(c=this.logicSimplifyDNF(b))?d===c:null};return a}();"undefined"!==typeof module&&null!==module?module.exports=a:this.CTATLogicParser=a}).call(this);var CTATFormulaFunctions={};
(function(){var a,b,d,e,g,c,f,h,m,l,n,p=[].slice;g=/^(\d+)?(?:$|(?:\s|^)(\d+)\/(\d+)$)/;e=/^\d+(\.\d\d)?$/;c=RegExp("((\\d+)\\.?(\\d+)?|\\.(\\d+))([Ee]([+-]?\\d+))?","g");l=/^[+-]?((\d+)\.?(\d+)?|\.(\d+))([Ee]([+-]?\d+))?$/;m=/^\s*\(\s*([+-]?((\d+)\.?(\d+)?|\.(\d+))([Ee]([+-]?\d+))?)\s*\,\s*([+-]?((\d+)\.?(\d+)?|\.(\d+))([Ee]([+-]?\d+))?)\s*\)\s*$/;h=/([bcdfghjklmnpqrstvwxz]|qu)y$/;f=/([bcdfghjklmnpqrstvwxz]o|[sc]h|s)$/;n=function(a,b){var c;null==b&&(b=!1);var d,e,f,g;f=null!=(c=a[4])?c:a[2]+(a[3]||
"");g=[];d=0;for(e=f.length;d<e;d++)c=f[d],(b||(b="0"!==c))&&g.push(c);return g.length};d=function(a){return(a[4]||a[3]||"").length-+(a[6]||0)};b=function(a,b,c){var d,e;return isNaN(d=+a)||isNaN(e=+b)?c(String(a).toLowerCase(),String(b).toLowerCase()):c(d,e)};a=function(){function a(){}a.printf=("undefined"!==typeof window&&null!==window?window:global).sprintf;a.sum=function(){return(1<=arguments.length?p.call(arguments,0):[]).reduce(function(a,b){return a+ +b},0)};a.mod=function(a,b){return Math.round(a)%
Math.round(b)};a.modf=function(a,b){return a%b};a.IEEEremainder=a.modf;a.isFactor=function(a,b){return 1!==+a&&0===b%a};a.isMultiple=function(a,b){return 0===a%b};a.isUnit=function(a){return 1===+a};a.isAny=function(a,b){return this.isFactor(a,b)||this.isMultiple(a,b)||this.isUnit(a)};a.gcf=function(a,b){var c;c=[Math.abs(a),Math.abs(b)];a=c[0];for(b=c[1];0<b;)c=[b,a%b],a=c[0],b=c[1];return a};a.lcm=function(a,b){return Math.abs(a*b)/this.gcf(a,b)};a.integerInRange=function(a,b,c){var d;null==b&&
(b=-Infinity);null==c&&(c=Infinity);return Math.round(b)<=(d=Math.round(a))&&d<=Math.round(c)};a.fmtDecimal=function(a,b){null==b&&(b=2);return(+a).toFixed(Math.round(+b))};a.fmtNormal=function(a,b){null==b&&(b=6);return this.fmtDecimal(a,b).replace(/\.0+$|(\..+?)0+$/,"$1")};a.fmtDollar=function(a,b){null==b&&(b="");a=this.fmtDecimal(a);b=b.toLowerCase();0<=b.indexOf("i")&&(a=a.replace(/\.00$/,""));return 0<=b.indexOf("d")?"$"+a:a};a.dollarEquals=function(){var a,b;a=arguments[0];b=2<=arguments.length?
p.call(arguments,1):[];a=this.fmtDollar(a,"i");return b.some(function(b){return function(c){return a===b.fmtDollar(c,"i")}}(this))};a.matchWithPrecision=function(a,c){var d,e;return(d=String(a).match(l))&&(e=String(c).match(l))&&n(d)===n(e)&&b(a,c,function(a,b){return a===b})};a.matchWithoutPrecision=function(a,c){var e,f;return(e=String(a).match(l))&&(f=String(c).match(l))&&(a=n(e)>n(f)?(+a).toFixed(d(f)):String(a))&&b(a,c,function(a,b){return a===b})};a.constantsConform=function(){var a,b;a=arguments[0];
b=2<=arguments.length?p.call(arguments,1):[];b=b.map(function(a){return"string"===typeof a?new RegExp("^"+a+"$","i"):a});return(a.match(c)||[]).every(function(a){return b.some(function(b){return b.test(a)})})};a.constantsDollar=function(a){return this.constantsConform(a,e)};a.isNumber=function(a,b,c){null==b&&(b=!0);return(b||"number"===typeof a)&&!isNaN(a=+a)&&(!c||a===Math.round(a))};a.isInteger=function(a,b){return this.isNumber(a,b,!0)};a.isVar=function(a){return/^\s*[a-zA-Z]\s*$/.test(a)};a.makeFraction=
function(a,b,c){null!=b&&null==c&&(c=[0,a,b],a=c[0],b=c[1],c=c[2]);a=+a||0;b=+b||0;c=+c||1;return this.isInteger(a)&&this.isInteger(b)&&this.isInteger(c)?(a?a+(b?" ":""):"")+(b?b+(1===c?"":"/"+c):""):null};a.fractionMake=a.makeFraction;a.getWhole=function(a){return null!=(a=a.match(g))?a[1]||"0":null};a.getNumerator=function(a){return null!=(a=a.match(g))?a[2]||"0":null};a.getDividend=a.getNumerator;a.getDenominator=function(a){return null!=(a=a.match(g))?a[3]||"1":null};a.getDivisor=a.getDenominator;
a.convertToMixed=function(a){return null!=(a=a.match(g))?this.makeFraction((+a[1]||0)+Math.floor((+a[2]||0)/(+a[3]||1)),(+a[2]||0)%(+a[3]||1),a[3]):null};a.convertToImproper=function(a){return null!=(a=a.match(g))?this.makeFraction(0,(+a[1]||0)*(+a[3]||1)+(+a[2]||0),a[3]||1):null};a.evaluateFraction=function(a){return null!=(a=a.match(g))?((+a[1]||0)*(+a[3]||1)+(+a[2]||0))/(+a[3]||1):null};a.divEvaluate=a.evaluateFraction;a.simplifyFraction=function(a){var b;return null!=(a=a.match(g))?(null!=a[1]&&
null!=a[2]&&(a[1]=+a[1]+Math.floor(+a[2]/+a[3]),a[2]=+a[2]%+a[3]),b=null!=a[2]?this.gcf(+a[2],+a[3]):1,this.makeFraction(a[1],a[2]/b,a[3]/b)):null};a.fractionsimplify=a.simplifyFraction;a.simplifyMixed=a.simplifyFraction;a.simplifiedFraction=function(a){var b;return null!=(b=this.simplifyFraction(a))?b===a:null};a.isSimplifiedMixed=a.simplifiedFraction;a.fractionEquals=function(a,b){var c,d;return null!=(c=this.evaluateFraction(a))&&null!=(d=this.evaluateFraction(b))?c===d:null};a.simplifiedFractionEquals=
function(a,b){var c,d;return null!=(c=this.simplifiedFraction(a))&&null!=(d=this.simplifiedFraction(b))?c&&d&&this.fractionEquals(a,b):null};a.rationalEquals=function(a,b){return this.matchWithoutPrecision(+b||this.evaluateFraction(b),+a||this.evaluateFraction(a))};a.quote=function(a){return'"'+a+'"'};a.compact=function(a){return a.replace(/\s*/g,"")};a.equalsIgnoreCase=function(a,b){return a===b||a.toUpperCase()===b.toUpperCase()||a.toLowerCase()===b.toLowerCase()};a.replaceFirst=function(a,b,c){return a.replace(new RegExp(b),
c)};a.replaceAll=function(a,b,c){return a.replace(new RegExp(b,"g"),c)};a.regExMatch=function(a,b,c){return("string"===typeof a?new RegExp("^("+a+")$",c):a).test(b)};a.rm1coeff=function(a){if(null!=a)return a.replace(/(^|[^0-9])1([a-zA-Z])/g,"$1$2")};a.setMatches=function(a,b,c){var d,e;d=a.split(c);e=b.split(c);return e.every(function(a){return d.includes(a)})&&d.every(function(a){return e.includes(a)})};a.pointInRange=function(a,b,c,d,e){var f,g,l;if(f=null!=b?"function"===typeof b.match?b.match(m):
void 0:void 0)e=[f[1],f[8],c,d],b=e[0],c=e[1],d=e[2],e=e[3];null==d&&(d=0);null==e&&(e=d);return(f=a.match(m))&&b-d<=(g=f[1])&&g<=+b+ +d&&c-e<=(l=f[8])&&l<=+c+ +e};a.plural=function(a,b,c,d){var e;if(!b||2>a)return b;null==c&&(c=h.test(e=b.toLowerCase())?"y":"");if(!b.endsWith(c))return b;null==d&&(d=h.test(e)?"ies":f.test(e)?"es":"s");c.length&&(b=b.split(c)[0]);return b+(/[A-Z]/.test(b[b.length-1])?d.toUpperCase():d)};a.totalTableDec=function(a,b,c,d){return 1E3*(+a||0)+100*(+b||0)+10*(+c||0)+(+d||
0)};a.columnCell=function(a,b,c,d,e,f,g,l,h,m){switch(h){case "r1c1":case "r2c1":case "r3c1":return m?a:e;case "r1c2":case "r2c2":case "r3c2":return m?b:f;case "r1c3":case "r2c3":case "r3c3":return m?c:g;case "r1c4":case "r2c4":case "r3c4":return m?d:l;default:return 0}};a.first=function(){return(1<=arguments.length?p.call(arguments,0):[])[0]};a.last=function(){var a;a=1<=arguments.length?p.call(arguments,0):[];return a[a.length-1]};a.chooseRandomly=function(){var a;a=1<=arguments.length?p.call(arguments,
0):[];return a[Math.floor(Math.random()*a.length)]};a.firstNonNull=function(){var a;return null!=(a=(1<=arguments.length?p.call(arguments,0):[]).find(function(a){return null!=a}))?a:null};a.valueOrZero=function(){var a;return null!=(a=(1<=arguments.length?p.call(arguments,0):[]).find(function(a){return null!=a}))?a:0};a.hasValue=function(){return(1<=arguments.length?p.call(arguments,0):[]).every(function(a){return null!=a})};a.equals=function(){var a,b,c;b=arguments[0];c=2<=arguments.length?p.call(arguments,
1):[];null==b&&(b=void 0);return isNaN(a=+b)?c.every(function(a){return b===(null!=a?a:void 0)}):c.every(function(b){return a===+(null!=b?b:NaN)})};a.memberOf=function(){var a,b,c;b=arguments[0];c=2<=arguments.length?p.call(arguments,1):[];null==b&&(b=void 0);return isNaN(a=+b)?c.some(function(a){return b===(null!=a?a:void 0)}):c.some(function(b){return a===+(null!=b?b:NaN)})};a.greaterThan=function(a,c){return b(a,c,function(a,b){return a>b})};a.lessThan=function(a,c){return b(a,c,function(a,b){return a<
b})};a.greaterThanOrEqual=function(a,c){return b(a,c,function(a,b){return a>=b})};a.lessThanOrEqual=function(a,c){return b(a,c,function(a,b){return a<=b})};a.equal=function(a,c){return b(a,c,function(a,b){return a===b})};a.notEqual=function(a,c){return b(a,c,function(a,b){return a!==b})};a.and=function(){return(1<=arguments.length?p.call(arguments,0):[]).reduce(function(a,b){return a&&b},!0)};a.or=function(){return(1<=arguments.length?p.call(arguments,0):[]).reduce(function(a,b){return a||b},!1)};
a.not=function(a){return!a};a.ifThen=function(a,b,c){return a?b:c};a.assign=function(a,b){var c,d,e,f,g,l;l="undefined"!==typeof window&&null!==window?window:global;d=a.split(".");e=2<=d.length?p.call(d,0,c=d.length-1):(c=0,[]);f=d[c++];c=0;for(g=e.length;c<g;c++)d=e[c],l=null!=l[d]?l[d]:l[d]={};return l[f]=b};a.toString=function(a){return a.toString()};return a}();"undefined"!==typeof module&&null!==module?module.exports=a:this.CTATFormulaFunctions=a}).call(this);var CTATFormulaActions={};
(function(){var a;a=function(){function a(){}a.goToState=function(a){return CTAT.ToolTutor.tutor.goToState(a)};a.goToStartState=function(){return CTAT.ToolTutor.tutor.goToStartState()};a.performInterfaceAction=function(a,b,g){return CTAT.ToolTutor.sendToInterface((new CTATTutoringServiceMessageBuilder).createInterfaceActionMessage(CTATMessage.makeTransactionId(),new CTATSAI(a,b,g)))};return a}();"undefined"!==typeof module&&null!==module?module.exports=a:this.CTATFormulaActions=a}).call(this);var CTATFormulaParser={};
(function(){var a,b,d,e,g=[].slice,c=[].indexOf||function(a){for(var b=0,c=this.length;b<c;b++)if(b in this&&this[b]===a)return b;return-1};e=/"(?:[^\\"]|\\\")*"|'(?:[^\\'']|\\\')*'/;b=/[A-Za-z_][\w._]*(?![\w(._])/g;d="abstract await boolean break byte case catch char class const continue debugger default delete do double else enum export extends false final finally float for function goto if implements import in instanceof int interface let long native new null of package private protected public return short static super switch synchronized this throw throws transient true try typeof var void volatile while with yield Array Date eval function global hasOwnProperty Infinity isFinite isNaN isPrototypeOf length Math NaN name Number Object prototype String toString undefined valueOf window".split(" ");a=
function(){function a(a){var b,c,d;this.variableTable=a;this.algebraParser=new CTATAlgebraParser;this.logicParser=new CTATLogicParser;this.keys=[];this.values=[];d="EPSILON MAX_VALUE MIN_VALUE POSITIVE_INFINITY NEGATIVE_INFINITY isFinite isInteger isNaN parseFloat parseInt".split(" ");a=0;for(c=d.length;a<c;a++)b=d[a],this.keys.push(b),this.values.push(Number[b]);d=["toExponential","toFixed","toLocaleString","toPrecision","valueOf"];a=0;for(c=d.length;a<c;a++)b=d[a],this.keys.push(b),this.values.push(function(a){return function(){var b,
c;c=arguments[0];b=2<=arguments.length?g.call(arguments,1):[];return a.apply(c,b)}}(Number.prototype[b]));d="E LN10 LN2 LOG10E LOG2E PI SQRT1_2 SQRT2 abs acos acosh asin asinh atan atanh atan2 cbrt ceil clz32 cos cosh exp expm1 floor fround hypot imul log log10 log1p log2 max min pow random round sign sin sinh sqrt tan tanh trunc".split(" ");a=0;for(c=d.length;a<c;a++)b=d[a],this.keys.push(b),this.values.push(Math[b]);d=["fromCharCode","fromCodePoint"];a=0;for(c=d.length;a<c;a++)b=d[a],this.keys.push(b),
this.values.push(String[b]);d="charAt charCodeAt codePointAt concat contains endsWith indexOf lastIndexOf localeCompare match repeat replace search slice split startsWith substr substring toLocaleLowerCase toLocaleUpperCase toLowerCase toUpperCase trim valueOf".split(" ");c=0;for(a=d.length;c<a;c++)b=d[c],this.keys.push(b),this.values.push(function(a){return function(){var b,c;c=arguments[0];b=2<=arguments.length?g.call(arguments,1):[];return a.apply(c,b)}}(String.prototype[b]));this.keys.push("length");
this.values.push(function(a){return a.length});d="algParse algEvaluate algPartialSimplify algSimplify algValid algValued algPartialSimplified algSimplified algIdentical algEqual algPartialEquivalent algEquivalent isAlgValid algEval algStrictEquivTermsSameOrder algEquivTermsSameOrder algStrictEquivTerms algEquivTerms algEquiv isSimplified calc calca simplify algebraicEqual patternMatches polyTermsEqual algebraicMatches expressionMatches".split(" ");c=0;for(a=d.length;c<a;c++)b=d[c],this.keys.push(b),
this.values.push(function(a,b){return function(){var c;c=1<=arguments.length?g.call(arguments,0):[];return a.apply(b,c)}}(this.algebraParser[b],this.algebraParser));d="logicParse logicEvaluate logicValid logicValued logicIdentical logicEqual logicEquivalent logicFindAllOperators logicFindAllExpressions logicReplaceExpression logicApplyRule logicSimplifyNNF logicSimplifyCNF logicSimplifyDNF logicSimplifiedNNF logicSimplifiedCNF logicSimplifiedDNF".split(" ");c=0;for(a=d.length;c<a;c++)b=d[c],this.keys.push(b),
this.values.push(function(a,b){return function(){var c;c=1<=arguments.length?g.call(arguments,0):[];return a.apply(b,c)}}(this.logicParser[b],this.logicParser));for(b in CTATFormulaFunctions)this.keys.push(b),this.values.push(function(a,b){return function(){var c;c=1<=arguments.length?g.call(arguments,0):[];return a.apply(b,c)}}(CTATFormulaFunctions[b],CTATFormulaFunctions));for(b in CTATFormulaActions)this.keys.push(b),this.values.push(function(a,b){return function(){var c;c=1<=arguments.length?
g.call(arguments,0):[];return a.apply(b,c)}}(CTATFormulaActions[b],CTATFormulaActions))}a.prototype.evaluate=function(a,f,l,n){var h,m,q,v,u,A,y,C,r,I,J,B;try{C="undefined"!==typeof window&&null!==window?window:global;h=function(){var a;a=[];for(v in C)a.push(v);return a}().concat(["selection","action","input"]);r=a.split(e);m=0;for(u=r.length;m<u;m++)for(y=r[m],J=null!=(I=y.match(b))?I:[],q=0,A=J.length;q<A;q++)v=J[q],0>c.call(d,v)&&0>c.call(h,v)&&0>c.call(this.keys,v)&&CTATFormulaFunctions.assign(v,
void 0);for(v in B=this.variableTable.getTable())C[v]=B[v];return function(a,b,c){c.prototype=a.prototype;c=new c;a=a.apply(c,b);return Object(a)===a?a:c}(Function,["selection","action","input"].concat(g.call(this.keys),["return "+a.trim()]),function(){}).apply(C,[f,l,n].concat(g.call(this.values)))}catch(D){return console.log(D),null}finally{for(v in C)null!=v&&0>c.call(h,v)&&(B[v]=C[v],delete C[v])}};a.prototype.interpolateSplitPattern=/<%=|%>/;a.prototype.interpolate=function(a,b,c,d){var e,f,
g,l,h;l=a.split(this.interpolateSplitPattern);h=[];a=f=0;for(g=l.length;f<g;a=++f)e=l[a],h.push(a%2?this.evaluate(e,b,c,d):e);return h.join("")};return a}();"undefined"!==typeof module&&null!==module?module.exports=a:this.CTATFormulaParser=a}).call(this);var CTATSingleMatcher=function(a,b){CTATMatcher.call(this,!0,a,b);var d=this,e="",g="";this.getSingle=function(a){return e};this.setSingle=function(a){null===a||"undefined"===typeof a?d.ctatdebug('CTATSingleMatcher --\x3e bad argument "'+a+'" to setSingle()'):e=a};this.toString=function(){console.log("Error: CTATSingleMatcher.toString() called: should be overridden")};this.matchSingle=function(a){console.log("Error: CTATSingleMatcher.matchSingle("+a+") called: should be overridden");return!1};this.getReplacementFormula=
function(){return g};this.setReplacementFormula=function(a){g=a?a:""};this.evaluateReplacement=function(a,b,e){e=null;if(!g)return e;d.ctatdebug("CTATSingleMatcher.evaluateReplacement("+a+", "+b+")");var c=a.getSelection(),f=a.getAction();a=CTATVariableTable.standardizeType(a.getInput());b||(b=new CTATVariableTable);b=new CTATFormulaParser(b);d.ctatdebug("CTATSingleMatcher calling CTATFormulaParser.evaluate("+g+", "+c+", "+f+", "+a+")");try{e=b.evaluate(g,c,f,a)}catch(n){d.ctatdebug("CTATSingleMatcher error from CTATFormulaParser.evaluate("+
g+") "+n.name+": "+n.message),e=null}d.ctatdebug("CTATSingleMatcher.evaluateReplacement() returns "+e+", type "+typeof e);return e}};CTATSingleMatcher.prototype=Object.create(CTATMatcher.prototype);CTATSingleMatcher.prototype.constructor=CTATSingleMatcher;CTATSingleMatcher.prototype.matchConcatenation=function(a){a=this.array2ConcatString(a);return this.matchSingle(a)};CTATSingleMatcher.prototype.match=function(a,b,d,e){return this.matchConcatenation(a)};
CTATSingleMatcher.prototype.setParameter=function(a,b,d){this.ctatdebug("CTATSingleMatcher.setParameter("+a+", "+b+", "+d+") calling\n  "+this.setSingle.toString());this.setSingle(a)};"undefined"!==typeof module&&(module.exports=CTATSingleMatcher);var CTATAnyMatcher=function(a,b){CTATSingleMatcher.call(this,a,!0);this.toString=function(){return"*"};this.matchSingle=function(a){return!0}};CTATAnyMatcher.prototype=Object.create(CTATSingleMatcher.prototype);CTATAnyMatcher.prototype.constructor=CTATAnyMatcher;"undefined"!==typeof module&&(module.exports=CTATAnyMatcher);var CTATExactMatcher=function(a,b){CTATSingleMatcher.call(this,a,!0);var d=this;this.toString=function(){return d.getSingle().toString()};this.matchSingle=function(a){var b=d.getSingle();ctatdebug("CTATExactMatcher --\x3e in matchSingle: s = "+a+", singleval = "+b+", caseInsensitive "+d.getCaseInsensitive()+", "+typeof d.getCaseInsensitive());return d.getCaseInsensitive()?String(a).toUpperCase()==String(b).toUpperCase():String(a)==String(b)}};CTATExactMatcher.prototype=Object.create(CTATSingleMatcher.prototype);
CTATExactMatcher.prototype.constructor=CTATExactMatcher;"undefined"!==typeof module&&(module.exports=CTATExactMatcher);var CTATExampleTracerException=function(a){CTATBase.call(this,"CTATExampleTracerException","");this.toString=function(){return a}};CTATExampleTracerException.prototype=Object.create(CTATBase.prototype);CTATExampleTracerException.prototype.constructor=CTATExampleTracerException;"undefined"!==typeof module&&(module.exports=CTATExampleTracerException);var CTATExpressionMatcher=function(a,b){function d(a,b,d,f,g){h.ctatdebug("CTATExpressionMatcher.testVector["+f+"]("+a+", "+b+", "+d+", "+g+") to call evaluate");var l=CTATVariableTable.standardizeType(d);h.ctatdebug("CTATExpressionMatcher.testVector typeof input "+typeof d+"; inputConv "+l+", typeof "+typeof l);d=h.evaluate(a,b,l,g);h.ctatdebug("CTATExpressionMatcher.testVector evaluate("+a+", "+b+", "+l+", "+g+") returned "+d+", type "+typeof d);g=null;switch(f){case CTATMatcher.SELECTION:g=a;break;
case CTATMatcher.ACTION:g=b;break;case CTATMatcher.INPUT:case CTATMatcher.NON_SINGLE:g=l}c=g;h.ctatdebug("CTATExpressionMatcher.testVector comparee "+g+", type "+typeof g+", relation "+e+"( "+CTATExpressionMatcher.RELATIONS[e]+" )");try{switch(e){case CTATExpressionMatcher.BOOL_RELATION:return!!d;case CTATExpressionMatcher.EQ_RELATION:if(null==g)return null==d;if(null==d)break;return h.compareNumberOrString(g,d,e);case CTATExpressionMatcher.NOT_EQ_RELATION:return null==g?null!=d:null==d?!0:h.compareNumberOrString(g,
d,e);case CTATExpressionMatcher.LT_RELATION:case CTATExpressionMatcher.GT_RELATION:if(null==g||null==d)break;return h.compareNumberOrString(g,d,e);case CTATExpressionMatcher.LTE_RELATION:case CTATExpressionMatcher.GTE_RELATION:if(null==g)return null==d;if(null!=d)return h.compareNumberOrString(g,d,e)}}catch(v){}return!1}CTATSingleMatcher.call(this,a,b);var e=CTATExpressionMatcher.EQ_RELATION,g=b,c=null,f=!1,h=this;this.getLastInput=function(){h.ctatdebug("CTATExpressionMatcher.getLastInput() returns "+
c);return c};this.isEqualRelation=function(){h.ctatdebug("CTATExpressionMatcher --\x3e in isEqualRelation");return e===CTATExpressionMatcher.EQ_RELATION};this.getEvaluatedInput=function(a,b){h.ctatdebug("CTATExpressionMatcher --\x3e in getEvaluatedInput("+a+", "+b+")");var c=CTATVariableTable.standardizeType(a.getInput()),c=h.evaluate(a.getSelection(),a.getAction(),c,b);h.ctatdebug("CTATExpressionMatcher.getEvaluatedInput() returns "+c);return c};this.toString=function(){return CTATExpressionMatcher.RELATIONS[e]+
' "'+g+'"'};this.matchSingle=function(a){throw new CTATExampleTracerException("UnsupportedOperationException");};this.setInputExpression=function(a){g=a};this.setRelation=function(a){e=a};this.interpolate=function(a,b,c,d){try{var e=new CTATVariableTable;return(new CTATFormulaParser(e)).interpolate(a,b,c,d)}catch(q){return null}};this.evaluate=function(a,b,c,d){if("undefined"==typeof d||null==d)d=new CTATVariableTable;h.ctatdebug("CTATExpressionMatcher.evaluate(..., vt="+d+") creating CTATFormulaParser");
d=new CTATFormulaParser(d);h.ctatdebug("calling CTATFormulaParser.evaluate("+h.getInputExpression()+", "+a+", "+b+", "+c+")");try{return d.evaluate(h.getInputExpression(),a,b,c)}catch(x){return h.ctatdebug("CTATExpressionMatcher --\x3e "+x.name+": "+x.message),null}};this.matchConcatenation=function(b,c,e,g){b=h.array2ConcatString(b);null===c||"undefined"===typeof c||null===e||"undefined"===typeof e?f=d(b,null,null,a,g):(c=h.array2ConcatString(c),e=h.array2ConcatString(e),f=d(b,c,e,a,g));return f};
this.match=function(a,b,c,d,e){return h.matchConcatenation(a,b,c,e)};this.getInputExpression=function(){return g};(function(){if(null!==b&&"undefined"!==typeof b){var a;a=b.indexOf('"');var c=b.lastIndexOf('"');0<=a&&0<=c?(a=b.substring(a+1,c),c=b.substring(0,b.indexOf(" ")),e=CTATExpressionMatcher.nameToRelation(c)):a=b;h.setInputExpression(a)}})()};Object.defineProperty(CTATExpressionMatcher,"EQ_RELATION",{enumerable:!1,configurable:!1,writable:!1,value:0});
Object.defineProperty(CTATExpressionMatcher,"LT_RELATION",{enumerable:!1,configurable:!1,writable:!1,value:1});Object.defineProperty(CTATExpressionMatcher,"GT_RELATION",{enumerable:!1,configurable:!1,writable:!1,value:2});Object.defineProperty(CTATExpressionMatcher,"NOT_EQ_RELATION",{enumerable:!1,configurable:!1,writable:!1,value:3});Object.defineProperty(CTATExpressionMatcher,"GTE_RELATION",{enumerable:!1,configurable:!1,writable:!1,value:4});
Object.defineProperty(CTATExpressionMatcher,"LTE_RELATION",{enumerable:!1,configurable:!1,writable:!1,value:5});Object.defineProperty(CTATExpressionMatcher,"BOOL_RELATION",{enumerable:!1,configurable:!1,writable:!1,value:6});Object.defineProperty(CTATExpressionMatcher,"RELATIONS",{enumerable:!1,configurable:!1,writable:!1,value:"= < > != >= <= boolean".split(" ")});
CTATExpressionMatcher.nameToRelation=function(a){for(var b=0;b<CTATExpressionMatcher.RELATIONS.length;b++)if(a==CTATExpressionMatcher.RELATIONS[b])return b;return CTATExpressionMatcher.EQ_RELATION};CTATExpressionMatcher.prototype=Object.create(CTATSingleMatcher.prototype);CTATExpressionMatcher.prototype.constructor=CTATExpressionMatcher;
CTATExpressionMatcher.prototype.setParameter=function(a,b,d){a&&b&&d&&(a=d.getNodeTextValue(a),this.ctatdebug("CTATExpressionMatcher.setParameter("+b+", "+a+")"),"InputExpression"==b?this.setInputExpression(a):"relation"==b&&this.setRelation(CTATExpressionMatcher.nameToRelation(a)))};
CTATExpressionMatcher.prototype.compareNumberOrString=function(a,b,d){a=String(a);b=String(b);var e=Number(a),g=Number(b);if(isNaN(e)||isNaN(g))switch(d){case CTATExpressionMatcher.EQ_RELATION:return a==b;case CTATExpressionMatcher.NOT_EQ_RELATION:return a!=b;case CTATExpressionMatcher.LT_RELATION:return a.toLowerCase()<b.toLowerCase();case CTATExpressionMatcher.GT_RELATION:return a.toLowerCase()>b.toLowerCase();case CTATExpressionMatcher.LTE_RELATION:return a.toLowerCase()<=b.toLowerCase();case CTATExpressionMatcher.GTE_RELATION:return a.toLowerCase()>=
b.toLowerCase();case CTATExpressionMatcher.BOOL_RELATION:return!!b;default:return!1}else switch(d){case CTATExpressionMatcher.EQ_RELATION:return e==g;case CTATExpressionMatcher.NOT_EQ_RELATION:return e!=g;case CTATExpressionMatcher.LT_RELATION:return e<g;case CTATExpressionMatcher.GT_RELATION:return e>g;case CTATExpressionMatcher.LTE_RELATION:return e<=g;case CTATExpressionMatcher.GTE_RELATION:return e>=g;case CTATExpressionMatcher.BOOL_RELATION:return!!g;default:return!1}};
"undefined"!==typeof module&&(module.exports=CTATExpressionMatcher);var CTATRangeMatcher=function(a,b){CTATSingleMatcher.call(this,a,!0);var d=0,e=0;this.toString=function(){return"[ "+d+" , "+e+" ]"};this.setMinimum=function(a){try{d=parseFloat(a)}catch(c){throw new CTATExampleTracerException('Number format exception while parsing minimum value "'+a+'": '+c);}};this.setMaximum=function(a){try{e=parseFloat(a)}catch(c){throw new CTATExampleTracerException('Number format exception while parsing maximum value "'+a+'": '+c);}};this.matchSingle=function(a){var b;try{b=
parseFloat(a)}catch(f){throw new CTATExampleTracerException("Number format exception while parsing .");}return d<=b&&b<=e?!0:!1}};CTATRangeMatcher.prototype=Object.create(CTATSingleMatcher.prototype);CTATRangeMatcher.prototype.constructor=CTATRangeMatcher;
CTATRangeMatcher.prototype.setParameter=function(a,b){switch((b?b:"").toString().trim().toLowerCase()){case "minimum":this.setMinimum(a);break;case "maximum":this.setMaximum(a);break;default:console.log('CTATRangeMatcher.setParameter() undefined parameter name "'+b+'"'),this.setMinimum(a),this.setMaximum(a)}};CTATRangeMatcher.prototype.match=function(a,b,d,e){return this.matchSingle(a,b,d,e)};"undefined"!==typeof module&&(module.exports=CTATRangeMatcher);var CTATRegexMatcher=function(a,b){CTATSingleMatcher.call(this,a,!0);var d=null,e=null,g=this;this.toString=function(){return d};this.setSinglePattern=function(a){"undefined"===typeof a||null===a?console.log("CTATRegexMatcher: null or undefined pattern"):(d=a,e=g.getCaseInsensitive()?new RegExp(a,"i"):new RegExp(a))};this.setSingle=function(a){g.setSinglePattern(a)};this.matchSingle=function(a){if(null==a)return null==getSingle();if(null==e)return console.log("Error: CTATRegexMatcher.matchSingle called before pattern has been set"),
!1;var b=e.exec(a);return null!=b&&b[0]==a}};CTATRegexMatcher.prototype=Object.create(CTATSingleMatcher.prototype);CTATRegexMatcher.prototype.constructor=CTATRegexMatcher;"undefined"!==typeof module&&(module.exports=CTATRegexMatcher);var CTATWildcardMatcher=function(a,b){function d(a){if(null==a||"undefined"===typeof a)return null;var b=(new String(a)).replace(RegExp("\\?","g"),"."),d=b.replace(RegExp("\\*","g"),".*"),g=d.replace(RegExp("\\[\\!","g"),"[^");e.ctatdebug("CTATWildcardMatcher.convertToFullRegex("+a+") after qm: "+b+"; after aster: "+d+"; after negate: "+g+";");return g}CTATRegexMatcher.call(this,a,b);var e=this;this.toString=function(){return null};this.setSingle=function(a){e.simpleSinglePattern=a;e.setSinglePattern.call(e,
d(a))};this.setSingle(b);this.simpleSinglePattern=b};CTATWildcardMatcher.prototype=Object.create(CTATRegexMatcher.prototype);CTATWildcardMatcher.prototype.constructor=CTATWildcardMatcher;"undefined"!==typeof module&&(module.exports=CTATWildcardMatcher);var CTATVectorMatcher=function(a,b,d,e){function g(a,b,d,e,g){l.ctatdebug("CTATVectorMatcher --\x3e in _match("+a+", "+b+", "+d+", "+e+")");if(0===c.length||0===f.length||0===h.length)c.push(new CTATExactMatcher(CTATMatcher.SELECTION,l.array2ConcatString(l.getDefaultSelectionArray()))),f.push(new CTATExactMatcher(CTATMatcher.ACTION,l.array2ConcatString(l.getDefaultActionArray()))),h.push(new CTATExactMatcher(CTATMatcher.INPUT,l.array2ConcatString(l.getDefaultInputArray())));var n=[];n[CTATMatcher.SELECTION]=
a;n[CTATMatcher.ACTION]=b;n[CTATMatcher.INPUT]=d;for(var p=0;3>p;p++){var q=m[p][0],r=q instanceof CTATExpressionMatcher?q.matchConcatenation(a,b,d,e):q.matchConcatenation(n[p]);l.ctatdebug("CTATVectorMatcher --\x3e in _match["+p+"] after "+q+".concat returns: "+r);if(g)g.push(r);else if(!1===r)return!1}if(g)for(a=0;a<g.length;++a)if(!g[a])return!1;return!0}CTATMatcher.call(this,!0,CTATMatcher.VECTOR,!0);var c=a instanceof Array?a:[],f=b instanceof Array?b:[],h=d instanceof Array?d:[],m=[];m[CTATMatcher.SELECTION]=
c;m[CTATMatcher.ACTION]=f;m[CTATMatcher.INPUT]=h;var l=this;this.match=function(a,b,c,d,e){return!1!==g(a,b,c,e)&&l.matchActor(d)?!0:!1};this.getMatchers=function(a){return m[a]};this.getTutorSAI=function(a,b,c){l.ctatdebug("CTATVectorMatcher.getTutorSAI("+a+", vt, "+c+")");if(c&&CTATExampleTracerLink.CORRECT_ACTION.toLowerCase()==c.toLowerCase())return a;var d=[];if(g(a.getSelectionArray(),a.getActionArray(),a.getInputArray(),b,d))return c=a.clone(),a=l.evaluateReplacement(a,b,null),null!=a&&c.setInput("object"==
typeof a?a.toString():a),c;c=a.clone();for(a=0;a<d.length;a++)switch(a){case CTATMatcher.SELECTION:if(d[a])continue;c.setSelection(l.getDefaultSelection());c.setSelectionArray(l.getDefaultSelectionArray());break;case CTATMatcher.ACTION:if(d[a])continue;c.setAction(l.getDefaultAction());c.setActionArray(l.getDefaultActionArray());break;case CTATMatcher.INPUT:if(d[a])continue;c.setInput(l.getDefaultInput());c.setInputArray(l.getDefaultInputArray());break;default:console.log("CTATVectorMatcher.getTutorSAI() unexpected no. of details: "+
a)}return c};this.getInputMatcher=function(){var a=h[0];return a instanceof CTATExactMatcher&&a.toString()==="".toString()?l.getDefaultInput():a.toString()};this.getActionMatcher=function(){var a=f[0];return a instanceof CTATExactMatcher&&a.toString()==="".toString()?l.getDefaultAction():a.toString()};this.getSelectionMatcher=function(){var a=c[0];return a instanceof CTATExactMatcher&&a.toString()==="".toString()?l.getDefaultSelection():a.toString()};this.getSingleMatcher=function(a){return"selection".toString().toUpperCase()===
a.toString().toUpperCase()?c[0]:"action".toString().toUpperCase()===a.toString().toUpperCase()?f[0]:h[0]};var n=l.getDefaultSAI;this.getDefaultSAI=function(){var a=n.apply(l),b=0<c.length&&c[0]instanceof CTATExactMatcher?c[0].getSingle():a.getSelection(),d=0<f.length&&f[0]instanceof CTATExactMatcher?f[0].getSingle():a.getAction(),a=0<h.length&&h[0]instanceof CTATExactMatcher?h[0].getSingle():a.getInput();return new CTATSAI(b,d,a)};this.getSelection=function(){return 0===c.length?l.getDefaultSelection():
c[0].toString()};this.getAction=function(){return 0===f.length?l.getDefaultAction():f[0].getAction()};this.setDefaultSelection=function(a){return 0===c.length?l.internalSetDefaultSelection(a):c[0].setDefaultSelection(a)};this.setDefaultAction=function(a){return 0===f.length?l.internalSetDefaultAction(a):f[0].setDefaultAction(a)};this.setDefaultInput=function(a){return 0===h.length?l.internalSetDefaultInput(a):h[0].setDefaultInput(a)};this.getEvaluatedInput=function(a,b){if(0===h.length)return l.getInput();
var c=h[0];return!1===c instanceof CTATExpressionMatcher?l.getInput():!0===c.isEqualRelation()?c.getEvaluatedInput(a,b):l.getInput()};this.matchForHint=function(a,b,d,e){ctatdebug("CTATVectorMatcher.matchForHint("+a+", "+b+", "+d+", vt)");if(!l.matchActor(d))return!1;b=c[0];return Array.isArray(a)?b.matchConcatenation(a,l.getDefaultActionArray(),l.getDefaultInputArray(),e):b.matchConcatenation([a],l.getDefaultActionArray(),l.getDefaultInputArray(),e)};this.setCaseInsensitive=function(a){ctatdebug("CTATVectorMatcher.setCaseInsensitive("+
a+")");for(var b=0;b<m.length;++b)if(Array.isArray(m[b]))for(var c=0;c<m[b].length;++c)m[b][c].setCaseInsensitive(a);else m[b]instanceof CTATMatcher&&m[b].setCaseInsensitive(a)};this.toString=function(){return"this is CTATVectorMatcher"};this.getReplacementFormula=function(){var a=h[0];return null===a||"undefined"===typeof a?null:a.getReplacementFormula()};this.evaluateReplacement=function(a,b,c){return h[0].evaluateReplacement(a,b,c)};this.setActor(e)};CTATVectorMatcher.prototype=Object.create(CTATMatcher.prototype);
CTATVectorMatcher.prototype.constructor=CTATVectorMatcher;"undefined"!==typeof module&&(module.exports=CTATVectorMatcher);var CTATExampleTracerNodeVisualData=function(){CTATBase.call(this,"ExampleTracerNodeVisualData","visualdata");var a="****",b="undefined",d=-1,e=-1,g=null;this.setID=function(b){a=b};this.getID=function(){return a};this.setLabel=function(a){b=a};this.getLabel=function(){return b};this.setX=function(a){d=a};this.getX=function(){return d};this.setY=function(a){e=a};this.getY=function(){return e};this.setVizReference=function(a){g=a};this.getVizReference=function(){return g}};
CTATExampleTracerNodeVisualData.prototype=Object.create(CTATBase.prototype);CTATExampleTracerNodeVisualData.prototype.constructor=CTATExampleTracerNodeVisualData;"undefined"!==typeof module&&(module.exports=CTATExampleTracerNodeVisualData);var CTATExampleTracerNode=function(a,b){CTATBase.call(this,"CTATExampleTracerNode",a);var d=null,e="",g=b?b:new Set,c=new Set;g.forEach(function(a,b,d){b.isCorrect()&&c.add(b)});var f=new Set,h=this;this.toString=function(){return"node"+a};this.getNodeID=function(){return a};this.getNodeName=function(){return e};this.setNodeName=function(a){h.ctatdebug("CTATExampleTracerGraph --\x3e in setNodeName("+a+")");e=a};this.getOutLinks=function(){ctatdebug("CTATExampleTracerNode --\x3e getOutLinks");return g};
this.getCorrectOutLinks=function(){return c};this.addOutLink=function(a){ctatdebug("CTATExampleTracerNode --\x3e addOutLink( "+a+" )");g.add(a);a.isCorrect()&&c.add(a)};this.clearInLinks=function(){f=new Set};this.addInLink=function(a){f.add(a)};this.getInLinks=function(){return f};this.getOutDegree=function(){return g.size};this.getCorrectOutDegree=function(){return c.size};this.setVisualData=function(a){d=a};this.getVisualData=function(){return d}};CTATExampleTracerNode.prototype=Object.create(CTATBase.prototype);
CTATExampleTracerNode.prototype.constructor=CTATExampleTracerNode;"undefined"!==typeof module&&(module.exports=CTATExampleTracerNode);var CTATExampleTracerLinkVisualData=function(){CTATBase.call(this,"CTATExampleTracerLinkVisualData","visualdata");var a="****",b="undefined",d="****",e="****";this.setID=function(b){a=b};this.getID=function(){return a};this.setLabel=function(a){b=a};this.getLabel=function(){return b};this.setSource=function(a){d=a};this.getSource=function(){return d};this.setDestination=function(a){e=a};this.getDestination=function(){return e}};CTATExampleTracerLinkVisualData.prototype=Object.create(CTATBase.prototype);
CTATExampleTracerLinkVisualData.prototype.constructor=CTATExampleTracerLinkVisualData;"undefined"!==typeof module&&(module.exports=CTATExampleTracerLinkVisualData);var CTATExampleTracerLink=function(a,b,d){CTATBase.call(this,"CTATExampleTracerLink","("+b+"-"+d+")");var e="undefined"===typeof a||null===a?null:a,g=null,c="undefined"===typeof b||null===b?null:b,f="undefined"===typeof d||null===d?null:d,h=null,m=1,l=1,n="CORRECT_ACTION",p=[],x=!1,q=null,v="",u=null,A=null,y=this;this.getUniqueID=function(){return e};this.getMatcher=function(){y.ctatdebug("CTATExampleTracerLink --\x3e in getMatcher");return h};this.isCorrect=function(){return n==CTATExampleTracerLink.CORRECT_ACTION};
this.matchesSAI=function(a,b,c){var d=y.getMatcher();y.ctatdebug("CTATExampleTracerLink --\x3e in matchesSAI(); matcher "+d+", typeof "+typeof d+", sai "+a);a=d.match(a.getSelectionArray(),a.getActionArray(),a.getInputArray(),b,c);y.ctatdebug("CTATExampleTracerLink --\x3e out of matchesSAI: result = "+a);return a};this.matchesSAIforHint=function(a,b,c,d){y.ctatdebug("CTATExampleTracerLink --\x3e in matchesSAIforHint("+a+", "+b+") selectionArray "+a.getSelectionArray());if(!1===y.getMatcher().matchForHint(a.getSelectionArray(),
a.getActionArray(),b,d))return y.ctatdebug("CTATExampleTracerLink --\x3e matchesSAIforHint() returning false because no match"),!1;if(null!==c&&"undefined"!==typeof c&&!0===c.getWantReportableHints()&&(a=null===y.getAllHints()||"undefined"===typeof y.getAllHints()?0:y.getAllHints().length,1>a))return y.ctatdebug("CTATExampleTracerLink --\x3e matchesSAIforHint() returning false nStaticHints "+a+"< 1"),!1;y.ctatdebug("CTATExampleTracerLink --\x3e matchesSAIforHint() returning true");return!0};this.getDepth=
function(){return g};this.getBuggyMsg=function(){return v};this.getSuccessMsg=function(){return q};this.getType=function(){return n};this.getPrevNode=function(){return c};this.getNextNode=function(){return f};this.setPrevNode=function(a){c=a};this.setNextNode=function(a){f=a};this.toString=function(){var a;a="[link "+y.getUniqueID();a+=" ("+y.getPrevNode()+"-"+y.getNextNode();a+=") "+y.getType();return a+"]"};this.getTutorSAI=function(a,b){return y.getMatcher().getTutorSAI(a,b,y.getActionType())};
this.getEvaluatedInput=function(a,b){return y.getMatcher().getEvaluatedInput(a,b)};this.setDepth=function(a){g=a};this.getMaxTraversals=function(){return m};this.isDone=function(){var a=String(y.getDefaultSAI().getSelection()).toLowerCase(),b=String(y.getDefaultSAI().getAction()).toLowerCase(),a=CTATMsgType.DONE.toLowerCase()==a&&CTATMsgType.BUTTON_PRESSED.toLowerCase()==b;y.ctatdebug("CTATExampleTracerLink.isDone() returns "+a);return a};this.interpolateHints=function(a){y.ctatdebug("CTATExampleTracerLink --\x3e interpolateHints("+
a+")");var b=[];if(null===p||"undefined"===typeof p||0===p.length)return b;null==a&&(a=new CTATVariableTable);var c=new CTATFormulaParser(a);p.forEach(function(a){if(!(1>String(a).trim().length)){var d=y.getDefaultSAI().getSelection(),e=y.getDefaultSAI().getAction(),f=CTATVariableTable.standardizeType(y.getDefaultSAI().getInput());y.ctatdebug("CTATExampleTracerLink.interpolateHints() calling fp.interpolate("+a+", "+d+", "+e+", "+f+")");a=c.interpolate(a,d,e,f);y.ctatdebug("CTATExampleTracerLink.interpolateHints() calling fp.interpolate() returns "+
a);b.push(a)}});y.ctatdebug("CTATExampleTracerLink --\x3e out of interpolateHints "+b);return b};this.getHints=function(){y.ctatdebug("CTATExampleTracerLink --\x3e in getHints");var a=[];y.interpolateHints(null).forEach(function(b){y.ctatdebug("CTATExampleTracerLink --\x3e in getHints loop");b.toString()!=="".toString()&&a.push(b)});y.ctatdebug("CTATExampleTracerLink --\x3e out of getHints");return a};this.getAllNonEmptyHints=function(){var a=[];p.forEach(function(b){b.trim().toString()!=="".toString()&&
a.push(b)});return a};this.isTraversable=function(){return 1>y.getMaxTraversals()?!1:CTATExampleTracerLink.CORRECT_ACTION.toString().toUpperCase()==y.getActionType().toString().toUpperCase()||CTATExampleTracerLink.FIREABLE_BUGGY_ACTION.toString().toUpperCase()==y.getActionType().toString().toUpperCase()?!0:!1};this.replaceInput=function(){return CTATExampleTracerLink.CORRECT_ACTION.toString().toUpperCase()!==y.getActionType().toString().toUpperCase()&&CTATExampleTracerLink.FIREABLE_BUGGY_ACTION.toString().toUpperCase()!==
y.getActionType().toString().toUpperCase()?!1:y.getMatcher().replaceInput()};this.evaluateReplacement=function(a,b,c){return y.getMatcher().evaluateReplacement(a,b,c)};this.getActor=function(){return y.getMatcher().getActor()};this.getDefaultSAI=function(){y.ctatdebug(y.toString()+".getSAI(): "+(h?h.getDefaultSAI():"(matcher null)"));return h.getDefaultSAI()};this.getActionType=function(){return n};this.getMinTraversals=function(){return l};this.getIsPreferredLink=function(){return x};this.getAllHints=
function(){return p};this.setMatcher=function(a){h=a};this.addHint=function(a){null!==a&&"undefined"!==typeof a&&a.toString()!=="".toString()&&p.push(a)};this.setSelection=function(a){y.getMatcher().setDefaultSelection(null===a[0]||"undefined"===typeof a[0]?"":a[0].toString())};this.setAction=function(a){y.getMatcher().setDefaultAction(null===a[0]||"undefined"===typeof a[0]?"":a[0].toString())};this.setActionType=function(a){if(null===a||"undefined"===typeof a||a.toString()!==CTATExampleTracerLink.CORRECT_ACTION.toString()&&
a.toString()!==CTATExampleTracerLink.FIREABLE_BUGGY_ACTION.toString()&&a.toString()!==CTATExampleTracerLink.BUGGY_ACTION.toString()&&a.toString()!==CTATExampleTracerLink.HINT_ACTION.toString()&&a.toString()!==CTATExampleTracerLink.UNTRACEABLE_ERROR.toString()&&a.toString()!==CTATExampleTracerLink.CLT_ERROR_ACTION.toString()&&a.toString()!==CTATExampleTracerLink.GIVEN_ACTION.toString())throw new CTATExampleTracerException("invalid action type "+n);n=a};this.setBuggyMsg=function(a){v=a};this.setSuccessMsg=
function(a){q=a};this.setMinTraversalsStr=function(a){if(null===a||"undefined"===typeof a||1>a.length)l=1;else try{l=parseInt(a.trim()),isNaN(l)&&(l=1)}catch(r){l=1}};this.setMaxTraversalsStr=function(a){if(null===a||"undefined"===typeof a||1>a.length)m=l;else try{m=parseInt(a.trim()),isNaN(m)&&(m=1)}catch(r){m=l}};this.setUniqueID=function(a){e=a};this.addSkillName=function(a){y.ctatdebug("ETLink["+e+"].addSkillName("+a+")");if("unnamed"!==a){if(null===A||"undefined"===typeof A)A=[];-1<A.indexOf(a)||
(A.push(a),y.ctatdebug("ETLink.addSkillName() return with skillNames "+A))}};this.getSkillNames=function(){if(null===A||"undefined"===typeof A)A=[];return A};this.isTutorPerformed=function(a){if(CTATExampleTracerLink.CORRECT_ACTION.toUpperCase()!==y.getActionType().toUpperCase())return!1;var b=y.getMatcher();if(null===b||"undefined"===typeof b||null!==a&&"undefined"!==typeof a&&a!==b.isLinkTriggered())return!1;a=y.getActor();return CTATMatcher.isTutorActor(a,!0)?!0:!1};this.setIsPreferredLink=function(a){y.ctatdebug("ETLink.setIsPreferredLink() was "+
x+", now "+a);x=a};this.setVisualData=function(a){u=a};this.getVisualData=function(){return u}};
CTATExampleTracerLink.compareLinkTypes=function(a,b){ctatdebug("CTATExampleTracerLink --\x3e in compareLinkTypes("+a+", "+b+")");return null===a||"undefined"===typeof a?null===b||"undefined"===typeof b?0:1:null===b||"undefined"===typeof b?-1:a.toString()===b.toString()?0:a.toString()===CTATExampleTracerLink.CORRECT_ACTION.toString()?-1:b.toString()===CTATExampleTracerLink.CORRECT_ACTION.toString()?1:a.toString()===CTATExampleTracerLink.FIREABLE_BUGGY_ACTION.toString()?-1:b.toString()===CTATExampleTracerLink.FIREABLE_BUGGY_ACTION.toString()?
1:a.toString()===CTATExampleTracerLink.BUGGY_ACTION.toString()?-1:b.toString()===CTATExampleTracerLink.BUGGY_ACTION.toString()?1:0};Object.defineProperty(CTATExampleTracerLink,"BUGGY_ACTION",{enumerable:!1,configurable:!1,writable:!1,value:"Buggy Action"});Object.defineProperty(CTATExampleTracerLink,"FIREABLE_BUGGY_ACTION",{enumerable:!1,configurable:!1,writable:!1,value:"Fireable Buggy Action"});
Object.defineProperty(CTATExampleTracerLink,"CORRECT_ACTION",{enumerable:!1,configurable:!1,writable:!1,value:"Correct Action"});Object.defineProperty(CTATExampleTracerLink,"NO_MODEL",{enumerable:!1,configurable:!1,writable:!1,value:"NO-MODEL"});Object.defineProperty(CTATExampleTracerLink,"HINT_ACTION",{enumerable:!1,configurable:!1,writable:!1,value:"Hint Action"});Object.defineProperty(CTATExampleTracerLink,"UNTRACEABLE_ERROR",{enumerable:!1,configurable:!1,writable:!1,value:"Untraceable Error"});
Object.defineProperty(CTATExampleTracerLink,"CLT_ERROR_ACTION",{enumerable:!1,configurable:!1,writable:!1,value:"Error Action"});Object.defineProperty(CTATExampleTracerLink,"GIVEN_ACTION",{enumerable:!1,configurable:!1,writable:!1,value:"Given Action"});Object.defineProperty(CTATExampleTracerLink,"SUCCESS",{enumerable:!1,configurable:!1,writable:!1,value:"SUCCESS"});CTATExampleTracerLink.prototype=Object.create(CTATBase.prototype);CTATExampleTracerLink.prototype.constructor=CTATExampleTracerLink;
"undefined"!==typeof module&&(module.exports=CTATExampleTracerLink);var CTATExampleTracerPathComparator=function(){CTATBase.call(this,"CTATExampleTracerPathComparator","");var a=this;this.compare=function(b,d){a.ctatdebug("CTATExampleTracerPathComparator --\x3e in compare");a.ctatdebug("CTATExampleTracerPathComparator --\x3e in compare p1.isDonePath(): "+b.isDonePath());a.ctatdebug("CTATExampleTracerPathComparator --\x3e in compare p2.isDonePath(): "+d.isDonePath());if(!0===b.isDonePath()&&!1===d.isDonePath())return-1;if(!0===d.isDonePath()&&!1===b.isDonePath())return 1;
a.ctatdebug("CTATExampleTracerPathComparator --\x3e in compare p2.isIncorrectPath(): "+d.isIncorrectPath());a.ctatdebug("CTATExampleTracerPathComparator --\x3e in compare p1.isIncorrectPath()(): "+b.isIncorrectPath());if(!0===d.isIncorrectPath()&&!1===b.isIncorrectPath())return-1;if(!0===b.isIncorrectPath()&&!1===d.isIncorrectPath())return 1;a.ctatdebug("CTATExampleTracerPathComparator --\x3e in compare p1.getNumberOfPreferredPrefixLinks(): "+b.getNumberOfPreferredPrefixLinks());a.ctatdebug("CTATExampleTracerPathComparator --\x3e in compare p2.getNumberOfPreferredPrefixLinks(): "+
d.getNumberOfPreferredPrefixLinks());var e=b.getNumberOfPreferredPrefixLinks(),g=d.getNumberOfPreferredPrefixLinks();if(e>g)return-1;if(e<g)return 1;a.ctatdebug("CTATExampleTracerPathComparator --\x3e in compare p1.getNumberOfSuboptimalLinks(): "+b.getNumberOfSuboptimalLinks());a.ctatdebug("CTATExampleTracerPathComparator --\x3e in compare p2.getNumberOfSuboptimalLinks(): "+d.getNumberOfSuboptimalLinks());e=b.getNumberOfSuboptimalLinks();g=d.getNumberOfSuboptimalLinks();if(e<g)return-1;if(e>g)return 1;
a.ctatdebug("CTATExampleTracerPathComparator --\x3e in compare p1.getNumberOfPreferredLinks(): "+b.getNumberOfPreferredLinks());a.ctatdebug("CTATExampleTracerPathComparator --\x3e in compare p2.getNumberOfPreferredLinks(): "+d.getNumberOfPreferredLinks());e=b.getNumberOfPreferredLinks();g=d.getNumberOfPreferredLinks();if(e>g)return-1;if(e<g)return 1;e=b.getLinks().size;g=d.getLinks().size;a.ctatdebug("CTATExampleTracerPathComparator --\x3e in compare p1.getLinks().size: "+e);a.ctatdebug("CTATExampleTracerPathComparator --\x3e in compare p1.getLinks().size: "+
g);if(e<g)return-1;if(e>g)return 1;a.ctatdebug("CTATExampleTracerPathComparator --\x3e out of comapre, about to call breakByLowerLinkID");return a.breakByLowerLinkID(b,d)};this.breakByLowerLinkID=function(b,d){a.ctatdebug("CTATExampleTracerPathComparator --\x3e in breakByLowerLinkID");var e=b.getSortedLinks(),g=d.getSortedLinks(),c=null,f=null,h=0,m=0;do a.ctatdebug("CTATExampleTracerPathComparator --\x3e in breakByLowerLinkID in do while"),m>=e.length?(a.ctatdebug("CTATExampleTracerPathComparator --\x3e in breakByLowerLinkID path 1 is shorter"),
h=-1):m>=g.length?(a.ctatdebug("CTATExampleTracerPathComparator --\x3e in breakByLowerLinkID path 2 is shorter"),h=1):(a.ctatdebug("CTATExampleTracerPathComparator --\x3e in breakByLowerLinkID path are same, compare IDS"),c=e[m],f=g[m]),m++;while(0===h&&c.getUniqueID()===f.getUniqueID());0===h&&(a.ctatdebug("CTATExampleTracerPathComparator --\x3e in breakByLowerLinkID result is zero: "+c.getUniqueID()),a.ctatdebug("CTATExampleTracerPathComparator --\x3e in breakByLowerLinkID result is zero: "+f.getUniqueID()),
h=c.getUniqueID()<f.getUniqueID()?-1:1);return h}};CTATExampleTracerPathComparator.prototype=Object.create(CTATBase.prototype);CTATExampleTracerPathComparator.prototype.constructor=CTATExampleTracerPathComparator;"undefined"!==typeof module&&(module.exports=CTATExampleTracerPathComparator);var CTATExampleTracerPath=function(a){CTATBase.call(this,"CTATExampleTracerPath","");var b=new Set;"undefined"!==typeof a&&null!==a&&a.forEach(function(a){ctatdebug("CTATExampleTracerPath --\x3e in constructor building links with "+a);b.add(a)});var d=null,e=null,g=null,c=null,f=null,h=null,m=this;this.isIncorrectPath=function(){ctatdebug("CTATExampleTracerPath --\x3e in isIncorrectPath");if(null!==h&&"undefined"!==typeof h)return h;var a=!1;m.getLinks().forEach(function(b){!0!==a&&b.getType().toString()===
CTATExampleTracerLink.BUGGY_ACTION.toString()&&(a=h=!0)});if(!0===a)return!0;h=!1;ctatdebug("CTATExampleTracerPath --\x3e out of isIncorrectPath");return!1};this.getNumberOfSuboptimalLinks=function(){ctatdebug("CTATExampleTracerPath --\x3e in getNumberOfSuboptimalLinks");m.getSortedLinks();if(null!==c&&"undefined"!==typeof c)return c;var a=0;m.getLinks().forEach(function(b){CTATExampleTracerLink.FIREABLE_BUGGY_ACTION.toString()===b.getType().toString()&&a++});c=a;ctatdebug("CTATExampleTracerPath --\x3e out of getNumberOfSuboptimalLinks");
return a};this.getNumberOfPreferredPrefixLinks=function(){ctatdebug("CTATExampleTracerPath --\x3e in getNumberOfPreferredPrefixLinks");if(null!==e&&"undefined"!==typeof e)return e;var a=0,b=!1;m.getSortedLinks().forEach(function(c){!0!==b&&(!0===c.getIsPreferredLink()?a++:b=!0)});e=a;ctatdebug("CTATExampleTracerPath --\x3e out of getNumberOfPreferredPrefixLinks");return a};this.size=function(){return b.size};this.containsAll=function(a){var b=!0;if(a)for(var c=0;b&&c<a.length;++c)b=m.getLinks().has(a[c]);
m.ctatdebug("CTATExampleTracerPath containsAll(testLinks.length "+a.length+") returning "+b);return b};this.getLinksRestricted=function(a){ctatdebug("CTATExampleTracerPath --\x3e in getLinksRestricted");var c=CTATExampleTracerPath.getDeepestLink(a),d=new Set;b.forEach(function(a){a.getDepth()<=c.getDepth()&&d.add(a)});ctatdebug("CTATExampleTracerPath --\x3e out of getLinksRestricted");return d};this.getLinks=function(){ctatdebug("CTATExampleTracerPath --\x3e in getLinks");return b};this.getSortedLinks=
function(){ctatdebug("CTATExampleTracerPath --\x3e in getSortedLinks that.getLinks(): "+m.getLinks());d=[];m.getLinks().forEach(function(a){d.push(a)});ctatdebug("CTATExampleTracerPath --\x3e in getSortedLinks sortedLinks.length(): "+d.length);d.sort(function(a,b){return a.getDepth()-b.getDepth()});ctatdebug("CTATExampleTracerPath --\x3e out of getSortedLinks, returning "+d);return d};this.isDonePath=function(){ctatdebug("CTATExampleTracerPath --\x3e in isDonePath");if(null!==f&&"undefined"!==typeof f)return f;
var a=!1;m.getLinks().forEach(function(b){!0!==a&&!0===b.isDone()&&(a=f=!0)});if(!0===a)return!0;f=!1;ctatdebug("CTATExampleTracerPath --\x3e out of isDonePath");return!1};this.addLink=function(a){ctatdebug("CTATExampleTracerPath --\x3e in addLink ("+a+")");b.add(a);h=f=c=g=e=d=null;ctatdebug("CTATExampleTracerPath --\x3e out of addLink")};this.getNumberOfPreferredLinks=function(){ctatdebug("CTATExampleTracerPath --\x3e in getNumberOfPreferredLinks");if(null!==g&&"undefined"!==typeof g)return g;var a=
0;m.getLinks().forEach(function(b){!0===b.getIsPreferredLink()&&a++});g=a;ctatdebug("CTATExampleTracerPath --\x3e out of getNumberOfPreferredLinks");return a};this.subpath=function(a){for(var b=new CTATExampleTracerPath,c=m.getSortedLinks(),d=0;d<c.length;++d)if(b.addLink(c[d]),c[d].getNextNode()==a.getNodeID())return b;return null};this.toString=function(){var a="CTATExampleTracerPath: links";m.getSortedLinks().forEach(function(b){a+=" "+b});return a};CTATExampleTracerPath.getDeepestLink=function(a){ctatdebug("CTATExampleTracerPath --\x3e in getDeepestLink");
var b=null;a.forEach(function(a){if(null===b||"undefined"===typeof b||b.getDepth()<a.getDepth())b=a});ctatdebug("CTATExampleTracerPath --\x3e out of getDeepestLink");return b};CTATExampleTracerPath.getBestPath=function(a){ctatdebug("CTATExampleTracerPath --\x3e in getBestPath");var b=null,c=new CTATExampleTracerPathComparator;a.forEach(function(a){ctatdebug("CTATExampleTracerPath --\x3e in getBestPath loop");if(null===b||"undefined"===typeof b||0<c.compare(b,a))b=a});ctatdebug("CTATExampleTracerPath --\x3e out of getBestPath");
return b}};CTATExampleTracerPath.prototype=Object.create(CTATBase.prototype);CTATExampleTracerPath.prototype.constructor=CTATExampleTracerPath;"undefined"!==typeof module&&(module.exports=CTATExampleTracerPath);var CTATLinkGroup=function(){CTATBase.call(this,"CTATLinkGroup","")};CTATLinkGroup.prototype=Object.create(CTATBase.prototype);CTATLinkGroup.prototype.constructor=CTATLinkGroup;"undefined"!==typeof module&&(module.exports=CTATLinkGroup);var CTATDefaultLinkGroup=function(a,b,d,e){CTATLinkGroup.call(this,"CTATDefaultLinkGroup",a);var g=a,c=b,f=d,h=new Set;null!==e&&"undefined"!==typeof e&&e.forEach(function(a){h.add(a)});var m=new Set,l=null,n=null,p=this;p.ctatdebug("CTATDefaultLinkGroup constructor group name: "+a);p.ctatdebug("CTATDefaultLinkGroup constructor group isOrdered: "+b);p.ctatdebug("CTATDefaultLinkGroup constructor group isReenterable: "+d);this.setOrdered=function(a){p.ctatdebug("CTATDefaultLinkGroup --\x3e in setOrdered group name: "+
g);p.ctatdebug("CTATDefaultLinkGroup --\x3e in setOrdered:: "+a);c=a};this.setName=function(a){p.ctatdebug("CTATDefaultLinkGroup --\x3e in setName: "+a);g=a};this.containsLink=function(a){p.ctatdebug("CTATDefaultLinkGroup --\x3e in containsLink: "+a.getUniqueID());return h.has(a)};this.removeLink=function(a){p.ctatdebug("CTATDefaultLinkGroup --\x3e in removeLink: "+a.getUniqueID());return h["delete"](a)};this.getParent=function(){p.ctatdebug("CTATDefaultLinkGroup --\x3e in getParent");return l};this.addLink=
function(a){p.ctatdebug("CTATDefaultLinkGroup --\x3e in addLink: "+a.getUniqueID());h.add(a)};this.getIsOrdered=function(){p.ctatdebug("CTATDefaultLinkGroup --\x3e in getIsOrdered: "+c);return c};this.getIsReenterable=function(){p.ctatdebug("CTATDefaultLinkGroup --\x3e in getIsReenterable: "+f);return f};this.getSubgroups=function(){p.ctatdebug("CTATDefaultLinkGroup --\x3e in getSubgroups");return m};this.getLinks=function(){p.ctatdebug("CTATDefaultLinkGroup --\x3e in getLinks");return h};this.setReenterable=
function(a){p.ctatdebug("CTATDefaultLinkGroup --\x3e in setReenterable: "+a);f=a};this.setParent=function(a){p.ctatdebug("CTATDefaultLinkGroup --\x3e in setParent: "+a.getName());l=a};this.addSubgroup=function(a){p.ctatdebug("CTATDefaultLinkGroup --\x3e in addSubgroup groupName: "+a.getName());m.add(a)};this.getName=function(){return g};this.getDefaultBuggyMsg=function(){return n};this.setDefaultBuggyMsg=function(a){n=""==a?null:a};this.toString=function(){return"Group Name: "+this.getName()}};
CTATDefaultLinkGroup.prototype=Object.create(CTATLinkGroup.prototype);CTATDefaultLinkGroup.prototype.constructor=CTATDefaultLinkGroup;"undefined"!==typeof module&&(module.exports=CTATDefaultLinkGroup);var InternalGroupIterator=function(a,b){CTATBase.call(this,"InternalGroupIterator",a);var d=this,e=b.length,g=[],c=0;a.getSubgroups().forEach(function(a){a&&g.push(a)});b.push(d);d.ctatdebug("InternalGroupIterator() constructor group "+a+", stack.length "+b.length+", sgList.length "+g.length);this.toString=function(){return"{"+a+" at "+e+" with "+g.length+" subgroups}"};this.next=function(){return c>=g.length?(b.pop(),d.ctatdebug("InternalGroupIterator at deepest next() returning "+a+" with stack.length "+
b.length),{value:a,done:!1}):(new InternalGroupIterator(g[c++],b)).next()}};InternalGroupIterator.prototype=Object.create(CTATBase.prototype);InternalGroupIterator.prototype.constructor=InternalGroupIterator;var CTATGroupIterator=function(a){CTATBase.call(this,"CTATGroupIterator",a);this.ctatdebug("CTATGroupIterator("+a+") begin constructor");var b=null;this.next=function(){null===b&&(b=[],new InternalGroupIterator(a,b));return 0>=b.length?{value:null,done:!0}:b[b.length-1].next()}};
CTATGroupIterator.prototype=Object.create(CTATBase.prototype);CTATGroupIterator.prototype.constructor=CTATGroupIterator;"undefined"!==typeof module&&(module.exports=CTATGroupIterator);var CTATGroupModel=function(){CTATBase.call(this,"CTATGroupModel","");var a=this;this.clear=function(){};this.setDefaultReenterable=function(a){};this.setGroupOrdered=function(a,d){};this.getTopLevelGroup=function(){};this.setGroupName=function(a,d){};this.addLinkToGroup=function(a,d){};this.isGroupOrdered=function(a){};this.isGroupReenterable=function(a){};this.isLinkInGroup=function(){};this.getGroupsContainingLink=function(a){};this.getGroupLinkCount=function(b){return a.getGroupLinks(b).size};
this.getLowestLevelGroupOfLink=function(a){};this.getGroupSubgroups=function(a){};this.getUniqueLinks=function(a){};this.getGroupLinks=function(a){};this.removeLinkFromGroup=function(a,d){};this.getGroupParent=function(a){};this.addGroup=function(a,d,e){};this.setGroupReenterable=function(a,d){}};CTATGroupModel.prototype=Object.create(CTATBase.prototype);CTATGroupModel.prototype.constructor=CTATGroupModel;"undefined"!==typeof module&&(module.exports=CTATGroupModel);var CTATDefaultGroupModel=function(){function a(a,c,d){m.ctatdebug("CTATDefaultGroupModel --\x3e in internalRemoveLinkFromGroupRecursive");!0===a.containsLink(c)&&(m.getGroupSubgroups(a).forEach(function(a){m.removeLinkFromGroup(a,c)}),(a!==f||d)&&b(a,c))}function b(a,b){m.ctatdebug("CTATDefaultGroupModel --\x3e in internalRemoveLinkFromGroup");return a.removeLink(b)}function d(a,b){m.ctatdebug("CTATDefaultGroupModel --\x3e in getImmediateGroupOfLink");var c=null,e=!1,f=null;m.getGroupSubgroups(b).forEach(function(b){!0!==
e&&!0===m.isLinkInGroup(b,a)&&(c=d(a,b),f=null!==c&&"undefined"!==typeof c?c:b,e=!0)});return!0===e?f:null}function e(a,b){m.ctatdebug("CTATDefaultGroupModel --\x3e in getNaturalContainingGroup");if(b.size===m.getGroupLinks(a).size)throw m.getGroupLinks(a).forEach(function(c){if(!1===b.has(c))throw new CTATExampleTracerException("Invalid link selection: Partial overlap with existing group: "+a);}),new CTATExampleTracerException("Group containing this set of links already exists: "+a);if(b.size>=m.getGroupLinks(a).size)throw new CTATExampleTracerException("Invalid link selection: Partial overlap with existing group: "+
a);var c=!1,d=null;b.forEach(function(f){if(!0!==c){if(!1===m.isLinkInGroup(a,f))throw new CTATExampleTracerException("Invalid link selection: Partial overlap with existing group: "+a);m.getGroupSubgroups(a).forEach(function(g){!0!==c&&!0===m.isLinkInGroup(g,f)&&(m.getGroupLinkCount(g)>=b.size?(d=e(g,b),c=!0):m.getGroupLinks(g).forEach(function(c){if(!1===b.has(c))throw new CTATExampleTracerException("Invalid link selection: Partial overlap with existing group: "+a);}))})}});return!0===c?d:a}function g(a,
b){m.ctatdebug("CTATDefaultGroupModel --\x3e in addSubgroupPreserveSanity parent: "+a.getName());m.ctatdebug("CTATDefaultGroupModel --\x3e in addSubgroupPreserveSanity child: "+b.getName());m.ctatdebug("CTATDefaultGroupModel --\x3e in addSubgroupPreserveSanity size: "+m.getGroupSubgroups(a).size);m.getGroupSubgroups(a).forEach(function(d){var e=m.getGroupLinks(d);if(0===e.size)m.getGroupSubgroups(a)["delete"](d),c(b,d);else{var f=null,g=!1;e.forEach(function(a){!1===g&&(f=a,g=!0)});!0===m.isLinkInGroup(b,
f)&&(m.getGroupSubgroups(a)["delete"](d),c(b,d))}});c(a,b)}function c(a,b){m.ctatdebug("CTATDefaultGroupModel --\x3e in addSubgroup");a.addSubgroup(b);b.setParent(a)}CTATGroupModel.call(this);var f=null,h=!1,m=this;this.clear=function(){m.ctatdebug("CTATDefaultGroupModel --\x3e in clear");f=new CTATDefaultLinkGroup("defaultName",!0,h,null)};this.setDefaultReenterable=function(a){m.ctatdebug("CTATDefaultGroupModel --\x3e in setDefaultReenterable");h=a};this.setGroupOrdered=function(a,b){m.ctatdebug("CTATDefaultGroupModel --\x3e in setGroupOrdered");
a.setOrdered(b)};this.getTopLevelGroup=function(){ctatdebug("CTATDefaultGroupModel --\x3e in getTopLevelGroup");return f};this.setGroupName=function(a,b){m.ctatdebug("CTATDefaultGroupModel --\x3e in setGroupName");a.setName(b)};this.addLinkToGroup=function(a,b){m.ctatdebug("CTATDefaultGroupModel --\x3e in addLinkToGroup");for(m.removeLinkFromGroup(f,b);null!==a&&"undefined"!==typeof a;a=m.getGroupParent(a)){var c=a,d=b;m.ctatdebug("CTATDefaultGroupModel --\x3e in internalAddLinkToGroup");c.addLink(d)}};
this.isGroupOrdered=function(a){m.ctatdebug("CTATDefaultGroupModel --\x3e in isGroupOrdered group name: "+a.getName());m.ctatdebug("CTATDefaultGroupModel --\x3e in isGroupOrdered: "+a.getIsOrdered());return a.getIsOrdered()};this.isGroupReenterable=function(a){m.ctatdebug("CTATDefaultGroupModel --\x3e in isGroupReenterable");return a.getIsReenterable()};this.isLinkInGroup=function(a,b){m.ctatdebug("CTATDefaultGroupModel --\x3e in isLinkInGroup");return a.containsLink(b)};this.getGroupsContainingLink=
function(a){m.ctatdebug("CTATDefaultGroupModel --\x3e in getGroupsContainingLink("+a+"): TopLevel "+f+", typeof(TopLevel) "+typeof f);var b=new Set,c=new CTATGroupIterator(f);m.ctatdebug("CTATDefaultGroupModel --\x3e in getGroupsContainingLink before loop: groupIter "+c+", typeof(groupIter) "+typeof c);for(var d=c.next();!d.done;d=c.next())d=d.value,!0===m.isLinkInGroup(d,a)&&b.add(d);m.ctatdebug("CTATDefaultGroupModel --\x3e in getGroupsContainingLink returning groups.size "+b.size);return b};this.getLowestLevelGroupOfLink=
function(a){m.ctatdebug("CTATDefaultGroupModel --\x3e in getLowestLevelGroupOfLink");var b=d(a,f);return null!==b&&"undefined"!==typeof b?b:!0===m.isLinkInGroup(f,a)?f:null};this.getGroupSubgroups=function(a){m.ctatdebug("CTATDefaultGroupModel --\x3e in getGroupSubgroups");return null!==a&&"undefined"!==typeof a?a.getSubgroups():null};this.getUniqueLinks=function(a){m.ctatdebug("CTATDefaultGroupModel --\x3e in getUniqueLinks");var b=new Set;m.getGroupLinks(a).forEach(function(a){b.add(a)});m.getGroupSubgroups(a).forEach(function(a){m.getGroupLinks(a).forEach(function(a){b["delete"](a)})});
return b};this.getGroupLinks=function(a){m.ctatdebug("CTATDefaultGroupModel --\x3e in getGroupLinks: "+a.getName());return a.getLinks()};this.removeLinkFromGroup=function(b,c){m.ctatdebug("CTATDefaultGroupModel --\x3e in removeLinkFromGroup");a(b,c,!1)};this.getGroupParent=function(a){m.ctatdebug("CTATDefaultGroupModel --\x3e in getGroupParent");return a.getParent()};this.addGroup=function(a,b,c){m.ctatdebug("CTATDefaultGroupModel --\x3e in addGroup");var d=null;try{d=e(f,c)}catch(q){return q.toString()}a=
new CTATDefaultLinkGroup(a,b,h,c);m.ctatdebug("CTATDefaultGroupModel --\x3e in addGroup after creating new group");g(d,a);return""};this.setGroupReenterable=function(a,b){m.ctatdebug("CTATDefaultGroupModel --\x3e in setGroupReenterable");a.setReenterable(b)};this.createIdToLinkMap=function(){m.ctatdebug("CTATDefaultGroupModel --\x3e in createIdToLinkMap");var a={};m.getGroupLinks(f).forEach(function(b){a[b.getUniqueID()]=b});return a};this.getGroupByName=function(a){m.ctatdebug("CTATDefaultGroupModel --\x3e in getGroupByName TopLevel has: "+
f.getSubgroups().size);for(var b=new CTATGroupIterator(f),c=b.next();!c.done;c=b.next())if(c=c.value,m.getGroupName(c).toString()===a.toString())return c;return null};this.getGroupName=function(a){return a.getName()};m.clear()};CTATDefaultGroupModel.prototype=Object.create(CTATGroupModel.prototype);CTATDefaultGroupModel.prototype.constructor=CTATDefaultGroupModel;"undefined"!==typeof module&&(module.exports=CTATDefaultGroupModel);var CTATMatcherComparator=function(){CTATBase.call(this,"CTATMatcherComparator","");CTATMatcherComparator.compare=function(a,b){ctatdebug("CTATMatcherComparator--\x3e in compare");var d=CTATMatcherComparator.compareBasedOnType(a,b);if(0!==d||!1===a instanceof CTATVectorMatcher&&!1===b instanceof CTATVectorMatcher)return d;d=CTATMatcherComparator.compareBasedOnType(a.getSingleMatcher("input"),b.getSingleMatcher("input"));if(0!==d)return d;d=CTATMatcherComparator.compareBasedOnType(a.getSingleMatcher("selection"),
b.getSingleMatcher("selection"));return 0!==d?d:CTATMatcherComparator.compareBasedOnType(a.getSingleMatcher("action"),b.getSingleMatcher("action"))};CTATMatcherComparator.compareBasedOnType=function(a,b){ctatdebug("CTATMatcherComparator --\x3e in compareBasedOnType");for(var d in CTATMatcherComparator.matcherPrecedenceOrder)if(CTATMatcherComparator.matcherPrecedenceOrder.hasOwnProperty(d)&&a instanceof CTATMatcherComparator.matcherPrecedenceOrder[d])break;for(var e in CTATMatcherComparator.matcherPrecedenceOrder)if(CTATMatcherComparator.matcherPrecedenceOrder.hasOwnProperty(e)&&
b instanceof CTATMatcherComparator.matcherPrecedenceOrder[e])break;return d<e?1:d>e?-1:0}};Object.defineProperty(CTATMatcherComparator,"matcherPrecedenceOrder",{enumerable:!1,configurable:!1,writable:!1,value:{0:CTATExactMatcher,1:CTATRangeMatcher,2:CTATExpressionMatcher,3:CTATWildcardMatcher,4:CTATRegexMatcher,5:CTATAnyMatcher}});CTATMatcherComparator.prototype=Object.create(CTATBase.prototype);CTATMatcherComparator.prototype.constructor=CTATMatcherComparator;
"undefined"!==typeof module&&(module.exports=CTATMatcherComparator);new CTATMatcherComparator;var CTATExampleTracerLinkComparator=function(a,b){CTATBase.call(this,"CTATExampleTracerLinkComparator","");this.compare=function(d,e){ctatdebug("CTATExampleTracerLinkComparator --\x3e in compare l1.getUniqueID(): "+d.getUniqueID());ctatdebug("CTATExampleTracerLinkComparator --\x3e in compare l2.getUniqueID(): "+e.getUniqueID());var g=d.getType(),c=e.getType(),g=CTATExampleTracerLink.compareLinkTypes(g,c);if(0!==g)return ctatdebug("CTATExampleTracerLinkComparator --\x3e in compare m: "+g),g;g=b.nonEmptyHints(d,
a.getVariableTable());c=b.nonEmptyHints(e,a.getVariableTable());ctatdebug("CTATExampleTracerLinkComparator --\x3e in compare h1, h2: "+g+", "+c);if(0<g&&0>=c)return-1;if(0>=g&&0<c)return 1;ctatdebug("CTATExampleTracerLinkComparator --\x3e in compare l1.getDepth(), l2.getDepth(): "+d.getDepth()+", "+e.getDepth());if(d.getDepth()<e.getDepth())return-1;if(d.getDepth()>e.getDepth())return 1;g=a.getTraversalCount(d)-d.getMinTraversals();c=a.getTraversalCount(e)-e.getMinTraversals();ctatdebug("CTATExampleTracerLinkComparator --\x3e in compare tc1, tc2: "+
g+", "+c);if(0>g&&0<=c)return-1;if(0<=g&&0>c)return 1;ctatdebug("CTATExampleTracerLinkComparator --\x3e in compare l1.getIsPreferredLink(): "+d.getIsPreferredLink());ctatdebug("CTATExampleTracerLinkComparator --\x3e in compare l2.getIsPreferredLink(): "+e.getIsPreferredLink());if(d.getIsPreferredLink())return-1;if(e.getIsPreferredLink())return 1;if(0!==(g=CTATMatcherComparator.compare(d.getMatcher(),e.getMatcher())))return g;ctatdebug("CTATExampleTracerLinkComparator --\x3e in compare l1.getUniqueID(): "+
d.getUniqueID());ctatdebug("CTATExampleTracerLinkComparator --\x3e in compare l2.getUniqueID(): "+e.getUniqueID());return d.getUniqueID()<e.getUniqueID()?-1:1}};CTATExampleTracerLinkComparator.prototype=Object.create(CTATBase.prototype);CTATExampleTracerLinkComparator.prototype.constructor=CTATExampleTracerLinkComparator;"undefined"!==typeof module&&(module.exports=CTATExampleTracerLinkComparator);var CTATExampleTracerEvent=function(a,b,d){CTATBase.call(this,"CTATExampleTracerEvent",b?b.toString():"null");var e="",g=!1,c=CTATExampleTracerLink.NO_MODEL,f=!1,h=null,m=null,l="student",n=null,p=null,x="",q=null,v="",u=null,A=null,y=null,C=null,r=[],I=!1,J=null,B=null,D=this,H=[],E=[],w={};this.getActor=function(){return l};this.setActor=function(a){D.ctatdebug("CTATExampleTracerEvent --\x3e setActor("+a+")");l=a};this.getStudentSAI=function(){D.ctatdebug("CTATExampleTracerEvent.getStudentSAI() returning type "+
typeof h+", value "+h);return h};this.setStudentSAI=function(a){D.ctatdebug("CTATExampleTracerEvent --\x3e in setStudentSAI("+a+")");null!==a&&"undefined"!==typeof a&&(h=a);D.ctatdebug("CTATExampleTracerEvent --\x3e out of setStudentSAI")};this.getPreloadedLinkMatches=function(){D.ctatdebug("CTATExampleTracerEvent --\x3e in getPreloadedLinkMatches");return u};this.setTutorSAI=function(a){D.ctatdebug("CTATExampleTracerEvent --\x3e in setTutorSAI");null!==a&&"undefined"!==typeof a&&(m=a);D.ctatdebug("CTATExampleTracerEvent --\x3e out of setTutorSAI")};
this.setNumberOfInterpretations=function(a){D.ctatdebug("CTATExampleTracerEvent --\x3e in setNumberOfInterpretations( "+a+" )")};this.getTransactionID=function(){D.ctatdebug("CTATExampleTracerEvent --\x3e in getTransactionID() returning "+e);return e};this.setTransactionID=function(a){D.ctatdebug("CTATExampleTracerEvent --\x3e in setTransactionID( "+a+" )");e=a};this.setDoneStepFailed=function(a){D.ctatdebug("CTATExampleTracerEvent --\x3e in setDoneStepFailed( "+a+" )");g=a};this.setHintRequest=function(a){f=
a};this.getHintRequest=function(){return f};this.setResult=function(a){D.ctatdebug("CTATExampleTracerEvent --\x3e in setResult( "+a+" )");c=a};this.isBuggyResult=function(){return c.toString()===CTATExampleTracerLink.BUGGY_ACTION||c.toString()===CTATExampleTracerLink.FIREABLE_BUGGY_ACTION};this.isSolverResult=function(){D.ctatdebug("CTATExampleTracerEvent --\x3e in isSolverResult");return!1};this.getResult=function(){D.ctatdebug("CTATExampleTracerEvent --\x3e in getResult() returning "+c);return c};
this.setReportableLink=function(a){D.ctatdebug("CTATExampleTracerEvent --\x3e in setReportableLink("+a+")");n=a};this.setReportableInterpretation=function(a){D.ctatdebug("CTATExampleTracerEvent --\x3e in setReportableInterpretation("+a+")");p=a};this.setStepID=function(a){D.ctatdebug("CTATExampleTracerEvent --\x3e in setStepID("+a+")");x=a?a.toString():""};this.setReportableVariableTable=function(a){y=a.clone()};this.setSuccessOrBuggyMsg=function(a){D.ctatdebug("CTATExampleTracerEvent --\x3e in setSuccessOrBuggyMsg("+
a+")");C=a};this.setReportableHints=function(a){D.ctatdebug("CTATExampleTracerEvent --\x3e in setReportableHints("+a+")");r=Array.isArray(a)&&0<a.length?a:[]};this.getWantReportableHints=function(){D.ctatdebug("CTATExampleTracerEvent --\x3e in getWantReportableHints() returning "+I);return I};this.setOutOfOrder=function(a){D.ctatdebug("CTATExampleTracerEvent --\x3e in setOutOfOrder("+a+")");q=a};this.isOutOfOrder=function(){D.ctatdebug("CTATExampleTracerEvent --\x3e in getOutOfOrder() returning "+
q);return q};this.setTraceOutcome=function(a){v=a};this.getTraceOutcome=function(){return v};this.setEvaluatedInput=function(a){D.ctatdebug("CTATExampleTracerEvent --\x3e in setEvaluatedInput("+a+")");if(null===A||"undefined"===typeof A)A=[];A.push(a)};this.addPreloadedLinkMatch=function(a){D.ctatdebug("CTATExampleTracerEvent --\x3e in addPreloadedLinkMatch("+a+")");if(null===u||"undefined"===typeof u)u=[];u.push(a)};this.setInterpolatedSAI=function(a){D.ctatdebug("CTATExampleTracerEvent --\x3e in setInterpolatedSAI("+
a+")");a&&(J=a)};this.getInterpolatedSAI=function(){return J?J:D.getStudentSAI()};this.setInterpolatedHints=function(a){D.ctatdebug("CTATExampleTracerEvent --\x3e in setInterpolatedHints("+a+")");B&&(B.length=0);a&&(B=a.slice(0));D.ctatdebug("CTATExampleTracerEvent --\x3e out of setInterpolatedHints")};this.setWantReportableHints=function(a){D.ctatdebug("CTATExampleTracerEvent --\x3e in setWantReportableHints("+a+")");I=a};this.setAssociatedRules=function(a){H=a instanceof Array?a:a instanceof String?
[a]:[]};this.setAssociatedSkills=function(a){E=a instanceof Array?a:a instanceof String?[a]:[]};this.setCustomFields=function(a){w=a instanceof Object?a:{}};this.getSuccessOrBuggyMsg=function(){D.ctatdebug("CTATExampleTracerEvent --\x3e in getSuccessOrBuggyMsg() returning "+C);return C};this.getReportableHints=function(){D.ctatdebug("CTATExampleTracerEvent --\x3e in getReportableHints() returning "+r);return r};this.getReportableLink=function(){D.ctatdebug("CTATExampleTracerEvent --\x3e in getReportableLink() returning "+
n);return n};this.getReportableVariableTable=function(){D.ctatdebug("CTATExampleTracerEvent --\x3e in getReportableVariableTable() returning "+y);return y};this.getReportableInterpretation=function(){D.ctatdebug("CTATExampleTracerEvent --\x3e in getReportableInterpretation() returning "+p);return p};this.getStepID=function(){D.ctatdebug("CTATExampleTracerEvent --\x3e in getStepID() returning "+x);return x};this.getTutorSelection=function(){return null===m||"undefined"===typeof m?null:m.getSelectionArray()};
this.getTutorAction=function(){return null===m||"undefined"===typeof m?null:m.getActionArray()};this.getTutorInput=function(){return null!==A&&"undefined"!==typeof A?D.getEvaluatedInputArray():null!==m&&"undefined"!==typeof m?m.getInputArray():null};this.getEvaluatedInputArray=function(){return A};this.toString=function(){var a;a="["+D.getResult();null!==D.getStudentSAI()&&"undefined"!==typeof D.getStudentSAI()&&(a+=", StudentSAI "+D.getStudentSAI());null!==D.getReportableLink()&&"undefined"!==typeof D.getReportableLink()&&
(a+=", reportableLink "+D.getReportableLink());!0===D.isDoneStepFailed()&&(a+=", doneStepFailed");null!==D.getTutorSAI()&&"undefined"!==typeof D.getTutorSAI()&&(a+=", TutorSAI "+D.getTutorSAI());return a+"]"};this.isDoneStepFailed=function(){return g};this.getTutorSAI=function(){return m};this.getAssociatedRules=function(){return H};this.getAssociatedSkills=function(){return E};this.getCustomFields=function(){return w};this.setStudentSAI(b);this.setActor(d)};CTATExampleTracerEvent.prototype=Object.create(CTATBase.prototype);
CTATExampleTracerEvent.prototype.constructor=CTATExampleTracerEvent;"undefined"!==typeof module&&(module.exports=CTATExampleTracerEvent);var CTATExampleTracerInterpretation=function(a){CTATBase.call(this,"CTATExampleTracerInterpretation","");var b=null,d=[],e={},g=new CTATVariableTable,c=new Set;a.forEach(function(a){c.add(a)});var f=CTATExampleTracerLink.CORRECT_ACTION,h=null,m=this;this.getVariableTable=function(){return g};this.setVariableTable=function(a){g=a};this.setLatestHints=function(a,b){m.ctatdebug("In evaluate after calling setInterpolatedHints");if(!Array.isArray(a)||1>a.length)a=b;!Array.isArray(a)||1>a.length||g.put("hints",
a)};this.getLatestHints=function(){return g.get("hints")};this.setLatestBuggyMessage=function(a){!a||1>(a=String(a)).length||g.put("buggy_message",a)};this.setLatestSuccessMessage=function(a){!a||1>(a=String(a)).length||g.put("success_message",a)};this.getLatestBuggyMessage=function(){return g.get("buggy_message")};this.getLatestSuccessMessage=function(){return g.get("success_message")};this.getTraversalCount=function(a){a=e[a.getUniqueID()];return"undefined"===typeof a||null===a?0:a[0]};this.getPaths=
function(){return c};this.clone=function(){var a=new CTATExampleTracerInterpretation(c);a.setInterpolatedSAI(m.getInterpolatedSAI());a.addTraversedLinks(d);for(var b in e)e.hasOwnProperty(b)&&a.putInlinkIdTraversalCountMap(b,e[b].slice());a.setWorstLinkType(f);b=g.clone();a.setVariableTable(b);h&&a.setPathToDone(new CTATExampleTracerPath(h.getLinks()));ctatdebug("CTATExampleTracerInterpretation --\x3e out of clone");return a};this.addTraversedLinks=function(a){d=d.concat(a)};this.putInlinkIdTraversalCountMap=
function(a,b){ctatdebug("CTATExampleTracerInterpretation --\x3e in putInlinkIdTraversalCountMap");ctatdebug("CTATExampleTracerInterpretation --\x3e in putInlinkIdTraversalCountMap key: "+a);ctatdebug("CTATExampleTracerInterpretation --\x3e in putInlinkIdTraversalCountMap value: "+b);e[a]=b};this.setWorstLinkType=function(a){f=a};this.addLink=function(a){!a.isTraversable()||h&&h.getLinks().has(a)||(h=null);ctatdebug("CTATExampleTracerInterpretation.addLink("+(a&&a.getUniqueID())+") pathToDone "+(h&&
h.size()));d.push(a);var b=a.getMatcher(),b=null===b||"undefined"===typeof b?1:b.getTraversalIncrement(),c=e[a.getUniqueID()];null!==c&&"undefined"!==typeof c?c[0]+=b:(c=[],c.push(b),e[a.getUniqueID()]=c);a=a.getType();0>CTATExampleTracerLink.compareLinkTypes(f,a)&&(f=a)};this.setPathToDone=function(a){h=a};this.getPathToDone=function(a){if(h)return h;var b=a.getStartNode();b&&a.getDoneStates().forEach(function(c){h||(h=a.getBestSubpath(b,c,d))});return h};this.countStepsForScore=function(a){var b=
Number.MAX_VALUE,c=m.getPathToDone(a);if((a=a.getStudentStartsHereNode()||a.getStartNode())&&c&&c.getLinks()){var d=a.getNodeID(),b=0;c.getSortedLinks().forEach(function(a){if(!(0<d&&a.getPrevNode()!=d||(d=-1,CTATMatcher.isTutorActor(a.getActor(),!0)))){var c=m.getTraversalCount(a);a=a.getMinTraversals();b=c>a?b+c:b+a}})}return b};this.updateVariableTable=function(a,b,c){var d=a,e=a.getInput();null!==b&&"undefined"!==typeof b&&(e=b,d=new CTATSAI(a.getSelection(),a.getAction(),e));g.put("link"+c.getUniqueID()+
".selection",a.getSelection());g.put("link"+c.getUniqueID()+".action",a.getAction());b="link"+c.getUniqueID()+".input";g.put(b,e);g.put(CTATVariableTable.nameAsString(b),CTATVariableTable.valueAsString(e));if(CTATExampleTracerLink.CORRECT_ACTION.toString().toUpperCase()===c.getActionType().toString().toUpperCase()||CTATExampleTracerLink.FIREABLE_BUGGY_ACTION.toString().toUpperCase()===c.getActionType().toString().toUpperCase())a=a.getSelection(),null!==a&&"undefined"!==typeof a&&0<a.length&&g.put(a,
e);return d};this.getInterpolatedSAI=function(){return b};this.setInterpolatedSAI=function(a){b=a};this.getLastMatchedLink=function(){return 0===d.length?null:d[d.length-1]};this.getMatchedLinks=function(){return d};this.getType=function(){return f};this.isTraversed=function(a,b){ctatdebug("CTATExampleTracerInterpretation --\x3e in isTraversed: "+a.getUniqueID());var c=e[a.getUniqueID()];if(null===c||"undefined"===typeof c)return ctatdebug("CTATExampleTracerInterpretation --\x3e in isTraversed in if condition (traversalCount === null): "+
(null===c)),ctatdebug("CTATExampleTracerInterpretation --\x3e in isTraversed in if condition (typeof(traversalCount) === 'undefined'): "+("undefined"===typeof c)),!0===b?0>=a.getMinTraversals():!1;ctatdebug("CTATExampleTracerInterpretation --\x3e in isTraversed out of if condition traversalCount[0]: "+c[0]);ctatdebug("CTATExampleTracerInterpretation --\x3e in isTraversed out of if condition link.getMinTraversals(): "+a.getMinTraversals());return c[0]>=a.getMinTraversals()};this.toString=function(){var a=
"{";d.forEach(function(b){a+=b.getUniqueID()+", "});a.substring(a.length-2,a.length).toString()===", ".toString()&&(a=a.substring(0,a.length-2));a+=" ("+(null===c||"undefined"===typeof c?-1:c.size)+" paths)";a+=" var tbl "+g;return a+="}"}};CTATExampleTracerInterpretation.prototype=Object.create(CTATBase.prototype);CTATExampleTracerInterpretation.prototype.constructor=CTATExampleTracerInterpretation;"undefined"!==typeof module&&(module.exports=CTATExampleTracerInterpretation);var CTATExampleTracerInterpretationComparator=function(){CTATBase.call(this,"CTATExampleTracerInterpretationComparator","");var a=this;this.compare=function(b,d){a.ctatdebug("CTATExampleTracerInterpretationComparator --\x3e in compare");var e=b.getType(),g=CTATExampleTracerLink.compareLinkTypes(e,d.getType());ctatdebug("CTATExampleTracerInterpretationComparator comparing i1Type: "+b.getType());ctatdebug("CTATExampleTracerInterpretationComparator comparing i2Type: "+d.getType());ctatdebug("CTATExampleTracerInterpretationComparator comparing link types result: "+
g);if(0!==g)return ctatdebug("CTATExampleTracerInterpretationComparator result is not equal to 0"),0>g?1:-1;if(CTATExampleTracerLink.BUGGY_ACTION.toString().toUpperCase()===e.toString().toUpperCase()&&(ctatdebug("CTATExampleTracerInterpretationComparator checking for buggy actions"),e=b.getLastMatchedLink(),g=d.getLastMatchedLink(),e=CTATMatcherComparator.compare(e.getMatcher(),g.getMatcher()),0!==e))return e;var g=CTATExampleTracerPath.getBestPath(b.getPaths()),e=CTATExampleTracerPath.getBestPath(d.getPaths()),
c=new Set;c.add(g);c.add(e);g=CTATExampleTracerPath.getBestPath(c);ctatdebug("CTATExampleTracerInterpretationComparator found best path: "+(g===e));g.getLinks().forEach(function(b){a.ctatdebug("My best link==: "+b.getUniqueID())});return g===e?-1:1}};CTATExampleTracerInterpretationComparator.prototype=Object.create(CTATBase.prototype);CTATExampleTracerInterpretationComparator.prototype.constructor=CTATExampleTracerInterpretationComparator;"undefined"!==typeof module&&(module.exports=CTATExampleTracerInterpretationComparator);var CTATExampleTracerTracer_count=0,CTATExampleTracerTracer=function(a,b){function d(a,b,c){if(!a)return a;b=new CTATFormulaParser(b);w.ctatdebug("CTATETT.interpolate("+a+",vt,"+c+")");var d=c.getSelection(),e=c.getAction();c=c.getInput();c=CTATVariableTable.standardizeType(c);w.ctatdebug("CTATETT.interpolate() calling CTATFP.interpolate("+a+", "+d+", "+e+", "+c);a=b.interpolate(a,d,e,c);w.ctatdebug("CTATETT.interpolate() returning "+a);return a}function e(a,b,c,e,f,g){w.ctatdebug("finishEvaluate() doUpdate "+
b+", link "+e+", bestInterp.getLastMatchedLink() "+f.getLastMatchedLink());null==e&&(e=f.getLastMatchedLink());(b||a.getWantReportableHints())&&g.forEach(function(b){var c=b.getLastMatchedLink();c&&(c.getActionType()==CTATExampleTracerLink.CORRECT_ACTION?a.getHintRequest()?a.getWantReportableHints()&&b.setLatestHints(e.interpolateHints(b.getVariableTable()),c.getHints()):b.setLatestSuccessMessage(d(c.getSuccessMsg(),b.getVariableTable(),a.getStudentSAI())):b.setLatestBuggyMessage(d(c.getBuggyMsg(),
b.getVariableTable(),a.getStudentSAI())))});if(b){J.push(a.getStudentSAI());e!=f.getLastMatchedLink()&&(f.addLink(e),a.setResult(e.getActionType()),a.setTraceOutcome(e.getActionType()));if(c.toString()===CTATExampleTracerLink.CORRECT_ACTION.toString()||c.toString()===CTATExampleTracerLink.FIREABLE_BUGGY_ACTION.toString()){w.ctatdebug("In evaluate -- in first branch doUpdate()");g.forEach(function(a){a.getLastMatchedLink().getType().toString()===CTATExampleTracerLink.BUGGY_ACTION.toString()&&(w.ctatdebug("In evaluate -- deleting an incorrect interp"),
g["delete"](a))});w.ctatdebug("In evaluate -- to call setInterpretations(), if 0 < newInterps.size "+g.size);0<g.size&&(x(g),H=f);for(var h in I)I.hasOwnProperty(h)&&delete I[h];w.ctatdebug("In evaluate -- out of DoUpdate if branch")}else{w.ctatdebug("In evaluate -- in else branch of doUpdate");a.setNumberOfInterpretations(0);for(var l in I)I.hasOwnProperty(l)&&delete I[l];g.forEach(function(a){I[a.getLastMatchedLink().getUniqueID()]=a.getLastMatchedLink()})}c.toString()===CTATExampleTracerLink.BUGGY_ACTION.toString()&&
J.splice(J.length-1,1)}a.isSolverResult()||(w.ctatdebug("In evaluate inside the NOT solver result if condition "+c),a.setResult(c),a.setTraceOutcome(c));w.ctatdebug("In evaluate out the solver result if condition");a.setReportableLink(e);a.setAssociatedSkills(e.getSkillNames());a.setStepID(e.getUniqueID());a.setReportableInterpretation(f);a.setInterpolatedSAI(f.getInterpolatedSAI());a.setReportableVariableTable(f.getVariableTable());a.getHintRequest()||(b=e.getTutorSAI(a.getInterpolatedSAI(),f.getVariableTable()),
w.ctatdebug("In evaluate -- TUTORSAI: "+b+", studentSAI was "+a.getStudentSAI()),a.setTutorSAI(b));b=c==CTATExampleTracerLink.CORRECT_ACTION?f.getLatestSuccessMessage():f.getLatestBuggyMessage();w.ctatdebug('ETT.finishEvaluate() successOrBuggyMsg "'+b+'"');a.setSuccessOrBuggyMsg(b);a.getHintRequest()&&(a.setReportableHints(f.getLatestHints()),w.ctatdebug("In evaluate --\x3e after setReportableHints"));w.ctatdebug("In evaluate after fireExampleTracerEvent");w.ctatdebug("CTATExampleTracerTracer --\x3e out of finishEvaluate");
return c.toString()!==CTATExampleTracerLink.BUGGY_ACTION.toString()}function g(a,b,d,e){w.ctatdebug("checkDoneStep() hintTrace "+b+", sai "+a.getStudentSAI()+", exitOnIncorrectDone "+B.exitOnIncorrectDone()+", hideButRequireSteps "+B.hideButRequireSteps()+", nInterps "+e.size);if(!a.getStudentSAI().isDone())return w.ctatdebug("checkDoneStep() not isDone(), so setDoneStepFailed(false) & return null "),null;if(B.exitOnIncorrectDone())return w.ctatdebug("checkDoneStep() exitOnIncorrectDone() with setDoneStepFailed(false), so return CORRECT"),
c(a,d,null,e);if(!b&&B.hideButRequireSteps()){b=B.getDoneLinks();w.ctatdebug("checkDoneStep getDoneLinks().size "+b.size);b=b.values();for(var f;!(f=b.next()).done;)if(B.pathToLinkIsSubset(f.value,E))return c(a,d,f.value,e)}1>e.size&&a.setDoneStepFailed(!0);return null}function c(a,b,c,d){var f;a.setDoneStepFailed(!1);1>d.size?(d=w.getInterpretationsInternal(),f=w.getBestInterpretation()):f=p(d);f.setInterpolatedSAI(new CTATSAI("done","ButtonPressed","-1"));return e(a,b,CTATExampleTracerLink.CORRECT_ACTION,
c,f,d)}function f(a,b,c){w.ctatdebug("CTATExampleTracerTracer --\x3e _evaluate("+a+", "+b+", "+c+")");D=a;var d=new Set,f=a.getPreloadedLinkMatches();w.ctatdebug("interps # : "+r.length);w.ctatdebug("interps: "+r);r.forEach(function(e){w.ctatdebug("In evaluate -- entered the interpretations loop");if("undefined"===typeof f||null===f)w.ctatdebug("In evaluate -- entered if check for saiLinkMatches"),f=m(a.getStudentSAI(),a.getActor(),b,e.getVariableTable(),a),w.ctatdebug("In evaluate -- exiting if check for saiLinkMatches");
else for(var g=0;g<f.length;++g)h(a.getStudentSAI(),!0,f[g],f[g].getActor(),e.getVariableTable());w.ctatdebug("Link matches # : "+f.length);f.forEach(function(b){w.ctatdebug("In evaluate -- entered the saiLinkMatches loop + "+b);if(!B.relaxOrderConstraints()&&e.getTraversalCount(b)>=b.getMaxTraversals())return w.ctatdebug("In evaluate -- skipped a saiLinkMatches loop \n Skipped due to max traversals"+b.getMaxTraversals()),!1;var f=e.clone();f.setInterpolatedSAI(null);w.ctatdebug("In evaluate size of getPaths "+
f.getPaths().size);f.getPaths().forEach(function(c){w.ctatdebug("In evaluate -- looping through the newInterp.getPaths()\n Examining path: "+c);!1===l(b,f,c,!1,a)&&(w.ctatdebug("In evaluate -- in if condition, checking if isPathOK"),f.getPaths()["delete"](c),w.ctatdebug("In evaluate -- out of if condition, checking if isPathOK\n Tried to delete path."))});w.ctatdebug("In evaluate -- done looping through the newInterp.getPaths(), size "+f.getPaths().size);if(0<f.getPaths().size){w.ctatdebug("In evaluate -- if number of paths is greater than 0");
f.addLink(b);w.ctatdebug("In evaluate -- new link added");if(!0===c){w.ctatdebug("In evaluate -- we are in the doUpdate if condition");var g=n(b,a.getStudentSAI(),f);w.ctatdebug("In evaluate -- updatingVariable table");f.setInterpolatedSAI(f.updateVariableTable(a.getStudentSAI(),g,b));w.ctatdebug("In evaluate -- done updatingVariable table: "+f.getVariableTable())}d.add(f);w.ctatdebug("In evaluate -- added new interp")}w.ctatdebug("In evaluate -- out of saiLinkMatches loop")});w.ctatdebug("In evaluate -- out of interpretation loops")});
a.setNumberOfInterpretations(d.size);w.ctatdebug("In evaluate -- number of interpretations "+d.size+" set");var q=g(a,b,c,d);if(null!==q)return q;if(0===d.size)return w.ctatdebug("In evaluate -- if condition no new interpretations"),0!==f.length&&!0===f[0].isDone()&&a.setDoneStepFailed(!0),a.setResult(CTATExampleTracerLink.NO_MODEL),a.setTraceOutcome(CTATExampleTracerLink.NO_MODEL),w.ctatdebug("In evaluate -- if condition no new interpretations returning false"),!1;q=p(d);w.ctatdebug("In evaluate -- just found bestInterp");
var u=null;!0===a.isSolverResult()?(w.ctatdebug("In evaluate -- in if branch of isSolverResult"),u=CTATExampleTracerLink.NO_MODEL.toString().toUpperCase()===a.getResult().toString().toUpperCase()?CTATExampleTracerLink.BUGGY_ACTION.toString():a.getResult().toString()):(w.ctatdebug("In evaluate -- in else branch of isSolverResult"),u=q.getLastMatchedLink().getType());return e(a,c,u,null,q,d)}function h(a,b,c,d,e){var f=b&&c.isCorrect();if("undefined"!=typeof E[c.getUniqueID()]||c.matchesSAIforHint(a,
d,null,e))E[c.getUniqueID()]=f;w.ctatdebug("updateMatchedSelections(): link "+c.getUniqueID()+", matched "+b+", newResult "+f+", matchedSelections[link] "+E[c.getUniqueID()])}function m(a,b,c,d,e){w.ctatdebug("CTATExampleTracerTracer --\x3e in findSAIMatchingLinks("+a+", "+b+", "+c+")");var f=[];B.getLinks().forEach(function(g){if(!1===c){w.ctatdebug("Calling link.matchesSAI() on link "+g+", sai "+a);var l=g.matchesSAI(a,b,d);w.ctatdebug("Result from link.matchesSAI() on link "+g+": "+l+", typeof "+
typeof l);!0===l&&f.push(g);B.hideButRequireSteps()&&h(a,l,g,b,d)}else!0===g.matchesSAIforHint(a,b,e,d)&&f.push(g)});w.ctatdebug("CTATExampleTracerTracer --\x3e out of findSAIMatchingLinks: #matchingLinks "+f.length);return f}function l(a,b,c,d,e){w.ctatdebug("CTATExampleTracerTracer --\x3e in isPathOK");var f=null;if(!0===d){w.ctatdebug("CTATExampleTracerTracer --\x3e in isPathOK in demonstrate mode");var g=b.getMatchedLinks().slice();g.push(a);f=c.getLinksRestricted(g)}else w.ctatdebug("CTATExampleTracerTracer --\x3e in isPathOK NOT in demonstrate mode"),
f=c.getLinks();w.ctatdebug("CTATExampleTracerTracer --\x3e in isPathOK path.getLinks() "+c.getLinks().size);w.ctatdebug("CTATExampleTracerTracer --\x3e in isPathOK pathLinks "+f.size);if(!0===d){var h=[],l=!0;b.getMatchedLinks().forEach(function(a){!1!==l&&(!1===B.observesOrderingConstraints(h,a,f,e)||!1===v(b,a,f)?(w.ctatdebug("CTATExampleTracerTracer --\x3e in isPathOK returning false1"),l=!1):h.push(a))});if(!1===l)return w.ctatdebug("CTATExampleTracerTracer --\x3e in isPathOK returning false2"),
!1}if(a.getType().toString()===CTATExampleTracerLink.BUGGY_ACTION.toString()){if(!1===B.isIncorrectLinkOK(b.getMatchedLinks(),a,f,b))return w.ctatdebug("CTATExampleTracerTracer --\x3e in isPathOK returning false3"),!1}else{if(!1===B.observesOrderingConstraints(b.getMatchedLinks(),a,f,e))return w.ctatdebug("CTATExampleTracerTracer --\x3e in isPathOK returning false4"),!1;if(!1===v(b,a,f))return w.ctatdebug("CTATExampleTracerTracer --\x3e in isPathOK returning false5"),!1}w.ctatdebug("CTATExampleTracerTracer --\x3e out of isPathOK returning true");
return!0}function n(a,b,c){w.ctatdebug("CTATExampleTracerTracer.replaceInput("+a+", "+b+", ...)");if(null===a||"undefined"===typeof a||!1===a.replaceInput())return w.ctatdebug("replaceInput false, returning null"),null;a=a.evaluateReplacement(b,c.getVariableTable(),w);w.ctatdebug("CTATExampleTracerTracer.replaceInput() returning "+a);return a}function p(a){w.ctatdebug("CTATExampleTracerTracer --\x3e in findBestInterpretation");var b=new CTATExampleTracerInterpretationComparator,c=null;a.forEach(function(a){w.ctatdebug("CTATExampleTracerTracer --\x3e in findBestInterpretation iteration");
null===c||"undefined"===typeof c?(w.ctatdebug("CTATExampleTracerTracer --\x3e in findBestInterpretation first if condition"),c=a):(w.ctatdebug("CTATExampleTracerTracer --\x3e in findBestInterpretation else of first if condition"),0<b.compare(a,c)&&(w.ctatdebug("CTATExampleTracerTracer --\x3e in findBestInterpretation second if condition"),c=a))});w.ctatdebug("CTATExampleTracerTracer --\x3e out of findBestInterpretation");return c}function x(a){w.ctatdebug("CTATExampleTracerTracer --\x3e in setInterpretations");
r.length=0;0===a.size?w.ctatdebug("CTATExampleTracerTracer --\x3e returning from setInterpretations"):(w.ctatdebug("CTATExampleTracerTracer --\x3e setInterpretations c.size: "+a.size),a.forEach(function(a){r.push(a)}),H=null,w.ctatdebug("CTATExampleTracerTracer --\x3e out of setInterpretations"))}function q(){w.ctatdebug("CTATExampleTracerTracer --\x3e in getAllPaths");var a=B.findAllPaths();w.ctatdebug("CTATExampleTracerTracer --\x3e in getAllPaths: #paths "+a.size);a.forEach(function(a){w.ctatdebug("CTATExampleTracerTracer --\x3e in getAllPaths loopring through paths");
w.ctatdebug("CTATExampleTracerTracer --\x3e in getAllPaths size of path"+a.getLinks().size)});return a}function v(a,b,c){w.ctatdebug("CTATExampleTracerTracer --\x3e in doneStepOK: link "+b+", isDone() "+b.isDone());if(null===b||"undefined"===typeof b||!1===b.isDone())return w.ctatdebug("doneStepOK in first if condition"),!0;if(b.isDone()&&B.exitOnIncorrectDone())return!0;if(b.getType().toString()===CTATExampleTracerLink.BUGGY_ACTION.toString())return w.ctatdebug("doneStepOK in second if condition"),
!0;w.ctatdebug("doneStepOK before loop");var d=!0;c.forEach(function(c){if(!1===d)w.ctatdebug("CTATExampleTracerTracer --\x3e we are breaking from the loop");else if(c.getUniqueID()===b.getUniqueID())w.ctatdebug("CTATExampleTracerTracer --\x3e inside second if condition");else{var e=a.getTraversalCount(c);B.hideButRequireSteps()&&(0<e||1>c.getMinTraversals())||!(e<c.getMinTraversals())||(w.ctatdebug("CTATExampleTracerTracer --\x3e we should return false from the second if condition"),d=!1)}});if(!1===
d)return w.ctatdebug("CTATExampleTracerTracer --\x3e out of doneStepOK returning false"),!1;w.ctatdebug("CTATExampleTracerTracer --\x3e out of doneStepOK returning true");return!0}function u(a,b){w.ctatdebug("CTATExampleTracerTracer --\x3e in _getBestNextLink");var c=null!==b&&"undefined"!==typeof b&&null!==b[0]&&"undefined"!==typeof b[0]?b[0]:null;if(null===c||"undefined"===typeof c)w.ctatdebug("CTATExampleTracerTracer --\x3e in _getBestNextLink first if condition"),c=w.getBestInterpretation();null!==
b&&"undefined"!==typeof b&&(b[0]=c);w.ctatdebug("CTATExampleTracerTracer --\x3e in _getBestNextLink interp.getPaths(): "+c.getPaths().size);var d=CTATExampleTracerPath.getBestPath(c.getPaths());w.ctatdebug("CTATExampleTracerTracer --\x3e in _getBestNextLink path: "+d);var e=A(c,d,a,!1);w.ctatdebug("CTATExampleTracerTracer --\x3e in _getBestNextLink highestLink: "+e);if(null!==e&&"undefined"!==typeof e)return w.ctatdebug("CTATExampleTracerTracer --\x3e in _getBestNextLink returning highestLink"),e;
var f=null;w.ctatdebug("CTATExampleTracerTracer --\x3e in _getBestNextLink returning path.getLinks() "+d.getLinks().size);w.ctatdebug("CTATExampleTracerTracer --\x3e in _getBestNextLink returning path.getSortedLinks() "+d.getSortedLinks());var g=!1,h=null;d.getSortedLinks().forEach(function(b){!0!==g&&(w.ctatdebug("CTATExampleTracerTracer --\x3e in _getBestNextLink in for loop"+b),f=b,c.getTraversalCount(b)<b.getMaxTraversals()&&(!1===a||0<w.nonEmptyHints(b,c.getVariableTable()))&&B.observesOrderingConstraints(c.getMatchedLinks(),
b,d.getLinks(),null)&&v(c,b,d.getLinks())&&(w.ctatdebug("CTATExampleTracerTracer --\x3e in _getBestNextLink in link: "+b),h=b,g=!0))});if(!0===g)return h;w.ctatdebug("CTATExampleTracerTracer --\x3e out of _getBestNextLink, returning: "+f);return null}function A(a,b,c,d){w.ctatdebug("CTATExampleTracerTracer --\x3e in getHighestUntraversedLink");var e=new CTATExampleTracerEvent(w,null,CTATMsgType.DEFAULT_STUDENT_ACTOR),f=!0,g=[];b.getSortedLinks().forEach(function(b){w.ctatdebug("CTATExampleTracerTracer --\x3e in getHighestUntraversedLink in loop link.getUniqueID(): "+
b.getUniqueID());w.ctatdebug("CTATExampleTracerTracer --\x3e in getHighestUntraversedLink in loop interp.isTraversed(link, countOptionalAsTraversed): "+a.isTraversed(b,d));w.ctatdebug("CTATExampleTracerTracer --\x3e in getHighestUntraversedLink in loop isNoOp(link): "+y(b));!0===a.isTraversed(b,d)||!0===y(b)?(w.ctatdebug("CTATExampleTracerTracer --\x3e in getHighestUntraversedLink in if condition"),f=!0):(!0===f&&(w.ctatdebug("CTATExampleTracerTracer --\x3e in getHighestUntraversedLink in second if condition"),
B.getNode(b.getPrevNode()).getOutLinks().forEach(function(b){c&&1>w.nonEmptyHints(b,a.getVariableTable())||a.getTraversalCount(b)>=b.getMaxTraversals()||(w.ctatdebug("CTATExampleTracerTracer --\x3e in getHighestUntraversedLink pushing outlink: "+b.getUniqueID()),g.push(b))})),f=null===b||"undefined"===typeof b?!1:b.getMinTraversals()<=a.getTraversalCount(b))});g.sort(function(b,c){return(new CTATExampleTracerLinkComparator(a,w)).compare(b,c)});w.ctatdebug("CTATExampleTracerTracer --\x3e in getHighestUntraversedLink before sorting");
var h=!1,m=null;g.forEach(function(c){!0!==h&&(w.ctatdebug("CTATExampleTracerTracer --\x3e in getHighestUntraversedLink after sorting in fro loop"),!0===l(c,a,b,!1,e)?(w.ctatdebug("CTATExampleTracerTracer --\x3e in getHighestUntraversedLink after sorting first if"),m=c,h=!0):a.getPaths().forEach(function(d){!0!==h&&(w.ctatdebug("CTATExampleTracerTracer --\x3e in getHighestUntraversedLink after sorting in inner loop"),b!==d&&(w.ctatdebug("CTATExampleTracerTracer --\x3e in getHighestUntraversedLink after sorting second if"),
!0===l(c,a,d,!1,e)&&(w.ctatdebug("CTATExampleTracerTracer --\x3e in getHighestUntraversedLink after sorting third if"),m=c,h=!0)))}))});if(!0===h)return w.ctatdebug("CTATExampleTracerTracer --\x3e in getHighestUntraversedLink returning: "+m.getUniqueID()),m;w.ctatdebug("CTATExampleTracerTracer --\x3e out of getHighestUntraversedLink");return null}function y(a){return null===a||"undefined"===typeof a?!1:1>a.getMinTraversals()&&1>a.getMaxTraversals()}CTATBase.call(this,"CTATExampleTracerTracer",a);
var C=!1,r=null,I=null,J=null,B=a,D=null;CTATExampleTracerTracer_count++;var H=null,E={},w=this;this.getModelInitialized=function(){return C};this.setModelInitialized=function(a){C=a};this.goToDone=function(a,b,c){return(a=a.getPathToDone(b))?c.traceLinks(a.getSortedLinks()):!1};this.getMatchedSelections=function(){return E};this.getLastResult=function(){w.ctatdebug("CTATExampleTracerTracer --\x3e in getResult");return D};this.resetTracer=function(){w.ctatdebug("CTATExampleTracerTracer --\x3e in resetTracer entering");
null===r||"undefined"===typeof r?(w.ctatdebug("CTATExampleTracerTracer --\x3e in resetTracer making interpretations array"),r=[]):(w.ctatdebug("CTATExampleTracerTracer --\x3e in resetTracer clearing interpretations array"),r.length=0);var a=new CTATExampleTracerInterpretation(q());w.ctatdebug("CTATExampleTracerTracer tempInterp--\x3e in resetTracer tempInterp "+a);null!==b&&"undefined"!==typeof b&&(w.ctatdebug("CTATExampleTracerTracer --\x3e in resetTracer startStateVT if condition"),a.setVariableTable(b));
r.push(a);H=a;if(null===I||"undefined"===typeof I)w.ctatdebug("CTATExampleTracerTracer --\x3e in resetTracer incorrectActionMatches if condition"),I={};else{w.ctatdebug("CTATExampleTracerTracer --\x3e in resetTracer else branch of incorrectActionMatches if condition");for(var c in I)I.hasOwnProperty(c)&&delete I[c]}E={};null===J||"undefined"===typeof J?(w.ctatdebug("CTATExampleTracerTracer --\x3e in resetTracer last if condition"),J=[]):(w.ctatdebug("CTATExampleTracerTracer --\x3e in resetTracer else branch of last if condition"),
J.length=0);w.ctatdebug("CTATExampleTracerTracer --\x3e in resetTracer before iterating over all the links in the graphs");B.getLinks().forEach(function(a){a.getMatcher().resetMatcher()});w.ctatdebug("CTATExampleTracerTracer --\x3e out of resetTracer")};this.evaluate=function(a){w.ctatdebug("CTATExampleTracerTracer --\x3e in public evaluate(), calling private _evaluate; given event "+a);return f(a,!1,!0)};this.nonEmptyHints=function(a,b){w.ctatdebug("CTATExampleTracerTracer --\x3e in nonEmptyHints");
if(null===a||"undefined"===typeof a)return 0;var c=a.interpolateHints(b);w.ctatdebug("CTATExampleTracerTracer --\x3e in nonEmptyHints: link.interpolateHints() "+a.interpolateHints().length);if(null===c||"undefined"===typeof c||1>c.length)return 0;for(var d=0,e=0;e<c.length;++e)0<String(c[e]).trim().length&&d++;w.ctatdebug("CTATExampleTracerTracer --\x3e returning from nonEmptyHints "+d);return d};this.traceForHint=function(a){w.ctatdebug("CTATExampleTracerTracer --\x3e in traceForHint");var b=f(a,
!0,!1);w.ctatdebug("CTATExampleTracerTracer --\x3e in traceForHint return from evaluate "+b);w.ctatdebug("CTATExampleTracerTracer --\x3e in traceForHint result from evaluate "+a.getResult().toString());w.ctatdebug("CTATExampleTracerTracer --\x3e in traceForHint link   from evaluate "+a.getReportableLink());if(a.getResult().toString()===CTATExampleTracerLink.CORRECT_ACTION.toString())return b=a.getReportableLink(),a.setTutorSAI(new CTATSAI(a.getStudentSAI().getSelection(),b.getDefaultSAI().getAction(),
b.getDefaultSAI().getInput())),a.setActor(CTATMsgType.DEFAULT_STUDENT_ACTOR),w.ctatdebug("CTATExampleTracerTracer --\x3e traceForHint returning hintLink "+b+", result "+a),b;w.ctatdebug("CTATExampleTracerTracer --\x3e out of traceForHint, returning null");return null};this.matchForHint=function(a){w.ctatdebug("CTATExampleTracerTracer --\x3e in matchForHint");var b;if((b=(b=a.getStudentSAI())?b.getSelectionArray():null)&&0<b.length&&(w.ctatdebug("CTATExampleTracerTracer --\x3e in matchForHint first if"),
(b=w.traceForHint(a))&&0<a.getReportableHints().length))return w.ctatdebug("CTATExampleTracerTracer --\x3e matchForHint via traceForHint returning "+b+", result "+a),b;b=w.getBestNextLink(!0,a);w.ctatdebug("CTATExampleTracerTracer --\x3e matchForHint() traceForHint via getBestNextLink returning "+b);return b};this.getBestNextLink=function(a,b){w.ctatdebug("CTATExampleTracerTracer --\x3e in getBestNextLink");var c=[],d=u(a,c);if(null===d||"undefined"===typeof d)return w.ctatdebug("CTATExampleTracerTracer --\x3e in getBestNextLink returning null"),
null;if(d.getType().toString()===CTATExampleTracerLink.BUGGY_ACTION.toString())return w.ctatdebug("CTATExampleTracerTracer --\x3e in getBestNextLink return null no correct suboptimal step"),null;w.ctatdebug("CTATExampleTracerTracer --\x3e in getBestNextLink else branch");w.ctatdebug("CTATExampleTracerTracer --\x3e in getBestNextLink got interp "+(null==c?"null":c[0]));if(b){var e=d.interpolateHints(c[0].getVariableTable());b.setInterpolatedHints(e);w.ctatdebug("CTATExampleTracerTracer --\x3e in getBestNextLink setInterpolatedHints");
Array.isArray(e)&&0<e.length?b.setReportableHints(e):b.setReportableHints(d.getHints());w.ctatdebug("In evaluate --\x3e after setReportableHints");c&&c[0]&&c[0].setLatestHints(e,d.getHints());b.setReportableLink(d);b.setAssociatedSkills(d.getSkillNames());b.setReportableInterpretation(c[0]);b.setResult(d.getType());b.setTraceOutcome(d.getType());b.setStepID(d.getUniqueID());b.setTutorSAI(d.getDefaultSAI())}w.ctatdebug("CTATExampleTracerTracer --\x3e in getBestNextLink return etLink");return d};this.doHint=
function(a,b){w.ctatdebug("CTATExampleTracerTracer --\x3e in doHint");var c=w.matchForHint(a);Array.isArray(b)&&(w.ctatdebug("CTATExampleTracerTracer --\x3e in doHint last if condition"),b.push(a));w.ctatdebug("CTATExampleTracerTracer --\x3e returning from doHint: "+c);return c};this.getBestInterpretation=function(){w.ctatdebug("CTATExampleTracerTracer --\x3e in getBestInterpretation");if(null===H||"undefined"===typeof H)w.ctatdebug("CTATExampleTracerTracer --\x3e in getBestInterpretation in if condition"),
H=p(w.getInterpretationsInternal());w.ctatdebug("CTATExampleTracerTracer --\x3e out of getBestInterpretation "+(null===H||void 0===H));return H};this.getInterpretationsInternal=function(){w.ctatdebug("CTATExampleTracerTracer --\x3e in getInterpretationsInternal");return r};this.toString=function(){var a="TracerState\n";null===r?a+="(no interpretations)\n":r.forEach(function(b){a+=b.toString()+"\n"});return a};this.addInterfaceVariablesFromEvent=function(a){if(a){var b=a.getTutorSelection();a=a.getTutorInput();
w.addInterfaceVariables(b,a)}};this.addInterfaceVariables=function(a,c){w.ctatdebug("CTATExampleTracerTracer.addInterfaceVariables("+a+", "+c+")");if(a&&c){var d=a.length;d>c.length&&(d=c.length);for(var e=0;e<d;e++)a[e]&&(b.put(a[e],CTATVariableTable.standardizeType(c[e])),b.put(CTATVariableTable.nameAsString(a[e]),CTATVariableTable.valueAsString(c[e])));w.ctatdebug("CTATExampleTracerTracer.addInterfaceVariables() startStateVT "+b);r&&r.forEach(function(b){if(b=b.getVariableTable()){for(var e=0;e<
d;e++)a[e]&&(b.put(a[e],CTATVariableTable.standardizeType(c[e])),b.put(CTATVariableTable.nameAsString(a[e]),CTATVariableTable.valueAsString(c[e])));w.ctatdebug("CTATExampleTracerTracer.addInterfaceVariables() interp.vt "+b)}})}};this.findCurrentState=function(){w.ctatdebug("Entering findCurrentState");var a=w.getBestInterpretation();return a&&a.getLastMatchedLink()&&a.getLastMatchedLink().isDone()?a.getLastMatchedLink().getNextNode():(a=u(!1,[a]))?a.getPrevNode():B?B.getStartNode():null}};
CTATExampleTracerTracer.prototype=Object.create(CTATBase.prototype);CTATExampleTracerTracer.prototype.constructor=CTATExampleTracerTracer;"undefined"!==typeof module&&(module.exports=CTATExampleTracerTracer);var CTATExampleTracerGraph=function(a,b,d){function e(a,b,d){z.ctatdebug("CTATExampleTracerGraph --\x3e in isOrderOK");if(z.relaxOrderConstraints()||b.isDone()&&z.exitOnIncorrectDone())return!0;for(var e=c(b),g=0;g<e.length;g++){var l=e[g];if(!0===E.isGroupOrdered(l))if(g!==e.length-1){if(!1===f(l,h(e[g+1],d),a,d))return!1}else if(!1===f(l,b,a,d))return!1}z.ctatdebug("CTATExampleTracerGraph --\x3e out of isOrderOK");return!0}function g(a,b,d){z.ctatdebug("CTATExampleTracerGraph --\x3e in isReenteringOK");
if(z.relaxOrderConstraints()||b.isDone()&&z.exitOnIncorrectDone())return!0;b=c(b);for(var e=!0,f=0;f<b.length;f++)if(!0===e&&!1===E.isGroupReenterable(b[f]))for(var e=!1,g=0;g<a.length;g++)if(!0===E.isLinkInGroup(b[f],a[g]))e=!0;else{if(!0===e)return!1}else if(!1===e)break;if(0!==a.length){var h=c(a[a.length-1]);z.ctatdebug("CTATExampleTracerGraph --\x3e in isReentrableOK: exitedGroups null? "+(null===h));z.ctatdebug("CTATExampleTracerGraph --\x3e in isReentrableOK: exitedGroups undefined? "+("undefined"===
typeof h));z.ctatdebug("CTATExampleTracerGraph --\x3e in isReentrableOK: exitedGroups last traversedLink "+a[a.length-1].getUniqueID());z.ctatdebug("CTATExampleTracerGraph --\x3e in isReentrableOK: exitedGroups length "+(h?h.length:null));b.forEach(function(a){a=h.indexOf(a);0<=a&&h.splice(a,1)});z.ctatdebug("CTATETGraph.isReentrableOK: exitedGroups.length after removing newLink's groups: "+h.length);for(k=h.length-1;0<=k;k--)E.isGroupReenterable(h[k])&&h.splice(k,1);z.ctatdebug("CTATETGraph --\x3e in isReentrableOK: exitedGroups after removing reenterables: "+
h.length);z.ctatdebug("CTATETGraph --\x3e in isReentrableOK: traversedLinks: "+a+", path: "+d);var l=!0;h.forEach(function(b){!1!==l&&d.forEach(function(c){!1!==l&&m(a,c)<c.getMinTraversals()&&!0===E.isLinkInGroup(b,c)&&(l=!1)})});if(!1===l)return!1}z.ctatdebug("CTATExampleTracerGraph --\x3e out of isReenteringOK");return!0}function c(a){z.ctatdebug("in findGroupsOfLink(link "+a+"): typeof(groupModel) "+typeof E);a=E.getGroupsContainingLink(a);z.ctatdebug("in findGroupsOfLink groupsSet.size "+a.size);
var b=[];a.forEach(function(a){z.ctatdebug("in findGroupsOfLink group element "+a.getName());b.push(a)});b.sort(function(a,b){return E.getGroupLinkCount(b)-E.getGroupLinkCount(a)});return b}function f(a,b,c,d){var e=-1,f=null,g=Number.MAX_VALUE,l=null;E.getGroupSubgroups(a).forEach(function(a){if(!1===E.isLinkInGroup(a,b)&&0!==E.getGroupLinkCount(a)){var m=h(a,d);null!==m&&"undefined"!==typeof m&&(m=m.getDepth(),m<b.getDepth()&&m>e&&(!1===n(a)||!0===p(a,c))&&(e=m,f=a),m>b.getDepth()&&m<g&&(!1===n(a)||
!0===p(a,c))&&(g=m,l=a))}});E.getUniqueLinks(a).forEach(function(a){if(!0===d.has(a)){var h=a.getDepth();h<b.getDepth()&&h>e&&(0<a.getMinTraversals()||-1<c.indexOf(a))&&(e=h,f=a);h>b.getDepth()&&h<g&&(0<a.getMinTraversals()||-1<c.indexOf(a))&&(g=h,l=a)}});if(null!==f&&"undefined"!==typeof f)if(f instanceof CTATExampleTracerLink){if(m(c,f)<f.getMinTraversals())return!1}else if(f instanceof CTATLinkGroup&&!1===x(f,c,d))return!1;return null!==l&&"undefined"!==typeof l&&(l instanceof CTATExampleTracerLink&&
-1<c.indexOf(l)||l instanceof CTATLinkGroup&&!0===p(l,c))?!1:!0}function h(a,b){var c=Number.MAX_VALUE,d=null;E.getGroupLinks(a).forEach(function(a){a.getDepth()<c&&!0===b.has(a)&&(c=a.getDepth(),d=a)});return d}function m(a,b){for(var c=0,d=0;d<a.length;d++)b===a[d]&&c++;z.ctatdebug("CTATETGraph.getTraversalCount("+b+"): "+c);return c}function l(a,b,c){var d=!1,e=!0,f=!1;(new CTATExampleTracerPath(b)).getSortedLinks().forEach(function(b){if(!1!==e&&!0!==f){if(!1===d)!0===E.isLinkInGroup(a,b)&&(d=
!0);else if(!1===E.isLinkInGroup(a,b)){f=!0;return}c.getTraversalCount(b)<b.getMaxTraversals()&&(e=!1)}});return!1===e?!1:!0}function n(a){var b=!0;E.getGroupLinks(a).forEach(function(a){!1!==b&&0!==a.getMinTraversals()&&(b=!1)});return!1===b?!1:!0}function p(a,b){for(var c=0;c<b.length;c++)if(!0===E.isLinkInGroup(a,b[c]))return!0;return!1}function x(a,b,c){var d=!0;E.getGroupLinks(a).forEach(function(a){!1!==d&&!0===c.has(a)&&m(b,a)<a.getMinTraversals()&&(d=!1)});return!1===d?!1:!0}function q(){for(var a=
0;a<y.length;a++)y[a].clearInLinks();var b=z.getStartNode();null!==b&&"undefined"!==typeof b&&null!==b.getOutLinks()&&"undefined"!==typeof b.getOutLinks()&&(a=0,b.getOutLinks().forEach(function(b){v(b,a++)}))}function v(a,b){ctatdebug("updateInLinkSubGraph("+a+", "+b+")");var c=z.getNode(a.getNextNode());if(null!==c&&"undefined"!==typeof c){c.addInLink(a);var d=0;c.getOutLinks().forEach(function(a){v(a,d++)})}}function u(a){var b=z.getNode(a.getPrevNode());if(null!==b&&"undefined"!==typeof b){var c=
-1;b.getInLinks().forEach(function(a){-1===a.getDepth()&&u(a);a.getDepth()>c&&(c=a.getDepth())});a.setDepth(c+1)}}CTATBase.call(this,"CTATExampleTracerGraph","visualdata");var A=null,y=null,C=null,r=null,I=null,J=null,B=new Set,D=new Set,H=null,E=null,w=CTATMsgType.SHOW_ALL_FEEDBACK,z=this;this.getFeedbackPolicy=function(){return w};this.setFeedbackPolicy=function(a){z.ctatdebug("Graph.setFeedbackPolicy("+a+") old policy "+w);w="false"===a?CTATMsgType.SHOW_ALL_FEEDBACK:"true"===a?CTATMsgType.HIDE_ALL_FEEDBACK:
a};this.hideButRequireSteps=function(){return w==CTATMsgType.HIDE_BUT_COMPLETE};this.hideAllFeedback=function(){return w==CTATMsgType.HIDE_ALL_FEEDBACK};this.relaxOrderConstraints=function(){return z.hideAllFeedback()||z.hideButRequireSteps()||w==CTATMsgType.DELAY_FEEDBACK};this.exitOnIncorrectDone=function(){switch(w){case CTATMsgType.HIDE_ALL_FEEDBACK:case CTATMsgType.HIDE_BUT_ENFORCE:return!0;default:return!1}};this.getDefaultBuggyMsg=function(){return E.getTopLevelGroup()?E.getTopLevelGroup().getDefaultBuggyMsg():
null};this.getLinks=function(){z.ctatdebug("CTATExampleTracerGraph --\x3e in getLinks");return C};this.addLink=function(a,b){z.ctatdebug("CTATExampleTracerGraph --\x3e in addLink");C.push(a);a.isDone()?D.add(a):D["delete"](a);null===b||"undefined"===typeof b?E.addLinkToGroup(E.getTopLevelGroup(),a):E.addLinkToGroup(b,a);z.ctatdebug("CTATExampleTracerGraph --\x3e out of addLink")};this.addNode=function(a){z.ctatdebug("CTATExampleTracerGraph --\x3e in addNode");y.push(a);r[a.getNodeID()]=a;z.ctatdebug("CTATExampleTracerGraph --\x3e out of addNode")};
this.findAllPaths=function(){ctatdebug("CTATExampleTracerGraph --\x3e in findAllPaths "+z.getStartNode().getNodeID());return z.findPathsFromNode(z.getStartNode())};this.pathToLinkIsSubset=function(a,b){var c=z.getNode(a.getPrevNode());z.ctatdebug("pathToLinkIsSubset("+a+") sourceNode "+c.getNodeID());if(0<a.getMinTraversals()&&"undefined"==typeof b[a.getUniqueID()])return!1;if(c==z.getStartNode())return!0;for(c=c.getInLinks().values();!(c=c.next()).done;)return z.pathToLinkIsSubset(c.value,b);return!1};
this.observesOrderingConstraints=function(a,b,c,d){z.ctatdebug("CTATExampleTracerGraph --\x3e in observesOrderingConstraints");null!==d&&"undefined"!==typeof d&&(z.ctatdebug("CTATExampleTracerGraph --\x3e in observesOrderingConstraints initializing out of order false"),d.setOutOfOrder(!1));if(null===c||"undefined"===typeof c||0===c.size||null===b||"undefined"===typeof b)return z.ctatdebug("CTATExampleTracerGraph --\x3e returning first true observesOrderingConstraints"),!0;if(b.isDone()&&z.exitOnIncorrectDone())return z.ctatdebug("CTATExampleTracerGraph.observesOrderingConstraints --\x3e returning true for doneStep && exitOnIncorrectDone"),
!0;if(!0===c.has(b)&&!0===e(a,b,c)&&!0===g(a,b,c))return z.ctatdebug("CTATExampleTracerGraph.observesOrderingConstraints --\x3e returning isOrderOK true && isisReenteringOK() true"),!0;null!==d&&"undefined"!==typeof d&&(z.ctatdebug("CTATExampleTracerGraph --\x3e in observesOrderingConstraints setting out of order true"),d.setOutOfOrder(!0));z.ctatdebug("CTATExampleTracerGraph --\x3e returning false observesOrderingConstraints");return!1};this.isIncorrectLinkOK=function(a,b,c,d){z.ctatdebug("CTATExampleTracerGraph --\x3e in isIncorrectLinkOK");
var f=!1,g=null,h=!0,m=!1;z.getNode(b.getPrevNode()).getOutLinks().forEach(function(b){!0!==m&&!1!==h&&b.getType().toString()!==CTATExampleTracerLink.BUGGY_ACTION.toString()&&!0===c.has(b)&&(f=!0,!1===e(a,b,c)?h=!1:(g=b,m=!0))});if(!1===h||null===g||"undefined"===typeof g)return!1;if(!1===f)return z.ctatdebug("isIncorrectLinkOK(): no siblings of link in path"),!1;if(!0===f&&(b=z.getSmallestContainingGroup(b),!0===E.isLinkInGroup(b,g)&&!1===E.isGroupOrdered(b)&&!0===l(b,c,d)))return!1;z.ctatdebug("CTATExampleTracerGraph --\x3e out of isIncorrectLinkOK");
return!0};this.getNode=function(a){z.ctatdebug("CTATExampleTracerGraph --\x3e in getNode("+a+") returning "+r[a]);return r[a]};this.findNode=function(a){if(a){a=a.toLowerCase();for(var b in r)if(r[b].getNodeName().toLowerCase()==a)return z.getNode(b);if("start"==a)return z.getStudentStartsHereNode()||z.getStartNode()}return null};this.findPathsFromNode=function(a){z.ctatdebug("CTATExampleTracerGraph --\x3e in findPathsFromNode outlinks "+a.getOutLinks().size);var b=new Set;if(!a||0===a.getOutLinks().size)return b.add(new CTATExampleTracerPath(null)),
b;z.ctatdebug("CTATExampleTracerGraph --\x3e before forEach ");a.getOutLinks().forEach(function(a){z.ctatdebug("CTATExampleTracerGraph --\x3e in forEach "+a.getType().toString());if(a.getType().toString()!=CTATExampleTracerLink.BUGGY_ACTION.toString()){var c=z.findPathsFromNode(z.getNode(a.getNextNode()));z.ctatdebug("findPathsFromNode childPaths.size "+c.size);c.forEach(function(c){z.ctatdebug("findPathsFromNode childPath.size "+c.size+", outLink "+a);c.addLink(a);b.add(c)})}},a);0===b.size&&b.add(new CTATExampleTracerPath(null));
z.ctatdebug("CTATExampleTracerGraph --\x3e out of findPathsFromNode "+b.size);return b};this.getDoneStates=function(){return B};this.checkForDoneState=function(a){if(a.isDone()&&a.isTraversable()){var b=z.getNode(a.getNextNode());z.ctatdebug("CTATExampleTracerGraph.addDoneState(linkID "+a.getUniqueID()+") adding destNode "+b);B.add(b)}};this.getBestSubpath=function(a,b,c){if(!a||!b)return null;var d=z.findPathsFromNode(a),e=new Set;d.forEach(function(a){a=a.subpath(b);!a||c&&!a.containsAll(c)||e.add(a)});
z.ctatdebug("CTATExampleTracerGraph.getBestSubpath("+a+", "+b+", ["+(c?c.length:-1)+"]) pathsFrom "+d.size+", pathsFromTo "+e.size);return 1>e.size?null:CTATExampleTracerPath.getBestPath(e)};this.getStartNode=function(){z.ctatdebug("CTATExampleTracerGraph --\x3e in getStartNode() returning "+I);return I};this.getLinkByID=function(a){z.ctatdebug("CTATExampleTracerGraph --\x3e in getLinkByID");for(var b=0;b<C.length;b++)if(C[b].getUniqueID()===a)return C[b];z.ctatdebug("CTATExampleTracerGraph --\x3e out of getLinkByID");
return null};this.setStartNode=function(a){z.ctatdebug("CTATExampleTracerGraph --\x3e in setStartNode("+a+")");I=a};this.getStudentStartsHereNode=function(){z.ctatdebug("CTATExampleTracerGraph --\x3e getStudentStartsHereNode() returns "+J);return J};this.setStudentStartsHereNode=function(a){z.ctatdebug("CTATExampleTracerGraph --\x3e in setStudentStartsHereNode("+a+")");J=a};this.getExampleTracer=function(){z.ctatdebug("CTATExampleTracerGraph --\x3e in getExampleTracer() returning "+A);return A};this.forDebugging=
function(){z.ctatdebug("CTATExampleTracerGraph --\x3e in forDebugging");z.ctatdebug("Nodes in the graph -- ids");y.forEach(function(a){z.ctatdebug(a.getNodeID())});z.ctatdebug("Links in the graph -- ids, from, to");C.forEach(function(a){z.ctatdebug(a)})};this.getSmallestContainingGroup=function(a){return E.getLowestLevelGroupOfLink(a)};this.redoLinkDepths=function(){q();z.getLinks().forEach(function(a){a.setDepth(-1)});z.getLinks().forEach(function(a){-1===a.getDepth()&&u(a)})};this.getGroupModel=
function(){return E};this.setVisualData=function(a){z.ctatdebug("CTATExampleTracerGraph --\x3e in setVisualData");H=a};this.getVisualData=function(){z.ctatdebug("CTATExampleTracerGraph --\x3e in getVisualData() returning "+H);return H};this.getDoneLinks=function(){return D};(function(a,b){z.ctatdebug("CTATExampleTracerGraph --\x3e in initGraph ("+a+" , "+b);C=[];y=[];r={};if(null===E||"undefined"===typeof E)E=new CTATDefaultGroupModel,z.ctatdebug("CTATExampleTracerGraph --\x3e created a group model from here");
E.clear();E.setDefaultReenterable(!b);E.setGroupOrdered(E.getTopLevelGroup(),a);E.setGroupName(E.getTopLevelGroup(),CTATExampleTracerGraph.TOP_LEVEL);A=new CTATExampleTracerTracer(z,d);z.ctatdebug("CTATExampleTracerGraph --\x3e out of initGraph")})(!a,b)};Object.defineProperty(CTATExampleTracerGraph,"TOP_LEVEL",{enumerable:!1,configurable:!1,writable:!1,value:"Top Level"});CTATExampleTracerGraph.prototype=Object.create(CTATBase.prototype);CTATExampleTracerGraph.prototype.constructor=CTATExampleTracerGraph;
"undefined"!==typeof module&&(module.exports=CTATExampleTracerGraph);var CTATGraphParser=function(){function a(a){ctatdebug("processEdge()");for(var d=new CTATExampleTracerLink(null,null,null),g=f.getElementChildren(a),h,l,m,p,q,x=a=-1,B=CTATMsgType.DEFAULT_ACTOR,D=!1,H=0;H<g.length;H++){"sourceID"===f.getElementName(g[H])&&(a=parseInt(f.getNodeTextValue(g[H])),d.setPrevNode(a));"destID"===f.getElementName(g[H])&&(x=parseInt(f.getNodeTextValue(g[H])),d.setNextNode(x));if("rule"===f.getElementName(g[H]))for(var E=f.getElementChildren(g[H]),w=0;w<E.length;w++)"text"===
f.getElementName(E[w])&&d.addSkillName(f.getNodeTextValue(E[w]).toString());if("actionLabel"===f.getElementName(g[H]))for(d.setIsPreferredLink("false"!=f.getElementAttr(g[H],"preferPathMark")),d.setMinTraversalsStr(f.getElementAttr(g[H],"minTraversals")),d.setMaxTraversalsStr(f.getElementAttr(g[H],"maxTraversals")),E=f.getElementChildren(g[H]),w=0;w<E.length;w++){"uniqueID"===f.getElementName(E[w])&&(q=f.getNodeTextValue(E[w]),d.setUniqueID(parseInt(f.getNodeTextValue(E[w]))));"message"===f.getElementName(E[w])&&
(p=new CTATMessage(E[w]));"actionType"===f.getElementName(E[w])&&d.setActionType(f.getNodeTextValue(E[w]));"buggyMessage"===f.getElementName(E[w])&&d.setBuggyMsg(f.getNodeTextValue(E[w]));"successMessage"===f.getElementName(E[w])&&d.setSuccessMsg(f.getNodeTextValue(E[w]));"hintMessage"===f.getElementName(E[w])&&d.addHint(f.getNodeTextValue(E[w]));if("matchers"===f.getElementName(E[w]))for(var z=f.getElementChildren(E[w]),K=0;K<z.length;K++)"Selection"===f.getElementName(z[K])&&(h=b(z[K],0)),"Action"===
f.getElementName(z[K])&&(l=b(z[K],1)),"Input"===f.getElementName(z[K])&&(m=b(z[K],2)),"Actor"===f.getElementName(z[K])&&(B=f.getNodeTextValue(z[K]),D=(D=f.getElementAttr(z[K],"linkTriggered"))&&"false"!=D.toLowerCase().trim()?!0:!1);if("matcher"===f.getElementName(E[w])){m=E[w];l=p;h=f.getElementAttr(m,"replacementFormula");var M=f.getElementChildren(m),L=z=void 0,G,U=void 0,K=CTATMsgType.DEFAULT_ACTOR;m=new CTATExactMatcher(CTATMatcher.SELECTION,null);B=new CTATExactMatcher(CTATMatcher.ACTION,null);
e.ctatdebug("processMatcher(): nChildren "+M.length+", saiMessage "+l);for(var P=0;P<M.length;P++)"matcherType"===f.getElementName(M[P])&&(G=f.getNodeTextValue(M[P]),"ExactMatcher"===G&&(L=CTATExactMatcher),"RegexMatcher"===G&&(L=CTATRegexMatcher),"AnyMatcher"===G&&(L=CTATAnyMatcher),"RangeMatcher"===G&&(L=CTATRangeMatcher),"WildcardMatcher"===G&&(L=CTATWildcardMatcher),"ExpressionMatcher"===G&&(L=CTATExpressionMatcher),e.ctatdebug("processMatcher(): child "+P+", eltText "+G+", matcher "+L)),"matcherParameter"===
f.getElementName(M[P])&&(G=f.getElementAttr(M[P],"name"),U=f.getNodeTextValue(M[P]),"selection"==G&&m.setParameter(U),"action"==G&&B.setParameter(U),"input"==G&&(z=z?z:new L(CTATMatcher.INPUT,null),z.setParameter(U)),"actor"==G&&(K=U),"minimum"==G&&(z=z?z:new L(CTATMatcher.INPUT,null),z.setParameter(U,"minimum")),"maximum"==G&&(z=z?z:new L(CTATMatcher.INPUT,null),z.setParameter(U,"maximum")),"InputExpression"==G&&(z=z?z:new L(CTATMatcher.INPUT,null),z.setParameter(M[P],G,f)),"relation"==G&&(z=z?z:
new L(CTATMatcher.INPUT,null),z.setParameter(M[P],G,f)),e.ctatdebug("processMatcher(): child "+P+", eltAttrName "+G+", inputMatcher "+z));z||(z=L?new L(CTATMatcher.INPUT,null):new CTATExactMatcher(CTATMatcher.INPUT,null),z.setParameter(U?U:""),"undefined"!=typeof l&&"function"==typeof l.getSAI&&(l=l.getSAI(),m.setSingle(l.getSelection()),B.setSingle(l.getAction()),z.setSingle(l.getInput())));z.setReplacementFormula(h);B=[[m],[B],[z],K];h=B[0];l=B[1];m=B[2];B=B[3]}}}c.getStartNode()&&x==c.getStartNode().getNodeID()&&
console.log("***WARNING*** edge "+q+" destination is graph startNode "+c.getStartNode());q=new CTATVectorMatcher(h,l,m,B);q.setDefaultSAI(p.getSAI());q.setCaseInsensitive(n);q.setLinkTriggered(D);d.setMatcher(q);ctatdebug("GraphParser.processEdge() "+a+"->"+x+", edge "+d);c.getNode(a).addOutLink(d);c.checkForDoneState(d);return d}function b(a,b){e.ctatdebug("processMatchers()");for(var c=f.getElementChildren(a),d=[],g=0;g<c.length;g++)if("matcher"===f.getElementName(c[g])){for(var h=null,l=f.getElementAttr(c[g],
"replacementFormula"),m=f.getElementChildren(c[g]),n=0;n<m.length;n++){if("matcherType"===f.getElementName(m[n]))switch(h=f.getNodeTextValue(m[n]),e.ctatdebug("CTATGraphParser.processMatchers() matcherType["+n+"] = "+h),h){case "ExactMatcher":h=new CTATExactMatcher(b,null);break;case "RegexMatcher":h=new CTATRegexMatcher(b,null);break;case "AnyMatcher":h=new CTATAnyMatcher(b,null);break;case "RangeMatcher":h=new CTATRangeMatcher(b,null);break;case "WildcardMatcher":h=new CTATWildcardMatcher(b,null);
break;case "ExpressionMatcher":h=new CTATExpressionMatcher(b,null);break;default:console.log("CTATGraphParser.processMatchers() unknown matcherType["+n+"] = "+h+"; using CTATExactMatcher"),h=new CTATExactMatcher(b,null)}if("matcherParameter"===f.getElementName(m[n])){var p=f.getElementAttr(m[n],"name");"single"===p?h.setParameter(f.getNodeTextValue(m[n])):"minimum"===p?h.setParameter(f.getNodeTextValue(m[n]),"minimum"):"maximum"===p?h.setParameter(f.getNodeTextValue(m[n]),"maximum"):h.setParameter(m[n],
p,f)}}h&&h.setReplacementFormula(l);d.push(h)}return d}function d(a,b){var c=new Set;if("group"!==f.getElementName(a))return c;var e=f.getElementAttr(a,"name");ctatdebug("readGroupFromXML group name: "+e);var g="true"===f.getElementAttr(a,"ordered"),h="true"===f.getElementAttr(a,"reenterable");ctatdebug("readGroupFromXML group isOrdered typeof: "+typeof g);ctatdebug("readGroupFromXML group isOrdered: "+g);for(var m=function(a){c.add(a)},n=f.getElementChildren(a),p=0;p<n.length;p++){if("link"===f.getElementName(n[p])){var q=
Number(f.getElementAttr(n[p],"id")),v=b[q];if(null!==v||void 0!==v)ctatdebug("Added link ID : "+q),c.add(v)}"group"===f.getElementName(n[p])&&(ctatdebug("encountered a subgroup"),d(n[p],b).forEach(m))}l.addGroup(e,g,c);l.setGroupReenterable(l.getGroupByName(e),h);return c}CTATBase.call(this,"CTATGraphParser","__undefined__");var e=this,g,c,f=new CTATXML,h=null,m=[];new XMLSerializer;var l,n=!0,p=!0,x=[];this.getLockWidget=function(){return p};this.parseGraph=function(b,e){ctatdebug("parseBRD()");
var q=0,v=f.getElementAttr(b,"startStateNodeName"),y="true"===f.getElementAttr(b,"unordered");n="false"!=String(f.getElementAttr(b,"caseInsensitive")).toLowerCase();p=f.getElementAttr(b,"lockWidget");var C=new CTATVariableTable;c=new CTATExampleTracerGraph(y,!1,C);var r=f.getElementChildren(b),C=f.getElementAttr(b,"suppressStudentFeedback");if(null===C||void 0===C)C=CTATMsgType.SHOW_ALL_FEEDBACK;c.setFeedbackPolicy(C);e.setFeedbackSuppressed(C);C=f.getElementAttr(b,"highlightRightSelection");e.setHighlightRightSelection("false"!=
C);var I=f.getElementAttr(b,"confirmDone");"true"!==I&&"false"!==I&&(I=c.getFeedbackPolicy()===CTATMsgType.HIDE_ALL_FEEDBACK?"true":"false");e.setHintPolicy(f.getElementAttr(b,"hintPolicy"));e.setOutOfOrderMessage(f.getElementAttr(b,"outOfOrderMessage"));for(var J=null,B=0;B<r.length;B++)switch(f.getElementName(r[B])){case "startNodeMessages":m=f.getElementChildren(r[B]);break;case "node":q++;var D;D=r[B];ctatdebug("processNode("+D+")");var H=f.getElementChildren(D),E=-1;D="";for(var w=0;w<H.length;w++)switch(f.getElementName(H[w])){case "uniqueID":E=
parseInt(f.getNodeTextValue(H[w]));break;case "text":D=f.getNodeTextValue(H[w])}H=new CTATExampleTracerNode(E,new Set);""!==D&&H.setNodeName(D);D=H;c.addNode(D);1==q&&(c.setStartNode(D),c.setStudentStartsHereNode(D));D.getNodeName()==v&&c.setStudentStartsHereNode(D);break;case "edge":c.addLink(a(r[B]));break;case "EdgesGroups":J=r[B];break;case "productionRule":var z=r[B];ctatdebug("processSkill()");for(var H=D="",w=E=null,z=f.getElementChildren(z),K=0;K<z.length;K++){var M=f.getElementName(z[K]);
"ruleName"==M&&(D=f.getNodeTextValue(z[K]),ctatdebug("ruleName="+D));"productionSet"==M&&(H=f.getNodeTextValue(z[K]),ctatdebug("productionSet="+H));"label"==M&&(E=f.getNodeTextValue(z[K]),ctatdebug("label="+E));"description"==M&&(w=f.getNodeTextValue(z[K]),ctatdebug("description="+w))}D&&(z=new CTATExampleTracerSkill(H,D,CTATExampleTracerSkill.DEFAULT_P_GUESS,CTATExampleTracerSkill.DEFAULT_P_KNOWN,CTATExampleTracerSkill.DEFAULT_P_SLIP,CTATExampleTracerSkill.DEFAULT_P_LEARN,CTATExampleTracerSkill.DEFAULT_HISTORY),
null!=E?z.setLabel(E):z.setLabel(D),null!=w?z.setDescription(w):z.setDescription(D+(H?" "+H:"")),x.push(z))}if(J){q=f.getElementAttr(J,"ordered");if(null===q||"undefined"==typeof isordered)q=!y;ctatdebug("parseGraph() value of isOrdered = "+q);ctatdebug("parseGraph() value of isUnordered = "+y);ctatdebug("parseGraph() typeof isOrdered: "+typeof q);ctatdebug("parseGraph()typeof isUnordered: "+typeof y);v=J;r=q;ctatdebug("processGroup()");l=c.getGroupModel();q=l.createIdToLinkMap();l.setGroupOrdered(l.getTopLevelGroup(),
r);ctatdebug("processGroup() name of group: "+l.getGroupName(l.getTopLevelGroup()));ctatdebug("processGroup() group isOrdered?: "+l.isGroupOrdered(l.getTopLevelGroup()));ctatdebug("processGroup() order of group: isOrdered= "+r);ctatdebug("processGroup() order of group: isOrdered typeof= "+typeof r);v=f.getElementChildren(v);for(r=0;r<v.length;r++)switch(f.getElementName(v[r])){case "group":d(v[r],q);break;case "outOfOrderMessage":l.getTopLevelGroup().setDefaultBuggyMsg(f.getNodeTextValue(v[r]))}}q=
e.getSkillBarVector(!1,!0);if(!q||1>q.length)ctatdebug("No existing skills. Add skills from BRD."),e.addGraphSkills(x),q=e.getSkillBarVector();h=(new CTATTutorMessageBuilder).createStateGraphMessage(n,y,p,e.isSourceFlash()?c.exitOnIncorrectDone():e.isFeedbackSuppressed(),C,I,q);c.redoLinkDepths();g=c.getExampleTracer();g.resetTracer();c.forDebugging();ctatdebug("Graph loaded.");return{gr:c,tracer:g,ssm:m,sgMsg:h}}};CTATGraphParser.prototype=Object.create(CTATBase.prototype);
CTATGraphParser.prototype.constructor=CTATGraphParser;"undefined"!==typeof module&&(module.exports=CTATGraphParser);var CTATProblemStateStatus=function(){var a="empty";this.getStatus=function(){return a};this.setStatus=function(b){a=b}};Object.defineProperty(CTATProblemStateStatus,"empty",{enumerable:!1,configurable:!1,writable:!1,value:"empty"});Object.defineProperty(CTATProblemStateStatus,"incompleteStartState",{enumerable:!1,configurable:!1,writable:!1,value:"incompleteStartState"});Object.defineProperty(CTATProblemStateStatus,"startState",{enumerable:!1,configurable:!1,writable:!1,value:"startState"});
Object.defineProperty(CTATProblemStateStatus,"incomplete",{enumerable:!1,configurable:!1,writable:!1,value:"incomplete"});Object.defineProperty(CTATProblemStateStatus,"goingToState",{enumerable:!1,configurable:!1,writable:!1,value:"goingToState"});Object.defineProperty(CTATProblemStateStatus,"normalFeedback",{enumerable:!1,configurable:!1,writable:!1,value:"normalFeedback"});Object.defineProperty(CTATProblemStateStatus,"complete",{enumerable:!1,configurable:!1,writable:!1,value:"complete"});
Object.defineProperty(CTATProblemStateStatus,"completedEarlier",{enumerable:!1,configurable:!1,writable:!1,value:"completedEarlier"});CTATProblemStateStatus.prototype=Object.create(CTATBase.prototype);CTATProblemStateStatus.prototype.constructor=CTATProblemStateStatus;CTATProblemStateStatus.prototype.isSendingSavedMsgsForRestore=function(){switch(this.getStatus()){case CTATProblemStateStatus.normalFeedback:case CTATProblemStateStatus.complete:return!0;default:return!1}};
CTATProblemStateStatus.prototype.mustSaveForRestore=function(){switch(this.getStatus()){case CTATProblemStateStatus.incomplete:case CTATProblemStateStatus.incompleteStartState:case CTATProblemStateStatus.goingToState:case CTATProblemStateStatus.completedEarlier:return!1;default:return!0}};
CTATProblemStateStatus.prototype.countForProblemSummary=function(){switch(this.getStatus()){case CTATProblemStateStatus.incompleteStartState:case CTATProblemStateStatus.goingToState:case CTATProblemStateStatus.startState:case CTATProblemStateStatus.completedEarlier:return!1;default:return!0}};CTATProblemStateStatus.prototype.isOutputSuppressed=function(){switch(this.getStatus()){case CTATProblemStateStatus.goingToState:return!0;default:return!1}};
CTATProblemStateStatus.prototype.isComplete=function(){switch(this.getStatus()){case CTATProblemStateStatus.complete:case CTATProblemStateStatus.completedEarlier:return!0;default:return!1}};CTATProblemStateStatus.prototype.canRestore=function(){switch(this.getStatus()){case CTATProblemStateStatus.incompleteStartState:case CTATProblemStateStatus.incomplete:case CTATProblemStateStatus.complete:case CTATProblemStateStatus.completedEarlier:return!0;default:return!1}};
CTATProblemStateStatus.prototype.mustRetrieveProblemState=function(){switch(this.getStatus()){case CTATProblemStateStatus.incompleteStartState:case CTATProblemStateStatus.incomplete:case CTATProblemStateStatus.complete:case CTATProblemStateStatus.completedEarlier:return!0;default:return!1}};
CTATProblemStateStatus.prototype.transition=function(a,b){var d=this.getStatus();if(CTATProblemStateStatus.completedEarlier!=d)if(CTATProblemStateStatus.complete==d&&b==CTATProblemStateStatus.completedEarlier)this.setStatus(CTATProblemStateStatus.completedEarlier);else{switch(a){case CTATMsgType.SET_PREFERENCES:CTATProblemStateStatus[b]&&(CTATProblemStateStatus.incomplete==CTATProblemStateStatus[b]?this.setStatus(CTATProblemStateStatus.incompleteStartState):CTATProblemStateStatus.complete==CTATProblemStateStatus[b]?
this.setStatus(CTATProblemStateStatus.completedEarlier):this.setStatus(CTATProblemStateStatus.startState));break;case CTATMsgType.STATE_GRAPH:this.getStatus()==CTATProblemStateStatus.incomplete||this.getStatus()==CTATProblemStateStatus.incompleteStartState?this.setStatus(CTATProblemStateStatus.incompleteStartState):this.setStatus(CTATProblemStateStatus.startState);break;case CTATMsgType.START_STATE_END:this.getStatus()==CTATProblemStateStatus.incompleteStartState?this.setStatus(CTATProblemStateStatus.incomplete):
this.setStatus(CTATProblemStateStatus.normalFeedback);break;case CTATMsgType.PROBLEM_RESTORE_END:case CTATMsgType.END_GO_TO_STATE:this.setStatus(CTATProblemStateStatus.normalFeedback);break;case CTATMsgType.BEGIN_GO_TO_STATE:this.setStatus(CTATProblemStateStatus.startState);break;case CTATMsgType.BEGIN_RESTORE:this.getStatus()!=CTATProblemStateStatus.incompleteStartState&&this.setStatus(CTATProblemStateStatus.incomplete)}ctatdebug("CTATProblemStateStatus.transition("+a+", "+b+") old "+d+" => new "+
this.getStatus());return this.getStatus()}};CTATProblemStateStatus.prototype.toString=function(){return"{"+this.getStatus()+"}"};var CTATMessageTank=function(a){function b(a){m.ctatdebug("entering updateProblemSummary()");a&&c.forEach(function(b){if(b.msgType==CTATMsgType.ASSOCIATED_RULES){var c=b.evt;m.ctatdebug("entering updateProblemSummaryWithEvent("+c+")");if(c)if(g&&g.getOutputStatus().isComplete())a.setCompletionStatus(CTATMsgType.CompletionValue[1],!1),a.setShowCounts(!1);else{b=c.getResult();c.getHintRequest()&&(b=CTATExampleTracerLink.HINT_ACTION);var d=CTATMsgType.CompletionValue[0],e=b&&b==CTATExampleTracerLink.CORRECT_ACTION,
f=!1,h=null,l=null,n=null,C=c.getStudentSAI();C&&(h=C.getSelection())&&(l=C.getAction())&&(f="done"==String(h).toLowerCase()&&"buttonpressed"==String(l).toLowerCase());a.setCompletionStatus(d,CTATGlobals.confirmDone);m.ctatdebug("updateProblemSummary() Completion status "+d+", doneStep "+f+", correct "+e);f&&(d=e?(n=C.getInput())&&"-1"!=n?n:CTATMsgType.CompletionValue[1]:CTATMsgType.CompletionValue[0],a.setCompletionStatus(d,!0));d.startsWith(CTATMsgType.CompletionValue[1])?(a.stopTimer(),g&&g.setOutputStatus(CTATProblemStateStatus.complete)):
a.restartTimer();d=c.getActor();m.ctatdebug("updateProblemSummmary() actor "+d+", indicatorObj "+b);!CTATMatcher.isTutorActor(d)&&g.getOutputStatus().countForProblemSummary()&&(c=c.getStepID(),CTATTutorMessageBuilder.isHint(b)?a.addHint(c):CTATTutorMessageBuilder.isCorrect(b)?null!==b&&"undefined"!==typeof b&&a.addCorrect(c):a.addError(c))}}})}function d(a){switch(m.suppressFeedback(a,g.getFeedbackPolicy())){case CTATMsgType.SHOW_ALL_FEEDBACK:return!1;case CTATMsgType.DELAY_FEEDBACK:a=a.msg;var b=
CTATMsgType.getProperty(a,"Selection");m.ctatdebug("CTATMessageTank.addToDelayedFeedbackTank(\n  "+a+") selection "+b);b&&(g.getDelayedFeedback()[b.toLowerCase()]=a);return!0;case CTATMsgType.HIDE_ALL_FEEDBACK:return!0;case CTATMsgType.HIDE_BUT_COMPLETE:return!0;case CTATMsgType.HIDE_BUT_ENFORCE:return!0;default:return!1}}function e(a,b){for(var c=new CTATMessageTank(a,null),d=0;d<b.length;++d){var e=b[d];m.ctatdebug("sendNewTankful() mto["+d+"] msgType "+e.msgType);c.addToMessageTank(e.msgType,e.msg,
e.evt,null)}c.flushMessageTank(null,!0)}CTATBase.call(this,"CTATMessageTank",null);var g=a,c=null,f=null,h=null;a=new Set;a.add("SuccessMessage");a.add("BuggyMessage");a.add("HighlightMsg");a.add("NotDoneMessage");var m=this;this.toString=function(){m.ctatdebug("toString tank "+c);if(!c||1>c.length)return"MessageTank empty";var a="";c.forEach(function(b){a+=b.msgType+", "});return"MessageTank["+a.substr(0,a.length-2)+"]"};this.enqueueToolActionToStudent=function(a,b,c,d){m.ctatdebug("Entering enqueueToolActionToStudent("+
a+", "+b+", "+c+", "+d+")");var e=CTATMsgType.INTERFACE_ACTION;m.ctatdebug("entering enqueueMessageToStudent()");var f=CTATMessage.makeTransactionId();a=new CTATSAI(a,b,c);b=(new CTATTutoringServiceMessageBuilder).createInterfaceActionMessage(f,a);b=CTATMsgType.setProperty(b,CTATTutorMessageBuilder.TRIGGER,"DATA");b=CTATMsgType.setProperty(b,CTATTutorMessageBuilder.SUBTYPE,!d||1>d.length?CTATTutorMessageBuilder.TUTOR_PERFORMED:d);d=new CTATExampleTracerEvent(g,a,CTATMsgType.DEFAULT_TOOL_ACTOR);d.setTransactionID(f);
m.addToMessageTank(e,b,d,a);return f};this.addToMessageTank=function(a,b,d,e){m.ctatdebug("Entering addToMessageTank("+a+", "+b+", "+d+")");if(b){c||(c=[],f={},h={});var g={};g.msgType=a;g.msg=b;g.evt=d;g.sai=e;c.push(g);f[a]=f[a]?f[a]+1:1;a=d.getResult();d.getHintRequest()&&(a=CTATExampleTracerLink.HINT_ACTION);h[a]=h[a]?h[a]+1:1;m.ctatdebug("Exiting addToMessageTank() this "+m.toString())}};this.flushMessageTank=function(a,n){m.ctatdebug("Entering flushMessageTank("+a+", "+n+")");if(c&&!(1>c.length)){b(a);
m.ctatdebug("flushMessageTank() after updateProblemSummary; messageTank.length "+c.length);for(var l=[],x=[],q=0;q<c.length;++q){var v=c[q];if(v.msg){var u=v.msgType,A=v.evt;m.ctatdebug("entering processInterfaceVariables() msgType "+u+", evt "+A);if(u){var y=g?g.getTracer():null;m.ctatdebug("entering processInterfaceVariables() et "+g+", tracer "+y);u=u.toLowerCase();(0===u.indexOf("correct")||0===u.indexOf("interfaceaction"))&&y&&y.addInterfaceVariablesFromEvent(A)}if(!(u=d(v)))if(u=v,A=x,CTATConfiguration.usingFlash()){var C=
y=void 0;if(!(u&&u.sai&&(y=u.sai.getAction())&&(C=CTATSAI.delayedActionRegExp.exec(y)))||3>C.length||1>=C[2])u=!1;else{var r=A.length-1,r=0>r?null:A[r];u.msg=u.msg.replace(y,C[1]);r&&r.timeout==C[2]?r.msgTuples.push(u):A.push({timeout:Number(C[2]),msgTuples:[u]});u=!0}}else u=!1;u||l.push(v.msg)}}m.ctatdebug("flushMessageTank(): msgBundle.length "+l.length+", delayedMsgsBundle.length "+x.length);for(q=0;q<x.length;++q)v=x[q],m.ctatdebug("processDelayedMsgs() delayedMsgs.timeout "+v.timeout+", .msgTuples.length "+
v.msgTuples.length),setTimeout(e,v.timeout,g,v.msgTuples);0<l.length&&(m.ctatdebug("Bottom of flushMessageTank(); to send bundle of length "+l.length+" via "+g),g.sendBundle(l)&&(m.ctatdebug("CTATMessageTank.shouldSaveNow() resultTypes "+h+", msgTypes "+f),(h[CTATExampleTracerLink.CORRECT_ACTION]||h[CTATExampleTracerLink.FIREABLE_BUGGY_ACTION]||f.CorrectAction||f.InterfaceAction||f.UntutoredAction||g.isFeedbackSuppressed()&&f.AssociatedRules)&&g.isSendingSavedMsgsForRestore()&&(CTATGlobalFunctions.isInstructorMode()?
m.ctatdebug("We're in reviewer mode: we shouldn't save as we go"):g.getProblemStateSaver().saveAsYouGo(a))),m.ctatdebug("Exiting flushMessageTank() #CorrectAction "+f.CorrectAction+", #InterfaceAction "+f.InterfaceAction+", #UntutoredAction "+f.UntutoredAction));f=c=null}};this.flushDelayedFeedback=function(){m.ctatdebug("Entering flushDelayedFeedback()");var a=g.getDelayedFeedback(),b;for(b in a)a.hasOwnProperty(b)&&CTAT.ToolTutor.sendToInterface(a[b]);g.clearDelayedFeedback()};this.suppressFeedback=
function(a,b){m.ctatdebug("CTATMessageTank.suppressFeedback("+a.msgType+", "+b+")");var c;b==CTATMsgType.SHOW_ALL_FEEDBACK?(m.ctatdebug("if.1"),c=b):CTATMsgType.hasTextFeedback(a.msgType)?(m.ctatdebug("if.2"),b==CTATMsgType.HIDE_ALL_FEEDBACK||b==CTATMsgType.HIDE_BUT_ENFORCE?(m.ctatdebug("if.2.1"),c=b):(m.ctatdebug("if.2.2"),(c=CTATMsgType.getProperty(a.msg,CTATMsgType.BUGGY_MSG))&&-1!=c.toLowerCase().indexOf(CTATMsgType.NOT_DONE_MSG.toLowerCase())?(m.ctatdebug("if.2.2.1"),c=CTATMsgType.SHOW_ALL_FEEDBACK):
(m.ctatdebug("if.2.2.2"),c=CTATMsgType.HIDE_ALL_FEEDBACK))):CTATMsgType.isCorrectOrIncorrect(a.msgType)?(m.ctatdebug("if.3: "+a.msg),CTATMsgType.isDoneMessage(a.msg)?(m.ctatdebug("if.3.1"),c=CTATMsgType.SHOW_ALL_FEEDBACK):(m.ctatdebug("if.3.2"),c=b)):(m.ctatdebug("if.4"),c=CTATMsgType.SHOW_ALL_FEEDBACK);m.ctatdebug("CTATMessageTank.suppressFeedback() returning "+c);return c}};Object.defineProperty(CTATMessageTank,"END_OF_TRANSACTION",{enumerable:!1,configurable:!1,writable:!1,value:"end_of_transaction"});
CTATMessageTank.prototype=Object.create(CTATBase.prototype);CTATMessageTank.prototype.constructor=CTATMessageTank;"undefined"!==typeof module&&(module.exports=CTATMessageTank);var CTATStep=function(a,b){CTATBase.call(this,"CTATStep",a);var d=0,e=null,g=0,c=0;this.ctatdebug("entering CTATStep("+a+", "+b+") constructor");this.incrementFirstHints=function(){d++};this.incrementNCorrect=function(){g++};this.incrementErrors=function(){c++};this.setLastResult=function(a){e=a};this.getLastResult=function(){return e};this.getResult=function(){return b};this.getNCorrect=function(){return g};this.getNErrors=function(){return c};this.getNFirstHints=function(){return d};this.ctatdebug("in CTATStep("+
a+", "+b+") constructor");switch(b){case CTATStep.StepResult[3]:this.incrementNCorrect();break;case CTATStep.StepResult[1]:this.incrementErrors();break;case CTATStep.StepResult[2]:this.incrementFirstHints()}this.ctatdebug("exiting CTATStep constructor")};Object.defineProperty(CTATStep,"StepResult",{enumerable:!1,configurable:!1,writable:!1,value:["UNTRIED","INCORRECT","HINT","CORRECT"]});CTATStep.prototype=Object.create(CTATBase.prototype);CTATStep.prototype.constructor=CTATStep;
"undefined"!==typeof module&&(module.exports=CTATStep);var CTATProblemSummary=function(a,b,d){CTATBase.call(this,"CTATProblemSummary","");if(null===a||"undefined"===typeof a||1>a.length)throw new CTATExampleTracerException("problemName null or empty");var e=!0,g=Number.MAX_VALUE,c=b,f=d,h=0,m=new Date,l={},n=0,p=0,x=0,q=0,v=0,u=0,A=0,y=CTATMsgType.CompletionValue[0],C=this;this.getCountOnlyLastResults=function(){return f};this.setCountOnlyLastResults=function(a){f=a};this.getTimeElapsed=function(){return h};this.getUniqueErrors=function(){if(!C.getCountOnlyLastResults())return A;
var a=0,b;for(b in l)l[b].getLastResult()==CTATStep.StepResult[1]&&a++;return a};this.getUniqueCorrect=function(){if(!C.getCountOnlyLastResults())return v;var a=0,b;for(b in l)l[b].getLastResult()==CTATStep.StepResult[3]&&a++;return a};this.getUniqueCorrectUnassisted=function(){return u};this.getHintsOnly=function(){var a=0,b;for(b in l)CTATStep.StepResult[2]==l[b].getResult()&&1>l[b].getNErrors()&&++a;return a};this.getErrorsOnly=function(){var a=0,b;for(b in l)CTATStep.StepResult[1]==l[b].getResult()&&
1>l[b].getNFirstHints()&&++a;return a};this.getUniqueSteps=function(){var a=0,b;for(b in l)a++;return a};this.getRequiredSteps=function(){return g==Number.MAX_VALUE?0:g};this.setRequiredSteps=function(a){g=a};this.getCorrect=function(){return n};this.toXML=function(b){var c,d="";c=""+(' ProblemName="'+a+'"');c+=' CompletionStatus="'+y+'"';e&&(c+=' Correct="'+n+'"',c+=' UniqueCorrect="'+C.getUniqueCorrect()+'"',c+=' UniqueCorrectUnassisted="'+u+'"',c+=' Hints="'+p+'"',c+=' UniqueHints="'+q+'"',c+=
' HintsOnly="'+C.getHintsOnly()+'"',c+=' Errors="'+x+'"',c+=' UniqueErrors="'+C.getUniqueErrors()+'"',c+=' ErrorsOnly="'+C.getErrorsOnly()+'"',c+=' UniqueSteps="'+C.getUniqueSteps()+'"',c+=' RequiredSteps="'+C.getRequiredSteps()+'"');c+=' TimeElapsed="'+h+'"';e&&(d=C.getSkills()?C.getSkills().toXML(b):"");return b?"&lt;ProblemSummary"+c+"&gt;"+d+"&lt;/ProblemSummary&gt;":"<ProblemSummary"+c+">"+d+"</ProblemSummary>"};this.getSkills=function(){return c};this.setSkills=function(a){c=a};this.stopTimer=
function(){var a=new Date;h+=a.getTime()-m.getTime();return a};this.restartTimer=function(){m=C.stopTimer();return h};this.addHint=function(a){C.ctatdebug("addHint("+a+")");var b=l[a];null!==b&&"undefined"!==typeof b?(1>b.getNFirstHints()&&++q,b.incrementFirstHints()):(b=new CTATStep(a,CTATStep.StepResult[2]),l[a]=b,q++);p++;b.setLastResult(CTATStep.StepResult[2]);C.ctatdebug("exiting addHint() hint count "+p+", trial "+b)};this.addError=function(a){C.ctatdebug("addError("+a+")");var b=l[a];null!==
b&&"undefined"!==typeof b?(1>b.getNCorrect()&&1>b.getNErrors()&&++A,b.incrementErrors()):(b=new CTATStep(a,CTATStep.StepResult[1]),l[a]=b,A++);x++;b.setLastResult(CTATStep.StepResult[1]);C.ctatdebug("exiting addError() error count "+x+", trial "+b)};this.addCorrect=function(a){var b=l[a];C.ctatdebug("entering addCorrect("+a+") trial "+b);b?(1>b.getNCorrect()&&1>b.getNErrors()&&(++v,1>b.getNFirstHints()&&u++),b.incrementNCorrect()):(C.ctatdebug("to call CTATStep("+a+", StepResult "+CTATStep.StepResult[3]),
b=new CTATStep(a,CTATStep.StepResult[3]),l[a]=b,v++,u++);n++;b.setLastResult(CTATStep.StepResult[3]);C.ctatdebug("exiting addCorrect() correct count "+n+", trial "+b)};this.setShowCounts=function(a){e=a};this.setCompletionStatus=function(a,b){C.ctatdebug("setCompletionStatus("+a+", "+b+") old value "+y);if(!y.startsWith(CTATMsgType.CompletionValue[1])||b)y=a};this.getCompletionStatus=function(){return y}};CTATProblemSummary.prototype=Object.create(CTATBase.prototype);
CTATProblemSummary.prototype.constructor=CTATProblemSummary;"undefined"!==typeof module&&(module.exports=CTATProblemSummary);var CTATSkills=function(a){CTATBase.call(this,"CTATSkills",a?String(a.length):"");var b={},d=0;a.forEach(function(a){b[a.getSkillName().toLowerCase()]=a});var e=new Set,g=this;this.toXML=function(a,d){d||(d="");var c=a?"&lt;Skills&gt;":"<Skills>",e=c.length,f;for(f in b)b.hasOwnProperty(f)&&b[f]&&(c+=d+b[f].toXML(a));c+=d&&c.length>e?"\n":"";return c+(a?"&lt;/Skills&gt;":"</Skills>")};this.updateSkill=function(a,b,h){var c=null,f=g.getSkill(b);null!==f&&"undefined"!==typeof f&&(f.setTransactionNumber(d),
b=h+" "+b,e.has(b)||(e.add(b),f.updatePKnown(a),f.updateHistory(a),f.changeOpportunityCount(1)),CTATExampleTracerSkill.CORRECT.toString().toUpperCase()===a.toString().toUpperCase()&&e["delete"](b),c=f);return c};this.startTransaction=function(){++d};this.getSkill=function(a){var c=null===a||"undefined"===typeof a?null:a.toLowerCase(),c=b[c];g.ctatdebug("CTATSkills.getSkill("+a+") returns "+c);return c};this.getSkillBarVector=function(a,e){var c=[],f;for(f in b)!0===b.hasOwnProperty(f)&&(!0!==e&&b[f].getTransactionNumber()!==
d||c.push(b[f].getSkillBarString(a)));return c};this.setExternallyDefined=function(a){};this.setVersion=function(a){for(var c in b)!0===b.hasOwnProperty(c)&&b[c].setVersion(a)}};CTATSkills.prototype=Object.create(CTATBase.prototype);CTATSkills.prototype.constructor=CTATSkills;"undefined"!==typeof module&&(module.exports=CTATSkills);var ProblemStateSaver=function(a){CTATBase.call(this,"ProblemStateSaver",a);this.tracer=a;var b=this,d=[],e=null,g="",c="",f=0;this.saveAsYouGo=function(e){b.ctatdebug("saveAsYouGo() curriculum_service_url "+g+", tracer "+a);if(a&&e){var h={};h.session_id=a.getSessionID();h.authenticity_token=c;h.summary=e.toXML(!1);h.problem_state=ProblemStateSaver.MESSAGES_TAG;for(var l=0;l<d.length;++l)d[l]&&(h.problem_state+=d[l]);h.problem_state+=ProblemStateSaver.MESSAGES_TAG.replace("<","</");++f;b.ctatdebug("saveAsYouGo["+
f+"] to send problem_state length "+h.problem_state.length);CTATLMS.saveProblemState&&CTATLMS.saveProblemState(h);CTATLMS.gradeStudent&&CTATLMS.gradeStudent(parseInt(e.getCorrect()),parseInt(e.getRequiredSteps()));CTATLMS.commit&&CTATLMS.commit()}else b.ctatdebug("Error: no tracer or no problem summary available, aborting save as you go")};this.setCurriculumServiceUrl=function(a){b.ctatdebug("ProblemStateSaver.setCurriculumServiceUrl() old "+g+", new "+a);g=a};this.setAuthenticityToken=function(a){b.ctatdebug("ProblemStateSaver.setAuthenticityToken() old "+
c+", new "+a);a&&(c=a)};this.getStepToIndexMap=function(){null===e&&(e=new Map);return e};this.getProblemState=function(){return d};this.getProblemStateLength=function(){return d.length}};ProblemStateSaver.prototype=Object.create(CTATBase.prototype);ProblemStateSaver.prototype.constructor=ProblemStateSaver;
ProblemStateSaver.prototype.replaceInProblemState=function(a,b,d,e){this.ctatdebug("PSS.replaceInProblemState("+CTATMsgType.getMessageType(a)+", "+d+", "+e+")");if(b.mustSaveForRestore()&&ProblemStateSaver.mustSaveForRestore(CTATMsgType.getMessageType(a))){b=this.getProblemState();a=this.editForProblemState(a);if(!e){d=ProblemStateSaver.makeStepKey(d);e=this.getStepToIndexMap();this.ctatdebug("PSS.replaceInProblemState() stepKey"+d+", index "+e.get(d)+")");if(e.has(d)){var g=e.get(d);b[g]=null}e.set(d,
b.length)}b.push(a)}};ProblemStateSaver.prototype.appendToProblemState=function(a,b,d){if(d||b.mustSaveForRestore()&&ProblemStateSaver.mustSaveForRestore(CTATMsgType.getMessageType(a)))b=this.getProblemState(),a=this.editForProblemState(a),b.push(a)};Object.defineProperty(ProblemStateSaver,"XML_PROLOGUE",{enumerable:!1,configurable:!1,writable:!1,value:/<\? *[xX][mM][lL][^?]*\?>/});Object.defineProperty(ProblemStateSaver,"LEADING_WHITE_SPACE",{enumerable:!1,configurable:!1,writable:!1,value:/^\s+</m});
Object.defineProperty(ProblemStateSaver,"MESSAGES_TAG",{enumerable:!1,configurable:!1,writable:!1,value:"<messages>"});
ProblemStateSaver.prototype.editForProblemState=function(a){var b=a.split(ProblemStateSaver.XML_PROLOGUE),d=b[0],e;for(e=1;e<b.length;++e)d+=b[e];b=d.split(ProblemStateSaver.LEADING_WHITE_SPACE);d=b[0];for(e=1;e<b.length;++e)d.endsWith("\n")&&(d=d.slice(0,-1)),d.endsWith("\r")&&(d=d.slice(0,-1)),d+="<"+b[e];this.ctatdebug("ProblemStateSaver.editForProblemState("+a+")\n returns "+d);return d};ProblemStateSaver.omitFromRestore={init:!1};
ProblemStateSaver.mustSaveForRestore=function(a){ProblemStateSaver.omitFromRestore.init||(ProblemStateSaver.omitFromRestore[CTATMsgType.ASSOCIATED_RULES.toLowerCase()]=!0,ProblemStateSaver.omitFromRestore[CTATMsgType.BUGGY_MESSAGE.toLowerCase()]=!0,ProblemStateSaver.omitFromRestore[CTATMsgType.CORRECT_ACTION.toLowerCase()]=!0,ProblemStateSaver.omitFromRestore[CTATMsgType.INCORRECT_ACTION.toLowerCase()]=!0,ProblemStateSaver.omitFromRestore[CTATMsgType.INTERFACE_IDENTIFICATION.toLowerCase()]=!0,ProblemStateSaver.omitFromRestore[CTATMsgType.PROBLEM_RESTORE_END.toLowerCase()]=
!0,ProblemStateSaver.omitFromRestore[CTATMsgType.PROBLEM_SUMMARY_REQUEST.toLowerCase()]=!0,ProblemStateSaver.omitFromRestore[CTATMsgType.PROBLEM_SUMMARY_RESPONSE.toLowerCase()]=!0,ProblemStateSaver.omitFromRestore[CTATMsgType.SET_PREFERENCES.toLowerCase()]=!0,ProblemStateSaver.omitFromRestore[CTATMsgType.SHOW_HINTS_MESSAGE.toLowerCase()]=!0,ProblemStateSaver.omitFromRestore[CTATMsgType.SUCCESS_MESSAGE.toLowerCase()]=!0,ProblemStateSaver.omitFromRestore.init=!0);return a&&ProblemStateSaver.omitFromRestore[a.toLowerCase()]?
!1:!0};ProblemStateSaver.prototype.forwardToInterface=function(a,b,d){var e=CTATMsgType.getMessageType(a);this.ctatdebug("PSS.forwardToInterface("+e+") problemState.length "+this.getProblemState().length+", outputStatus "+d);if(d&&d.isOutputSuppressed())return!1;CTAT.ToolTutor.sendToInterface(a,b);d&&d.transition(CTATMsgType.getMessageType(a));return!0};ProblemStateSaver.prototype.processMessage=function(a){this.ctatdebug("ProblemStateSaver.processMessage("+a+")")};
ProblemStateSaver.makeStepKey=function(a){if(!a)return" ";var b=a.getSelection();a=a.getAction();b="string"!=typeof b||1>b.length?" ":b;a="string"!=typeof a||1>a.length?" ":a;return b+" "+a};"undefined"!==typeof module&&(module.exports=ProblemStateSaver);var ProblemStateRestorer=function(a){CTATBase.call(this,"ProblemStateRestorer",a);var b=this,d=null;this.getRestoreProblemUrl=function(){return d};this.setRestoreProblemUrl=function(a){d=a};this.toString=function(){return"["+d+": 0]"};this.retrieveMessages=function(d){console.log("retrieveMessages("+d+", ...)");d.mustRetrieveProblemState()?(a.stopWorking(1),CTATLMS.getProblemState&&CTATLMS.getProblemState(b.process)):console.log("Retrieval status indicates that we should not retrieve")};this.process=
function(d){a.getOutputStatus().transition(CTATMsgType.BEGIN_RESTORE);if("string"!=typeof d)console.log("ProblemStateRestorer.process() called with parameter not a string: ",typeof d),a.enqueueForRestore([]);else{if(d.slice(0,ProblemStateSaver.MESSAGES_TAG.length)!=ProblemStateSaver.MESSAGES_TAG){console.log("ProblemStateRestorer.process() called with unrecognized string, to try htmlDecode(): ",d.slice(0,20));var e=d;d=(new DOMParser).parseFromString(e,"text/html").documentElement.textContent;if(d.slice(0,
ProblemStateSaver.MESSAGES_TAG.length)!=ProblemStateSaver.MESSAGES_TAG){console.log("ProblemStateRestorer.process() called with unrecognized string: ",d.slice(0,20));a.enqueueForRestore([]);return}}e=[];if("string"==typeof d&&(d=d.split(/<\/?messages>/),b.ctatdebug("msgsArr.length "+d.length+", msgsArr[1].length "+(d[1]?d[1].length:-1)),!(2>d.length))){d=d[1].split("<message>");b.ctatdebug("problemStateArr.length "+d.length);for(var c=0,f=!1,h=1;h<d.length;++h){var m="<message>"+d[h],l=CTATMsgType.getMessageType(m);
CTATMsgType.STATE_GRAPH==l?f=!0:CTATMsgType.START_STATE_END==l?f=!1:f?c++:CTATMsgType.INTERFACE_ACTION==l&&h==d.length-1&&CTATMsgType.isDoneMessage(m)&&a.getOutputStatus().isComplete()||(a.getProblemStateSaver().appendToProblemState(m,null,!0),e.push(m));b.ctatdebug("problemStateArr["+h+"] "+(f?"omit ":"keep ")+l+" omitted "+c+" kept "+e.length)}}a.enqueueForRestore(e)}}};ProblemStateRestorer.prototype=Object.create(CTATBase.prototype);ProblemStateRestorer.prototype.constructor=ProblemStateRestorer;var SCORMProblemSummary=function(){CTATBase.call(this,"SCORMProblemSummary","")};Object.defineProperty(SCORMProblemSummary,"LESSON_STATUS",{enumerable:!1,configurable:!1,writable:!1,value:"cmi.core.lesson_status"});Object.defineProperty(SCORMProblemSummary,"RAW_SCORE",{enumerable:!1,configurable:!1,writable:!1,value:"cmi.core.score.raw"});Object.defineProperty(SCORMProblemSummary,"EXIT",{enumerable:!1,configurable:!1,writable:!1,value:"cmi.core.exit"});
Object.defineProperty(SCORMProblemSummary,"SESSION_TIME",{enumerable:!1,configurable:!1,writable:!1,value:"cmi.core.session_time"});Object.defineProperty(SCORMProblemSummary,"ExitReason",{enumerable:!1,configurable:!1,writable:!1,value:{timeout:"time-out",suspend:"suspend",logout:"logout",done:" "}});
Object.defineProperty(SCORMProblemSummary,"LessonStatus",{enumerable:!1,configurable:!1,writable:!1,value:{passed:"passed",completed:"completed",failed:"failed",incomplete:"incomplete",browsed:"browsed",notAttempted:"not attempted"}});SCORMProblemSummary.getLessonStatus=function(a){return CTATMsgType.CompletionValue[1]==a.getCompletionStatus()?SCORMProblemSummary.LessonStatus.completed:SCORMProblemSummary.LessonStatus.incomplete};
SCORMProblemSummary.getRawScore=function(a){var b=a.getUniqueSteps();return 0==b?0:parseInt(100*(a.getUniqueCorrectUnassisted()/b+.005))};SCORMProblemSummary.getExitReason=function(a){return SCORMProblemSummary.ExitReason.suspend};SCORMProblemSummary.getSessionTime=function(a){var b=a.getTimeElapsed();a=b%1E3;var b=(b-a)/1E3,d=b/60,e=d/60,b=b%60;9999<e&&(e=9999,d=b=99,a=990);return sprintf("%04d:%02d:%02d.%02d",e,d,b,a/10)};
SCORMProblemSummary.getProblemSummaryElements=function(a){var b=sprintf("<%s>%s</%s>",SCORMProblemSummary.LESSON_STATUS,SCORMProblemSummary.getLessonStatus(a),SCORMProblemSummary.LESSON_STATUS),d=sprintf("<%s>%d</%s>",SCORMProblemSummary.RAW_SCORE,SCORMProblemSummary.getRawScore(a),SCORMProblemSummary.RAW_SCORE),e=sprintf("<%s>%s</%s>",SCORMProblemSummary.EXIT,SCORMProblemSummary.getExitReason(a),SCORMProblemSummary.EXIT);a=sprintf("<%s>%s</%s>",SCORMProblemSummary.SESSION_TIME,SCORMProblemSummary.getSessionTime(a),
SCORMProblemSummary.SESSION_TIME);return b+d+e+a};CTATMsgType.prototype=Object.create(CTATBase.prototype);CTATMsgType.prototype.constructor=SCORMProblemSummary;"undefined"!==typeof module&&(module.exports=SCORMProblemSummary);var CTATExampleTracer=function(){function a(){return"example"===C&&J&&J.getModelInitialized()||"rule"===C&&B&&B.getModelInitialized()}function b(a,b){b?V|=1<<a:(V&=-65537>>16-a,c())}function d(a){if(r.isFeedbackSuppressed()){var b=new CTATSAI("hint","SetVisible","false"),b=(new CTATTutoringServiceMessageBuilder).createInterfaceActionMessage("dummyTransactionID",b);a.push(b)}}function e(){return"<message><verb>NotePropertySet</verb><properties><MessageType>"+CTATMsgType.INTERFACE_REBOOT+"</MessageType></properties></message>"}
function g(a){a.unshift(e());r.ctatdebug("sendStartStateMessageStrings(): "+a.length+" elts, "+F);r.sendBundle(a)}function c(){r.ctatdebug("workTheQueue() working "+V+", workQueue.length "+T.length+", restoreQueue.length "+Q.length);if(0==V)for(;0!=(V=0<T.length|(0<Q.length)<<1);){var a,b=!1;0<Q.length?(X=1,a=Q.shift(),b=!0):(X=0,a=T.shift());if(!f(a,b)){r.ctatdebug("workTheQueue() suspending workQueue.length "+T.length+", restoreQueue.length "+Q.length);r.stopWorking(b?1:0);break}r.ctatdebug("workTheQueue() bottom workQueue.length "+
T.length+", restoreQueue.length "+Q.length)}}function f(b,c){r.lastMessageAsString=b;var d=r.lastMessageAsXML=(new CTATXML).parseXML(b),f=r.lastMessage=new CTATMessage(d),g=f.getMessageType();r.ctatdebug("CTATExampleTracer.handleMessageFromInterface(msgType "+g+")");switch(g){case CTATMsgType.SET_PREFERENCES:g=w;r.ctatdebug("handleSetPreferences ()");U=f.getProperty("problem_name");r.ctatdebug("SetPreferences.problem_name = "+U);f=g.getElementChildren(g.getElementChildren(d)[1]);for(d=0;d<f.length;d++){var h=
g.getElementName(f[d]);r.ctatdebug("SetPreferences eltName "+h);if(h)switch(h.toLowerCase()){case "source_id":P=g.getNodeTextValue(f[d]);break;case "question_file":I=g.getNodeTextValue(f[d]);break;case "skills":r.ctatdebug(" parseSkills("+f[d]+")");for(var h=[],l=w.getElementChildren(f[d]),m=0;m<l.length;m++){var q=w.getElementName(l[m]);if(q&&"skill"==q.toLowerCase()){var u=w.getElementAttr(l[m],"name");if(u&&""!=u.trim()){var q=w.getElementAttr(l[m],"label"),v=w.getElementAttr(l[m],"pSlip"),Z=w.getElementAttr(l[m],
"description"),x=w.getElementAttr(l[m],"pKnown"),y=w.getElementAttr(l[m],"category"),A=w.getElementAttr(l[m],"pLearn"),D=w.getElementAttr(l[m],"pGuess"),R=w.getElementAttr(l[m],"history"),u=new CTATExampleTracerSkill(y,u,D,x,v,A,R);u.setLabel(q);u.setDescription(Z);h.push(u)}}}r.getProblemSummary().setSkills(new CTATSkills(h));break;case "problem_state_status":F.transition(CTATMsgType.SET_PREFERENCES,g.getNodeTextValue(f[d]));N||(N=new ProblemStateRestorer(r));r.ctatdebug("SetPreferences problemStateRestorer "+
N);break;case "curriculum_service_url":CTATConfiguration.set("curriculum_service_url",g.getNodeTextValue(f[d]));break;case "restore_problem_url":N||(N=new ProblemStateRestorer(r));r.ctatdebug("SetPreferences problemStateRestorer "+N);CTATConfiguration.set("restoreProblemUrl",g.getNodeTextValue(f[d]));break;case "session_id":Y=g.getNodeTextValue(f[d]);break;case "authenticity_token":S.setAuthenticityToken(g.getNodeTextValue(f[d]))}}r.ctatdebug("questionFile "+I+", outputStatus "+F+", problemStateRestorer "+
N);f="undefined"!=typeof sessionStorage&&sessionStorage?sessionStorage.getItem("Go-To-State"):null;null!=f&&(sessionStorage.removeItem("Go-To-State"),f=Number(f),!Number.isSafeInteger(f)||0>=f||(O=f,F.transition(CTATMsgType.BEGIN_GO_TO_STATE,null)));r.ctatdebug("outputStatus "+F+", problemStateRestorer "+N);W.retrieveProblemFile(I,g,r);N&&N.retrieveMessages(F);return!1;case CTATMsgType.INTERFACE_IDENTIFICATION:return!0;case CTATMsgType.UNTUTORED_ACTION:return c&&r.sendBundle([b]),g=w,f=f.getTransactionID(),
r.ctatdebug("UntutoredAction ("+b+"), getTransactionID "+f),S.appendToProblemState(b,r.getOutputStatus(),!1),a()&&r.setVariablesFromSAI(d,g),!0;case CTATMsgType.INTERFACE_ACTION:c&&r.sendBundle([b]);r.ctatdebug("Interface action received.");g=f.getTransactionID();if(a())if(r.messageTank=new CTATMessageTank(r),r.ctatdebug("MessageTank "+r.messageTank),r.ctatdebug("InterfaceAction ("+b+"), getTransactionID "+g),h=f.getSelectionArray().slice(0),d=f.getActionArray().slice(0),r.ctatdebug("selectionArray "+
h+", message.getSelectionArray() "+f.getSelectionArray()),h[0]&&"_tutor"==h[0].toLowerCase())r.ctatdebug("handleInterfaceAction tutor cmd SAI "+f.getSAI()+";"),d[0]&&"function"===typeof r[d[0]]&&(g=f.getSAI().getInput(),r[d[0]](g)),g=!0;else if(!h[0]||"hint"!=h[0].toLowerCase()&&"help"!=h[0].toLowerCase())r.ctatdebug("calling doNewTrace("+C+", "+f.getSAI()+") sai.selectionArray "+f.getSAI().getSelectionArray()+" msg.selectionArray "+f.getSelectionArray()),g=p(C,[null,f.getSAI(),"student",!0,g,b]);
else{r.ctatdebug("handleInterfaceAction() hint request: hintPolicy "+K+", errorSAI "+z);K===CTATHintPolicyEnum.HINTS_UNBIASED?(1<h.length&&(h[1]=""),1<d.length&&(d[1]="")):K!==CTATHintPolicyEnum.HINTS_BIASED_BY_CURRENT_SELECTION_ONLY&&(K===CTATHintPolicyEnum.HINTS_BIASED_BY_PRIOR_ERROR_ONLY?z&&z.getSelection()?(h.splice(1,0,z.getSelection()),d.splice(1,0,"PreviousFocus")):(h[1]="",d[1]=""):K===CTATHintPolicyEnum.HINTS_BIASED_BY_ALL&&z&&z.getSelection()&&(h.splice(1,0,z.getSelection()),d[1]=CTATMsgType.PREVIOUS_FOCUS.toString()));
r.startSkillTransaction();r.ctatdebug("ExampleTracer.doHint, givenSelection = "+h);l=f=null;if(d&&1<d.length&&d[1].toString()===CTATMsgType.PREVIOUS_FOCUS.toString()&&h&&1<h.length&&h[1]&&"null"!==h[1].toString()&&(f=h[1]!==h[0]?[h[1]]:null,2<d.length))for(r.ctatdebug("CTATExampleTracer --\x3e in doHint inner if condition"),l=[],h=2;h<d.length;h++)r.ctatdebug("CTATExampleTracer --\x3e in doHint for loop "+h),l.push(d[h]);r.ctatdebug("CTATExampleTracer --\x3e in doHint out of if condition");f=new CTATSAI(f,
l,null);d=new CTATExampleTracerEvent(r,f,"student");d.setHintRequest(!0);d.setWantReportableHints(!0);r.ctatdebug("CTATExampleTracerTracer --\x3e in doHint result: "+d);"example"===C?(f=J.doHint(d),g=n(d,g,f)):g=B.doHint(d,g,n)?d:null}else g=!1;return g;case CTATMsgType.PROBLEM_SUMMARY_REQUEST:return g=r.getProblemSummary(),r.ctatdebug("CTATExampleTracer.ProblemSummaryRequest getProblemSummary() "+r.getProblemSummary()),f="<message><verb>NotePropertySet</verb><properties><MessageType>"+CTATMsgType.PROBLEM_SUMMARY_RESPONSE+
"</MessageType>",f+=SCORMProblemSummary.getProblemSummaryElements(g),f+="<ProblemSummary>"+g.toXML(!0)+"</ProblemSummary>",f+="<end_of_transaction>true</end_of_transaction></properties></message>",d=[],d.push(f),r.sendBundle(d),F.transition(CTATMsgType.PROBLEM_SUMMARY_RESPONSE,g.getCompletionStatus()),r.ctatdebug("CTATExampleTracer.handleProblemSummaryRequest() sent result '"+f+"';"),!0;case CTATMsgType.START_STATE_END:return F.transition(CTATMsgType.START_STATE_END),!0;case CTATMsgType.PROBLEM_RESTORE_END:return F.transition(CTATMsgType.PROBLEM_RESTORE_END),
g=r.getSkillBarVector(),f=[],d=new CTATTutorMessageBuilder,f.push(d.createMessage(CTATMsgType.PROBLEM_RESTORE_END,g?{Skills:g}:null)),r.sendBundle(f),!0;case CTATMsgType.GO_TO_STATE:return g=f.getProperty("nodeID"),0>g||!sessionStorage||!sessionStorage.setItem?g=!0:(sessionStorage.setItem("Go-To-State",String(g)),CTAT.ToolTutor.reboot("Go-To-State "+g+" from CTATExampleTracer")||(f=[],f.push(e()),r.ctatdebug("CTATET.handleGoToState() saved nodeID "+g+"; sending to interface\n"+f),r.sendBundle(f)),
g=!1),g;default:return console.log("CTATExampleTracer.handleMessageFromInterface(restoring "+c+") "+(c?"sending":"unprocessed")+" message, type "+g+"\n  "+b),c&&r.sendBundle([b]),!0}}function h(a,b,c){var d={tutorAdvice:null,msg:null,msgType:null};if(a.isBuggyResult())return d.tutorAdvice=a.getSuccessOrBuggyMsg(),d.tutorAdvice&&d.tutorAdvice.trim()?(d.msg=c.createBuggyMessage(a.getTransactionID(),d.tutorAdvice),d.msgType="BuggyMessage"):d.tutorAdvice=null,d;r.ctatdebug("CTATET.createBuggyMessage() past getReportableLink()");
if(a.isDoneStepFailed())return d.tutorAdvice=CTATMsgType.NOT_DONE_MSG,d.msg=c.createBuggyMessage(a.getTransactionID(),d.tutorAdvice),d.msgType="BuggyMessage",d;r.ctatdebug("CTATET.createBuggyMessage() past isDoneStepFailed()");var e=b&&b.getTutorSAI()?b.getTutorSAI().getSelection():null,e=e&&""!==e.trim()?e:null,f=a.getStudentSAI()?a.getStudentSAI().getSelection():null,f=f&&""!==f.trim()?f:null;r.ctatdebug("CTATET.createBuggyMessage() past hintSelection0 "+e+", studentSelection0 "+f);if(a.getResult()==
CTATExampleTracerLink.NO_MODEL&&a.isOutOfOrder()&&e&&e!=f)return r.ctatdebug("CTATET.createBuggyMessage() to create out of order"),r.isHighlightRightSelection()?(d.tutorAdvice=r.getOutOfOrderMessage(),d.msg=c.createHighlightWidgetMessage(e,b.getTutorSAI().getAction(),d.tutorAdvice,a.getTransactionID()),d.msgType="HighlightMsg",r.ctatdebug("createBuggyMessage() out of order with highlight; rtn: "+d)):(d.tutorAdvice=CTATGlobals.languageManager.getString("OUTOFORDER"),d.msg=c.createBuggyMessage(a.getTransactionID,
d.tutorAdvice),d.msgType="BuggyMessage",r.ctatdebug("createBuggyMessage() out of order without highlight; rtn: "+d)),d;if(b="example"===C?E.getDefaultBuggyMsg():B.getDefaultBuggyMsg())return d.tutorAdvice=b,d.msg=c.createBuggyMessage(a.getTransactionID,d.tutorAdvice),d.msgType="BuggyMessage",r.ctatdebug("createBuggyMessage() default buggy msg: "+d),d;r.ctatdebug("createBuggyMessage() no buggy msg: "+d);return d}function m(a,b,c,d){r.ctatdebug("checkForTutorAction("+a+", "+b+", "+c+", "+d+")");var e=
[];e[0]=l(E.getNode(a),!0);e[1]=l(E.getNode(b),!1);r.ctatdebug("checkForTutorAction() links[0] "+e[0]+", links[1] "+e[1]+";");a=0;e[0]===e[1]?e[1]=null:e[0]||(a=1);b=null;r.messageTank||(r.messageTank=new CTATMessageTank(r,null));for(;a<e.length&&e[a];++a)if(b=CTATGuid.guid(),c){var f=e[a].getEvaluatedInput(c,d.getReportableVariableTable()),g=e[a].getDefaultSAI().clone();g.setInput(f);b=p("example",[e[a],g,e[a].getActor(),!0,b])}else b=p("example",[e[a],e[a].getDefaultSAI(),e[a].getActor(),!0,b]);
r.ctatdebug("checkForTutorAction() returning "+b+";");return b}function l(a,b){if(null===a||"undefined"===typeof a||1!==a.getCorrectOutDegree())return null;var c=null;a.getCorrectOutLinks().forEach(function(a){null===c&&a.isTutorPerformed(b)&&0<a.getMaxTraversals()&&(c=a)});return c}function n(a,b,c){c=a.getReportableHints();if(!c||1>c.length)c=[],c.push(CTATGlobals.languageManager.getString("NO_HINT_AVAILABLE"));var d=a.getAssociatedSkills()||[],e=a.getStepID();r.updateSkills(CTATExampleTracerSkill.HINT,
d,e,a.getActor());r.ctatdebug("Before building hint message: tutorSAI "+a.getTutorSAI()+", hints "+c+", edge # "+e);d=(new CTATTutorMessageBuilder).createHintMessage(c,a.getTutorSAI(),e,b);r.messageTank.addToMessageTank(CTATMsgType.SHOW_HINTS_MESSAGE,d,a,null);b=(new CTATTutorMessageBuilder).createAssociatedRulesMessageForHint(c,a.getTutorSAI(),v(CTATMsgType.DEFAULT_STUDENT_ACTOR),r.getSkillBarVector(!0),e,b,a.getCustomFields());r.messageTank.addToMessageTank(CTATMsgType.ASSOCIATED_RULES,b,a,null);
b=r.getProblemSummary(a.getReportableInterpretation());r.messageTank.flushMessageTank(b,!0);r.ctatdebug("handleInterfaceAction() sent hint result "+a);z=null;r.restartWorking();return a}function p(a,b){r.ctatdebug("doNewTrace ( "+a+", "+b+" )");var c=b.shift(),d=b.shift(),e=b.shift(),f=b.shift(),g=b.shift(),h=b.shift(),l=new CTATExampleTracerEvent(r,d,e),m=g;if(r.getOutputStatus().isComplete()&&d.isDone())return l.setResult(CTATExampleTracerLink.CORRECT_ACTION),l.setTraceOutcome(CTATExampleTracerLink.CORRECT_ACTION),
l.setTutorSAI(d),l.setTransactionID(m),c=u(l,d,e,!1),r.ctatdebug("doNewTrace("+d+", "+e+", "+f+", "+m+") returns "+c),c;r.startSkillTransaction();g=function(){l.setTransactionID(m);var c=u(l,d,e,f);r.ctatdebug("doNewTrace( "+a+", "+b+" ) returns "+c);r.restartWorking();return c};switch(a){case "example":return m=x(c,l,h,m),g();case "rule":f=!1,q(l,h,g)}return null}function x(a,b,c,d){r.ctatdebug("doNewExampleTrace (link "+a+", result "+b+", origMsgTxt "+c+", transactionID "+d);a&&b.addPreloadedLinkMatch(a);
var e=J.evaluate(b);r.ctatdebug("Evaluate returned : "+e+", given link "+a+", result "+b);a?(r.ctatdebug("result.getTutorSelection() "+b.getTutorSelection()),r.ctatdebug("result.getTutorAction() "+b.getTutorAction()),r.ctatdebug("result.getTutorInput() "+b.getTutorInput()),r.ctatdebug("typeof(messageTank) "+typeof messageTank),a=b.getTutorSelection(),c=b.getTutorAction(),b=b.getTutorInput(),d=r.messageTank.enqueueToolActionToStudent(a,c,b,CTATTutorMessageBuilder.TUTOR_PERFORMED)):r.isFeedbackSuppressed()?
S.replaceInProblemState(c,r.getOutputStatus(),b.getStudentSAI(),E.getFeedbackPolicy()==CTATMsgType.HIDE_BUT_ENFORCE):b.getResult()!=CTATExampleTracerLink.CORRECT_ACTION&&b.getResult()!=CTATExampleTracerLink.FIREABLE_BUGGY_ACTION||S.appendToProblemState(c,r.getOutputStatus(),!1);return d}function q(a,b,c){r.ctatdebug("DoNewRuleTrace( "+a+", "+b+" )");B.evaluate(a,c)}function v(a){return"undefined"!=typeof a&&a&&0<=a.toString().toLowerCase().indexOf("tutor")?"Tutor":"Student"}function u(a,b,c,d){r.ctatdebug("finishNewExampleTrace("+
a+", "+b+", "+c+", "+d+")");var e=a.getStudentSAI(),f=a.getTutorSAI(),g=a.getTransactionID(),l=new CTATTutorMessageBuilder,n=a.getReportableLink()||null,p=null;b=a.getAssociatedSkills()||[];var q=function(){r.lastResult=a;var b=r.getProblemSummary(a.getReportableInterpretation());r.ctatdebug("finishNewExampleTrace() to flushMessageTank");r.messageTank.flushMessageTank(b,!0);r.ctatdebug("finishNewExampleTrace() sent result "+a.getResult()+", studentSAI "+e);return a};if(a.isSolverResult())return a.getResult(),
q();if(a.getResult()===CTATExampleTracerLink.CORRECT_ACTION){CTATMsgType.UNGRADED_TOOL_ACTOR.toUpperCase()!=c.toUpperCase()&&r.messageTank.addToMessageTank(CTATMsgType.CORRECT_ACTION,l.createCorrectActionMessage(g,f),a,f);r.updateSkills(CTATExampleTracerSkill.CORRECT,b,a.getStepID(),c);b=a.getSuccessOrBuggyMsg();var u=l.createAssociatedRulesMessageForAction(a.getResult(),f,v(c),e,r.getSkillBarVector(!0,c),n?n.getUniqueID():-1,g,b,a.isOutOfOrder(),a.getCustomFields(),a.getTraceOutcome());r.messageTank.addToMessageTank(CTATMsgType.ASSOCIATED_RULES,
u,a,f);r.ctatdebug("finishNewExampleTrace() successMsg "+b);b&&r.messageTank.addToMessageTank("SuccessMessage",l.createSuccessMessage(g,b),a,null);z=null;d&&(p=m(n?n.getNextNode():null,J.findCurrentState(!1,!1),r.lastMessage?r.lastMessage.getSAI():null,a))&&(a=p);return q()}r.messageTank.addToMessageTank(CTATMsgType.INCORRECT_ACTION,l.createInCorrectActionMessage(g,a.getInterpolatedSAI()),a,null);r.ctatdebug("about to do silent traceForHint("+e+"), selectionArray "+e.getSelectionArray());var w=r.lastSilentHintResult=
new CTATExampleTracerEvent(r,e,c);w.setHintRequest(!0);b=function(){var b=a.getAssociatedSkills()||[],u=a.getStepID()||"";r.updateSkills(CTATExampleTracerSkill.INCORRECT,b,u,c);f=a.getTutorSAI();b=h(a,w,l);r.ctatdebug("createBuggyMessage() tutorAdvice: "+b.tutorAdvice+";\n  msg "+b.msg);u=l.createAssociatedRulesMessageForAction(a.getResult(),f&&f.getSelection()?f:e,v(c),e,r.getSkillBarVector(!0,c),u,g,b.tutorAdvice,a.isOutOfOrder(),a.getCustomFields(),a.getTraceOutcome());r.messageTank.addToMessageTank(CTATMsgType.ASSOCIATED_RULES,
u,a,null);b.msg&&r.messageTank.addToMessageTank(b.msgType,b.msg,a);z=e;d&&CTATExampleTracerLink.FIREABLE_BUGGY_ACTION==a.getResult()?(p=m(n?n.getNextNode():null,J.findCurrentState(!1,!1),r.lastMessage?r.lastMessage.getSAI():null,a))&&(a=p):a.isDoneStepFailed()&&r.messageTank.flushDelayedFeedback();return q()};if("example"===C)return A(a,w),b();"rule"===C&&y(a,w,b)}function A(a,b){var c=J.traceForHint(b);r.ctatdebug("silent hint result: "+b+"; hintLink "+c);c||(c=J.getBestNextLink(!1,b),r.ctatdebug("getBestNextLink result: "+
b+"; hintLink "+c));c&&((c=b.getTutorSAI())&&c.getSelection()&&a.setTutorSAI(c),b.getStepID(),a.setStepID(b.getStepID()),a.setAssociatedSkills(b.getAssociatedSkills()))}function y(a,b,c){B.checkOutOfOrder(b,function(d){d&&(b.setTutorSAI(a.getTutorSAI()),a.setOutOfOrder(!0));c()})}CTATBase.call(this,"CTATExampleTracer","tracer");var C=null,r=this,I=null,J,B,D=null,H,E,w=new CTATXML;new XMLSerializer;var z=null,K,M=!0,L=!1,G=null,U=null,P=null,S=new ProblemStateSaver(r);S.setAuthenticityToken(CTATCommLibrary.getAuthenticityToken());
var N=null,X=0,F=new CTATProblemStateStatus,Q=[],T=[],V=0,Y="",O=-1,ba=null;r.ctatdebug("CTATExampleTracer constructor outputStatus="+F);this.messageTank=this.lastSilentHintResult=this.lastResult=this.lastMessage=this.lastMessageAsXML=this.lastMessageAsString=null;var W=new CTATCommLibrary;this.receiveFromInterface=function(a){r.ctatdebug("CTATExampleTracer.receiveFromInterface() \n  "+a);T.push(a);c()};this.setVariablesFromSAI=function(a,b){var c=CTATMsgType.getSAIArraysFromElement(a,b);switch(C){case "example":r.getTracer()&&
r.getTracer().addInterfaceVariables(c.selection,c.input);break;case "rule":B.handleUntutoredAction(c)}};this.traceLinks=function(a){for(var b=[],c=r.getTracer().getBestInterpretation(),d=0;d<a.length&&null!==a[d];++d)c.getTraversalCount(a[d])<a[d].getMinTraversals()&&(r.messageTank=new CTATMessageTank(r,null),b.push(p("example",[a[d],a[d].getDefaultSAI(),a[d].getActor(),!1,null])),r.ctatdebug("traceLinks["+d+"] result "+b[d]));return b};this.enqueueForRestore=function(b){r.ctatdebug("enqueueForRestore() tracerReady "+
a()+": got "+(b?b.length:-1)+" message elements");null==D&&null!=b&&(D=b);a()&&null!=D&&(Q=Q.concat(D),b=(new CTATTutorMessageBuilder).createMessage(CTATMsgType.PROBLEM_RESTORE_END,null),Q.push(b),X=1,r.startWorking(),D=null)};this.restartWorking=function(){"rule"===C&&b(X,!1)};this.startWorking=function(){b(X,!1)};this.stopWorking=function(a){b("undefined"!=typeof a?a:X,!0)};this.goToStartState=function(){var a=E.getStudentStartsHereNode()||E.getStartNode();a?r.goToState(a.getNodeName()):console.trace("goToStartState() did not find start node")};
this.goToState=function(a){a=(a=E.findNode(a))?a.getNodeID():-1;0<a&&r.receiveFromInterface("<message><verb>NotePropertySet</verb><properties><MessageType>"+CTATMsgType.GO_TO_STATE+"</MessageType><nodeID>"+a+"</nodeID></properties></message>")};this.processXML=function(a){if(null!=a){C="example";r.ctatdebug("processXML (), tutorType = "+C);r.ctatdebug("No of children"+w.getElementChildren(a).length);var b=new CTATGraphParser,c=b.parseGraph(a,r);E=c.gr;J=c.tracer;a=c.ssm;c=c.sgMsg;r.ctatdebug("sendStartStateMessages() nMsgs "+
a.length+", outputStatus "+F);for(var e=[],f=new XMLSerializer,h=null,l=0;l<a.length;l++)if("message"==w.getElementName(a[l])){var n=f.serializeToString(a[l]),p=CTATMsgType.getMessageType(n);CTATMsgType.UNTUTORED_ACTION!=p&&CTATMsgType.INTERFACE_ACTION!=p||r.setVariablesFromSAI(a[l],w);CTATMsgType.START_STATE_END==p?(d(e),h=n,e.push((new CTATTutoringServiceMessageBuilder).createInterfaceConfigurationEnd()),e.push((new CTATTutorMessageBuilder).createLockWidgetMsg(b.getLockWidget()))):e.push(n)}e.unshift(c);
g(e);b=h;a:{a=[];c=E.getStartNode();e=CTATMsgType.START_STATE_END;f=c.getNodeID();h=null;l=O;O=-1;0>l&&(l=(l=E?E.getStudentStartsHereNode():null)?l.getNodeID():f);l==f?F.transition(e,null):0<l&&(h=E.getNode(l));r.ctatdebug("CTATET.resetGoToState("+e+", null, "+f+") returns "+h);h||F.transition(CTATMsgType.END_GO_TO_STATE,null);e=h;if(null!==c&&null!==e&&c.getNodeID()!=e.getNodeID()){a=E.getBestSubpath(c,e);r.ctatdebug("advanceToStudentStartsHere() path "+a);if(!a)break a;a=a.getSortedLinks();a=r.traceLinks(a);
r.ctatdebug("advanceToStudentStartsHere() results "+a)}e=c=null;0<a.length&&(e=a[a.length-1],a=e.getReportableLink(),null!==a&&(c=a.getNextNode()));r.ctatdebug("advanceToStudentStartsHere() to check for TPA "+c+", "+e);m(c,J.findCurrentState(!1,!1),null,e)}a=[];b&&a.push(b);F.canRestore()||a.push((new CTATTutorMessageBuilder).createMessage(CTATMsgType.PROBLEM_RESTORE_END,null));0<a.length&&r.sendBundle(a);J.setModelInitialized(!0)}r.startWorking()};this.processNools=function(a){var b=new CTATTutorMessageBuilder;
C="rule";B=new CTATRuleTracer("nools",r);B.initEngine(a,function(a,c){r.ctatdebug("nools engine compiled");var e;e=new CTATTutorMessageBuilder;var f=c.suppressStudentFeedback;if(null===f||void 0===f)f=CTATMsgType.SHOW_ALL_FEEDBACK;r.setFeedbackSuppressed(f);var h=c.highlightRightSelection;r.setHighlightRightSelection("false"!=h);var l=c.confirmDone;"true"!==l&&"false"!==l&&(l=f===CTATMsgType.HIDE_ALL_FEEDBACK?"true":"false");f=c.lockWidget;r.setHintPolicy(c.hintPolicy);r.setOutOfOrderMessage(c.outOfOrderMessage);
e=e.createStateGraphMessage("false","false",f,r.isFeedbackSuppressed(),h,l,[]);h=[];d(a);a.push((new CTATTutoringServiceMessageBuilder).createInterfaceConfigurationEnd());a.push(b.createLockWidgetMsg(c.lockWidget));a.unshift(e);g(a);h.push("<message><verb>SendNoteProperty</verb><properties><MessageType>StartStateEnd</MessageType></properties></message>");F.canRestore()||h.push(b.createMessage(CTATMsgType.PROBLEM_RESTORE_END,null));r.sendBundle(h);r.startWorking();r.enqueueForRestore()},function(a){console.log("error starting nools engine: "+
a)},CTATConfiguration.get("use_backtracking"))};this.addGraphSkills=function(a){r.ctatdebug("adding graph skills: "+a.length);0<a.length&&(a=new CTATSkills(a),a.setExternallyDefined(!1),r.getProblemSummary().setSkills(a))};this.sendBundle=function(a){r.ctatdebug("sending bundle #msgs = "+a.length+", outputStatus "+F);for(var b=0,c=0;c<a.length;c++){r.ctatdebug("Sending message #"+c);var d=a[c];0>=c&&(d='<?xml version="1.0" encoding="UTF-8"?>'+d);S.forwardToInterface(d,c>=a.length-1,F)&&++b}return 0<
b};this.setHintPolicy=function(a){K=CTATHintPolicyEnum.lookup(a)};this.isHighlightRightSelection=function(){return M};this.setHighlightRightSelection=function(a){M=a};this.updateSkills=function(a,b,c,d){var e=[];r.ctatdebug("in updateSkills("+b+") with step ID = "+c+", transaction result = "+a+", outputStatus "+r.getOutputStatus()+", actor "+d);if(!r.getOutputStatus().countForProblemSummary()||d&&!/^(student)?$/i.test(d))return e;var f=r.getProblemSummary().getSkills();if(!f)return e;b.forEach(function(b){(b=
f.updateSkill(a,b,c))&&e.push(b)});return e};this.getSessionID=function(){return Y};this.getProblemSummary=function(a){r.ctatdebug("Entering getProblemSummary() problemSummary "+G);if(null===G||"undefined"===typeof G){var b=r.getProblemName();G=null===b||"undefined"===typeof b||1>b.length?new CTATProblemSummary("NoProblemDefined",null,r.isFeedbackSuppressed()):new CTATProblemSummary(b,null,r.isFeedbackSuppressed())}a&&G.setRequiredSteps(a.countStepsForScore(E));return G};this.getProblemName=function(){return U};
this.getSourceID=function(){return P};this.isSourceFlash=function(){return"string"==typeof P&&P.match(/flash/i)};this.isFeedbackSuppressed=function(){return L};this.setFeedbackSuppressed=function(a){L="false"===a?!1:"true"===a?!0:a===CTATMsgType.SHOW_ALL_FEEDBACK?!1:a===CTATMsgType.HIDE_ALL_FEEDBACK?!0:a===CTATMsgType.HIDE_BUT_ENFORCE?!0:a===CTATMsgType.HIDE_BUT_COMPLETE?!0:!1;r.ctatdebug("setFeedbackSuppressed("+a+"): "+L);G&&G.setCountOnlyLastResults(L)};this.getSkillBarVector=function(a,b){var c=
r.getProblemSummary().getSkills();return null===c||"undefined"===typeof c?null:"Student"!=v(b)?null:"undefined"!=typeof a&&a?c.getSkillBarVector(!1,!1):c.getSkillBarVector(!0,!0)};this.startSkillTransaction=function(){var a=r.getProblemSummary().getSkills();a&&a.startTransaction()};this.getProblemStateSaver=function(){return S};this.isSendingSavedMsgsForRestore=function(){return r.getOutputStatus().isSendingSavedMsgsForRestore()};this.getOutputStatus=function(){return F};this.setOutputStatus=function(a){var b=
F.getStatus();r.ctatdebug("setOutputStatus() old "+b+", new "+a);CTATProblemStateStatus[a]?F.setStatus(CTATProblemStateStatus[a]):(console.error("CTATExampleTracer.setOutputStatus() unexpected argument "+a),F.setStatus(CTATProblemStateStatus.empty))};this.getFeedbackPolicy=function(){return E?E.getFeedbackPolicy():CTATMsgType.SHOW_ALL_FEEDBACK};this.getGraph=function(){return E};this.getTracer=function(){return J};this.getOutOfOrderMessage=function(){return H?H:CTATMsgType.DEFAULT_OUT_OF_ORDER_MESSAGE};
this.setOutOfOrderMessage=function(a){H=a};this.getDelayedFeedback=function(){null==ba&&(ba={});return ba};this.clearDelayedFeedback=function(){ba=null};this.getQuestionFile=function(a){if(!I||a)return I;a=I.split("/");return a[a.length-1]};this.addTPAToMessageTank=function(a,b,c,d){r.messageTank.enqueueToolActionToStudent(a,b,c,d)}};CTATExampleTracer.prototype=Object.create(CTATBase.prototype);CTATExampleTracer.prototype.constructor=CTATExampleTracer;
"undefined"!==typeof module&&(module.exports=CTATExampleTracer);
